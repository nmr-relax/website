<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r27012 &#45; /branches/nmrglue/test_suite/system_tests/nmrglue.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 08 Dec 2014 18:02:36 +0100 -->
<!--X-Message-Id: CAED9pY&#45;jzyAM25ogkNVeD4maZ=DCjcWGO+CHdvpE1jS7EuVXeg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XxxcS&#45;00053Z&#45;Nu@subversion.gna.org -->
<!--X-Reference: CAED9pY_mHMH1B8Gz5w_QRqvqrgWa+DXr+nM8F6JaxQnquuZDyg@mail.gmail.com -->
<!--X-Reference: CA+CBx2PDF1JMx5hXO1&#45;wDr0+K=amf5+5zwSitOZ73tqpRA_jUA@mail.gmail.com -->
<!--X-Reference: CAED9pY8oO5zHwwU8KeLVzMHE7CiDaRfCeUOvJLNhCbjBtHtDTg@mail.gmail.com -->
<!--X-Reference: CA+CBx2NWyzF6LgT3i==ZHRhBDh36mferv4w9wikPUF=1B9wGhw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;T006HX2+Hy64LFWvFosKXVV6es6d&#45;C9RaEBM_R3oOMg@mail.gmail.com -->
<!--X-Reference: CA+CBx2Mf9wDVPCroOZ2U7ATSQqa6yJRk0YM=OaPZAsxMDX5DEg@mail.gmail.com -->
<!--X-Reference: CAED9pY_KekL7cXQA&#45;&#45;SvGUCY2ibH9GZiZ_1a0S2Ux=AwnSE6AQ@mail.gmail.com -->
<!--X-Reference: CAED9pY80QZABiXs+YATQYS&#45;FZkN5cY+9446W_Cz2Et9U7XvJow@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py -- December 08, 2014 - 18:02</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00050" class="tabs">Index by Date</a> | <a href="threads.html#00050" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00049.html">Date Prev</a>] [<a href="msg00051.html">Date Next</a>] [<a href="msg00049.html">Thread Prev</a>] [<a href="msg00051.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;,  &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 8 Dec 2014 18:02:05 +0100</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:content-type:content-transfer-encoding; bh=d5IqgMYl2b0+ciZuzP+aY7UrCg54eAlIdjS85duESsA=; b=VUI0VBjR52VM7aTvrDOvA1rf18mHpGBbxnhGDI5LKFYkM8GbcnUqfqURs1h2vaxkMG Cn/UJhJRMKUkIyu7KDaEADm/Qpfy+MkowC6JpPwsDDtUNtlEQVX8JSHXzm3q9x+jzMtD 5xZA+gp+K4slQH6CXVt37xgK70scAba8MzPG2tjSGt+Ua/p1OXupC7+HbMiI7kRhFGvX 3EUu/4ha85Xe5XQG+jmMjxZrLReHnp6NFWy9hhr9umaoqMkNaAcY10g7u8L7GaP/7th6 bbdyQpW0IsNe3UA5KgJheUL0j8xs7FIA64Kz09uiCghXPc+4C1v54DlYUfazsGlXxXYW Rd9Q==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY-jzyAM25ogkNVeD4maZ=DCjcWGO+CHdvpE1jS7EuVXeg@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XxxcS-00053Z-Nu@subversion.gna.org&gt; &lt;<a href="msg00043.html">CAED9pY_mHMH1B8Gz5w_QRqvqrgWa+DXr+nM8F6JaxQnquuZDyg@mail.gmail.com</a>&gt; &lt;CA+CBx2PDF1JMx5hXO1-wDr0+K=amf5+5zwSitOZ73tqpRA_jUA@mail.gmail.com&gt; &lt;<a href="msg00046.html">CAED9pY8oO5zHwwU8KeLVzMHE7CiDaRfCeUOvJLNhCbjBtHtDTg@mail.gmail.com</a>&gt; &lt;CA+CBx2NWyzF6LgT3i==ZHRhBDh36mferv4w9wikPUF=1B9wGhw@mail.gmail.com&gt; &lt;CAED9pY-T006HX2+Hy64LFWvFosKXVV6es6d-C9RaEBM_R3oOMg@mail.gmail.com&gt; &lt;CA+CBx2Mf9wDVPCroOZ2U7ATSQqa6yJRk0YM=OaPZAsxMDX5DEg@mail.gmail.com&gt; &lt;CAED9pY_KekL7cXQA--SvGUCY2ibH9GZiZ_1a0S2Ux=AwnSE6AQ@mail.gmail.com&gt; &lt;<a href="msg00049.html">CAED9pY80QZABiXs+YATQYS-FZkN5cY+9446W_Cz2Et9U7XvJow@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on December 08, 2014 - 18:02:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">I've updated most of the system tests.  However there are two that
show that the software verification tests will fail.  For example:

======================================================================
ERROR: test_plot_contour_cpmg (test_suite.system_tests.nmrglue.Nmrglue)
Test the plot_contour function in pipe_control.
----------------------------------------------------------------------

relax&gt; pipe.create(pipe_name='mf', pipe_type='mf', bundle=None)

relax&gt; spectrum.nmrglue_read(file='128_0_FT.ft2',
dir='/data/relax/branches/nmrglue/test_suite/shared_data/dispersion/repeated_analysis/SOD1/cpmg_disp_sod1d90a_060518/cpmg_disp_sod1d90a_060518_normal.fid/ft2_data',
nmrglue_id='128_0_FT')
Traceback (most recent call last):
  File &quot;/data/relax/branches/nmrglue/test_suite/system_tests/nmrglue.py&quot;,
line 441, in test_plot_contour_cpmg
    self.setup_plot_contour_cpmg(show=False)
  File &quot;/data/relax/branches/nmrglue/test_suite/system_tests/nmrglue.py&quot;,
line 192, in setup_plot_contour_cpmg
    ax = plot_contour(nmrglue_id=sp_id, contour_start=200000.,
contour_num=20, contour_factor=1.20, ppm=True, show=show)
  File &quot;/data/relax/branches/nmrglue/pipe_control/nmrglue.py&quot;, line
158, in plot_contour
    ax = contour_plot(nmrglue_id=nmrglue_id,
contour_start=contour_start, contour_num=contour_num,
contour_factor=contour_factor, ppm=ppm, show=show)
  File &quot;/data/relax/branches/nmrglue/lib/software/nmrglue.py&quot;, line
59, in contour_plot
    dic  = cdp.nmrglue_dic[nmrglue_id]
AttributeError: 'PipeContainer' object has no attribute 'nmrglue_dic'

----------------------------------------------------------------------

Here the lib.software.nmrglue module is not allowed to access the
relax data store, as it must be independent of it.  Instead, simply
pass in the dic, udic and data nmrglue objects from the data store
when needed.

Regards,

Edward





On 8 December 2014 at 17:53, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

It's all done.  It took a while longer than I though.  That was my
fault, as I made the nmrglue objects of the relax data store a lot
more flexible.  Hence the commit is far more complicated than actually
required (<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/24773">http://article.gmane.org/gmane.science.nmr.relax.scm/24773</a>).
You now have:

cdp.nmrglue -&gt; data_store.nmrglue.Nmrglue_dict dictionary instance (it
inherits from data_store.data_classes.RelaxDictType).
cdp.nmrglue[key] -&gt; data_store.nmrglue.Nmrglue instance (it inherits
from data_store.data_classes.Element).
cdp.nmrglue[key].dic -&gt; the nmrglue dic object.
cdp.nmrglue[key].udic -&gt; the nmrglue udic object.
cdp.nmrglue[key].data -&gt; the nmrglue numpy.float32 data object.

The Nmrglue.test_save_state system test now passes.  Have a look at a
relax save file for what is now being created.

Regards,

Edward


On 8 December 2014 at 15:39, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Ok, so I'll start moving things around in your branch.

Regards,

Edward

On 8 December 2014 at 15:37, Troels Emtekær Linnet
&lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">That sound good !

2014-12-08 15:34 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi,

I wouldn't bother with the matplotlib data storage.  If you like, I
could give this 10 minutes of work on the nmrglue branch and have the
Base64 string in XML storage fixed.  The system test is in place
already to implement this, and I know exactly what needs to be done,
so it won't take long.  Then we can keep the numpy format as is.  I'd
probably restore some of your original ideas and have all data in
cdp.nmrglue_data which a dictionary with
data_store.data_classes.Element instances as its elements, and then
write to_xml() and from_xml() methods to handle the numpy data as
Base64 and all other structures are passed to the Element base class
methods.

Regards,

Edward




On 8 December 2014 at 15:19, Troels Emtekær Linnet
&lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I am trying to look at my data now with the plots I have in my mind.

The branch is actually in a state where I can use it.

The only trouble I have, is the storing of the numpy array.

I am actually not planning on saving the state, but will continuously
just
read from the original file.
But since the numpy array is saved in cdp, to get access, then storing
the
state should be possible.

All plots will just be made with matplotlib after the shuffling around
with
the numpy array.

Best
Troels



2014-12-08 15:14 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Troels,

</pre><blockquote class="blockquote"><pre style="margin: 0em;">I think I will have to leave the implementation in relax.
</pre></blockquote><pre style="margin: 0em;">

Would it take much to get the branch in a reasonable state for merging
back?  Even if not everything is implemented?  Well, apart from
bringing in nmrglue 0.5 when that is released.  I'm sure that in the
future some PhD student or postdoc will appreciate and take up what
you have already done and expand on it.  You've already put a lot of
polish on this, so it'd be a pity to not merge it.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Time goes away from pursuing the analysis, and goes into rather
annoying
stuff.
</pre></blockquote><pre style="margin: 0em;">

With coding, it's a bit hard to know what will be quick and what will
take a lot of time.  It's a problem I have too.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The idea is simple.
Load one or two spectrum.
Plot the contour, or histogram.
Or make a correlation plot of the two spectra.

Store the data.
</pre></blockquote><pre style="margin: 0em;">

Storing the data in any other format always takes more effort when
combining data from different sources/software.  But this is pretty
much sorted out for the nmrglue data.  You could even store the
nmrglue data in the relax data store as a Base64 string and a new
variable for the ndarray shape, as a shortcut.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Storing the axis plots is a different question.


<a  rel="nofollow" href="http://stackoverflow.com/questions/7290370/store-and-reload-matplotlib-pyplot-object">http://stackoverflow.com/questions/7290370/store-and-reload-matplotlib-pyplot-object</a>

I cannot actually do it at the moment.
So essentially, it just storing a numpy array
</pre></blockquote><pre style="margin: 0em;">

For matplotlib data, I don't think that storing these data structures
will ever be possible to implement in a compatible way.  The reason is
because matplotlib is too much of a moving target.  They do not have a
stable API!  So I would never recommend that you tackle such a problem
in this way.  That's just asking for pain ;)

There is a much better alternative which would be more compatible with
future matplotlib versions.  And that is that all the information
required to create the matplotlib plot is stored in a pure
data_store.data_classes.Element class container as simple variables
(str, bool, int, float, or a list, tuple or dict of these).  This is
similar to the GUI setting storage.  Then there could be a user
function to recreate the plot using the currently stored settings.
This would work much better.  And it would be orders of magnitude
quicker to implement than working with matplotlib data structures.

Regards,

Edward
</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00051" href="msg00051.html">Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00043" href="msg00043.html">Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00045" href="msg00045.html">Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00046" href="msg00046.html">Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00047" href="msg00047.html">Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00048" href="msg00048.html">Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00049" href="msg00049.html">Re: r27012 - /branches/nmrglue/test_suite/system_tests/nmrglue.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Dec 08 18:20:14 2014</div>  
</body>
</html>
