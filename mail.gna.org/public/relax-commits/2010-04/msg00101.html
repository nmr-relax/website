<!-- MHonArc v2.6.16 -->
<!--X-Subject: r11153 &#45; /1.3/specific_fns/n_state_model.py -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Tue, 27 Apr 2010 17:55:04 +0200 -->
<!--X-Message-Id: E1O6n7o&#45;0006wg&#45;SU@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r11153 - /1.3/specific_fns/n_state_model.py -- April 27, 2010 - 17:55</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r11153 - /1.3/specific_fns/n_state_model.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00101" class="tabs">Index by Date</a> | <a href="threads.html#00101" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00100.html">Date Prev</a>] [<a href="msg00102.html">Date Next</a>] [<a href="msg00100.html">Thread Prev</a>] [<a href="msg00102.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Tue, 27 Apr 2010 15:55:04 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00101.html">E1O6n7o-0006wg-SU@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on April 27, 2010 - 17:55:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Tue Apr 27 17:55:04 2010
New Revision: 11153

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=11153&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=11153&amp;view=rev</a>
Log:
Big bug fixes for the _minimise_setup_pcs() and _minimise_setup_rdcs() 
methods.

This allows the missing data PCS and RDC optimisation system test to pass.  
Many problems were
solved to allow all types of data with anything missing (one spin in one 
alignment, one spin in all
RDC or all PCS lists, or entire RDC or PCS lists for one alignment).


Modified:
    1.3/specific_fns/n_state_model.py

Modified: 1.3/specific_fns/n_state_model.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/1.3/specific_fns/n_state_model.py?rev=11153&amp;r1=11152&amp;r2=11153&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/specific_fns/n_state_model.py?rev=11153&amp;r1=11152&amp;r2=11153&amp;view=diff</a>
==============================================================================
--- 1.3/specific_fns/n_state_model.py (original)
+++ 1.3/specific_fns/n_state_model.py Tue Apr 27 17:55:04 2010
@@ -698,8 +698,8 @@
             if not spin.select:
                 continue
 
-            # Only use spins with PCS data.
-            if not hasattr(spin, 'pcs'):
+            # Only use spins with alignment data.
+            if not hasattr(spin, 'pcs') and not hasattr(spin, 'rdc'):
                 continue
 
             # Add empty lists to the r and unit_vector lists.
@@ -753,7 +753,8 @@
                     if hasattr(spin, 'rdc'):
                         pcs[-1].append(None)
                         pcs_err[-1].append(None)
-                        pcs_const[-1].append(None)
+                        pcs_const[-1].append([None]*cdp.N)
+                        j = j + 1
 
                     # Jump to the next spin.
                     continue
@@ -903,7 +904,7 @@
             if unit_vect[i] == None:
                 unit_vect[i] = [[None, None, None]]*num
 
-        # The PCS data.
+        # The RDC data.
         for align_id in cdp.align_ids:
             # Append empty arrays to the RDC structures.
             rdc.append([])
@@ -925,8 +926,12 @@
                     # Jump to the next spin.
                     continue
 
+                # Defaults of None.
+                value = None
+                error = None
+
                 # Pseudo-atom set up.
-                if hasattr(spin, 'members'):
+                if hasattr(spin, 'members') and align_id in spin.rdc.keys():
                     # Skip non-Me groups.
                     if len(spin.members) != 3:
                         continue
@@ -934,24 +939,30 @@
                     # The RDC for the Me-pseudo spin where:
                     #     &lt;D&gt; = -1/3 Dpar.
                     # See Verdier, et al., JMR, 2003, 163, 353-359.
-                    rdc[-1].append(-3.0 * spin.rdc[align_id])
+                    value = -3.0 * spin.rdc[align_id]
+
+                    # The error.
+                    if hasattr(spin, 'rdc_err') and align_id in 
spin.rdc_err.keys():
+                        error = -3.0 * spin.rdc_err[align_id]
 
                 # Normal spin set up.
-                else:
+                elif align_id in spin.rdc.keys():
                     # The RDC.
-                    rdc[-1].append(spin.rdc[align_id])
-
-                # Append the RDC errors (or a list of None).
-                if hasattr(spin, 'rdc_err'):
-                    rdc_err[-1].append(spin.rdc_err[align_id])
-                else:
-                    rdc_err[-1].append(None)
+                    value = spin.rdc[align_id]
+
+                    # The error.
+                    if hasattr(spin, 'rdc_err') and align_id in 
spin.rdc_err.keys():
+                        error = spin.rdc_err[align_id]
+
+                # Append the RDCs to the list.
+                rdc[-1].append(value)
+
+                # Append the RDC errors.
+                rdc_err[-1].append(error)
 
         # Convert to numpy objects.
         rdc = array(rdc, float64)
         rdc_err = array(rdc_err, float64)
-        for i in range(len(unit_vect)):
-            print unit_vect[i]
         unit_vect = array(unit_vect, float64)
         rdc_const = array(rdc_const, float64)
 



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Apr 27 18:00:02 2010</div>  
</body>
</html>
