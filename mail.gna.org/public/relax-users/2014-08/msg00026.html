<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: field strength off&#45;resonance R1rho constant relax time relaxation dispersion -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Sat, 23 Aug 2014 00:46:50 +0200 -->
<!--X-Message-Id: CA+CBx2Pok+GFuE4ZTuKCmZD0GCUij6FqyUN5PruR6WrVJTGDuw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CAMmADa=s09qKHWv4TUcKMJ_iX=dLygyL95c&#45;6RG5xKxH008EUg@mail.gmail.com -->
<!--X-Reference: CA+CBx2PCeVAexqxY=fn8zOcW8sLgtV2s5ghEi42rx00_B&#45;_B8Q@mail.gmail.com -->
<!--X-Reference: CA+CBx2N3uBGFUK4JvgHOFcCT649fCsOxUxH3JxRNtEWeTQurmw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;Z&#45;&#45;kdfHPyEP7osunX0EjTYkaZD&#45;WyO41gFjnvAE4=og@mail.gmail.com -->
<!--X-Reference: CAMmADan_GNQ2DeD0+cjQx31_87U0JiivEW6hG6vYaSbZFgv8Wg@mail.gmail.com -->
<!--X-Reference: CAMmADakiDBq9RBGM_e0CKeia_fJB=K5+f8rXT2xA=ABO1sNDPg@mail.gmail.com -->
<!--X-Reference: CA+CBx2Mg__D3tEqkxexndVt_37Qb_2VERpcwvm0mif8uKVNpUQ@mail.gmail.com -->
<!--X-Reference: CAED9pY_9NMRd&#45;HYnvB5TyQffCeFHtFV7rPMMj2CG7U4Rgg39OA@mail.gmail.com -->
<!--X-Reference: CAMmADamWoW1Kj=WwPfZGtqU7L&#45;BYKFXgsrdrLxpjzEA6_FjSxA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: field strength off-resonance R1rho constant relax time relaxation dispersion -- August 23, 2014 - 00:46</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: field strength off-resonance R1rho constant relax time relaxation dispersion</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00026" class="tabs">Index by Date</a> | <a href="threads.html#00026" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00025.html">Date Prev</a>] [<a href="msg00027.html">Date Next</a>] [<a href="msg00025.html">Thread Prev</a>] [<a href="msg00027.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Atul Srivastava &lt;asrivast@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Sat, 23 Aug 2014 00:45:54 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-users@xxxxxxx&quot; &lt;relax-users@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type:content-transfer-encoding; bh=ikIfbuBbnv4xXqot1/jFnOPukSV+4lbORwd11BcpVl0=; b=IQDgOYn1eBT7qc9pMaVJvIt8fxVIJhcb82nS0gFiBATwyAVC8b25+Qh+WB9KNVDuNf Ar6diMZYoytJU4ft+G04Yc4subxDIn/+t92nIkEimVAbYPG6POE6hU2ZyAehBOIUFpVH wVcytVeM9b6PQLpuLYKaGuOY2DqH5q5RQsFc3OsDmG/BVroD3onW5iFoMmAqv/lbvD1s wUil6Fg+UER0WLJY3vTdeYDfStH04kltzSN5O80M9komfHzWZvtAPylWbQIiaQJ58P+C O6FlnKsa6K7ZwpjJ7tIPV9NztHMcGyQbJ+a8NKWLRnfECbekMaJhuZGk7SYTwnm53IYx XSPA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00026.html">CA+CBx2Pok+GFuE4ZTuKCmZD0GCUij6FqyUN5PruR6WrVJTGDuw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CAMmADa=s09qKHWv4TUcKMJ_iX=dLygyL95c-6RG5xKxH008EUg@mail.gmail.com&gt; &lt;CA+CBx2PCeVAexqxY=fn8zOcW8sLgtV2s5ghEi42rx00_B-_B8Q@mail.gmail.com&gt; &lt;<a href="msg00009.html">CA+CBx2N3uBGFUK4JvgHOFcCT649fCsOxUxH3JxRNtEWeTQurmw@mail.gmail.com</a>&gt; &lt;CAED9pY-Z--kdfHPyEP7osunX0EjTYkaZD-WyO41gFjnvAE4=og@mail.gmail.com&gt; &lt;<a href="msg00018.html">CAMmADan_GNQ2DeD0+cjQx31_87U0JiivEW6hG6vYaSbZFgv8Wg@mail.gmail.com</a>&gt; &lt;CAMmADakiDBq9RBGM_e0CKeia_fJB=K5+f8rXT2xA=ABO1sNDPg@mail.gmail.com&gt; &lt;<a href="msg00021.html">CA+CBx2Mg__D3tEqkxexndVt_37Qb_2VERpcwvm0mif8uKVNpUQ@mail.gmail.com</a>&gt; &lt;<a href="msg00024.html">CAED9pY_9NMRd-HYnvB5TyQffCeFHtFV7rPMMj2CG7U4Rgg39OA@mail.gmail.com</a>&gt; &lt;CAMmADamWoW1Kj=WwPfZGtqU7L-BYKFXgsrdrLxpjzEA6_FjSxA@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on August 23, 2014 - 00:46:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Dear Atul.

Please use the support tracker when you upload files.
The email list is fragile, and cannot handle email attachment.

I made small modifications to your script.

I normally split them up.

1st script for setup, and printing stuff to check.
2nd script, which just call the previous script, and run analysis.

So, I would:
relax 1_setup_r1rho.py
to check everything.

When I am happy, I just:
relax 2_pre_run_r2eff.py

which call script 1, setup, and then run.

Did you know you can also:
relax 1_setup_r1rho.py -p

This runs the script, and enters terminal. Like &quot;python -i script.py&quot;
Any variable saved in the &quot;cdp&quot; can be accessed.

Try:
relax 1_setup_r1rho.py -p
print cdp.temp

You can also run relax with the debug option &quot;-d&quot;
relax 2_pre_run_r2eff.py -d

This gives more information about where the error is.

Anyway.
The problem seems related to, that you only have one reference
intensity per offset.

----1_setup_r1rho.py
# Python module imports.
from os import sep, getcwd

# relax module imports.
from pipe_control.mol_res_spin import generate_spin_string,
return_spin, spin_loop
from specific_analyses.relax_disp.data import average_intensity,
generate_r20_key, get_curve_type, has_exponential_exp_type,
has_r1rho_exp_type, loop_exp_frq, loop_exp_frq_offset_point,
loop_exp_frq_offset_point_time, loop_time, return_grace_file_name_ini,
return_param_key_from_data

# Set up the data pipe.
#######################

# The path to the data files.
DATA_PATH = getcwd()

# Create the data pipe.
pipe_name = 'base pipe'
pipe_bundle = 'relax_disp'
pipe.create(pipe_name=pipe_name, bundle=pipe_bundle, pipe_type='relax_disp')

# Read the spins from a spectum file instead. This already contain the
spin name.
spectrum.read_spins(file='2100_off_reso_R1rho.list', dir=DATA_PATH)

# Set the isotope information.
spin.isotope(isotope='15N')

# Loop over spins, to see current setup.
for cur_spin, mol_name, resi, resn, spin_id in
spin_loop(full_info=True, return_id=True, skip_desel=True):
    print mol_name, resi, resn, spin_id
    print &quot; &quot;
    print cur_spin

# The spectral data - spectrum ID, peak list file name, spin-lock
field strength (Hz), the spin-lock offset (ppm), the relaxation time
(s), spectrometer frequency (Hz), and experimental error (RMSD of the
base plane noise for each spectrum).
data = [
    ['ref_off_reso_R1rho', 'ref_off_reso_R1rho.list', None, 150.87,
0.320,  900.21422558574e6, 90000.0],
    ['2100_off_reso_R1rho', '2100_off_reso_R1rho.list', 1500.0,
141.01, 0.320,  900.21422558574e6, 90000.0],
    ['2728_off_reso_R1rho', '2728_off_reso_R1rho.list', 1500.0,
147.89, 0.320,  900.21422558574e6, 90000.0],
    ['3357_off_reso_R1rho', '3357_off_reso_R1rho.list', 1500.0,
154.78, 0.320,  900.21422558574e6, 90000.0],
    ['3985_off_reso_R1rho', '3985_off_reso_R1rho.list', 1500.0,
161.66, 0.320,  900.21422558574e6, 90000.0],
    ['4614_off_reso_R1rho', '4614_off_reso_R1rho.list', 1500.0,
168.55, 0.320,  900.21422558574e6, 90000.0],
    ['5242_off_reso_R1rho', '5242_off_reso_R1rho.list', 1500.0,
175.43, 0.320,  900.21422558574e6, 90000.0],
    ['5871_off_reso_R1rho', '5871_off_reso_R1rho.list', 1500.0,
182.32, 0.320,  900.21422558574e6, 90000.0],
    ['6500_off_reso_R1rho', '6500_off_reso_R1rho.list', 1500.0,
189.21, 0.320,  900.21422558574e6, 90000.0]
]

# Loop over the spectra.
for id, file, field, offset, relax_time, H_frq, rmsd in data:
    print(&quot;\n###############&quot;)
    print(&quot;id=%s, field=%s, offset=%3.2f, time=%1.3f, frq=%3.1f,
rmsd=%3.2f&quot; % (id, field, offset, relax_time, H_frq/1e6, rmsd) )

    # Load the peak intensities and set the errors.
    spectrum.read_intensities(file=file, dir=DATA_PATH,
spectrum_id=id, int_method='height')
    spectrum.baseplane_rmsd(spectrum_id=id, error=rmsd)

    # Set the relaxation dispersion experiment type.
    relax_disp.exp_type(spectrum_id=id, exp_type='R1rho')

    # Set the relaxation dispersion spin-lock field strength (nu1).
    relax_disp.spin_lock_field(spectrum_id=id, field=field)

    # Set the spin-lock offset.
    relax_disp.spin_lock_offset(spectrum_id=id, offset=offset)

    # Set the relaxation times (in s).
    relax_disp.relax_time(spectrum_id=id, time=relax_time)

    # Set the NMR field strength of the spectrum.
    spectrometer.frequency(id=id, frq=H_frq)

# Load the R1 data.
relax_data.read(ri_id='R1', ri_type='R1', frq=H_frq,
file='R1_relax.out', dir=DATA_PATH, mol_name_col=1, res_num_col=2,
res_name_col=3, spin_num_col=4, spin_name_col=5, data_col=6,
error_col=7)

# Read the chemical shift data.
chemical_shift.read(file='2100_off_reso_R1rho.list', dir=DATA_PATH)

# Loop over spins, to see current setup.
for cur_spin, mol_name, resi, resn, spin_id in
spin_loop(full_info=True, return_id=True, skip_desel=True):
    print mol_name, resi, resn, spin_id
    print &quot; &quot;
    print cur_spin

print &quot; &quot;

# Loop over setup.
for id in cdp.exp_type.keys():
    print id, cdp.exp_type[id], cdp.spectrometer_frq[id],
cdp.spin_lock_offset[id], cdp.spin_lock_nu1[id]

print &quot;&quot;

cdp.temp = []

for exp_type, frq, offset, point, ei, mi, oi, di in
loop_exp_frq_offset_point(return_indices=True):
    for time, ti in loop_time(exp_type=exp_type, frq=frq,
offset=offset, point=point, return_indices=True):
        print exp_type, frq, offset, point, time
        cdp.temp.append([exp_type, frq, offset, point, time])

------2_pre_run_r2eff.py
# Python module imports.
from os import sep, getcwd

# relax module imports.
from auto_analyses.relax_disp import Relax_disp

# Analysis variables.
#####################

# The dispersion models.
MODELS = ['R2eff']

# The grid search size (the number of increments per dimension).
GRID_INC = 11

# The number of Monte Carlo simulations to be used for error analysis
at the end of the analysis.
MC_NUM = 10

# A flag which if True will activate Monte Carlo simulations for all
models.  Note this will hugely increase the computation time.
MC_SIM_ALL_MODELS = False

# The results directory.
RESULTS_DIR = getcwd() + sep + 'results_T'

# The directory of results of an earlier analysis without clustering.
PRE_RUN_DIR = None

# The model selection technique to use.
MODSEL = 'AIC'

# The flag for only using numeric models in the final model selection.
NUMERIC_ONLY = False

# The R1rho value in rad/s by which to judge insignificance.  If the
maximum difference between two points on all dispersion curves for a
spin is less than this value, that spin will be deselected.
INSIGNIFICANCE = 1.0

# Run the setup script
script('1_setup_r1rho.py')

pipe_name = 'base pipe'
pipe_bundle = 'relax_disp'

# Auto-analysis execution.
##########################
# Do not change!
Relax_disp(pipe_name=pipe_name, pipe_bundle=pipe_bundle,
results_dir=RESULTS_DIR, models=MODELS, grid_inc=GRID_INC,
mc_sim_num=MC_NUM, modsel=MODSEL, insignificance=INSIGNIFICANCE,
numeric_only=NUMERIC_ONLY)

2014-08-22 23:01 GMT+02:00 Atul Srivastava &lt;asrivast@xxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Dear Edward,

Thanks for providing help and insights. I used an improved script. The
scripts is able to calculate the R2eff and the omegaeffective properly, but
it is not able to fit any model. It also sees dispersion point as a constant
1500 Hz (see attached file in results/R2eff/disp_55_N.out).

I have attached all sample data, script and results for your review. Please
see the last few lines in the log file for the error message.

Thanks,
Atul




On Fri, Aug 22, 2014 at 3:02 AM, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Atul,

Again continuing from Troels' post at
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.user/1718/focus=1732">http://thread.gmane.org/gmane.science.nmr.relax.user/1718/focus=1732</a>.
Well, actually, as Troels fully covered all of you questions in more
detail than I could have provided, I don't have anything to add.  If
you have other questions, please don't hesitate to ask.

Regards,

Edward


On 21 August 2014 12:00, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;
wrote:

[snip]

</pre><blockquote class="blockquote"><pre style="margin: 0em;">relax_disp.relax_time(spectrum_id=id, time=relax_time)
-&gt; This is used for the initial R2eff calculation, for exponential
curve fitting.

# Set the NMR field strength of the spectrum.
spectrometer.frequency(id=id, frq=H_frq)
-&gt; This is used for conversion between nucleus, etc.

# Load the R1 data.
relax_data.read(ri_id='500MHz', ri_type='R1', frq=500e6,
file='R1_500MHz.out', dir=DATA_PATH, mol_name_col=1, res_num_col=2,
res_name_col=3, spin_num_col=4, spin_name_col=5, data_col=6,
error_col=7)
-&gt; R1 needs to be loaded. This is because that R1 is part of the
equations. :-) The next release of relax, will implement feature where
R1 is fitted.
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Note, that fitting introduces another variable in the equations.
</pre></blockquote><pre style="margin: 0em;">

# Read the chemical shift data.
chemical_shift.read(file='ref_500MHz.list', dir=DATA_PATH)

-&gt; This is needed to get the ppm position of the nucleus.
-&gt; See now:
<a  rel="nofollow" href="http://www.nmr-relax.com/manual/Dispersion_model_summary.html">http://www.nmr-relax.com/manual/Dispersion_model_summary.html</a>
-&gt; The &quot;average resonance in the rotating frame&quot; Omega(bar) = w_(bar) -
w_rf.&quot;
-&gt; Here w_bar is the chemical shift, and w_rf is the offset.
-&gt; Let is review figure Fig1_Palmer_Massi_2006.png
-&gt; This is the S_z axis.

That should be it.

If you have any questions, please don't hesitate to write again.

If you need more help, consider writing a support request on the
homepage tracker.
- <a  rel="nofollow" href="https://gna.org/support/?group=relax">https://gna.org/support/?group=relax</a>

Add following information:
# Please attach a system info file
</pre><blockquote class="blockquote"><pre style="margin: 0em;">relax -i -t relax_i.txt
</pre></blockquote><pre style="margin: 0em;">

# Please write up, which buttons you pushed, or attach your script.
# Consider adding your data in &quot;sample&quot; format. Meaning that you
delete all confidential information from the files, and only have 1-2
residues left for testing.

If you write such a support request, it it easier to share script files,
and
help other users.

The benefits from such a support request is:
  - The information is available to all users, which can benefit
others in same situation.
  - The information can be tracked back.
  - The relax manual can be expanded, to help future users in same
situation.


Good luck!

Best
Troels Emtekær Linnet
PhD student
Copenhagen University
SBiNLab, 3-0-41
Ole Maaloes Vej 5
2200 Copenhagen N
Tlf: +45 353-22083
Lync Tlf: +45 353-30195
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00007" href="msg00007.html">field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Atul Srivastava</li></ul></li>
<li><strong><a name="00008" href="msg00008.html">Re: field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00009" href="msg00009.html">Re: field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00015" href="msg00015.html">Re: field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00018" href="msg00018.html">Re: field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Atul Srivastava</li></ul></li>
<li><strong><a name="00020" href="msg00020.html">Re: field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Atul Srivastava</li></ul></li>
<li><strong><a name="00021" href="msg00021.html">Re: field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00024" href="msg00024.html">Re: field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00025" href="msg00025.html">Re: field strength off-resonance R1rho constant relax time relaxation dispersion</a></strong>
<ul><li><em>From:</em> Atul Srivastava</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Sat Aug 23 10:00:24 2014</div>  
</body>
</html>
