<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r23147 &#45; /trunk/lib/numpy_future.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Sat, 10 May 2014 14:55:19 +0200 -->
<!--X-Message-Id: CAED9pY&#45;6hob&#45;1ud9bqzEA_NOpLvzHty&#45;PobK1O36W86iy0i2zQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Wj2J1&#45;0008Ce&#45;7t@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r23147 - /trunk/lib/numpy_future.py -- May 10, 2014 - 14:55</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r23147 - /trunk/lib/numpy_future.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00292" class="tabs">Index by Date</a> | <a href="threads.html#00292" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00291.html">Date Prev</a>] [<a href="msg00293.html">Date Next</a>] [<a href="msg00290.html">Thread Prev</a>] [<a href="msg00299.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Sat, 10 May 2014 14:54:29 +0200</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:content-type; bh=1PZ6v5ihQfGRSBFzJF9CUmzaxXCJyYlNaF4YxYC6KkA=; b=Hw9DQsQk94Fm4EPBHzA+STeN66c+dLixyACJnnPCSx20HvDEGCSv/lt8Qq/O58vHiy 92YOG2ZsVvyL5tLEQQDo1ytjJT93XeAiJEjWrlAch/wu+9f+hvucIM858UewjQqbRG27 K6iNe7LWp5iEIbXMplMe6RplUrqVr5nSH7tAt5X2ObCSPF2GMPun6s5ZIDgPsQUhQm0S aL6nZHAIUl+SGjvIFxBYt8v6Wm9MS+sJSHm370aQiK9NAT+q0rk4shkCzs+WmDWtZy/o qaYqjC/9EHl6FRKWmyTrhagbigAswg/IEOqXswbkMvoI5RoGoAQ74/+pf0IjTnwzh05Q IjPg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00292.html">CAED9pY-6hob-1ud9bqzEA_NOpLvzHty-PobK1O36W86iy0i2zQ@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Wj2J1-0008Ce-7t@subversion.gna.org&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on May 10, 2014 - 14:55:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

This will do the trick!  I would suggest that this module be shifted
into the 'extern' package.  This is a special package for external
software or code that is bundled with relax, when the licence so
allows, so this numpy code will fit in quite well there.  If you go
back into relax's history, you'll see that we used to include some
ScientificPython code there (see
<a  rel="nofollow" href="http://dirac.cnrs-orleans.fr/plone/software/scientificpython/">http://dirac.cnrs-orleans.fr/plone/software/scientificpython/</a>).  The
original PDB reading in relax was using the ScientificPython PDB
reader as it is far, far more advanced than the SciPy one, but then I
wrote a much faster internal reader for relax for some projects where
I needed to load many millions of PDB files quickly
(<a  rel="nofollow" href="http://www.nmr-relax.com/refs.html#Sun11">http://www.nmr-relax.com/refs.html#Sun11</a> -
<a  rel="nofollow" href="http://dx.doi.org/10.1002/chem.201002520">http://dx.doi.org/10.1002/chem.201002520</a>;
<a  rel="nofollow" href="http://www.nmr-relax.com/refs.html#Erdelyi11">http://www.nmr-relax.com/refs.html#Erdelyi11</a> -
<a  rel="nofollow" href="http://dx.doi.org/10.1002/chem.201100854">http://dx.doi.org/10.1002/chem.201100854</a>).  The internal PDB reader in
the end was more advanced and much faster than the ScientificPython
one, so in the end I deleted the ScientificPython code bundled with
relax (<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/16880">http://article.gmane.org/gmane.science.nmr.relax.scm/16880</a>).

Cheers,

Edward

On 10 May 2014 10:06,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Sat May 10 10:06:50 2014
New Revision: 23147

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=23147&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=23147&amp;view=rev</a>
Log:
Added lib/numpy_future.py.

This module is for implementing numpy function code from higher versions of 
numpy.

The relax dependencies listed at the download page of relax:
<a  rel="nofollow" href="http://www.nmr-relax.com/download.html#Source_code_release">http://www.nmr-relax.com/download.html#Source_code_release</a>
currently only requires Numpy v. 1.0.4.

task #7792: (<a  rel="nofollow" href="https://gna.org/task/?7792">https://gna.org/task/?7792</a>) Make the dx.map write suggest chi 
surface values.

Added:
    trunk/lib/numpy_future.py

Added: trunk/lib/numpy_future.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/numpy_future.py?rev=23147&amp;view=auto">http://svn.gna.org/viewcvs/relax/trunk/lib/numpy_future.py?rev=23147&amp;view=auto</a>
==============================================================================
--- trunk/lib/numpy_future.py   (added)
+++ trunk/lib/numpy_future.py   Sat May 10 10:06:50 2014
@@ -0,0 +1,178 @@
+#####################################################################################################################################################
+#                                                                          
                                                                         #
+# Copyright (c) 2005-2013, NumPy Developers.                               
                                                                           #
+#                                                                          
                                                                         #
+# All rights reserved.                                                     
                                                                         #
+#                                                                          
                                                                         #
+# Redistribution and use in source and binary forms, with or without 
modification, are permitted provided that the following conditions are met: 
   #
+#                                                                          
                                                                         #
+#   1. Redistributions of source code must retain the above copyright 
notice, this list of conditions and the following disclaimer.               
  #
+#   2. Redistributions in binary form must reproduce the above copyright 
notice, this list of conditions                                            #
+#      and the following disclaimer in the documentation and/or other 
materials provided with the distribution.                                   
  #
+#   3. Neither the name of the NumPy Developers nor the names of any 
contributors may be used to endorse or promote products derived from this   
   #
+#      software without specific prior written permission.                 
                                                                         #
+#                                                                          
                                                                         #
+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS 
IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT             #
+# LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A 
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT        #
+# OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, 
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT            
#
+# LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON           
#
+# ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT 
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE     #
+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.     
                                                                         #
+#                                                                          
                                                                         #
+# The full license for NumPy is provided at: 
<a  rel="nofollow" href="http://www.numpy.org/license.html">http://www.numpy.org/license.html</a>.                                          
                           #
+# This license is known under the terms: 3-clause license (&quot;Revised BSD 
License&quot;, &quot;New BSD License&quot;, or &quot;Modified BSD License&quot;).                    
#
+# This can be found here: <a  rel="nofollow" href="http://opensource.org/licenses/BSD-3-Clause">http://opensource.org/licenses/BSD-3-Clause</a>      
                                                                         #
+#                                                                          
                                                                         #
+####################################################################################################################################################
+
+# Module docstring.
+&quot;&quot;&quot;Module for implementing numpy function code from higher versions of 
numpy. The relax dependencies listed at
+U{the download page of 
relax&lt;<a  rel="nofollow" href="http://www.nmr-relax.com/download.html#Source_code_release">http://www.nmr-relax.com/download.html#Source_code_release</a>&gt;}, 
currently only requires 1.0.4.&quot;&quot;&quot;
+
+# Python module imports.
+import numpy as np
+from numpy import add, array, isscalar, sort
+
+#####################################################################
+# This is from source code of Numpy v. 1.6.1.                       #
+#####################################################################
+
+def percentile(a, q, axis=None, out=None, overwrite_input=False):
+    &quot;&quot;&quot;
+    Compute the qth percentile of the data along the specified axis.
+
+    Returns the qth percentile of the array elements.
+
+    Parameters
+    ----------
+    a : array_like
+        Input array or object that can be converted to an array.
+    q : float in range of [0,100] (or sequence of floats)
+        Percentile to compute which must be between 0 and 100 inclusive.
+    axis : int, optional
+        Axis along which the percentiles are computed. The default (None)
+        is to compute the median along a flattened version of the array.
+    out : ndarray, optional
+        Alternative output array in which to place the result. It must
+        have the same shape and buffer length as the expected output,
+        but the type (of the output) will be cast if necessary.
+    overwrite_input : bool, optional
+       If True, then allow use of memory of input array `a` for
+       calculations. The input array will be modified by the call to
+       median. This will save memory when you do not need to preserve
+       the contents of the input array. Treat the input as undefined,
+       but it will probably be fully or partially sorted.
+       Default is False. Note that, if `overwrite_input` is True and the
+       input is not already an array, an error will be raised.
+
+    Returns
+    -------
+    pcntile : ndarray
+        A new array holding the result (unless `out` is specified, in
+        which case that array is returned instead).  If the input contains
+        integers, or floats of smaller precision than 64, then the output
+        data-type is float64.  Otherwise, the output data-type is the same
+        as that of the input.
+
+    See Also
+    --------
+    mean, median
+
+    Notes
+    -----
+    Given a vector V of length N, the qth percentile of V is the qth ranked
+    value in a sorted copy of V.  A weighted average of the two nearest
+    neighbors is used if the normalized ranking does not match q exactly.
+    The same as the median if ``q=0.5``, the same as the minimum if ``q=0``
+    and the same as the maximum if ``q=1``.
+
+    Examples
+    --------
+    &gt;&gt;&gt; a = np.array([[10, 7, 4], [3, 2, 1]])
+    &gt;&gt;&gt; a
+    array([[10,  7,  4],
+           [ 3,  2,  1]])
+    &gt;&gt;&gt; np.percentile(a, 50)
+    3.5
+    &gt;&gt;&gt; np.percentile(a, 0.5, axis=0)
+    array([ 6.5,  4.5,  2.5])
+    &gt;&gt;&gt; np.percentile(a, 50, axis=1)
+    array([ 7.,  2.])
+
+    &gt;&gt;&gt; m = np.percentile(a, 50, axis=0)
+    &gt;&gt;&gt; out = np.zeros_like(m)
+    &gt;&gt;&gt; np.percentile(a, 50, axis=0, out=m)
+    array([ 6.5,  4.5,  2.5])
+    &gt;&gt;&gt; m
+    array([ 6.5,  4.5,  2.5])
+
+    &gt;&gt;&gt; b = a.copy()
+    &gt;&gt;&gt; np.percentile(b, 50, axis=1, overwrite_input=True)
+    array([ 7.,  2.])
+    &gt;&gt;&gt; assert not np.all(a==b)
+    &gt;&gt;&gt; b = a.copy()
+    &gt;&gt;&gt; np.percentile(b, 50, axis=None, overwrite_input=True)
+    3.5
+
+    &quot;&quot;&quot;
+    a = np.asarray(a)
+
+    if q == 0:
+        return a.min(axis=axis, out=out)
+    elif q == 100:
+        return a.max(axis=axis, out=out)
+
+    if overwrite_input:
+        if axis is None:
+            sorted = a.ravel()
+            sorted.sort()
+        else:
+            a.sort(axis=axis)
+            sorted = a
+    else:
+        sorted = sort(a, axis=axis)
+    if axis is None:
+        axis = 0
+
+    return _compute_qth_percentile(sorted, q, axis, out)
+
+
+#####################################################################
+# This is from source code of Numpy v. 1.6.1.                       #
+#####################################################################
+
+# handle sequence of q's without calling sort multiple times
+def _compute_qth_percentile(sorted, q, axis, out):
+    if not isscalar(q):
+        p = [_compute_qth_percentile(sorted, qi, axis, None)
+             for qi in q]
+
+        if out is not None:
+            out.flat = p
+
+        return p
+
+    q = q / 100.0
+    if (q &lt; 0) or (q &gt; 1):
+        raise ValueError, &quot;percentile must be either in the range [0,100]&quot;
+
+    indexer = [slice(None)] * sorted.ndim
+    Nx = sorted.shape[axis]
+    index = q*(Nx-1)
+    i = int(index)
+    if i == index:
+        indexer[axis] = slice(i, i+1)
+        weights = array(1)
+        sumval = 1.0
+    else:
+        indexer[axis] = slice(i, i+2)
+        j = i + 1
+        weights = array([(j - index), (index - i)],float)
+        wshape = [1]*sorted.ndim
+        wshape[axis] = 2
+        weights.shape = wshape
+        sumval = weights.sum()
+
+    # Use add.reduce in both cases to coerce data type as well as
+    #   check and use out array.
+    return add.reduce(sorted[indexer]*weights, axis=axis, out=out)/sumval


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu May 29 19:00:16 2014</div>  
</body>
</html>
