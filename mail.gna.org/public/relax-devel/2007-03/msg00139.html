<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: how to parallelise model_free minimise -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneq.qnhiretarNtznvy.pbz> -->
<!--X-Date: Tue, 27 Mar 2007 18:08:01 +0200 -->
<!--X-Message-Id: 7f080ed10703270907h3e882251v6b66b329ecfeb910@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7f080ed10703191030h79036e06w56912aa1d9130f48@mail.gmail.com -->
<!--X-Reference: 7f080ed10703200727l5fad8e72if4cf9aff74bc21@mail.gmail.com -->
<!--X-Reference: 45FFF714.7070903@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703200813x323ec212l471796641855a7ff@mail.gmail.com -->
<!--X-Reference: 4603EA08.60801@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703252217x7db43e6bxfe7324ad0379c778@mail.gmail.com -->
<!--X-Reference: 4607F0AB.6000807@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703261002i7cc384a6n8bf20be7aaad4e0e@mail.gmail.com -->
<!--X-Reference: f001463a0703270015n76d1b728m749f70fba54d8213@mail.gmail.com -->
<!--X-Reference: f001463a0703270022iec6830fs2aec68f942d16cb2@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: how to parallelise model_free minimise -- March 27, 2007 - 18:08</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: how to parallelise model_free minimise</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00139" class="tabs">Index by Date</a> | <a href="threads.html#00139" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00138.html">Date Prev</a>] [<a href="msg00140.html">Date Next</a>] [<a href="msg00138.html">Thread Prev</a>] [<a href="msg00144.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;gary thompson&quot; &lt;garyt@xxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 28 Mar 2007 02:07:07 +1000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: a=rsa-sha1; c=relaxed/relaxed; d=gmail.com; s=beta;	h=domainkey-signature:received:received:message-id:date:from:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;	b=It945LG1Fhz4tIa+fecnxKAF07KbkdKGB38Nv+AtOLcJowI7RZOXjql9HmncUAFX995jXdSRYyohvKtIEsxtAZE5xboaKEHLWYskpa74hy04EeqjQkrgrPRNpYEGD7KBBcoiexz/4LdCbUE6J+ul5awDC5H88MTPFeDDpJdHLnc=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00139.html">7f080ed10703270907h3e882251v6b66b329ecfeb910@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00092.html">7f080ed10703191030h79036e06w56912aa1d9130f48@mail.gmail.com</a>&gt;	&lt;<a href="msg00110.html">7f080ed10703200727l5fad8e72if4cf9aff74bc21@mail.gmail.com</a>&gt;	&lt;<a href="msg00112.html">45FFF714.7070903@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00114.html">7f080ed10703200813x323ec212l471796641855a7ff@mail.gmail.com</a>&gt;	&lt;<a href="msg00124.html">4603EA08.60801@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00126.html">7f080ed10703252217x7db43e6bxfe7324ad0379c778@mail.gmail.com</a>&gt;	&lt;<a href="msg00128.html">4607F0AB.6000807@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00129.html">7f080ed10703261002i7cc384a6n8bf20be7aaad4e0e@mail.gmail.com</a>&gt;	&lt;<a href="msg00131.html">f001463a0703270015n76d1b728m749f70fba54d8213@mail.gmail.com</a>&gt;	&lt;<a href="msg00133.html">f001463a0703270022iec6830fs2aec68f942d16cb2@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on March 27, 2007 - 18:08:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>On 3/27/07, gary thompson &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">On 3/26/07, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
&gt; On 3/27/07, Gary S. Thompson &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:
</pre></blockquote><pre style="margin: 0em;"><br>[snip]</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">&gt; &gt; e.g.it would be nice to have
&gt; &gt;
&gt; &gt; for residue in  all residues:
&gt; &gt;     for model in models:
&gt; &gt;              do_stuff-(tm)
&gt; &gt;
&gt; &gt;
&gt; &gt; as opposed to
&gt; &gt;
&gt; &gt; for model in models: #currently at the user level
&gt; &gt;     for residue in  all residues:
&gt; &gt;              do_stuff-(tm)
&gt; &gt;
&gt; &gt; now that might need something of the form
&gt; &gt;
&gt; &gt;         # Set the run names (also the names of preset model-free models).
&gt; &gt;         if local_tm:
&gt; &gt;             self.runs = ['tm0', 'tm1', 'tm2', 'tm3', 'tm4', 'tm5',
&gt; &gt; 'tm6', 'tm7', 'tm8', 'tm9']
&gt; &gt;         else:
&gt; &gt;             self.runs = ['m0', 'm1', 'm2', 'm3', 'm4', 'm5', 'm6', 'm7',
&gt; &gt; 'm8', 'm9']
&gt; &gt;
&gt; &gt; run.create_composite('super')
&gt; &gt; for name in self.runs:
&gt; &gt;
&gt; &gt;     run.create(name, 'mf')
&gt; &gt;     composite_add('super',name)
&gt; &gt;     minimise('newton', run='super')
&gt; &gt;
&gt; &gt;
&gt; &gt; which would minimise all runs in parallel...
&gt; &gt;
&gt; &gt; and I understand from chris that we are planning to do
&gt; &gt;
&gt; &gt;
&gt; &gt;        # Set the run names (also the names of preset model-free models).
&gt; &gt;         if local_tm:
&gt; &gt;             self.runs = ['tm0', 'tm1', 'tm2', 'tm3', 'tm4', 'tm5',
&gt; &gt; 'tm6', 'tm7', 'tm8', 'tm9']
&gt; &gt;         else:
&gt; &gt;             self.runs = ['m0', 'm1', 'm2', 'm3', 'm4', 'm5', 'm6', 'm7',
&gt; &gt; 'm8', 'm9']
&gt; &gt;
&gt; &gt;
&gt; &gt;      minimise('newton', runs=self.runs)
&gt; &gt;
&gt; &gt;
&gt; &gt; which would also work
&gt; &gt;
&gt; &gt;
&gt; &gt; now comes the tricky bit
&gt; &gt;
&gt; &gt;
&gt; &gt; all the minimisations etc would now become rfnctions to setup
&gt; &gt; minimsations and say submit them to a queue with a suitable object to
&gt; &gt; allow the results to be sorted out later.
&gt; &gt;
&gt; &gt; then at the end of minimise('newton', runs=self.runs) you would collect
&gt; &gt; in all the results from all calculations and complete the calculation so
&gt; &gt; we have something like
&gt; &gt;
&gt; &gt; for residue
&gt; &gt;     for run in runs:
&gt; &gt;        calculation-instance = setup-calculation(residue,run)
&gt; &gt;        queue.submit(calculation-instance)
&gt; &gt; while(queue.not_complete()):
&gt; &gt;     result.queue.get_result()
&gt; &gt;     result.record(self.reax.data)
&gt; &gt;
&gt; &gt; This will allow the maximum numer of calculations to be conducted in
&gt; &gt; parallel and will intrisically load balance as well as we can get
&gt;
&gt; There are a number of very important issues with this approach.  The
&gt; most important is that the loop over the data pipes corresponding to
&gt; the model-free models (the 'runs') is deliberately not part of the
&gt; relax codebase.  In Chris' implementation of the 'runs' argument
&gt; (which will need to be renamed) the loop will be at the highest level
&gt; of the code so that for the generic_fns.minimise code onwards nothing
&gt; changes.  This high level loop would probably be a very difficult
&gt; target for MPI as the whole relax data storage object will need to be
&gt; sent between nodes.  This multi-megabyte transfer per node, per
&gt; calculation is not ideal.
&gt;
no you wouldn't have to if put the whole thing over the wire as long
as you add calculations to do to a queue at the low level and then
requested the calculations  be completed at the end  of the high level
function. In the end of it the user and program see no difference its
a bit like how an optimising compiler works I guess....
</pre></blockquote><pre style="margin: 0em;"><br>I'm not talking about your suggested implementation but Chris'
implementation (the runs argument) which we have already decided upon.
Your suggestion affects this decision (as well as the whole relax UI,
I'll get to this later).</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">&gt; Secondly, and very importantly, relax doesn't loop over residues in
&gt; the model-free minimise() function.  relax loops over minimisation
&gt; instances.  For the 'mf' and 'local_tm' parameter sets, this is a loop
&gt; over the spin systems (i.e. molecules first, residues second, and spin
&gt; systems last).  For the 'diff' and 'all' parameters sets the number of
&gt; minimisation instances is one and hence the loop runs once and then
&gt; that's it.  Looping over these followed by looping over the data pipes
&gt; (ex-runs) is insane!  That is essentially first looping over the
&gt; finest grained level followed by the coarsest.</pre><br>
<pre style="margin: 0em;">I do not quite follow where the insanity comes from ;-)</pre><br>
<pre style="margin: 0em;">It is not problem...  What is required is to pass as few chunks of
data with the largest size and best balance of computations over the
wire...  Essentially  I want to (effectively, not literally) build a
list of residues and divide the residues out roughly by processor and
then find all the models required for each residue set them up the
whole set of calculations chunk the whole list by the number of
processors say *3 and then put all these calculations on a queue then
collect the results and put the results where they need to be.
Basically i am saying that in many cases minimisation instances and
runs are disjoint sets and so can be calculated at the same time e.g.
the result of residue3 run tm0 does not affect the result of residue 3
tm1 etc ....
</pre></blockquote><pre style="margin: 0em;"><br>The insanity is from the fact that the suggestion of the looping over
residues first and then looping over the data pipes breaks the most
fundamental premise of the relax UI (user interface) design - the data
pipes and how the user interacts with them.  I cannot stress how bad
this is!</pre><br>
<pre style="margin: 0em;">It's important to note the difference in terminology we are using.
Rather than 'residue' I will use 'spin system'.  In the suggestion you
are only looking at the 'mf' and 'local_tm' parameter sets and hence
instead of 'looping over residues' I will use 'main loop' of the
model-free minimise() function (and 'minimisation instances' instead
of 'individual residue').  Importantly that allows for the 'all' and
'diff' parameter sets (or mathematical model).</pre><br>
<pre style="margin: 0em;">There is no computational benefit from looping over minimisation
instances first and then the data pipes (when compared to looping over
the data pipes followed by looping over the minimisation instances).
There may be slight inter-node communication benefits for MPI by not
having to send the same spin system specific data repeatedly for each
model-free model.  Actually I'll take that back because the user is
free to have non-identical data for the same spin system in different
data pipes.  I cannot see communication as a factor which will affect
the speed of the cluster.  The minimisation itself is the limiting
factor.  In the case of the very simple model-free models in which the
calculations are fast, the communication between nodes will be the
limiting factor.  But these are so fast that the calculations and
communications will be over before you know it.  Compared to the
complex double motion model-free models, optimising MPI for these
models is a waste of time.</pre><br>
<pre style="margin: 0em;">All of these problems go away if the parallelisation of the
minimisation of model-free models does not occur at this point.  I see
no benefit in the parallelisation of the optimisation of the
model-free models in the 'mf' and 'local_tm' parameter sets.  This is
because if the main loop over the minimisation instances is targeted,
you will almost never have idle nodes during optimisation.</pre><br>
<pre style="margin: 0em;">As for sending a number of spin systems to a single node to execute a
couple of optimisations, how would this be of benefit?  The inter-node
communication overhead will still be the same.  The optimisations will
occur in series and hence I can't see a computational advantage.</pre><br>
<pre style="margin: 0em;">I really see fundamental problems with the integration of the design
of this proposal and the design of relax.  If the looping over data
pipes at the lowest level is removed, then I am happy with the design.
There are many cases where there is only one data pipe optimisation
where this loop is not used.  I do however question the computational
or communicational benefits of sending data for a number of spin
systems simultaneously to a single node.  I am going to put my foot
down and say that I will not accept this reversal of the core relax UI
design into the main line.</pre><br>
<pre style="margin: 0em;">Regards,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00144" href="msg00144.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> gary thompson</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00092" href="msg00092.html">relax and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00110" href="msg00110.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00112" href="msg00112.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00114" href="msg00114.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00124" href="msg00124.html">how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00126" href="msg00126.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00128" href="msg00128.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00129" href="msg00129.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00131" href="msg00131.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> gary thompson</li></ul></li>
<li><strong><a name="00133" href="msg00133.html">Fwd: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> gary thompson</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Mar 27 21:24:00 2007</div>  
</body>
</html>
