<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor? -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 20 May 2014 11:53:58 +0200 -->
<!--X-Message-Id: CA+CBx2Pt5q2E0tnvhxq2ocY2NqYmiB1jqqb61M5cBZXeywtYPg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140520&#45;000356.sv20529.92877@gna.org -->
<!--X-Reference: 20140520&#45;000436.sv20529.46737@gna.org -->
<!--X-Reference: CAED9pY9dgTO=XEMitiXkucSttRHH4dwnV6KEwqz4jTxHRarvcQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor? -- May 20, 2014 - 11:53</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00386" class="tabs">Index by Date</a> | <a href="threads.html#00386" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00385.html">Date Prev</a>] [<a href="msg00387.html">Date Next</a>] [<a href="msg00379.html">Thread Prev</a>] [<a href="msg00390.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 20 May 2014 11:52:45 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;, Gary Thompson &lt;garyt@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type; bh=NIH14nkYPU8tdf8pXihedIHHSiRB+R5ro/VEfq8IOng=; b=Q4QCgo04Ohw2hY6XtB+hN4mlXhak1+4ssN7BFd9OQ3rJiklFRxzWnOKdtMO32Ctzpb klaUObolS2gItTpcUatHWsXYKwdMguL2n9grESHZdBTv8umfVeI1wgEaHiSZHFCPkmSe nG8LouZU0a0T9Q2U2Hud57nW3jox70hPqXV9CrUzGArkvqZBxA0VM9AySObdM7n1/3so gHPt7Zxzhlt+CEiPMu6PdB3lMRR9cCsY9E3Lo2com7T5VShfgymajnyWsUqd6WnA2BQP 3bSFMPg7gh6uwEgCWSSHtn26xXxXDxm13uL9qlpNbpyZA/OWia27+15b5CgFU/m+e9YU wTdg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00386.html">CA+CBx2Pt5q2E0tnvhxq2ocY2NqYmiB1jqqb61M5cBZXeywtYPg@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00377.html">20140520-000356.sv20529.92877@gna.org</a>&gt; &lt;<a href="msg00378.html">20140520-000436.sv20529.46737@gna.org</a>&gt; &lt;CAED9pY9dgTO=XEMitiXkucSttRHH4dwnV6KEwqz4jTxHRarvcQ@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on May 20, 2014 - 11:53:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Ed.

I tried hard for several hours yesterday.

But this multi-processing goes beyond my skills...

If you know a little more about, and can fix it, I would be very happy.

I can try the thing you suggested, but beyond that, I would be lost.

Best
Trpels

2014-05-20 9:43 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

You might have actually have found the source of the problem!  This
has been an issue for a long time, but I never solved it.  It affects
many analysis types and I have always wondered why one failing test
would cause many subsequent tests of the same analysis type to fail.
This has been around longer than the dispersion analysis which was
started in 2009.  I always tried to solve it in the special
self.tearDown() test suite method for cleaning up after tests, but
this somehow never completely solved the issue.  So it could have
something to do with the FIXME comment in the run_queue() method of
the multi.uni_processor module:


    def run_queue(self):
        #FIXME: need a finally here to cleanup exceptions states for 
windows etc

        last_command = len(self.command_queue)-1
        for i, command  in enumerate(self.command_queue):
            completed = (i == last_command)

            command.run(self, completed)

        #self.run_command_queue()
        #TODO: add cheques for empty queues and maps if now warn
        del self.command_queue[:]
        self.memo_map.clear()


There are a few minor FIXMEs and TODOs in Gary Thompson's
multi-processor framework.  But this one might be quite important for
the test suite.  You could try as the FIXME says, add a 'try-finally'
statements so the last two lines are always run.  This may cause other
issues, so be careful.

Note, this must not be committed to your 'disp_speed' branch.  If you
have a fix, make sure it is applied to the trunk.

Cheers,

Edward





On 20 May 2014 02:04, Troels E. Linnet &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Additional Item Attachment, bug #22055 (project relax):

File name: log.txt                        Size:792 KB


    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/bugs/?22055">http://gna.org/bugs/?22055</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00390" href="msg00390.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00377" href="msg00377.html">[bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00378" href="msg00378.html">[bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00379" href="msg00379.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue May 20 14:00:17 2014</div>  
</body>
</html>
