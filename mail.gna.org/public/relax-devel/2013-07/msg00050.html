<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: bash script for a FTP dump of the newly create relax wiki -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Wed, 17 Jul 2013 14:50:43 +0200 -->
<!--X-Message-Id: CAED9pY9cG8wUpUkd3yWQETTDHWNt6XePiY7zJD23=fyNj_kzwg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CA+CBx2MXQogUUeFKZFQwYJ=VV=y3_6cQ+mjBafTVx&#45;Eg2_Ktpw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;yeSvP7Nqqof7SbHEsryuUUBr_A0OZ10aGeELnv9ty=Q@mail.gmail.com -->
<!--X-Reference: CA+CBx2NWWoQBa6poPP3uNszpcTRjKzBfaVPMzEGO&#45;4VTZ&#45;MNuw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: bash script for a FTP dump of the newly create relax wiki -- July 17, 2013 - 14:50</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: bash script for a FTP dump of the newly create relax wiki</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00050" class="tabs">Index by Date</a> | <a href="threads.html#00050" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00049.html">Date Prev</a>] [<a href="msg00051.html">Date Next</a>] [<a href="msg00049.html">Thread Prev</a>] [<a href="msg00051.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 17 Jul 2013 14:50:12 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date	:x-google-sender-auth:message-id:subject:from:to:cc:content-type	:content-transfer-encoding;	bh=EdXFQE5tY3inreBmbqOci8hntBs2IlPsTZleH2Tynvo=;	b=KuDrxgaSddGtgPx9NS8hyFBlTaQutAnqpZeKC3mRjuPfcMxTojoNtWb2buzrw9f9Y5	xSWih5aJUoj7gWkGX4aaPA/ihA+4KYOrd4XCoU/AVLJdAGz3XPWm+zR23c+Y6OfRYp8Z	hdkSBzKyi+J+k2xpjWoMGnTmrkaK/oz9GQ1yKF517ktjULAqFuV52qhBojXvMM8aywFK	Oy46dhGKKlRtJU45fkErXDYkM2sPnKs9EMnE2/8ZjQDAgOVlBeDw2UPrH2axyBaQfu0T	lCvj9eIJYSdUZMO0S/Ec4rgie79ts3aWzT13bzQEtgXBoPRdsmlkbxsyM/mMaihUhDIf	gOIg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00050.html">CAED9pY9cG8wUpUkd3yWQETTDHWNt6XePiY7zJD23=fyNj_kzwg@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2MXQogUUeFKZFQwYJ=VV=y3_6cQ+mjBafTVx-Eg2_Ktpw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-yeSvP7Nqqof7SbHEsryuUUBr_A0OZ10aGeELnv9ty=Q@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2NWWoQBa6poPP3uNszpcTRjKzBfaVPMzEGO-4VTZ-MNuw@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on July 17, 2013 - 14:50:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

I think, for security reasons, that it would be best not to upload the
files generated by your two scripts (devel_scripts/wiki_mysqldump.sh
and devel_scripts/wiki_ftpdump.sh) to a publicly accessible URL.
Instead, select trusted relax developers can be tasked with running
cronjobs with these scripts and the private MySQL and FTP user name
and passwords.  And that the file always kept in confidence.  That
would solve most of the security problems.  It will also allow the
wiki to be restored with user information in case of a catastrophic
failure of the Gigahost infrastructure, or if we migrate to a
different server in the future.  What do you think?

Cheers,

Edward


On 17 July 2013 14:33, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

Yes, same scripts should be run together.

The mysql database will alter for each page modification.
The FTP will only alter on file upload, or if we add extensions.

Note. There is a security issue with the mysql dump.
If you look for the line:

INSERT INTO `user` VALUES

The database will contain the fields:
`user_id`, `user_name`, `user_real_name`, `user_password`,
`user_newpassword`, `user_newpass_time`, `user_email`, `user_touched`,
`user_token`, `user_email_authenticated`, `user_email_token`,
`user_email_token_expires`, `user_registration`, `user_editcount`

Reference:
<a  rel="nofollow" href="http://www.mediawiki.org/wiki/Manual:User_table">http://www.mediawiki.org/wiki/Manual:User_table</a>

And so these fields should be kept secret:
`user_password`
`user_email`
`user_token`

The password is hashed, but could be brute force cracked. How, I dont know, 
but

I suggest complely removing the line in the mysql file, by

sed -i '/^INSERT INTO `user` VALUES/d' mysqlfile.sql


Best
Troels


Troels Emtekær Linnet


2013/7/17 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

For backing up the relax wiki (<a  rel="nofollow" href="http://wiki.nmr-relax.com">http://wiki.nmr-relax.com</a>), should I
run both this script and the MySQL dumping script at
<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.devel/4163">http://article.gmane.org/gmane.science.nmr.relax.devel/4163</a>?  Will the
FTP script get the MySQL database contents?  I could create one script
to run both scripts, and then upload using rsync to the relax download
site.  I have now added this script to the relax sources as
devel_scripts/wiki_ftpdump.sh.

Cheers,

Edward



On 17 July 2013 13:24, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Dear relax developers and users.

I hereby send a bash script for a FTP dump of the newly create relax wiki.
Thereby the wiki can easily be created anywhere else, if created
together with the mysql database.

To prevent abuse of the webpage hosting service, I need to keep the
password secret.

The password is shared with Edward d'Auvergne.

I suggest a setup, where Edward run a cronjob a his infrastructure,
and expose the files to:
<a  rel="nofollow" href="http://download.gna.org/relax/wiki/ftpdump">http://download.gna.org/relax/wiki/ftpdump</a>

The FTP dump should only tricker when new files are added.
That would normally only be when images are uploaded.

Best
Troels Linnet

-----------------------
#!/bin/bash
# -*- coding: UTF-8 -*-
# Script for dumping ftp server automatically using cron.

# exec test
exec_test () {
[ $? -eq 0 ] &amp;&amp; echo &quot;-- Command successfully executed&quot; || echo &quot;--
Command failed; exit 1&quot;
}

# Filenames
dbhost=&quot;web3.gigahost.dk&quot;
# The following two fields are kept secret, to prevent abuse.
# Please contact Troels Linnet at: tlinnet _at_ gmail dot com, for access.
dbuser=&quot;secret&quot;
dbpwd=&quot;secret&quot;

mydate=`date '+%Y%m%d_%H%M'`
mytime=`date '+%T %Y%m%d'`
backupfolder=&quot;${HOME}/backup/ftpdump&quot;
backupfoldermirror=&quot;${backupfolder}/mirror&quot;
backupfoldercurrent=&quot;${backupfolder}/current&quot;
mkdir -p $backupfolder $backupfoldermirror $backupfoldercurrent

# Logging
exec 3&gt;&amp;1 4&gt;&amp;2
trap 'exec 2&gt;&amp;4 1&gt;&amp;3' 0 1 2 3
exec 1&gt;&gt;${backupfolder}/ftpdump.log 2&gt;&amp;1
# Everything below will go to the log file

dump_base () {
echo &quot;###########################&quot;
echo &quot;STARTING on: $mytime&quot;
echo &quot;Mirror syncing...&quot;
cd $backupfoldermirror
lftp -e &quot;open <a  rel="nofollow" href="ftp://${dbuser}:${dbpwd}@${dbhost}">ftp://${dbuser}:${dbpwd}@${dbhost}</a> &amp;&amp; mirror --no-perms
--exclude-glob backup_scripts/ --exclude-glob cache/ --exclude-glob
LocalSettings.php --parallel=10 &amp;&amp; bye&quot;
}

compress_base () {
echo &quot;Compressing current...&quot;
DIFF=`diff -q -r $backupfoldermirror $backupfoldercurrent`
echo -e &quot;Difference between sync and current is:\n$DIFF&quot;
DIFFARR=($DIFF)
LENDIFFARR=${#DIFFARR[@]}
if [ &quot;$LENDIFFARR&quot; -gt &quot;0&quot; ]
then
rm -rf $backupfoldercurrent
cp -p -r $backupfoldermirror $backupfoldercurrent
tar -zcf ${backupfolder}/ftpdump_${mydate}.tar.gz $backupfoldercurrent/
fi
}

dump_base ; exec_test
compress_base ; exec_test

echo &quot;Done, quit!&quot;

_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00051" href="msg00051.html">Re: bash script for a FTP dump of the newly create relax wiki</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00046" href="msg00046.html">bash script for a FTP dump of the newly create relax wiki</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00047" href="msg00047.html">Re: bash script for a FTP dump of the newly create relax wiki</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00048" href="msg00048.html">Re: bash script for a FTP dump of the newly create relax wiki</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Jul 17 15:00:07 2013</div>  
</body>
</html>
