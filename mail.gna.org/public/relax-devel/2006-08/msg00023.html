<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [bug #6503] Uncaught nan in xh_vect -->
<!--X-From-R13: Quevf [npDnvyq <p.n.znpenvyqNyrrqf.np.hx> -->
<!--X-Date: Tue, 08 Aug 2006 11:07:23 +0200 -->
<!--X-Message-Id: 1155027991.28764.327.camel@fbsdpcu021 -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20060802&#45;104941.sv4125.3051@gna.org -->
<!--X-Reference: 7f080ed10608020558o47fd0260s9579f663147ab84@mail.gmail.com -->
<!--X-Reference: 1154597081.28764.140.camel@fbsdpcu021 -->
<!--X-Reference: 7f080ed10608030650t7896164mbcfa499f1987270a@mail.gmail.com -->
<!--X-Reference: 1154620634.28764.190.camel@fbsdpcu021 -->
<!--X-Reference: 7f080ed10608040708k4738dd5cjb41e9056acd88902@mail.gmail.com -->
<!--X-Reference: 1154706350.28764.284.camel@fbsdpcu021 -->
<!--X-Reference: 44D37486.6060003@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10608040954n4971257diabac2c1b51f17790@mail.gmail.com -->
<!--X-Reference: 44D6F769.10204@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10608070240j43e47b3cif1b60924755c4fa9@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [bug #6503] Uncaught nan in xh_vect -- August 08, 2006 - 11:07</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [bug #6503] Uncaught nan in xh_vect</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00023" class="tabs">Index by Date</a> | <a href="threads.html#00023" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00022.html">Date Prev</a>] [<a href="msg00024.html">Date Next</a>] [<a href="msg00022.html">Thread Prev</a>] [<a href="msg00024.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 08 Aug 2006 10:06:31 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00023.html">1155027991.28764.327.camel@fbsdpcu021</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;20060802-104941.sv4125.3051@gna.org&gt;	&lt;<a href="msg00000.html">7f080ed10608020558o47fd0260s9579f663147ab84@mail.gmail.com</a>&gt;	&lt;<a href="msg00001.html">1154597081.28764.140.camel@fbsdpcu021</a>&gt;	&lt;<a href="msg00002.html">7f080ed10608030650t7896164mbcfa499f1987270a@mail.gmail.com</a>&gt;	&lt;<a href="msg00003.html">1154620634.28764.190.camel@fbsdpcu021</a>&gt;	&lt;<a href="msg00007.html">7f080ed10608040708k4738dd5cjb41e9056acd88902@mail.gmail.com</a>&gt;	&lt;<a href="msg00009.html">1154706350.28764.284.camel@fbsdpcu021</a>&gt;	&lt;<a href="msg00013.html">44D37486.6060003@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00016.html">7f080ed10608040954n4971257diabac2c1b51f17790@mail.gmail.com</a>&gt;	&lt;<a href="msg00020.html">44D6F769.10204@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00022.html">7f080ed10608070240j43e47b3cif1b60924755c4fa9@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Chris MacRaild</strong> on August 08, 2006 - 11:07:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">On Mon, 2006-08-07 at 19:40 +1000, Edward d'Auvergne wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">On 8/7/06, Gary S. Thompson &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">It ought to be said that nan and inf etc have very clearly defined bit
patterns in memory that are defined by an ieee754 cf
<a  href="http://steve.hollasch.net/cgindex/coding/ieeefloat.html">http://steve.hollasch.net/cgindex/coding/ieeefloat.html</a> and
<a  href="http://www.psc.edu/general/software/packages/ieee/ieee.html">http://www.psc.edu/general/software/packages/ieee/ieee.html</a>. Thus its a
question of python/compilers not putting nan in the right place and not
using comaprisons etc properly when nans are are present. It should
always be possible to detect if a nan is present by the bit pattern in
memory (and this is the way fpconst.py does it). It is of course
possible to test if nans are supported correctly on a paricular
architecture and compiler by comparisons etc and if not warnings etc
could be raised or alternative code executed)
</pre></blockquote><pre style="margin: 0em;">


</pre><blockquote class="blockquote"><pre style="margin: 0em;">another thing to say is that though fpconst.py  is gpl incompatible due
to some arcana about /patent termination cases
(<a  href="http://en.wikipedia.org/wiki/Apache_License">http://en.wikipedia.org/wiki/Apache_License</a>)/ in the apache license,
due to they way it works should be relativley easy to cook up our own
version which would bullet proof and low maintenance in the same way as
fpconst.py is... and also quite legal
</pre></blockquote><pre style="margin: 0em;">


Could the fpconst.py file be legally included in a relax distribution?
</pre></blockquote><pre style="margin: 0em;">

I am not a lawyer and the waters eem to be muddy...


      Is the Apache license compatible with the GPL (GNU Public License)?

It is the unofficial position of The Apache Software Foundation that the
Apache license *is* compatible with the GPL. However, the Free Software
Foundation holds a different position, although we have not been able to
get them to give us categorical answers to our queries asking for
details on just what aspects they consider incompatible.
</pre></blockquote><pre style="margin: 0em;">

Did you contact the FSF about the issue?

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Whether to mix software covered under these two different licenses
*must* be a determination made by those attempting such a synthesis.
</pre></blockquote><pre style="margin: 0em;">

According to the FSF list of licences
(<a  href="http://www.gnu.org/philosophy/license-list.html">http://www.gnu.org/philosophy/license-list.html</a>), all of the Apache
licences are GPL incompatible.  For version 2 of the licence they say:

This is a free software license but it is incompatible with the GPL.
The Apache Software License is incompatible with the GPL because it
has a specific requirement that is not in the GPL: it has certain
patent termination cases that the GPL does not require. (We don't
think those patent termination cases are inherently a bad idea, but
nonetheless they are incompatible with the GNU GPL.)

After looking at the GPL FAQ and thinking about it for a while, I
don't believe the file can be put into the relax distribution.  From
the link <a  href="http://www.gnu.org/licenses/gpl-faq.html#MereAggregation">http://www.gnu.org/licenses/gpl-faq.html#MereAggregation</a> I
would classify the co-distribution of relax with fpconst.py as an
imported module to be a single program rather than an aggregation of
programs.  Because of the licence incompatibility, the link
<a  href="http://www.gnu.org/licenses/gpl-faq.html#GPLIncompatibleAlone">http://www.gnu.org/licenses/gpl-faq.html#GPLIncompatibleAlone</a> explains
how it is not legal to co-distribute.

</pre><blockquote class="blockquote"><pre style="margin: 0em;">however I don''t see that ther is a problem if the file is in a separate
module... plenty of people install apache based software and gpl
software in their python machines. At worst all that would happen is
someone would complain and we would have to write out own...
( I reckon I could do the whole thing in a few hours at most including
some unit tests)
</pre></blockquote><pre style="margin: 0em;">

Because what I wrote above, it would probably have to be listed as a
dependency.  However I don't really like that idea as dependencies are
a pain.  Do you have the link to it's homepage?  All the links I've
tried that look like it would be its homepage (for example
<a  href="http://www.warnes.net/rwndown">http://www.warnes.net/rwndown</a>) are still down.  Having it in-built
into relax would be better.
</pre></blockquote><pre style="margin: 0em;">

I agree that having an additional dependency is a bad idea. The options
then are: 1) do nothing, and accept Pythons default NaN handling.
Although I agree that NaNs are a rare occurence, I think this option is
just putting off the inevitable - as more users push relax into more
places, its inevitable that NaNs will appear again and give us more
headaches, probably in ways we cant anticipate. 2) Code our own version
of fpconst for relax. Then we could catch NaNs as and when we need to.
3) Make the move from Numeric to Numpy. As I understand it, this should
give us both the ability to catch NaNs, but also give us reliable NaN
comparisons (ie. NaN will compare False with everything). I've done some
very preliminary testing towards this, and at first glance it seems
easier than I expected. I have run the convertcode script that is
distributed with Numpy on all modules in the maths directory of the
relax 1.3 branch. All tests pass except the openDx tests, which also
failed in 1.3 before the conversion. Obviously this will require a lot
of care and more thorough testing than the current test-suite allows,
but it atleast seems feasible. As we have discussed before, that shift
to Numpy will be necessary soon enough anyway, so perhaps now is the
time to give it a shot?

</pre><blockquote class="blockquote"><pre style="margin: 0em;">

However I still question whether the floating point value of NaN
actually needs to be caught at all - it would be useful, but is
unnecessary.  It's a rare occurrence to begin with and I can easily
modify the optimisation component of relax to break the infinite
loops.  Therefore does anything else need to be done?  It will be
glaringly obvious in the final results file if NaNs get through the
analysis.  And if there is an issue in relax's handling of NaN then
that should be classified as a relax bug.


</pre></blockquote><pre style="margin: 0em;">[snip]

</pre><blockquote class="blockquote"><pre style="margin: 0em;">NaN should propagate - however I do see one point at which they will
disappear and that is during AIC model selection.  The AIC value will
be NaN (NaN + 2k = NaN) and any model with a non-NaN AIC value will be
selected.  Unless of course all model-free models for that residue are
affected.  Yet if they do propagate the results for that residue will
make no sense.  
</pre></blockquote><pre style="margin: 0em;">

Agreed, and that is one reason why we need to catch NaNs (or have
properly defined comparisons on NaNs). In the current situation, if we
do model selection on both NaN and finite values, the behaviour will be
undefined. The options are to use a system that has defined NaN
comparisons (Numpy seems to fit the bill) or to remove NaN values before
model selection (another test in the model elimiation, perhaps?).
Obviously this last option requires that we are able to catch NaNs in a
defined way.

Chris

</pre><blockquote class="blockquote"><pre style="margin: 0em;">That should be an indication to the end user that
there is a problem and that they should look at the final results file
in detail - none of the logs or intermediate results files need to be
initially examined to identify that there is a problem.  If, however,
we can prevent users from encountering this problem as much as
possible, while making it possible to continue running if it does
occur, then NaNs shouldn't be a problem in relax.

Edward

</pre></blockquote><pre style="margin: 0em;">



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00024" href="msg00024.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00000" href="msg00000.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00001" href="msg00001.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00002" href="msg00002.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00003" href="msg00003.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00007" href="msg00007.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00009" href="msg00009.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00016" href="msg00016.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00020" href="msg00020.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00022" href="msg00022.html">Re: [bug #6503] Uncaught nan in xh_vect</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Aug 08 12:40:14 2006</div>  
</body>
</html>
