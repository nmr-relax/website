<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: CST branch -->
<!--X-From-R13: Bniry Ynqrenirx <cniry.xnqrenirxNtznvy.pbz> -->
<!--X-Date: Thu, 24 Feb 2011 10:03:19 +0100 -->
<!--X-Message-Id: AANLkTi=DQ9KGP+e0ONhZ66XhSzKhuQzFoQcQNwXnVsgG@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: p2l6052a51004080823g94a64268lf8af8d3e332c2a03@mail.gmail.com -->
<!--X-Reference: j2i7f080ed11004120000r80bba9bch9556be67b0c1707@mail.gmail.com -->
<!--X-Reference: g2v6052a51004131048sb5c01509sfc9a77045ad33310@mail.gmail.com -->
<!--X-Reference: r2g7f080ed11004131113mb209905eh63ff1eb61c171fee@mail.gmail.com -->
<!--X-Reference: l2q6052a51004301221h9ad09886ha016465129beb516@mail.gmail.com -->
<!--X-Reference: g2m7f080ed11005050153y2ad8b4bfjb4eb8191b0efd0cc@mail.gmail.com -->
<!--X-Reference: AANLkTin4nzkkOCxs94vUKCpT00R7ak22gLaL5rK&#45;VjPN@mail.gmail.com -->
<!--X-Reference: AANLkTinF4yNXoJQS&#45;rd81VBi3keRURUNeb&#45;_GdkxqqsG@mail.gmail.com -->
<!--X-Reference: AANLkTinibyBQvsoG1&#45;0vmzOXFmRJxD95VMF3eGxzSMMB@mail.gmail.com -->
<!--X-Reference: AANLkTimFT0&#45;Kbgdz_U5LeOW5Ln22mPBZBC8FL68n6CeF@mail.gmail.com -->
<!--X-Reference: AANLkTikhknBoHTc7B7GCRULkrEnxSx+PpqPP=x6KrDOH@mail.gmail.com -->
<!--X-Reference: AANLkTim0B&#45;E6kMW9Nn47o+u+atxrm38540u1Xhaoe6j0@mail.gmail.com -->
<!--X-Reference: AANLkTi=m5S08Nd1F5VDnMGTOu2s+j2Euz1t&#45;ytw0zOAf@mail.gmail.com -->
<!--X-Reference: AANLkTinxUWLu2N19dc3eaPgh22igv_SGy=6qmVnJN=Qj@mail.gmail.com -->
<!--X-Reference: AANLkTik0K3B7huKE8hJtAkXL_yzJmNa9BFxfczu8Sfx9@mail.gmail.com -->
<!--X-Reference: AANLkTin1JfUtMoVqR4c&#45;5dRHTf58N&#45;FAcv4_bc=LpH2b@mail.gmail.com -->
<!--X-Reference: AANLkTimBsSm504qysJd8&#45;e0O_thUdcwvciKrNhMTdoQW@mail.gmail.com -->
<!--X-Reference: AANLkTikf&#45;g23EPV+R2&#45;7inSpXbT5fqv5vDO8nL+DZrwA@mail.gmail.com -->
<!--X-Reference: AANLkTikNh5FTMmeQPqkSiX8ieG5oUw5UcuG83k8PeAiM@mail.gmail.com -->
<!--X-Reference: AANLkTimADCpNAJG4Pg02_UukH5hFW5eQfr&#45;SymzqXrc=@mail.gmail.com -->
<!--X-Reference: AANLkTi=8_288HiMhVQDwpFUCqMp+aBotECez44s44q7z@mail.gmail.com -->
<!--X-Reference: AANLkTi=vSTA2B&#45;jpTzShJab84W=&#45;z1YBzvhW10wTXg_P@mail.gmail.com -->
<!--X-Reference: AANLkTikXiEtqtDWOycdJdyYSG+KfxAARiXhtDwrQm_v+@mail.gmail.com -->
<!--X-Reference: AANLkTinWS1m+j069Y+sTXrae&#45;J5DamkkNTp&#45;Wx8u7OTX@mail.gmail.com -->
<!--X-Reference: AANLkTinNsF7fA3Va=&#45;63bYBE3EoOeZ21OOO8ZYunU0uR@mail.gmail.com -->
<!--X-Reference: AANLkTinw8sg3staDqr+=mBGqLgB0joQwKzKbFNGY_5sF@mail.gmail.com -->
<!--X-Reference: AANLkTi=aZJDUcj0+p_0Or_P1v3xwSvk=7=s=+DjHFRcA@mail.gmail.com -->
<!--X-Reference: AANLkTinB0kczjTRe5etQtviQ0p9sxu&#45;fmeh3FJ&#45;Lx6Pg@mail.gmail.com -->
<!--X-Reference: AANLkTikwqUH6Z&#45;NmxNmj02ysSaYYAQ_cuS5&#45;kJ6K4U5u@mail.gmail.com -->
<!--X-Reference: AANLkTikZXALuxeob=_YvJjE5&#45;ZyRrLTNqG&#45;wTf_nxgqf@mail.gmail.com -->
<!--X-Reference: AANLkTi=o2jzDfj+Y=WMMBTL=YpOT++n2X0sN=G4_S25+@mail.gmail.com -->
<!--X-Reference: AANLkTimthyxNok+Fsv94fnF8JVdia6VXJ6M0sDQYAAzT@mail.gmail.com -->
<!--X-Reference: AANLkTinydi7mCO0EeWvGOOyOw1a_h3f3618tC_+9FOF5@mail.gmail.com -->
<!--X-Reference: AANLkTimyoJqYWVk8Y7x3Y5UDWr_GaMa_dDVJ9492OEht@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: CST branch -- February 24, 2011 - 10:03</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: CST branch</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00071" class="tabs">Index by Date</a> | <a href="threads.html#00071" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00070.html">Date Prev</a>] [<a href="msg00072.html">Date Next</a>] [<a href="msg00052.html">Thread Prev</a>] [<a href="msg00076.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 24 Feb 2011 10:02:48 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:mime-version:in-reply-to:references:date	:message-id:subject:from:to:cc:content-type;	bh=ILCp2MAPsGSPCFovRpQX6IjAXEjAG425yaR8yHnCsNM=;	b=vQ1hv2gZxnMXlUs3LfAm0uFxP+8tfKjOeEIe8jj2gNwkEMJXBQADYyjocShyE3vkGg	mbQsgE12BWr+uZcP3vzhLEcXb9fGw/pQkimc6TxrccNKht73ZGEKmpi9fXOaZPyiHUTD	DN5nu8l+HrFSQaXtm05Kkcq+g3VjjRDbxFtnk=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00071.html">AANLkTi=DQ9KGP+e0ONhZ66XhSzKhuQzFoQcQNwXnVsgG@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;p2l6052a51004080823g94a64268lf8af8d3e332c2a03@xxxxxxxxxxxxxx&gt;	&lt;j2i7f080ed11004120000r80bba9bch9556be67b0c1707@xxxxxxxxxxxxxx&gt;	&lt;g2v6052a51004131048sb5c01509sfc9a77045ad33310@xxxxxxxxxxxxxx&gt;	&lt;r2g7f080ed11004131113mb209905eh63ff1eb61c171fee@xxxxxxxxxxxxxx&gt;	&lt;l2q6052a51004301221h9ad09886ha016465129beb516@xxxxxxxxxxxxxx&gt;	&lt;g2m7f080ed11005050153y2ad8b4bfjb4eb8191b0efd0cc@xxxxxxxxxxxxxx&gt;	&lt;AANLkTin4nzkkOCxs94vUKCpT00R7ak22gLaL5rK-VjPN@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinF4yNXoJQS-rd81VBi3keRURUNeb-_GdkxqqsG@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinibyBQvsoG1-0vmzOXFmRJxD95VMF3eGxzSMMB@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimFT0-Kbgdz_U5LeOW5Ln22mPBZBC8FL68n6CeF@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikhknBoHTc7B7GCRULkrEnxSx+PpqPP=x6KrDOH@xxxxxxxxxxxxxx&gt;	&lt;AANLkTim0B-E6kMW9Nn47o+u+atxrm38540u1Xhaoe6j0@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=m5S08Nd1F5VDnMGTOu2s+j2Euz1t-ytw0zOAf@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinxUWLu2N19dc3eaPgh22igv_SGy=6qmVnJN=Qj@xxxxxxxxxxxxxx&gt;	&lt;AANLkTik0K3B7huKE8hJtAkXL_yzJmNa9BFxfczu8Sfx9@xxxxxxxxxxxxxx&gt;	&lt;AANLkTin1JfUtMoVqR4c-5dRHTf58N-FAcv4_bc=LpH2b@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimBsSm504qysJd8-e0O_thUdcwvciKrNhMTdoQW@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikf-g23EPV+R2-7inSpXbT5fqv5vDO8nL+DZrwA@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikNh5FTMmeQPqkSiX8ieG5oUw5UcuG83k8PeAiM@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimADCpNAJG4Pg02_UukH5hFW5eQfr-SymzqXrc=@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=8_288HiMhVQDwpFUCqMp+aBotECez44s44q7z@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=vSTA2B-jpTzShJab84W=-z1YBzvhW10wTXg_P@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikXiEtqtDWOycdJdyYSG+KfxAARiXhtDwrQm_v+@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinWS1m+j069Y+sTXrae-J5DamkkNTp-Wx8u7OTX@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinNsF7fA3Va=-63bYBE3EoOeZ21OOO8ZYunU0uR@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinw8sg3staDqr+=mBGqLgB0joQwKzKbFNGY_5sF@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=aZJDUcj0+p_0Or_P1v3xwSvk=7=s=+DjHFRcA@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinB0kczjTRe5etQtviQ0p9sxu-fmeh3FJ-Lx6Pg@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikwqUH6Z-NmxNmj02ysSaYYAQ_cuS5-kJ6K4U5u@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikZXALuxeob=_YvJjE5-ZyRrLTNqG-wTf_nxgqf@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=o2jzDfj+Y=WMMBTL=YpOT++n2X0sN=G4_S25+@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimthyxNok+Fsv94fnF8JVdia6VXJ6M0sDQYAAzT@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinydi7mCO0EeWvGOOyOw1a_h3f3618tC_+9FOF5@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimyoJqYWVk8Y7x3Y5UDWr_GaMa_dDVJ9492OEht@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Pavel Kaderavek</strong> on February 24, 2011 - 10:03:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div class="im">Hi,<br><br>We realized a problem during the preparation
of the following patch. Currently, it is impossible to initialize
variables in the originally suggested way:<br><br>data = "">data.ri_prime = 0.0<br><br>
in the function func_mf (maths_fns/mf.py) and other similar functions
(func_local_tm, func_diff, func_all, and their equivalents for a first
and second derivatives).<br><br></div>It
is not possible because of the approved changes of __init__ function in
the class Mf (file maths_fns/mf.py). The array used to store data is
created in the following way:<div class="im"><br>
<br>        self.data = "">        for i in xrange(self.num_spins):<br>            ...<br>            self.data.append([])<br>            ...<br>            # Loop over the relaxation interactions.<br>            for j in xrange(self.num_interactions[i]):<br>

                self.data[i].append(Data()) # This is a list dedicated
for the storage of interaction specific parameters (i.e. type of
interaction, internuclei distance, ...)<br>                self.data[i][j].interactions=interactions[i][j]<br>
                self.data[i][j].internuclei_distance=internuclei_distance[i][j]<br>                ...<br><br><br></div>Thus, the list for a storage of spin specific data does not exist and the suggested variable location does not exist:<div class="im">
<br>
self.data[0].ri_prime<br><br><br></div>We found some possible ways to solve the problem. However we do not think, they are ideal.<div class="im"><br>First,
we can add for each spin a new list except those which store the
interaction specific data. Data_spin list would be at the beginning of
the array and therefore every loop over interactions in the code has to
keep it in mind and start from index 1 not 0 to avoid Data_spin list.<br>
<br></div>The second possibility is based on the idea to declare for
each spin a class Spin_data. The Spin_data would contain all
spin specific variables (ri_prime, chi2, ...) and also a
class Data which would contain interaction specific data. <br><div class="im">
<br>What do you think about these suggestions? We will be glad for any better suggestion, than ours.<br>Best regards,<br>Pavel</div><br><br><div class="gmail_quote">On 18 February 2011 11:11, Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;"><div class="im">On 16 February 2011 19:18, Pavel Kaderavek &lt;<a rel="nofollow" href="mailto:pavel.kaderavek@xxxxxxxxx">pavel.kaderavek@xxxxxxxxx</a>&gt; wrote:<br>

&gt; Hi,<br>
&gt;<br>
</div><div class="im">&gt; sorry for the late response. I am continuing in the discussion - see Section<br>
&gt; 1) of the message:<br>
&gt; <a rel="nofollow" href="https://mail.gna.org/public/relax-devel/2010-10/msg00016.html" target="_blank">https://mail.gna.org/public/relax-devel/2010-10/msg00016.html</a><br>
<br>
</div>Hi,<br>
<br>
Don&#39;t worry about it, I fully understand how these things are.  I hope<br>
you can add this work to a future publication (and then you can say<br>
that relax version 1.3.x will fully support RNA work, and that all<br>
future versions will have this functionality).  If we have a system<br>
test checking the operation of this code for a small RNA data test set<br>
with CSA tensors, then this part of relax will be guaranteed to always<br>
work.<br>
<div class="im"><br>
<br>
&gt; We would like to add the implementation of relaxation rate calculation from<br>
&gt; the contributions of the individual interactions in the next patch. It<br>
&gt; covers changes of functions func_mf, func_local_tm , func_diff, func_all,<br>
&gt; and their equivalents for a first and second derivatives (class Mf, file<br>
&gt; maths_fns/mf.py). We suggest to initialize new variables which would store<br>
&gt; values which are related to the spin and not to the individual interactions.<br>
&gt; It concerns calculated relaxation rates (ri_prime), chi squared (chi2), and<br>
&gt; corresponding derived variables (dri_prime, dri2_prime, dchi2, and d2chi2).<br>
<br>
</div><div class="im">This is a good idea.<br>
<br>
<br>
</div><div class="im">&gt; The suggested approach is demonstrated on func_mf function. The other<br>
&gt; function will be treated similarly (func_local_tm, func_diff, func_all, and<br>
&gt; their equivalents for a first and second derivatives).<br>
&gt;<br>
&gt;     def func_mf(self, params):<br>
&gt;         ...<br>
&gt;         data = "">
&gt;         data.ri_prime = 0  # Initialization of the variable which will store<br>
&gt; the contribution to the relaxation rate from the individual interactions<br>
<br>
</div>I would make this a floating point number for speed, otherwise python<br>
will have perform a conversion from this integer &#39;0&#39; to the float<br>
&#39;0.0&#39;.<br>
<div class="im"><br>
<br>
&gt;         ...<br>
&gt;         # Loop over the relaxation interactions.<br>
&gt;         for j in xrange(self.num_interactions[0]):<br>
&gt;              ....<br>
&gt;             # Calculate the R1, R2, and sigma_noe contribution of j-th<br>
&gt; interaction.<br>
&gt;             data[j].ri_prime = data[j].create_ri_prime(data[j])<br>
<br>
</div>Is there a need to store this if the next step is to sum all values?<br>
Are the individual components needed for the conversion of sigma_NOE<br>
to the steady-state NOE value?  Are the individual values used in the<br>
gradient or Hessian methods?<br>
<div class="im"><br>
<br>
&gt;             # The individual contribution will be cumulated here.<br>
&gt;             data.ri_prime = data.ri_prime + data[j].ri_prime<br>
<br>
</div>This seems ok.<br>
<div class="im"><br>
<br>
&gt;          ...<br>
&gt;          # Outside the loop the chi2 will be calculated (as it is already in<br>
&gt; the original code):<br>
&gt;<br>
&gt;          # Calculate the chi-squared value.<br>
&gt;          data.chi2 = chi2(data.relax_data, data.ri, data.errors)<br>
&gt;<br>
&gt; The original version of the function data[j].create_ri_prime(data[j])<br>
&gt; calculates the relaxation rates from all interactions (CSA, dipole-dipole,<br>
&gt; Rex). It will be necessary to modify the function to calculate the<br>
&gt; relaxation rate contribution per individual interaction separately.<br>
&gt; Therefore, the equation has to be selected according to both type of<br>
&gt; relaxation rate (R1,R2,sigmaNOE) and type of relaxation interaction<br>
&gt; (dipole-dipole, CSA, Rex, ...). However, this change be covered in a<br>
&gt; separate patch.<br>
<br>
</div>It would be better to have it separate.  You may have noticed new code<br>
in your cst branch (after an &#39;svn up&#39;).  I have added system tests in<br>
the main line covering the optimisation of all model-free models (m0<br>
to m9 and tm0 to tm9).  I have merged the code into the branch as<br>
well.  Once these all pass, then it will indicated that your code is<br>
working perfectly.  We also need a system test, i.e. a mini analysis<br>
with script, truncated data and CSA tensors, for showing that the new<br>
CS tensor and multi-dipole code is fully functional.<br>
<br>
Cheers,<br>
<font color="#888888"><br>
Edward<br>
</font></blockquote></div><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00076" href="msg00076.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00047" href="msg00047.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Pavel Kaderavek</li></ul></li>
<li><strong><a name="00052" href="msg00052.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Feb 24 12:40:14 2011</div>  
</body>
</html>
