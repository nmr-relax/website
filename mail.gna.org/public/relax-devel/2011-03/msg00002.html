<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: CST branch -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 01 Mar 2011 10:37:19 +0100 -->
<!--X-Message-Id: AANLkTi=D0wxL=MhE3AaSmW3b1cMR_btPNH&#45;BbrQhQC&#45;o@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: p2l6052a51004080823g94a64268lf8af8d3e332c2a03@mail.gmail.com -->
<!--X-Reference: j2i7f080ed11004120000r80bba9bch9556be67b0c1707@mail.gmail.com -->
<!--X-Reference: g2v6052a51004131048sb5c01509sfc9a77045ad33310@mail.gmail.com -->
<!--X-Reference: r2g7f080ed11004131113mb209905eh63ff1eb61c171fee@mail.gmail.com -->
<!--X-Reference: l2q6052a51004301221h9ad09886ha016465129beb516@mail.gmail.com -->
<!--X-Reference: g2m7f080ed11005050153y2ad8b4bfjb4eb8191b0efd0cc@mail.gmail.com -->
<!--X-Reference: AANLkTin4nzkkOCxs94vUKCpT00R7ak22gLaL5rK&#45;VjPN@mail.gmail.com -->
<!--X-Reference: AANLkTinF4yNXoJQS&#45;rd81VBi3keRURUNeb&#45;_GdkxqqsG@mail.gmail.com -->
<!--X-Reference: AANLkTinibyBQvsoG1&#45;0vmzOXFmRJxD95VMF3eGxzSMMB@mail.gmail.com -->
<!--X-Reference: AANLkTimFT0&#45;Kbgdz_U5LeOW5Ln22mPBZBC8FL68n6CeF@mail.gmail.com -->
<!--X-Reference: AANLkTikhknBoHTc7B7GCRULkrEnxSx+PpqPP=x6KrDOH@mail.gmail.com -->
<!--X-Reference: AANLkTim0B&#45;E6kMW9Nn47o+u+atxrm38540u1Xhaoe6j0@mail.gmail.com -->
<!--X-Reference: AANLkTi=m5S08Nd1F5VDnMGTOu2s+j2Euz1t&#45;ytw0zOAf@mail.gmail.com -->
<!--X-Reference: AANLkTinxUWLu2N19dc3eaPgh22igv_SGy=6qmVnJN=Qj@mail.gmail.com -->
<!--X-Reference: AANLkTik0K3B7huKE8hJtAkXL_yzJmNa9BFxfczu8Sfx9@mail.gmail.com -->
<!--X-Reference: AANLkTin1JfUtMoVqR4c&#45;5dRHTf58N&#45;FAcv4_bc=LpH2b@mail.gmail.com -->
<!--X-Reference: AANLkTimBsSm504qysJd8&#45;e0O_thUdcwvciKrNhMTdoQW@mail.gmail.com -->
<!--X-Reference: AANLkTikf&#45;g23EPV+R2&#45;7inSpXbT5fqv5vDO8nL+DZrwA@mail.gmail.com -->
<!--X-Reference: AANLkTikNh5FTMmeQPqkSiX8ieG5oUw5UcuG83k8PeAiM@mail.gmail.com -->
<!--X-Reference: AANLkTimADCpNAJG4Pg02_UukH5hFW5eQfr&#45;SymzqXrc=@mail.gmail.com -->
<!--X-Reference: AANLkTi=8_288HiMhVQDwpFUCqMp+aBotECez44s44q7z@mail.gmail.com -->
<!--X-Reference: AANLkTi=vSTA2B&#45;jpTzShJab84W=&#45;z1YBzvhW10wTXg_P@mail.gmail.com -->
<!--X-Reference: AANLkTikXiEtqtDWOycdJdyYSG+KfxAARiXhtDwrQm_v+@mail.gmail.com -->
<!--X-Reference: AANLkTinWS1m+j069Y+sTXrae&#45;J5DamkkNTp&#45;Wx8u7OTX@mail.gmail.com -->
<!--X-Reference: AANLkTinNsF7fA3Va=&#45;63bYBE3EoOeZ21OOO8ZYunU0uR@mail.gmail.com -->
<!--X-Reference: AANLkTinw8sg3staDqr+=mBGqLgB0joQwKzKbFNGY_5sF@mail.gmail.com -->
<!--X-Reference: AANLkTi=aZJDUcj0+p_0Or_P1v3xwSvk=7=s=+DjHFRcA@mail.gmail.com -->
<!--X-Reference: AANLkTinB0kczjTRe5etQtviQ0p9sxu&#45;fmeh3FJ&#45;Lx6Pg@mail.gmail.com -->
<!--X-Reference: AANLkTikwqUH6Z&#45;NmxNmj02ysSaYYAQ_cuS5&#45;kJ6K4U5u@mail.gmail.com -->
<!--X-Reference: AANLkTikZXALuxeob=_YvJjE5&#45;ZyRrLTNqG&#45;wTf_nxgqf@mail.gmail.com -->
<!--X-Reference: AANLkTi=o2jzDfj+Y=WMMBTL=YpOT++n2X0sN=G4_S25+@mail.gmail.com -->
<!--X-Reference: AANLkTimthyxNok+Fsv94fnF8JVdia6VXJ6M0sDQYAAzT@mail.gmail.com -->
<!--X-Reference: AANLkTinydi7mCO0EeWvGOOyOw1a_h3f3618tC_+9FOF5@mail.gmail.com -->
<!--X-Reference: AANLkTimyoJqYWVk8Y7x3Y5UDWr_GaMa_dDVJ9492OEht@mail.gmail.com -->
<!--X-Reference: AANLkTi=DQ9KGP+e0ONhZ66XhSzKhuQzFoQcQNwXnVsgG@mail.gmail.com -->
<!--X-Reference: AANLkTind0EOBhSi_G=M_+LVY_WmLC=03f0&#45;TMrvzs6zs@mail.gmail.com -->
<!--X-Reference: AANLkTim1gTBVKDQPK=+aM1SHnuF7ZyKQTUzjpqBMt4xo@mail.gmail.com -->
<!--X-Reference: AANLkTinE=fRfL=&#45;dfe&#45;Uj6NAVuL9AOK9ENLC58C_&#45;1iu@mail.gmail.com -->
<!--X-Reference: AANLkTinaaQTrpANe1zqD&#45;pH3OGsk=sA8p7pWa4_GfrUb@mail.gmail.com -->
<!--X-Reference: AANLkTimFewU0=snUOZVVD==0d40oRuS4zNbdUsoEKMVM@mail.gmail.com -->
<!--X-Reference: AANLkTi=U0rRm2Rv+ynBehBgcJ58gOcyGpZRu5vBGM1Pv@mail.gmail.com -->
<!--X-Reference: AANLkTi=E2tq_mP1soRPB&#45;1c67a0cX&#45;NmXBYqVvot+aFA@mail.gmail.com -->
<!--X-Reference: AANLkTinBO3eWruVYxHj6g1m1Fbxr5BNC=FBo=a948V&#45;q@mail.gmail.com -->
<!--X-Reference: AANLkTikPLDbCmJRKfn+1j0epx&#45;=FAHq2eCBspBqwqizg@mail.gmail.com -->
<!--X-Reference: AANLkTintdOt63AWrtS4_7R5C64j7aXZ0u8T41UaSRpGJ@mail.gmail.com -->
<!--X-Reference: AANLkTikDPM+srXqbPRUxv9ehk2NfGQ5HA6ODWueN4FWB@mail.gmail.com -->
<!--X-Reference: AANLkTim0uEyEEmu1V3Rx8SN1hmWMThpxrORZr7RQDZ++@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: CST branch -- March 01, 2011 - 10:37</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: CST branch</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00002" class="tabs">Index by Date</a> | <a href="threads.html#00002" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00001.html">Date Prev</a>] [<a href="msg00003.html">Date Next</a>] [<a href="msg00001.html">Thread Prev</a>] [<a href="msg00004.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Pavel Kaderavek &lt;pavel.kaderavek@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 1 Mar 2011 10:36:48 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:mime-version:sender:in-reply-to:references:date	:x-google-sender-auth:message-id:subject:from:to:cc:content-type	:content-transfer-encoding;	bh=hVFWLOY5zNpDLsoTmHhmqlxWwWk0FSQLLhr4CGHzJJM=;	b=reEcAoFgZMOkMCuEBbViLSeMpEluFHhPtjE272lJDXxP9YapbDShYxvytsQuj76Exk	JkljEfvmucbYpCJhnPXssebn5zzXHQUHY7Fhbd5JOZNKqz1Ztw7UkPbqotKmCQon0qRm	SUAGdd7oCxBknyYfEGjC3pXU6GBKHMJ5g+5us=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00002.html">AANLkTi=D0wxL=MhE3AaSmW3b1cMR_btPNH-BbrQhQC-o@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;p2l6052a51004080823g94a64268lf8af8d3e332c2a03@xxxxxxxxxxxxxx&gt;	&lt;j2i7f080ed11004120000r80bba9bch9556be67b0c1707@xxxxxxxxxxxxxx&gt;	&lt;g2v6052a51004131048sb5c01509sfc9a77045ad33310@xxxxxxxxxxxxxx&gt;	&lt;r2g7f080ed11004131113mb209905eh63ff1eb61c171fee@xxxxxxxxxxxxxx&gt;	&lt;l2q6052a51004301221h9ad09886ha016465129beb516@xxxxxxxxxxxxxx&gt;	&lt;g2m7f080ed11005050153y2ad8b4bfjb4eb8191b0efd0cc@xxxxxxxxxxxxxx&gt;	&lt;AANLkTin4nzkkOCxs94vUKCpT00R7ak22gLaL5rK-VjPN@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinF4yNXoJQS-rd81VBi3keRURUNeb-_GdkxqqsG@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinibyBQvsoG1-0vmzOXFmRJxD95VMF3eGxzSMMB@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimFT0-Kbgdz_U5LeOW5Ln22mPBZBC8FL68n6CeF@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikhknBoHTc7B7GCRULkrEnxSx+PpqPP=x6KrDOH@xxxxxxxxxxxxxx&gt;	&lt;AANLkTim0B-E6kMW9Nn47o+u+atxrm38540u1Xhaoe6j0@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=m5S08Nd1F5VDnMGTOu2s+j2Euz1t-ytw0zOAf@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinxUWLu2N19dc3eaPgh22igv_SGy=6qmVnJN=Qj@xxxxxxxxxxxxxx&gt;	&lt;AANLkTik0K3B7huKE8hJtAkXL_yzJmNa9BFxfczu8Sfx9@xxxxxxxxxxxxxx&gt;	&lt;AANLkTin1JfUtMoVqR4c-5dRHTf58N-FAcv4_bc=LpH2b@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimBsSm504qysJd8-e0O_thUdcwvciKrNhMTdoQW@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikf-g23EPV+R2-7inSpXbT5fqv5vDO8nL+DZrwA@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikNh5FTMmeQPqkSiX8ieG5oUw5UcuG83k8PeAiM@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimADCpNAJG4Pg02_UukH5hFW5eQfr-SymzqXrc=@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=8_288HiMhVQDwpFUCqMp+aBotECez44s44q7z@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=vSTA2B-jpTzShJab84W=-z1YBzvhW10wTXg_P@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikXiEtqtDWOycdJdyYSG+KfxAARiXhtDwrQm_v+@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinWS1m+j069Y+sTXrae-J5DamkkNTp-Wx8u7OTX@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinNsF7fA3Va=-63bYBE3EoOeZ21OOO8ZYunU0uR@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinw8sg3staDqr+=mBGqLgB0joQwKzKbFNGY_5sF@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=aZJDUcj0+p_0Or_P1v3xwSvk=7=s=+DjHFRcA@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinB0kczjTRe5etQtviQ0p9sxu-fmeh3FJ-Lx6Pg@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikwqUH6Z-NmxNmj02ysSaYYAQ_cuS5-kJ6K4U5u@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikZXALuxeob=_YvJjE5-ZyRrLTNqG-wTf_nxgqf@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=o2jzDfj+Y=WMMBTL=YpOT++n2X0sN=G4_S25+@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimthyxNok+Fsv94fnF8JVdia6VXJ6M0sDQYAAzT@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinydi7mCO0EeWvGOOyOw1a_h3f3618tC_+9FOF5@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimyoJqYWVk8Y7x3Y5UDWr_GaMa_dDVJ9492OEht@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=DQ9KGP+e0ONhZ66XhSzKhuQzFoQcQNwXnVsgG@xxxxxxxxxxxxxx&gt;	&lt;AANLkTind0EOBhSi_G=M_+LVY_WmLC=03f0-TMrvzs6zs@xxxxxxxxxxxxxx&gt;	&lt;AANLkTim1gTBVKDQPK=+aM1SHnuF7ZyKQTUzjpqBMt4xo@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinE=fRfL=-dfe-Uj6NAVuL9AOK9ENLC58C_-1iu@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinaaQTrpANe1zqD-pH3OGsk=sA8p7pWa4_GfrUb@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimFewU0=snUOZVVD==0d40oRuS4zNbdUsoEKMVM@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=U0rRm2Rv+ynBehBgcJ58gOcyGpZRu5vBGM1Pv@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=E2tq_mP1soRPB-1c67a0cX-NmXBYqVvot+aFA@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinBO3eWruVYxHj6g1m1Fbxr5BNC=FBo=a948V-q@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikPLDbCmJRKfn+1j0epx-=FAHq2eCBspBqwqizg@xxxxxxxxxxxxxx&gt;	&lt;AANLkTintdOt63AWrtS4_7R5C64j7aXZ0u8T41UaSRpGJ@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikDPM+srXqbPRUxv9ehk2NfGQ5HA6ODWueN4FWB@xxxxxxxxxxxxxx&gt;	&lt;AANLkTim0uEyEEmu1V3Rx8SN1hmWMThpxrORZr7RQDZ++@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on March 01, 2011 - 10:37:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

The renaming should be fine.  I see no reason at the moment why we
cannot perform an in place replacement of sigma_NOE with the NOE value
inside the data[x][y].ri data structure.  If sigma_NOE is needed in
the future, then the person who needs it can recalculate it from the
NOE and R1.

Cheers,

Edward


On 1 March 2011 10:22, Pavel Kaderavek &lt;pavel.kaderavek@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

Yes, you are right. It might be included in some of the following patches.
First, we would like to discuss changes in the next patch, where we would
like to replace variable name ri_prime in functions calc_(d,d2)noe in a file
maths_fns/ri.py to follow the changes in the patch:
<a  rel="nofollow" href="https://mail.gna.org/public/relax-devel/2011-02/msg00081.html">https://mail.gna.org/public/relax-devel/2011-02/msg00081.html</a>
It was pre-discussed in:
<a  rel="nofollow" href="https://mail.gna.org/public/relax-devel/2011-02/msg00084.html">https://mail.gna.org/public/relax-devel/2011-02/msg00084.html</a>

The changes also imply renaming of variables r1_data.(d,d2)ri_prime to
r1_data.(d,d2)ri in the initialization function init_res_r1_data (class Mf,
maths_fns/mf.py).

Best regards,
Pavel


On 1 March 2011 09:59, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi,

The patch looks good, I've now applied it.  In the future, you might
find that the self.diff_data structure does not need to be passed into
self.init_spin_data().

Cheers,

Edward



On 28 February 2011 16:51, Pavel Kaderavek &lt;pavel.kaderavek@xxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">This change is related to the task #6397 (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/?6397">https://gna.org/task/?6397</a>)

kada _at_ chemi _dot_ muni _dot_ cz

<a  rel="nofollow" href="https://mail.gna.org/public/relax-devel/2011-02/msg00088.html">https://mail.gna.org/public/relax-devel/2011-02/msg00088.html</a>
<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/download.php?file_id=12598">https://gna.org/task/download.php?file_id=12598</a>

This patch includes change in init_res_data function of class Mf in a
file
maths_fns/mf.py. The function is split into init_interaction_data and
init_spin_data. The initializations of data.ri_prime, data.dri_prime,
and
data.d2ri_prime are excluded. Calls for both newly introduced functions
are
incorporated in the patch.

On 25 February 2011 20:38, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi,

I agree, these are good designs.  The init_res_data name is a relic of
old code from relax 1.2 when only single residues were handled and not
individual and multiple spins per residue.  It should have been
renamed to init_spin_data.

Cheers,

Edward



On 25 February 2011 20:18, Pavel Kaderavek &lt;pavel.kaderavek@xxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

We would like to discuss the initialization of the spin and
interaction
data
(Spin_object, Data) in class Mf (maths_fns/mf.py). Currently, there
is a
function init_res_data which initializes variables in container Data.
The
container Data is now redesigned to store only the interaction
specific
information and the spin specific data were moved to Spin_object.

We suggest to rename init_res_data to init_interaction_data and move
spin
data initialization parts to a newly created function init_spin_data.
The
function init_interaction_dat will be called at the same place as the
original init_res_data, while init_spin_data will be called just
after
the
Spin_object is appended to self.data.

Best regards,
Pavel

On 25 February 2011 19:48, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

I should have read the text of the commit message more carefully :)

Bye,

Edward



On 25 February 2011 19:46, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Ah, this will also work.  I didn't release that one of the next
changes would be the in place replacement of sigma_noe by the NOE
value inside maths_fns/ri.py.  Ok, I'll commit the patch.

Cheers,

Edward



On 25 February 2011 19:34, Pavel Kaderavek
&lt;pavel.kaderavek@xxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,
maybe we misunderstood some parts of the code, but the
data.ri_prime
seems
to be used only in maths_fns/ri.py to calculate NOE value.
Therefore,
it
should be possible to replace data.ri_prime by data.ri directly
and
later
change function defined in ri.py to use data.ri instead of
data.ri_prime.

original code of maths_fns/ri.py:

def calc_noe(data, i, frq_num, get_r1, params):
    &quot;&quot;&quot;Calculate the NOE value.

    Half this code needs to be shifted into the function
initialisation
code.
    &quot;&quot;&quot;

    # Get the r1 value either from data.ri_prime or by
calculation
if
the
value is not in data.ri_prime
    data.r1[i] = get_r1[i](data, i, frq_num, params)

    # Calculate the NOE.
    if data.r1[i] == 0.0 and data.ri_prime[i] == 0.0:
        data.ri[i] = 1.0
    elif data.r1[i] == 0.0:
        data.ri[i] = 1e99
    else:
        data.ri[i] = 1.0 + data.g_ratio*(data.ri_prime[i] /
data.r1[i])

modified version:

def calc_noe(data, i, frq_num, get_r1, params):
    &quot;&quot;&quot;Calculate the NOE value.

    Half this code needs to be shifted into the function
initialisation
code.
    &quot;&quot;&quot;

    # Get the r1 value either from data.ri_prime or by
calculation
if
the
value is not in data.ri_prime
    data.r1[i] = get_r1[i](data, i, frq_num, params)

    # Calculate the NOE.
    if data.r1[i] == 0.0 and data.ri[i] == 0.0:
        data.ri[i] = 1.0
    elif data.r1[i] == 0.0:
        data.ri[i] = 1e99
    else:
        data.ri[i] = 1.0 + data.g_ratio*(data.ri[i] / data.r1[i])

the data structure data.ri is created during the initialization
and
data.ri
is calculated by function calc_noe. Therefore we
do not see a reason to keep this line in the code:

data.ri = data.ri_prime * 1.0

since data.ri would be calculated by cumulative summation as we
suggested.
Is our understanding correct?

Best regards,
Pavel


On 25 February 2011 18:16, Edward d'Auvergne
&lt;edward@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi,

The line:

data.ri = data.ri_prime * 1.0

is also quite important.  This creates a new data structure
data.ri
initialised to the values of data.ri_prime.  These lines are
probably
still necessary.

Cheers,

Edward



On 25 February 2011 18:14, Edward d'Auvergne
&lt;edward@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

I've just been looking at this patch, and it seems to have a
problem.
The new lines are:

           data.ri = data.ri +
data[j].create_ri_prime(data[j])

But this is ri_prime.  data.ri is created later on with the
call
to
data.create_ri.  Should this be:

           data.ri_prime = data.ri_prime +
data[j].create_ri_prime(data[j])

Regards,

Edward


On 25 February 2011 18:09, Pavel Kaderavek
&lt;pavel.kaderavek@xxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">This change is related to the task #6397
(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/?6397">https://gna.org/task/?6397</a>)

kada _at_ chemi _dot_ muni _dot_ cz

<a  rel="nofollow" href="https://mail.gna.org/public/relax-devel/2011-02/msg00076.html">https://mail.gna.org/public/relax-devel/2011-02/msg00076.html</a>
<a  rel="nofollow" href="https://gna.org/support/download.php?file_id=12556">https://gna.org/support/download.php?file_id=12556</a>

This patch includes change in  func_mf, func_local_tm,
func_diff,
func_all,
dfunc_mf, dfunc_local_tm, dfunc_diff, dfunc_all, d2func_mf,
d2func_local_tm,
d2func_diff, d2func_all functions of class Mf in a file
maths_fns/mf.py. The
functions were modified in order to handle data for more
interactions.
Due to the equality of (d,d2)ri and (d,d2)ri_prime variables,
the
(d,d2)ri_prime were replaced by (d,d2)ri and the equality was
removed.
Moreover, (d,d2)ri was redefined as a cumulative sum of
individual
interaction contributions to the total relaxation rate or
corresponding
derivatives.


On 24 February 2011 12:26, Edward d'Auvergne
&lt;edward@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi,

Please see below:


On 24 February 2011 10:02, Pavel Kaderavek
&lt;pavel.kaderavek@xxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

We realized a problem during the preparation of the
following
patch.
Currently, it is impossible to initialize variables in the
originally
suggested way:

data = self.data[0]
data.ri_prime = 0.0

in the function func_mf (maths_fns/mf.py) and other
similar
functions
(func_local_tm, func_diff, func_all, and their equivalents
for a
first
and
second derivatives).
</pre></blockquote><pre style="margin: 0em;">

Ah, yes.  'data' here is a list rather than a container, so
you
can't
do this.  If you like, what I can do is create a special
list-like
object for this.  The you can access list elements, but also
place
variables inside it.

The other problem is that ri_prime returned by
maths_fns.ri_prime.func_ri_prime() is not a number but a
numpy
array.
Its dimensions are Nx1, where N is the number of relaxation
data
points.  So the initialisation will have to be at the very
start
rather than in the func_mf() methods, and it needs to be
initialised
to the correct numpy object using something like
'zeros(num_ri[i],
float64)'.  The dri_prime, d2ri_prime, ri, dri, and d2ri
prime
will
have similar problems.

I would suggest that 'ri_prime' does not need to be summed,
but
only
'ri'.  Or am I missing something?  The difference between ri
and
ri_prime is that ri contains the steady-state NOE whereas
ri_prime
contains sigma_NOE.  Do we need to store and sum ri_prime at
all?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">It is not possible because of the approved changes of
__init__
function
in
the class Mf (file maths_fns/mf.py). The array used to
store
data is
created
in the following way:

        self.data = []
        for i in xrange(self.num_spins):
            ...
            self.data.append([])
            ...
            # Loop over the relaxation interactions.
            for j in xrange(self.num_interactions[i]):
                self.data[i].append(Data()) # This is a
list
dedicated
for
the storage of interaction specific parameters (i.e. type
of
interaction,
internuclei distance, ...)

self.data[i][j].interactions=interactions[i][j]



self.data[i][j].internuclei_distance=internuclei_distance[i][j]
                ...


Thus, the list for a storage of spin specific data does
not
exist
and
the
suggested variable location does not exist:
self.data[0].ri_prime
</pre></blockquote><pre style="margin: 0em;">

This can be created, if I make this special Python list-like
object.
There is already one special object, the Data class at the
very
end of
the file.  I can create a list-like object here as well, and
initialise each spin object to this.  Ok, I've just added
this
code in
r12618.  This should fix the problem and not cause too many
problems
with your current code.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">We found some possible ways to solve the problem. However
we
do
not
think,
they are ideal.
First, we can add for each spin a new list except those
which
store
the
interaction specific data. Data_spin list would be at the
beginning
of
the
array and therefore every loop over interactions in the
code
has
to
keep
it
in mind and start from index 1 not 0 to avoid Data_spin
list.

The second possibility is based on the idea to declare for
each
spin
a
class
Spin_data. The Spin_data would contain all spin specific
variables
(ri_prime, chi2, ...) and also a class Data which would
contain
interaction
specific data.

What do you think about these suggestions? We will be glad
for
any
better
suggestion, than ours.
</pre></blockquote><pre style="margin: 0em;">

I have taken your second idea, but it is inbuilt into the
self.data[i]
structure itself rather than a separate object inside
self.data.
 I
hope this solution will be ok.

Cheers,

Edward
</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00004" href="msg00004.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Pavel Kaderavek</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00000" href="msg00000.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00001" href="msg00001.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Pavel Kaderavek</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Mar 01 13:00:08 2011</div>  
</body>
</html>
