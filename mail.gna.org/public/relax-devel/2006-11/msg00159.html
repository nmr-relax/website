<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: r2801 &#45; /branches/test_suite/float.py -->
<!--X-From-R13: "Unel E. Fubzcfba" <tnelgNozo.yrrqf.np.hx> -->
<!--X-Date: Mon, 13 Nov 2006 16:55:33 +0100 -->
<!--X-Message-Id: 45589547.1080509@bmb.leeds.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1GipcG&#45;0005K7&#45;3b@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r2801 - /branches/test_suite/float.py -- November 13, 2006 - 16:55</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r2801 - /branches/test_suite/float.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00159" class="tabs">Index by Date</a> | <a href="threads.html#00159" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00158.html">Date Prev</a>] [<a href="msg00160.html">Date Next</a>] [<a href="msg00152.html">Thread Prev</a>] [<a href="msg00160.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>Date</em>: Mon, 13 Nov 2006 15:54:47 +0000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00159.html">45589547.1080509@bmb.leeds.ac.uk</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1GipcG-0005K7-3b@subversion.gna.org&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla Thunderbird 1.0 (X11/20041206)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Gary S. Thompson</strong> on November 13, 2006 - 16:55:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">edward.dauvergne@xxxxxxxxx wrote:</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Author: bugman
Date: Sat Nov 11 10:57:35 2006
New Revision: 2801</pre><br>
<pre style="margin: 0em;">URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=2801&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=2801&amp;view=rev</a>
Log:
Two functions for converting a string bit pattern to a float and a number of 
IEEE-754 constants.</pre><br>
<tt>The fucntions 'bitpatternToFloat()' and 'bitpatternToInt()' have been added to 'float.py'.  The<br>
first converts a 64 bit IEEE-754 bit pattern in the form of a string into a 64 bit Python float.<br>
The second converts an arbitrary bit pattern into its integer representation.  By looping over each<br>
8 characters of the string (1 byte), 'bitpatternToFloat()' calls 'bitpatternToInt()' to create an<br>
array of integers.  Then 'packBytesAsPyFloat()' is called to convert the byte array into the float.<br>
These two functions convert between big and little endian when necessary.<br>
 </tt><br>
<br>
</blockquote><pre style="margin: 0em;">Nice functions! However, I would suggest that these should go in utility
functions or  the test suite.... I am trying to keep float.py as the
bare minimum file for testing floating point numbers and floating point
constants</pre><br>
<pre style="margin: 0em;">A couple of other matters as well</pre><br>
<pre style="margin: 0em;">1. the constants are not much use at the end of the file as if anything
else in the file wants to refer to them they won't be able to
2. I was thinking of a test case with random numbers in the exponent of
the nan and then reporting what the bit pattern that failed was....
3. I was also thinking of having test caseswith minimum and maximum bit
patterns e.g. max denorm min denorm nan with highest mantissa bit set
nan with smallest mantissa bit set etc</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">By passing big-endian 64 bit patterns to the 'bitpatternToFloat()' function, 
the following IEEE-754
constants are defined:
   PosZero:            
0000000000000000000000000000000000000000000000000000000000000000
   NegZero:            
1000000000000000000000000000000000000000000000000000000000000000
   PosEpsilonDenorm:   
0000000000000000000000000000000000000000000000000000000000000001
   NegEpsilonDenorm:   
1000000000000000000000000000000000000000000000000000000000000001
   PosEpsilonNorm:     
0000000000010000000000000000000000000000000000000000000000000001
   NegEpsilonNorm:     
1000000000010000000000000000000000000000000000000000000000000001
   PosMax:             
0111111111101111111111111111111111111111111111111111111111111111
   NegMin:             
1111111111101111111111111111111111111111111111111111111111111111
   PosInf:             
0111111111110000000000000000000000000000000000000000000000000000
   NegInf:             
1111111111110000000000000000000000000000000000000000000000000000
   PosNaN_A:           
0111111111110000000000000000000000000000001000000000000000000000
   NegNaN_A:           
1111111111110000000000000000000000000000001000000000000000000000
   PosNaN_B:           
0111111111110000000000000000011111111111111111111110000000000000
   NegNaN_B:           
1111111111110000000000000000011111111111111111111110000000000000
   PosNaN_C:           
0111111111110101010101010101010101010101010101010101010101010101
   NegNaN_C:           
1111111111110101010101010101010101010101010101010101010101010101
   PosNaN = PosNaN_C
   NegNaN = NegNaN_C</pre><br>
<tt> </tt><br>
<br>
</blockquote><pre style="margin: 0em;">I have some code that reads and displays these as octes which makes life
easier...</pre><br>
<pre style="margin: 0em;">11111111 11110101 01010101 01010101 01010101 01010101 01010101 01010101</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Modified:
   branches/test_suite/float.py</pre><br>
<tt>Modified: branches/test_suite/float.py<br>
URL: <a  href="http://svn.gna.org/viewcvs/relax/branches/test_suite/float.py?rev=2801&amp;r1=2800&amp;r2=2801&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/test_suite/float.py?rev=2801&amp;r1=2800&amp;r2=2801&amp;view=diff</a><br>
==============================================================================<br>
--- branches/test_suite/float.py (original)<br>
+++ branches/test_suite/float.py Sat Nov 11 10:57:35 2006<br>
@@ -637,6 +637,7 @@<br>
    '''        
    return isInf(obj) and isPositive(obj)</tt><br>
<br>
<tt>+<br>
def isNegInf(obj):<br>
    ''' check to see if a python float is negative infinity 
        
@@ -647,11 +648,124 @@<br>
        
        throws -- throws a TypeError if obj isn't a python float     
    '''<br>
-        
-    return isInf(obj) and not isPositive(obj)   
-    
-<br>
-    
-<br>
-<br>
-<br>
+<br>
+    return isInf(obj) and not isPositive(obj)<br>
+<br>
+<br>
+def bitpatternToFloat(string, endian='big'):<br>
+    &quot;&quot;&quot;Convert a 64 bit IEEE-754 ascii bit pattern into a 64 bit Python float.<br>
+<br>
+    @param string:  The ascii bit pattern repesenting the IEEE-754 float.<br>
+    @type string:   str<br>
+    @param endian:  The endianness of the bit pattern (can be 'big' or 'little').<br>
+    @type endian:   str<br>
+    @return:        The 64 bit float corresponding to the IEEE-754 bit pattern.<br>
+    @returntype:    float<br>
+    @raise:         TypeError if 'string' is not a string, the length of the 'string' is not 64, or<br>
+        if 'string' does not consist solely of the characters '0' and '1'.<br>
+    &quot;&quot;&quot;<br>
+<br>
+    # Test that the bit pattern is a string.<br>
+    if type(string) != str:<br>
+        raise TypeError, &quot;The string argument '%s' is not a string.&quot; % string<br>
 </tt><br>
<br>
</blockquote><pre style="margin: 0em;"><br>I think this is to restrictive opther things can act as sequences...</pre><br>
<br>
<blockquote class="blockquote"><tt>+<br>
+    # Test the length of the bit pattern.<br>
+    if len(string) != 64:<br>
+        raise TypeError, &quot;The string '%s' is not 64 characters long.&quot; % string<br>
+<br>
+    # Test that the string consists solely of zeros and ones.<br>
+    for char in string:<br>
+        if char not in ['0', '1']:<br>
+            raise TypeError, &quot;The string '%s' should be composed solely of the characters '0' and '1'.&quot; % string<br>
+<br>
+    # Reverse the byte order as neccessary.<br>
+    if endian == 'big' and sys.byteorder == 'little':<br>
+        string = string[::-1]<br>
+    elif endian == 'little' and sys.byteorder == 'big':<br>
+        string = string[::-1]<br>
+<br>
 </tt><br>
<br>
</blockquote><pre style="margin: 0em;"><br>this could be better written as</pre><br>
<pre style="margin: 0em;"># Reverse the byte order as neccessary.
if endian != sys.byteorder:
   string = string[::-1]</pre><br>
<pre style="margin: 0em;"><br>and then add an assert effectivley of the form endian..tolower()  in
('little','big')</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">+    # Convert the bit pattern into a byte array (of integers).
+    bytes = []
+    for i in xrange(8):
+        bytes.append(bitpatternToInt(string[i*8:i*8+8], 
endian=sys.byteorder))
+
+    # Pack the byte array into a float and return it.
+    return packBytesAsPyFloat(bytes)
+
+
+def bitpatternToInt(string, endian='big'):
+    &quot;&quot;&quot;Convert a bit pattern into its integer representation.
+
+    @param string:  The ascii string repesenting binary data.
+    @type string:   str
+    @param endian:  The endianness of the bit pattern (can be 'big' or 
'little').
+    @type endian:   str
+    @return:        The integer value.
+    @returntype:    int
+    &quot;&quot;&quot;
+
+    # Test that the bit pattern is a string.
+    if type(string) != str:
+        raise TypeError, &quot;The string argument '%s' is not a string.&quot; % string
+
+    # Test that the string consists solely of zeros and ones.
+    for char in string:
+        if char not in ['0', '1']:
+            raise TypeError, &quot;The string '%s' should be composed solely of the 
characters '0' and '1'.&quot; % string
+
+    # Reverse the byte order as neccessary.
+    if endian == 'big' and sys.byteorder == 'little':
+        string = string[::-1]
+    elif endian == 'little' and sys.byteorder == 'big':
+        string = string[::-1]
+
+    # Calculate the integer corresponding to the string.
+    int_val = 0
+    for i in xrange(len(string)):
+        if int(string[i]):
+            int_val = int_val + 2**i
+
+    # Return the integer value.
+    return int_val
+
+
+# IEEE-754 Constants.
+#####################
+
+# The following bit patterns are to be read from right to left (big-endian).
+# Hence bit positions 0 and 63 are to the far right and far left 
respectively.
+PosZero             = 
bitpatternToFloat('0000000000000000000000000000000000000000000000000000000000000000',
 endian='big')
+NegZero             = 
bitpatternToFloat('1000000000000000000000000000000000000000000000000000000000000000',
 endian='big')
+PosEpsilonDenorm    = 
bitpatternToFloat('0000000000000000000000000000000000000000000000000000000000000001',
 endian='big')
+NegEpsilonDenorm    = 
bitpatternToFloat('1000000000000000000000000000000000000000000000000000000000000001',
 endian='big')
+PosEpsilonNorm      = 
bitpatternToFloat('0000000000010000000000000000000000000000000000000000000000000001',
 endian='big')
+NegEpsilonNorm      = 
bitpatternToFloat('1000000000010000000000000000000000000000000000000000000000000001',
 endian='big')
+PosMax              = 
bitpatternToFloat('0111111111101111111111111111111111111111111111111111111111111111',
 endian='big')
+NegMin              = 
bitpatternToFloat('1111111111101111111111111111111111111111111111111111111111111111',
 endian='big')
+PosInf              = 
bitpatternToFloat('0111111111110000000000000000000000000000000000000000000000000000',
 endian='big')
+NegInf              = 
bitpatternToFloat('1111111111110000000000000000000000000000000000000000000000000000',
 endian='big')
+PosNaN_A            = 
bitpatternToFloat('0111111111110000000000000000000000000000001000000000000000000000',
 endian='big')
+NegNaN_A            = 
bitpatternToFloat('1111111111110000000000000000000000000000001000000000000000000000',
 endian='big')
+PosNaN_B            = 
bitpatternToFloat('0111111111110000000000000000011111111111111111111110000000000000',
 endian='big')
+NegNaN_B            = 
bitpatternToFloat('1111111111110000000000000000011111111111111111111110000000000000',
 endian='big')
+PosNaN_C            = 
bitpatternToFloat('0111111111110101010101010101010101010101010101010101010101010101',
 endian='big')
+NegNaN_C            = 
bitpatternToFloat('1111111111110101010101010101010101010101010101010101010101010101',
 endian='big')
+PosNaN = PosNaN_C
+NegNaN = NegNaN_C
+
+#print &quot;%-30s%-20.40g&quot; % (&quot;Pos zero: &quot;, PosZero)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Neg zero: &quot;, NegZero)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Pos epsilon denorm: &quot;, PosEpsilonDenorm)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Neg epsilon denorm: &quot;, NegEpsilonDenorm)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Pos epsilon norm: &quot;, PosEpsilonNorm)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Neg epsilon norm: &quot;, NegEpsilonNorm)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Max: &quot;, PosMax)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Min: &quot;, NegMin)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Pos inf: &quot;, PosInf)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Neg inf: &quot;, NegInf)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Pos NaN (A): &quot;, PosNaN_A)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Neg NaN (A): &quot;, NegNaN_A)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Pos NaN (B): &quot;, PosNaN_B)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Neg NaN (B): &quot;, NegNaN_B)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Pos NaN (C): &quot;, PosNaN_C)
+#print &quot;%-30s%-20.40g&quot; % (&quot;Neg NaN (C): &quot;, NegNaN_C)</pre><br>
<pre style="margin: 0em;"><br>_______________________________________________
relax (<a  href="http://nmr-relax.com">http://nmr-relax.com</a>)</pre><br>
<pre style="margin: 0em;">This is the relax-commits mailing list
relax-commits@xxxxxxx</pre><br>
<pre style="margin: 0em;">To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a></pre><br>
<pre style="margin: 0em;">.</pre><br>
<tt> </tt><br>
<br>
</blockquote><pre style="margin: 0em;">regards
gary</pre><br>
<pre style="margin: 0em;">--
-------------------------------------------------------------------
Dr Gary Thompson
Astbury Centre for Structural Molecular Biology,
University of Leeds, Astbury Building,
Leeds, LS2 9JT, West-Yorkshire, UK             Tel. +44-113-3433024
email: garyt@xxxxxxxxxxxxxxx                   Fax  +44-113-2331407
-------------------------------------------------------------------</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;"><br></pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00160" href="msg00160.html">Re: r2801 - /branches/test_suite/float.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Nov 15 10:00:30 2006</div>  
</body>
</html>
