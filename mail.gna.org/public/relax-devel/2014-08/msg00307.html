<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 26 Aug 2014 19:24:57 +0200 -->
<!--X-Message-Id: CAED9pY&#45;cMPLjRMhLmX3uAA3C+tLb=gDR_Ai14fgEkZtZs4vWMg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140824&#45;155636.sv20529.53107@gna.org -->
<!--X-Reference: CAED9pY&#45;2d9hsRS+t23hHvpY7DkuMH5_ShkOc_xjbgNag1rJAtA@mail.gmail.com -->
<!--X-Reference: CAED9pY80Uu4PJ9xSd0xoEDdVy6MmZRoF04N3gv=7k0zsTxTC0Q@mail.gmail.com -->
<!--X-Reference: CA+CBx2PggFprd1MPUrzxZ0vNkv7ogkZitYEH9tNVzed=o_D_ww@mail.gmail.com -->
<!--X-Reference: CAED9pY_sm6bL&#45;ev4_F1PpQzzitKwnaFuPF&#45;TywapQdu9PvLtkg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting. -- August 26, 2014 - 19:24</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00307" class="tabs">Index by Date</a> | <a href="threads.html#00307" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00306.html">Date Prev</a>] [<a href="msg00308.html">Date Next</a>] [<a href="msg00300.html">Thread Prev</a>] [<a href="msg00308.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 26 Aug 2014 19:24:27 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=PRsV/geHOj2s+1gVjQ5vYfXyuD17ElbGvgey7Su0mz8=; b=syuqLOVd6It+0LDQA7jIsJ3d0Zru4umBnHvJG2nR1h72wYsseWyGAPGKZtulzmQwBi d6M2ap1reD8G3XPXCzFc7WPyk78oahg/HAFW5NXsviyhk3RRV/pR5B2khf4s14yjyXQB 8RRTJXmIhz89fWHv3pp8SAl9d63P6oMu1Vdnd85L0dv4IOxTk1mU1ZDRZEjyU2g94wi3 iwLEyi5kCLgb/C46FsVGN5t4JxCKfi2QCvLo7lCnP47E5PXf6iN7+cbnkA8GrVr2hKmy g5WA0ChAQ2ieGIgr/5CVG6GQw869fPxt8QwieTzis2FiXTVi+lSbV/SB7dhgRFeURpT+ VtMQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY-cMPLjRMhLmX3uAA3C+tLb=gDR_Ai14fgEkZtZs4vWMg@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00254.html">20140824-155636.sv20529.53107@gna.org</a>&gt; &lt;<a href="msg00295.html">CAED9pY-2d9hsRS+t23hHvpY7DkuMH5_ShkOc_xjbgNag1rJAtA@mail.gmail.com</a>&gt; &lt;CAED9pY80Uu4PJ9xSd0xoEDdVy6MmZRoF04N3gv=7k0zsTxTC0Q@mail.gmail.com&gt; &lt;CA+CBx2PggFprd1MPUrzxZ0vNkv7ogkZitYEH9tNVzed=o_D_ww@mail.gmail.com&gt; &lt;<a href="msg00300.html">CAED9pY_sm6bL-ev4_F1PpQzzitKwnaFuPF-TywapQdu9PvLtkg@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on August 26, 2014 - 19:24:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Oh well, I had some time between frame order calculations and decided
to practice my C coding a little.  The full exponential curve Hessian
is now implemented.  It may still need debugging.  But you can now use
the full Newton algorithm in your timing tests and comparisons to
Scipy.

Regards,

Edward

On 26 August 2014 13:32, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Test it and see ;)  And if you are interested in the speed up in this
part of the analysis, you can take it one more step and implement the
Hessian in the C modules and then time the Newton algorithm!

Regards,

Edward

On 26 August 2014 13:26, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Should this be used instead then in R2eff minimisation?

Is it faster than simplex?

Best
Troels

2014-08-26 13:04 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Oh, I forgot to mention, but I also converted the
Relax_fit.test_curve_fitting_height and
Relax_fit.test_curve_fitting_volume system tests to use BFGS
optimisation.  This is one of the best optimisation techniques when
only the function and gradient are present, as it tries to numerically
approximate the Hessian matrix, updating it as the algorithm moves
along.  It is fast and performs incredibly well, so it is a widely
used algorithm.  The system tests using BFGS demonstrate that the
gradient works very well for optimisation.  It isn't as fast as Newton
optimisation however.

Regards,

Edward




On 26 August 2014 13:00, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

I've now implemented the exponential curve-fitting dfunc() function
for calculating the gradient.  This includes:

- The Python wrapper function
specific_analyses.relax_fit.optimisation.dfunc_wrapper(),
- The target_functions/c_chi2.c function dchi2(),
- The target_functions/exponential.c functions exponential_dI0() and
exponential_dR(),
- The target_functions.relax_fit C module dfunc() Python function.

I have tested the gradient using the numerical integration in the
test_suite/shared_data/curve_fitting/numeric_gradient/integrate.py
file to determine what the chi-squared gradient should be at different
parameter combinations.  And this has been converted into a few unit
tests.  As this works, that means that the jacobian() function of the
C module should also be correct and bug-free, hence you should be able
to use it to obtain the covariance matrix.

This is all I will do for now.  All that is left is to do for the
target_functions.relax_fit C module is simply the same thing, but for
the Hessian.  Feel free to give this a go if you are interested.  If I
have time in the future, I might add this too.

Regards,

Edward





On 24 August 2014 17:56, Troels E. Linnet
&lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">URL:
  &lt;<a  rel="nofollow" href="http://gna.org/task/?7822">http://gna.org/task/?7822</a>&gt;

                 Summary: Implement user function to estimate R2eff and
associated errors for exponential curve fitting.
                 Project: relax
            Submitted by: tlinnet
            Submitted on: Sun 24 Aug 2014 03:56:36 PM UTC
         Should Start On: Sun 24 Aug 2014 12:00:00 AM UTC
   Should be Finished on: Sun 24 Aug 2014 12:00:00 AM UTC
                Category: relax's source code
                Priority: 5 - Normal
                  Status: In Progress
        Percent Complete: 0%
             Assigned to: tlinnet
             Open/Closed: Open
         Discussion Lock: Any
                  Effort: 0.00

    _______________________________________________________

Details:

A verification script, showed that using scipy.optimize.leastsq reaches 
the
exact same parameters as minfx for exponential curve fitting.

The verification script is in:
test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py
test_suite/shared_data/curve_fitting/profiling/verify_error.py

The profiling script shows that a 10 X increase in speed can be reached 
by
removing
the linear constraints when using minfx.

The profiling also shows that scipy.optimize.leastsq is 10X as fast as 
using
minfx, even without linear constraints.

scipy.optimize.leastsq is a wrapper around wrapper around MINPACK's 
lmdif and
lmder algorithms.

MINPACK is a FORTRAN90 library which solves systems of nonlinear 
equations, or
carries out the least squares minimization of the residual of a set of 
linear
or nonlinear equations.

 The verification script also shows, that a very heavy and time 
consuming
monte carlo simulation of 2000 steps, reaches the same errors as the 
errors
reported by scipy.optimize.leastsq.

The return from scipy.optimize.leastsq, gives the estimated co-variance.
Taking the square root of the co-variance corresponds with 2X error 
reported
by minfx after 2000 Monte-Carlo simulations.

This could be an extremely time saving step, when performing model 
fitting in
R1rho, where the errors of the R2eff values, are estimated by 
Monte-Carlo
simulations.

The following setup illustrates the problem.
This was analysed on a: MacBook Pro, 13-inch, Late 2011.
With no multi-core setup.

Script running is:
test_suite/shared_data/dispersion/Kjaergaard_et_al_2013/2_pre_run_r2eff.py

This script analyses just the R2eff values for 15 residues.
It estimates the errors of R2eff based on 2000 Monte Carlo simulations.
For each residues, there is 14 exponential graphs.

The script was broken after 35 simulations.
This was measured to 20 minutes.
So 500 simulations would take about 4.8 Hours.

The R2eff values and errors can by scipy.optimize.leastsq can instead be
calculated in: 15 residues * 0.02 seconds = 0.3 seconds.




    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/task/?7822">http://gna.org/task/?7822</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00308" href="msg00308.html">Re: [task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00254" href="msg00254.html">[task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting.</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00295" href="msg00295.html">Re: [task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00296" href="msg00296.html">Re: [task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00298" href="msg00298.html">Re: [task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00300" href="msg00300.html">Re: [task #7822] Implement user function to estimate R2eff and associated errors for exponential curve fitting.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Aug 26 20:00:17 2014</div>  
</body>
</html>
