<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [task #7882] Implement Monte&#45;Carlo simulation, where errors are generated with width of standard deviation or residuals -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 19 Jan 2015 18:48:54 +0100 -->
<!--X-Message-Id: CAED9pY9g31urPky59eh7RjU3L9BBQ6O&#45;AVoDvwnD6k7oGYUFRg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20150116&#45;161430.sv20529.18990@gna.org -->
<!--X-Reference: CAED9pY9Ptz7oi+jFAENz=kk9+62Cy+BSjQ+_YHpk6ou5iivqkw@mail.gmail.com -->
<!--X-Reference: CA+CBx2PXMLmqGVVfKZWwV_OR2Qx0QPVebaYnoebZ4W&#45;t3fj6CA@mail.gmail.com -->
<!--X-Reference: CAED9pY9xFdgK=y==pHoEbd5=0v1qXd&#45;SXdM+czNo0vE2Fx7FQg@mail.gmail.com -->
<!--X-Reference: CA+CBx2P_mhA1hcB01ACYcyqAZwFakMD6BLwJ3q8jdWBwQYJ_ZA@mail.gmail.com -->
<!--X-Reference: CAED9pY9fn7ONn+MeknhH5Hm_bPrZwjfvkngZUwMc6SxTB4HNEg@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;qXRehqq&#45;=SJ2K&#45;cU1PkmF9GmhNi4uXGz8h4xr+JZZUw@mail.gmail.com -->
<!--X-Reference: CAED9pY8Ou+HaBez3YdXeA=3by6A_a3QJH2qPVqk3nsCGKEOM2Q@mail.gmail.com -->
<!--X-Reference: CA+CBx2MEnCdcB_bD8jMV6_24&#45;+59gLt21=xLso1jv7qDX2h9Vg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals -- January 19, 2015 - 18:48</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00059" class="tabs">Index by Date</a> | <a href="threads.html#00059" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00058.html">Date Prev</a>] [<a href="msg00060.html">Date Next</a>] [<a href="msg00058.html">Thread Prev</a>] [<a href="msg00041.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtek√¶r Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 19 Jan 2015 18:48:29 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type; bh=FEYK+CbfeBptZnTL86m54b4iL6oKpS7heMi8M+Z/U8k=; b=sqFyGCsiZFEWl1/2/lqctdSPFRMqcphHyD0oI3+AA4bYEFbhljaya97lPraIlMi+kE NEpAzwnhWvTAa7az6JTdDjvkGeKtLWij02G8cZkOwR3QdGgGXw4peJ/z/CHmEVNYVyTO +ryzj5Ch80q6pFJDXB5bN9LRHQMYX+OqoVmFnFSA+XXPDrkqzgxP6UnYn6XnWtgicYsm QszHnoFhcy1G+pHBF/3uEYIJ2xqMfpwIIQmiL+6tbUS/1Y3m6p+Ae/rOTrSvXNr2JPVX bG+8foFMajH+oY7vf3PVcsCedhUqSboLC+BSAOUZz+Fdrz1dtHqWVTE8ujafbJLWaT0n 7TTA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00059.html">CAED9pY9g31urPky59eh7RjU3L9BBQ6O-AVoDvwnD6k7oGYUFRg@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00034.html">20150116-161430.sv20529.18990@gna.org</a>&gt; &lt;CAED9pY9Ptz7oi+jFAENz=kk9+62Cy+BSjQ+_YHpk6ou5iivqkw@mail.gmail.com&gt; &lt;<a href="msg00036.html">CA+CBx2PXMLmqGVVfKZWwV_OR2Qx0QPVebaYnoebZ4W-t3fj6CA@mail.gmail.com</a>&gt; &lt;CAED9pY9xFdgK=y==pHoEbd5=0v1qXd-SXdM+czNo0vE2Fx7FQg@mail.gmail.com&gt; &lt;<a href="msg00038.html">CA+CBx2P_mhA1hcB01ACYcyqAZwFakMD6BLwJ3q8jdWBwQYJ_ZA@mail.gmail.com</a>&gt; &lt;<a href="msg00039.html">CAED9pY9fn7ONn+MeknhH5Hm_bPrZwjfvkngZUwMc6SxTB4HNEg@mail.gmail.com</a>&gt; &lt;CAED9pY-qXRehqq-=SJ2K-cU1PkmF9GmhNi4uXGz8h4xr+JZZUw@mail.gmail.com&gt; &lt;CAED9pY8Ou+HaBez3YdXeA=3by6A_a3QJH2qPVqk3nsCGKEOM2Q@mail.gmail.com&gt; &lt;CA+CBx2MEnCdcB_bD8jMV6_24-+59gLt21=xLso1jv7qDX2h9Vg@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on January 19, 2015 - 18:48:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

</pre><blockquote class="blockquote"><pre style="margin: 0em;">I have used this regression book.
<a  rel="nofollow" href="http://www.graphpad.com/faq/file/Prism4RegressionBook.pdf">http://www.graphpad.com/faq/file/Prism4RegressionBook.pdf</a>

I like the language (fun and humoristic), and goes over a great detail.
For example, there is quite a list of weighting methods.
I find the comments on page 28 a little disturbing.
(See also page 86+87)
</pre></blockquote><pre style="margin: 0em;">

We already weight by the individual data point error.  As we are using
non-linear least squared fitting of the chi2 value, the weights
described on pages 86 and 87 are not relevant.  For dispersion data
they are also not relevant as the NMR spectrum is so complicated that
any of these weights will not reliably replicate the field dependent
effects, the peak height effects, etc.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The Monte-Carlo simulation is described at page 104.

1) Create an ideal data set.
-&gt; Check. This is done with relax
monte_carlo.create_data(method='back_calc')
</pre></blockquote><pre style="margin: 0em;">

This is correct.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">2) Add random scatter.
relax now add random scatter, per individual datapoint. The random scatter
is drawn from the measured error of the datapoint.
</pre></blockquote><pre style="margin: 0em;">

Point 2) is correct, it is how you perform Monte Carlo simulations for
non-linear regression.  The reason is two fold - because in regression
you don't know the error sigma_i, and because the residuals can be
used as an estimator of sigma_i.  But there is a much better error
estimator.  That is to use residuals in bootstrapping to estimate the
data errors (as mentioned on page 108).  This would be far superior!

However we are using non-linear least squares optimisation, not
regression.  Therefore we do not need an estimator of the errors, as
we already know the errors.  The residuals or error bootstrapping
techniques are only there to estimate the measured error, which we
already have.  If the residues or error bootstrapping have been
successful, these should converge to the measured errors.  So this is
unlikely to be the source of your too low kex error.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">But the book suggest adding errors described by variance of the residuals.
This is described at page 33.
&quot;If you chose to weight the values and minimize the relative distance
squared (or some other weighting function), goodness-of-fit is quantified
with the weighted sum- of-squares.&quot;

Sy.x = sqrt(SS/dof) = sqrt(chi2 / dof)
The question is of course, if SS should be sum of squared errors for the
weighted points, or the non-weighted R2eff points.
</pre></blockquote><pre style="margin: 0em;">

Note that the variance of the residuals is an error estimator.  All
estimators also have an error (this is the error of an error, or sigma
of sigma_i).  In the case of a single spin system, as there are not
many R2eff points, sigma of sigma_i will be big (you need 500+ points
before sigma of sigma_i is reasonably small).  Hence your error
estimates from such methods will be very noisy.

In any case, because the chi-squared value has been optimised, this is
not the same solution as the regression of the SSE.  The two minima
are not necessarily the same.  They converge under certain strong
conditions in the regression problem (Gaussian errors, no outliers,
and errors for all points for all field strengths are the same).
Because the two solutions are not the same you cannot use the SSE
value, which would have to be calculated from the base data and
back-calculated data, for the error estimate.  It can only be used
strictly under the convergence condition.

I don't know of any error estimate for the non-linear least squares
optimisation problem.  But one probably has been derived for the cases
when the errors are not known.  This would require a different
reference, as the GraphPad Prism 4 book only covers regression and not
least squares and hence cannot give the correct answer.  The Numerical
Optimisation book by Nocedal and Wright
(<a  rel="nofollow" href="https://books.google.de/books?id=VbHYoSyelFcC&amp;lpg=PP1&amp;dq=numerical%20optimisation%20nocedal%20wright&amp;pg=PP1#v=onepage&amp;q=numerical%20optimisation%20nocedal%20wright&amp;f=false">https://books.google.de/books?id=VbHYoSyelFcC&amp;lpg=PP1&amp;dq=numerical%20optimisation%20nocedal%20wright&amp;pg=PP1#v=onepage&amp;q=numerical%20optimisation%20nocedal%20wright&amp;f=false</a>)
also doesn't seem to cover this.  Do you know the Numerical Recipes
books (<a  rel="nofollow" href="http://www.nr.com/">http://www.nr.com/</a>)?  Maybe there is something in there.  Monte
Carlo simulations are described very clearly in section 15.6 of the
second edition.  There might be something in chapter 15, &quot;the
modelling of data&quot; detailing the correct error estimate for this
problem.

As a side note, for the non-linear least squares problem when errors
are unknown and Monte Carlo simulations are not an option, the
covariance matrix might be the best error estimate.

Regards,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00034" href="msg00034.html">[task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00035" href="msg00035.html">Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00036" href="msg00036.html">Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Troels Emtek√¶r Linnet</li></ul></li>
<li><strong><a name="00037" href="msg00037.html">Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00038" href="msg00038.html">Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Troels Emtek√¶r Linnet</li></ul></li>
<li><strong><a name="00039" href="msg00039.html">Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00040" href="msg00040.html">Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00049" href="msg00049.html">Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00054" href="msg00054.html">Re: [task #7882] Implement Monte-Carlo simulation, where errors are generated with width of standard deviation or residuals</a></strong>
<ul><li><em>From:</em> Troels Emtek√¶r Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Jan 20 12:40:12 2015</div>  
</body>
</html>
