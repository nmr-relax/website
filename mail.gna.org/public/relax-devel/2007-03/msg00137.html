<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: r3241 &#45; in /branches/multi_processor: maths_fns/mf.py	multi/mpi4py_processor.py -->
<!--X-From-R13: "Unel E. Fubzcfba" <tnelgNozo.yrrqf.np.hx> -->
<!--X-Date: Tue, 27 Mar 2007 17:47:13 +0200 -->
<!--X-Message-Id: 46093C46.3070309@bmb.leeds.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1HWBpX&#45;0002aV&#45;Ow@subversion.gna.org -->
<!--X-Reference: 7f080ed10703270715o218f4121qb4e867586717d484@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r3241 - in /branches/multi_processor: maths_fns/mf.py	multi/mpi4py_processor.py -- March 27, 2007 - 17:47</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r3241 - in /branches/multi_processor: maths_fns/mf.py	multi/mpi4py_processor.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00137" class="tabs">Index by Date</a> | <a href="threads.html#00137" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00136.html">Date Prev</a>] [<a href="msg00138.html">Date Next</a>] [<a href="msg00134.html">Thread Prev</a>] [<a href="msg00141.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 27 Mar 2007 16:46:14 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00137.html">46093C46.3070309@bmb.leeds.ac.uk</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1HWBpX-0002aV-Ow@subversion.gna.org&gt;	&lt;<a href="msg00134.html">7f080ed10703270715o218f4121qb4e867586717d484@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla Thunderbird 1.0.8 (X11/20060411)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Gary S. Thompson</strong> on March 27, 2007 - 17:47:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>Edward d'Auvergne wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">Hi,</pre><br>
<pre style="margin: 0em;">Gary, why have you changed the 'maths_fns/mf.py' file?</pre><br>
<pre style="margin: 0em;">Cheers,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<br>
</blockquote><tt>Hi ed this is a local fix for my own sanity that I checked in by 
mistake. I am still working out how to revert it ;-) i guess I will have 
to check out an older revision of the file over it and recommit it?</tt><br>
<br>
<tt>However it does throw up a couple of questions (if there is iterest I 
will add these to a new thread)</tt><br>
<br>
<tt>1. should we have a width limit? It is quite common to have a convention 
of the  maximum width that source code runs to in a program so as to aid 
legibility(especially for functions such as maths_fns.Mf which has a 
huge parameter list). is this something we should adopt?<br>
2. not all of the arguments seem to be documented for this function</tt><br>
<br>
<pre style="margin: 0em;">regards
gary
</pre><blockquote class="blockquote"><tt>On 3/27/07, garyt@xxxxxxxxxxxxxxx &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">Author: varioustoxins
Date: Tue Mar 27 15:35:16 2007
New Revision: 3241</pre><br>
<pre style="margin: 0em;">URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=3241&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=3241&amp;view=rev</a>
Log:
installation of simplistic remote minimisation command</pre><br>
<pre style="margin: 0em;">Modified:
    branches/multi_processor/maths_fns/mf.py
    branches/multi_processor/multi/mpi4py_processor.py</pre><br>
<tt>Modified: branches/multi_processor/maths_fns/mf.py<br>
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/branches/multi_processor/maths_fns/mf.py?rev=3241&amp;r1=3240&amp;r2=3241&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/multi_processor/maths_fns/mf.py?rev=3241&amp;r1=3240&amp;r2=3241&amp;view=diff</a> </tt><br>
<br>
<tt>============================================================================== </tt><br>
<br>
<pre style="margin: 0em;">--- branches/multi_processor/maths_fns/mf.py (original)
+++ branches/multi_processor/maths_fns/mf.py Tue Mar 27 15:35:16 2007
@@ -37,7 +37,11 @@</pre><br>
<tt><br> class Mf:<br>
-    def __init__(self, init_params=None, param_set=None, 
diff_type=None, diff_params=None, scaling_matrix=None, num_res=None, 
equations=None, param_types=None, param_values=None, relax_data=None, 
errors=None, bond_length=None, csa=None, num_frq=0, frq=None, 
num_ri=None, remap_table=None, noe_r1_table=None, ri_labels=None, 
gx=0, gh=0, g_ratio=0, h_bar=0, mu0=0, num_params=None, vectors=None):<br>
+    def __init__(self, init_params=None, param_set=None, 
diff_type=None, diff_params=None,<br>
+                  scaling_matrix=None, num_res=None, equations=None, 
param_types=None,<br>
+                  param_values=None, relax_data=None, errors=None, 
bond_length=None,<br>
+                  csa=None, num_frq=0, frq=None, num_ri=None, 
remap_table=None, noe_r1_table=None,<br>
+                  ri_labels=None, gx=0, gh=0, g_ratio=0, h_bar=0, 
mu0=0, num_params=None, vectors=None):<br>
         &quot;&quot;&quot;The model-free minimisation class.</tt><br>
<br>
<pre style="margin: 0em;">         This class should be initialised before every calculation.
@@ -45,7 +49,8 @@</pre><br>
<tt>         Arguments<br>
         ~~~~~~~~~<br>
-<br>
+        FIXME: widths<br>
+        FIXME: no arguments<br>
         equation:  The model-free equation string which should be 
either 'mf_orig' or 'mf_ext'.</tt><br>
<br>
<tt>         param_types:  An array of the parameter types used in 
minimisation.<br>
@@ -115,7 +120,7 @@<br>
         dthetaj     dthetaj</tt><br>
<br>
<tt><br>-         dNOE()     gH      1      /        
dsigma_noe()                    dR1()  \<br>
+         dNOE()     gH      1      /        
dsigma_noe()                    dR1()  \<br>
         -------  =  -- . ------- . | R1() . ------------  -  
sigma_noe() . ------- |<br>
         dthetaj     gN   R1()**2   \          
dthetaj                      dthetaj /</tt><br>
<br>
<pre style="margin: 0em;">@@ -141,11 +146,11 @@
         dthetai.dthetaj     dthetai.dthetaj</pre><br>
<tt><br>-            d2NOE()         gH      1      /               /      
dR1()     dR1()                  d2R1()     \<br>
+            d2NOE()         gH      1      /               /      
dR1()     dR1()                  d2R1()     \<br>
         ---------------  =  -- . ------- . | sigma_noe() . | 2 . 
------- . -------  -  R1() . --------------- |<br>
         dthetai.dthetaj     gN   R1()**3   \               \     
dthetai   dthetaj            dthetai.dthetaj /</tt><br>
<br>
<tt>-                     / dsigma_noe()    dR1()       dR1()    
dsigma_noe()             d2sigma_noe()  \ \<br>
+                     / dsigma_noe()    dR1()       dR1()    
dsigma_noe()             d2sigma_noe()  \ \<br>
             - R1() . | ------------ . -------  +  ------- . 
------------  -  R1() . --------------- | |<br>
                      \   dthetai      dthetaj     dthetai     
dthetaj               dthetai.dthetaj / /</tt><br>
<br>
<tt>@@ -168,7 +173,7 @@<br>
         The chi-sqared gradient<br>
         ~~~~~~~~~~~~~~~~~~~~~~~<br>
                        _n_<br>
-         dChi2         \   /  Ri - Ri()      dRi()  \<br>
+         dChi2         \   /  Ri - Ri()      dRi()  \<br>
         -------  =  -2  &gt;  | ----------  .  ------- |<br>
         dthetaj        /__ \ sigma_i**2     dthetaj /<br>
                        i=1<br>
@@ -182,7 +187,7 @@<br>
         The chi-sqared Hessian<br>
         ~~~~~~~~~~~~~~~~~~~~~~<br>
                              _n_<br>
-             d2chi2          \       1      /  dRi()     
dRi()                         d2Ri()     \<br>
+             d2chi2          \       1      /  dRi()     
dRi()                         d2Ri()     \<br>
         ---------------  = 2  &gt;  ---------- | ------- . -------  -  
(Ri - Ri()) . --------------- |<br>
         dthetaj.dthetak      /__ sigma_i**2 \ dthetaj   
dthetak                   dthetaj.dthetak /<br>
                              i=1</tt><br>
<br>
<tt>Modified: branches/multi_processor/multi/mpi4py_processor.py<br>
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/branches/multi_processor/multi/mpi4py_processor.py?rev=3241&amp;r1=3240&amp;r2=3241&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/multi_processor/multi/mpi4py_processor.py?rev=3241&amp;r1=3240&amp;r2=3241&amp;view=diff</a> </tt><br>
<br>
<tt>============================================================================== </tt><br>
<br>
<tt>--- branches/multi_processor/multi/mpi4py_processor.py (original)<br>
+++ branches/multi_processor/multi/mpi4py_processor.py Tue Mar 27 
15:35:16 2007<br>
@@ -5,6 +5,9 @@<br>
 import os<br>
 import math</tt><br>
<br>
<pre style="margin: 0em;">+#FIXME: me move top generic command module
+from maths_fns.mf import Mf
+from minimise.generic import generic_minimise</pre><br>
<pre style="margin: 0em;"> # load mpi
 try:
@@ -74,6 +77,7 @@</pre><br>
<pre style="margin: 0em;"> NULL_RESULT=Null_result_command()</pre><br>
<tt>+<br>
 class Slave_command(object):<br>
     def run(self,processor):<br>
         pass<br>
@@ -92,6 +96,41 @@<br>
         msg = processor.get_name()<br>
         result = Result_string(msg,True)<br>
         processor.return_object(result)<br>
+<br>
+class MF_minimise_command(Slave_command):<br>
+    def __init__(self):<br>
+        #!! 'a0':1.0,'mu':0.0001,'eta':0.1,<br>
+        self.minimise_map={'args':(), 'x0':None, 'min_algor':None, 
'min_options':None, 'func_tol':1e-25, 'grad_tol':None,<br>
+                     'maxiter':1e6, 'A':None, 'b':'None', 'l':None, 
'u':None, 'c':None, 'dc':None, 'd2c':None,<br>
+                     'dc':None, 'd2c':None, 'full_output':0, 
'print_flag':0,<br>
+                     'print_prefix':&quot;&quot;}<br>
+<br>
+<br>
+<br>
+        self.mf_map={'init_params':None, 'param_set':None, 
'diff_type':None, 'diff_params':None,<br>
+                      'scaling_matrix':None, 'num_res':None, 
'equations':None, 'param_types':None,<br>
+                      'param_values':None, 'relax_data':None, 
'errors':None, 'bond_length':None,<br>
+                      'csa':None, 'num_frq':0, 'frq':None, 
'num_ri':None, 'remap_table':None, 'noe_r1_table':None,<br>
+                      'ri_labels':None, 'gx':0, 'gh':0, 'g_ratio':0, 
'h_bar':0, 'mu0':0, 'num_params':None, 'vectors':None}<br>
+<br>
+<br>
+    #FIXME: bad names<br>
+    def set_mf(self, **kwargs):<br>
+        self.mf_map.update(**kwargs)<br>
+<br>
+<br>
+    def set_minimise(self,**kwargs):<br>
+        self.minimise_map.update(**kwargs)<br>
+<br>
+    def build_mf(self):<br>
+        return  Mf(**self.mf_map)<br>
+<br>
+    def do_minimise(self):<br>
+        return generic_minimise(func=self.mf.func, 
dfunc=self.mf.dfunc, d2func=self.mf.d2func, **self.minimise_map)<br>
+<br>
+    def run(self,processor):<br>
+        self.mf = self.build_mf()<br>
+        self.results = generic_minimise(func=self.mf.func, 
dfunc=self.mf.dfunc, d2func=self.mf.d2func, **self.minimise_map)</tt><br>
<br>
<pre style="margin: 0em;"> #FIXME do some inheritance
 class Mpi4py_processor:</pre><br>
<pre style="margin: 0em;"><br>_______________________________________________
relax (<a  href="http://nmr-relax.com">http://nmr-relax.com</a>)</pre><br>
<pre style="margin: 0em;">This is the relax-commits mailing list
relax-commits@xxxxxxx</pre><br>
<pre style="margin: 0em;">To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a></pre><br>
</blockquote><pre style="margin: 0em;"><br>.</pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
-------------------------------------------------------------------
Dr Gary Thompson
Astbury Centre for Structural Molecular Biology,
University of Leeds, Astbury Building,
Leeds, LS2 9JT, West-Yorkshire, UK             Tel. +44-113-3433024
email: garyt@xxxxxxxxxxxxxxx                   Fax  +44-113-2331407
-------------------------------------------------------------------</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00141" href="msg00141.html">Re: r3241 - in /branches/multi_processor: maths_fns/mf.py	multi/mpi4py_processor.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00134" href="msg00134.html">Re: r3241 - in /branches/multi_processor: maths_fns/mf.py	multi/mpi4py_processor.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Mar 27 18:42:37 2007</div>  
</body>
</html>
