<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Help with settings script for R1rho analysis. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 22 Oct 2013 23:45:34 +0200 -->
<!--X-Message-Id: CAED9pY_FGF1Liq3f0drkFMaX4FZk=1gH_FOnUBBcbJJeQ9TFDw@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CA+CBx2Otwm3tdPgfzVduw9gDZxtwjq82Y8iAp7q_OJeQ2LKZ8g@mail.gmail.com -->
<!--X-Reference: CAED9pY8QeGe=P4G+=6YD7EitmkKW82HCpTapFsnKfmCiBAZMzg@mail.gmail.com -->
<!--X-Reference: CA+CBx2O=c47Fug5LwhmnFMQLxxnntDr0SHLXR3=SAW_k6bHovg@mail.gmail.com -->
<!--X-Reference: CAED9pY9FZ8ihwpDvHhyxz3ec0QwTeV=FOG9zfn+LPeD6xVZUsw@mail.gmail.com -->
<!--X-Reference: CA+CBx2OEmeEWsvWNL283avhzjb1zBV3=qT&#45;N7q&#45;8Jo8Dn7WgZw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;vYtxFYNaAtwTg&#45;Uu+p=9cfsYeESbSQDYzusN0GmacRA@mail.gmail.com -->
<!--X-Reference: CA+CBx2PPxJgWfK6iXpiLYDNMx2vvqnFMT_JtMoZRg&#45;WLMkdViw@mail.gmail.com -->
<!--X-Reference: CAED9pY9DyZhAMBBOJh=ttah2n3kGqWgpPfb&#45;h8WCZhThn_aLCg@mail.gmail.com -->
<!--X-Reference: CA+CBx2OqSykw&#45;sZasy9Wx8YYscpCTJV5YO6Kus9CR_FY0dEm5Q@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Help with settings script for R1rho analysis. -- October 22, 2013 - 23:45</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Help with settings script for R1rho analysis.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00082" class="tabs">Index by Date</a> | <a href="threads.html#00082" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00081.html">Date Prev</a>] [<a href="msg00083.html">Date Next</a>] [<a href="msg00078.html">Thread Prev</a>] [<a href="msg00069.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 22 Oct 2013 23:45:03 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date:message-id:subject	:from:to:cc:content-type;	bh=ZLkei8bF7CsOwr6Hm2wbmpYBCvEpK0ClknV9zD4vabE=;	b=UMWyYIp569xu6n/UuuEW+0qpfx3kkE0vA0T24Gpt5R5oFn5Q3OrNZy1KYH+Ia1UUa6	bu0w98EVX8ORSfmbJsiJQJy6zilKAVNeO1vc+RYIKLGXGlVl0S1/3spOqPv26+uMthJk	hnvBs/iAU3Y2u9h2BjAor1gIbwgzt9FvAQiaFb9hoRSxLBIr8mrHojJl+w7jZCSOkcK3	+DWHeH7niqIWBBWG52jcwJnvNA4B1cgG2WuhVkUYCqSPLvecl0/bOA0a1sXxc5qjVfht	ubH6Zkk3I8b/Upg0+QqgzCFYlaACgc2hVS9Gi1a09orpoaQAm+dLTqdLCEd8h/16rJYp	JrfA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00082.html">CAED9pY_FGF1Liq3f0drkFMaX4FZk=1gH_FOnUBBcbJJeQ9TFDw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2Otwm3tdPgfzVduw9gDZxtwjq82Y8iAp7q_OJeQ2LKZ8g@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY8QeGe=P4G+=6YD7EitmkKW82HCpTapFsnKfmCiBAZMzg@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2O=c47Fug5LwhmnFMQLxxnntDr0SHLXR3=SAW_k6bHovg@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY9FZ8ihwpDvHhyxz3ec0QwTeV=FOG9zfn+LPeD6xVZUsw@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2OEmeEWsvWNL283avhzjb1zBV3=qT-N7q-8Jo8Dn7WgZw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-vYtxFYNaAtwTg-Uu+p=9cfsYeESbSQDYzusN0GmacRA@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2PPxJgWfK6iXpiLYDNMx2vvqnFMT_JtMoZRg-WLMkdViw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY9DyZhAMBBOJh=ttah2n3kGqWgpPfb-h8WCZhThn_aLCg@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2OqSykw-sZasy9Wx8YYscpCTJV5YO6Kus9CR_FY0dEm5Q@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on October 22, 2013 - 23:45:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi,<div><br></div><div>This is part of the clean design of relax.  The code in the lib and target_functions packages are absolutely forbidden from touching the relax data store.  Only the code in the pipe_control and specific_analyses can.  These last two packages are for handling data input, packaging for other parts of relax, and data output.  An exception is the data package which defines the relax data store.  All the other relax packages - multi, docs, graphics, user_functions - are also forbidden.  One grey area is the gui package.  I would really like to make a clean separation for the gui by accessing data via functions in pipe_control and specific_analyses.  Such a transition is slow though, and has been in progress since Michael Bieri created the first version of the relax GUI.  But my eventual aim is to abstract the GUI from the data store layout, and forbid that package too.</div>
<div><br></div><div>Regards,</div><div><br></div><div>Edward</div><div><br></div><div><br><br>On Tuesday, 22 October 2013, Troels Emtekær Linnet  wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<div dir="ltr">Ah ja. :-)<div><br></div><div>I found the information in:</div><div>specific_analyses/relax_disp/api.py<br></div><div>specific_analyses/relax_disp/disp_data.py<br></div><div><br></div><div>It is the return_offset_data() function.</div>


<div><br></div><div>For reference:</div><div>----------------</div><div><br></div><div><br></div><div><div># Convert the shift from ppm to rad/s and store it.</div><div>shifts[spin_index, frq_index] = spin.chemical_shift * 2.0 * pi * frq / g1H * return_gyromagnetic_ratio(spin.isotope) * 1e-6</div>


</div><div><br></div><div><div># Store the offset in rad/s.</div><div>offsets[spin_index, frq_index, disp_pt_index] = cdp.spin_lock_offset[id] * 2.0 * pi * frq / g1H * return_gyromagnetic_ratio(spin.isotope) * 1e-6</div>


</div><div><br></div><div><div># Calculate the tilt angle.</div><div>point = cdp.spin_lock_nu1[id]<br></div><div>omega1 = point * 2.0 * pi</div><div><br></div><div>Delta_omega = shifts[spin_index, frq_index] - offsets[spin_index, frq_index, disp_pt_index]</div>


<div>if Delta_omega == 0.0:</div><div>    theta[spin_index, frq_index, disp_pt_index] = pi / 2.0</div><div>else:</div><div>    theta[spin_index, frq_index, disp_pt_index] = atan(omega1 / Delta_omega)</div><div>------------------</div>


<div><br></div><div>Which resembles:</div><div><br></div><div><div>$OMEGA=($centerPPM-$chemShift{$peakName})*$frq+$offset{$i};</div><div>$omegaEFF=sqrt($OMEGA**2+$omega1{$i}**2);</div><div>if (($omega1{$i}/$OMEGA) &gt; 0){</div>


<div><span style="white-space:pre-wrap">	</span>$theta=180/$PI*abs(atan($omega1{$i}/$OMEGA));</div><div>}else{</div><div><span style="white-space:pre-wrap">	</span>$theta=180-180/$PI*abs(atan($omega1{$i}/$OMEGA));</div>

</div><div><br></div></div><div> </div></div><div class="gmail_extra"><br><br><div>2013/10/22 Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow">edward@xxxxxxxxxxxxx</a>&gt;</span><br>

<blockquote style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">I have to give up for the day, but just a quick hint - look in the<br>
modules of the specific_analyses.relax_disp package!  The disp_data<br>
module is probably your best bet.<br>
<br>
Bye,<br>
<br>
Edward<br>
<div><div><br>
<br>
<br>
On 22 October 2013 19:16, Troels Emtekær Linnet &lt;<a rel="nofollow">tlinnet@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt; Hi Edward.<br>
&gt;<br>
&gt; I prefer to do the calculations straight away in my scripts, from the<br>
&gt; information which is ex-tractable from the procpar files.<br>
&gt; But I guess that is a matter of taste.<br>
&gt;<br>
&gt; But now I think I got it. :-) Thanks!<br>
&gt; I guess that relax calculates &quot;omega_rf_ppm - chemShift{peakName} &quot;, but I<br>
&gt; could not locate this functions call.<br>
&gt; ( I do load the chemical shifts from a SPARKY list, (the seriesTab format is<br>
&gt; not yet supported). )<br>
&gt;<br>
&gt;<br>
&gt; I now do the settings script, by settting variables:<br>
&gt; # In MHz<br>
&gt; yOBS = 81.050<br>
&gt; # In ppm<br>
&gt; yCAR = 118.078<br>
&gt; centerPPM_N15 = yCAR<br>
&gt;<br>
&gt; And then I calculate the offset in ppm for each spectrum.<br>
&gt;<br>
&gt; # Calculating the spin-lock offset in ppm, from offsets values provided in<br>
&gt; Hz.<br>
&gt; #frq_N15_Hz = set_sfrq * 1E6 * gyro15N / gyro1H<br>
&gt; frq_N15_Hz = yOBS * 1E6<br>
&gt; offset_ppm_N15 = float(deltadof2) / frq_N15_Hz * 1E6<br>
&gt; omega_rf_ppm = centerPPM_N15 + offset_ppm_N15<br>
&gt;<br>
&gt; And the range is now 118.078 ppm to 241.45 ppm.<br>
&gt;<br>
&gt; I tried to locate the corresponding calculation of OMEGA in relax, but i was<br>
&gt; not successful.<br>
&gt; I looked in:<br>
&gt;<br>
&gt; lib/dispersion/dpl94.py<br>
&gt; target_functions/relax_disp.py<br>
&gt;<br>
&gt; I wonder where how to locate the calculation of theta?<br>
&gt;<br>
&gt; Best<br>
&gt; Troels<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; 2013/10/22 Edward d&#39;Auvergne &lt;<a rel="nofollow">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt;<br>
&gt;&gt; Hi,<br>
&gt;&gt;<br>
&gt;&gt; You could look at the relax code for how omega_eff is calculated.<br>
&gt;&gt; However you will never use this - it is never input into relax.  If<br>
&gt;&gt; you have a look at the sample_scripts/relax_disp/R1rho_analysis.py<br>
&gt;&gt; script, you will see that all is needed is an equivalent of the table:<br>
&gt;&gt;<br>
&gt;&gt; # The spectral data - spectrum ID, peak list file name, spin-lock<br>
&gt;&gt; field strength (Hz), the spin-lock offset (ppm), the relaxation time<br>
&gt;&gt; (s), spectrometer frequency (Hz), and experimental error (RMSD of the<br>
&gt;&gt; base plane noise for each spectrum).<br>
&gt;&gt; data = "">
&gt;&gt;     [&#39;ref_500MHz&#39;,       &#39;ref_500MHz.list&#39;,     ,   None, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_1000.0_500MHz&#39;, &#39;nu_1000.0_500MHz.list&#39;, 1000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_1500.0_500MHz&#39;, &#39;nu_1500.0_500MHz.list&#39;, 1500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_2000.0_500MHz&#39;, &#39;nu_2000.0_500MHz.list&#39;, 2000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_2500.0_500MHz&#39;, &#39;nu_2500.0_500MHz.list&#39;, 2500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_3000.0_500MHz&#39;, &#39;nu_3000.0_500MHz.list&#39;, 3000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_3500.0_500MHz&#39;, &#39;nu_3500.0_500MHz.list&#39;, 3500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_4000.0_500MHz&#39;, &#39;nu_4000.0_500MHz.list&#39;, 4000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_4500.0_500MHz&#39;, &#39;nu_4500.0_500MHz.list&#39;, 4500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_5000.0_500MHz&#39;, &#39;nu_5000.0_500MHz.list&#39;, 5000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_5500.0_500MHz&#39;, &#39;nu_5500.0_500MHz.list&#39;, 5500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_6000.0_500MHz&#39;, &#39;nu_6000.0_500MHz.list&#39;, 6000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;ref_800MHz&#39;,       &#39;ref_800MHz.list&#39;,     ,   None, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_1000.0_800MHz&#39;, &#39;nu_1000.0_800MHz.list&#39;, 1000.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_1500.0_800MHz&#39;, &#39;nu_1500.0_800MHz.list&#39;, 1500.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
</div></div></blockquote></div></div>
</blockquote></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00063" href="msg00063.html">Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00064" href="msg00064.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00065" href="msg00065.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00066" href="msg00066.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00067" href="msg00067.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00068" href="msg00068.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00075" href="msg00075.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00076" href="msg00076.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00078" href="msg00078.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Oct 23 16:20:07 2013</div>  
</body>
</html>
