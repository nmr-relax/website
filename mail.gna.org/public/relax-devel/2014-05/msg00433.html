<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r23316 &#45; /trunk/lib/dispersion/b14.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 22 May 2014 10:23:14 +0200 -->
<!--X-Message-Id: CA+CBx2Mk_xMEwJuNc5LO8k=Wtz4ZjaHxYbsKWMe+omEHTg&#45;gsw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1WnBNU&#45;00028E&#45;MI@subversion.gna.org -->
<!--X-Reference: CAED9pY_3GWTbQ1HvUOYSS3d+6KYtYfg_ractKn8X_sMpds=A+Q@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r23316 - /trunk/lib/dispersion/b14.py -- May 22, 2014 - 10:23</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r23316 - /trunk/lib/dispersion/b14.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00433" class="tabs">Index by Date</a> | <a href="threads.html#00433" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00432.html">Date Prev</a>] [<a href="msg00434.html">Date Next</a>] [<a href="msg00428.html">Thread Prev</a>] [<a href="msg00437.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;, Andrew Baldwin &lt;andrew.baldwin@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 22 May 2014 10:22:02 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type; bh=V+vyejDezcrFexQdODOUrJFsQExrZUAceFi+7Q0Xf4Y=; b=0Bpa+e9XTJAbrZ4nEq4hJqC4lDxYOlv71AihjZZynGNpvIkeiV908yCsEQWhMIpJY1 0L4G4Hs5kj/hdSOTBxOY1yWD04l3Zz47FUL4St0W8x+9OSwc8UExwGKk1ALxQ743vcgu 5kkSyIIb2PRX60TfxANVB61uJJWRNek5Rofbu3+kwz8UUAouxVA1iglEdbVjIbSLE8wQ dEaPwv22rVCKhnImFSRxklpEWd5I7/Ruw2oD3gbgs7wkyl00EdfQ2vi6lkz/ma82Bgwz +j6uMAVmDuu8Yb26oD7wITR2kP5fHwSuvKFWRA3wBbYE6QdOvcERb4FDtqTCcrrra3nt QZWg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CA+CBx2Mk_xMEwJuNc5LO8k=Wtz4ZjaHxYbsKWMe+omEHTg-gsw@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1WnBNU-00028E-MI@subversion.gna.org&gt; &lt;CAED9pY_3GWTbQ1HvUOYSS3d+6KYtYfg_ractKn8X_sMpds=A+Q@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on May 22, 2014 - 10:23:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Edward.
Hi Andrew, I have added you to this mail, since this relates to your work.

--

Before the fix Andrew sent, B14 would not be able to do it.
I tried, and the results was miserable.

Hence the statement:
&quot;The model B14 was previously in a state of non-functioning.&quot;

The problem was, that I could fit Andrews original result from the
paper just fine.
<a  rel="nofollow" href="https://gna.org/bugs/index.php?22021#comment7">https://gna.org/bugs/index.php?22021#comment7</a>

But when I gave the challenging try, it would fail.
<a  rel="nofollow" href="https://gna.org/bugs/index.php?22021#comment5">https://gna.org/bugs/index.php?22021#comment5</a>

I did try my self to implement the trigometric functions:
<a  rel="nofollow" href="https://gna.org/bugs/index.php?22021#comment6">https://gna.org/bugs/index.php?22021#comment6</a>

But I did that wrong.

I was first when Andrew corrected me, that I got it right:
<a  rel="nofollow" href="https://gna.org/bugs/index.php?22021#comment10">https://gna.org/bugs/index.php?22021#comment10</a>

I tested it a little yesterday, and the results are as good as the numerical.

This is indeed a very interesting and promising model!

And I am sure it will get some attention.

Best
Troels



2014-05-22 9:50 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

For reference, do you have the B14 optimisation results for this
parameter set prior to the fix?  This is just to see the difference
the change makes.

Cheers,

Edward



On 21 May 2014 20:36,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Wed May 21 20:36:36 2014
New Revision: 23316

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=23316&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=23316&amp;view=rev</a>
Log:
Extremely important fix to the model B14.

This was discovered by author Andrew Baldwin of the inspection of his code 
in relax.

bug #22021: (<a  rel="nofollow" href="https://gna.org/bugs/?22021">https://gna.org/bugs/?22021</a>) Model B14 shows bad fitting to 
data.

The implementation was performed wrong for calculation of g3 and g4.
The implementations should be performed by trigonometric functions.

The model B14 was previously in a state of non-functioning.

The B14 model now shows excellent performance.

For the challenging case of data created with numerical model NS CPMG 
2-site 3D:

sfrq_1 = 599.8908617*1E6
time_T2_1 = 0.06
ncycs_1 = [2, 4, 8, 10, 20, 30, 40, 60]
sfrq_2 = 499.8908617*1E6
time_T2_2 = 0.05
ncycs_2 = [2, 4, 8, 10, 30, 35, 40, 50]

r2 = 10. rad/s.
kex: 1000 rad/s
pA: 0.99
dw: 2. ppm

CR72 would fit:
----------
CR72 Ala :1@N r2 599.9 GRID=10.116 MIN=10.000 SET=10.000 RELC=0.000
CR72 Ala :1@N r2 499.9 GRID=10.080 MIN=9.999 SET=10.000 RELC=0.000
CR72 Ala :1@N pA GRID=0.929 MIN=0.990 SET=0.990 RELC=0.000
CR72 Ala :1@N dw GRID=1.429 MIN=1.925 SET=2.000 RELC=0.039
CR72 Ala :1@N kex GRID=5714.714 MIN=1034.721 SET=1000.000 RELC=0.034

B14 fits:
-----------
B14 Ala :1@N r2 599.9 GRID=10.116 MIN=10.000 SET=10.000 RELC=0.000
B14 Ala :1@N r2 499.9 GRID=10.080 MIN=10.000 SET=10.000 RELC=0.000
B14 Ala :1@N pA GRID=0.929 MIN=0.990 SET=0.990 RELC=0.000
B14 Ala :1@N dw GRID=1.429 MIN=2.000 SET=2.000 RELC=0.000
B14 Ala :1@N kex GRID=10000.000 MIN=1000.001 SET=1000.000 RELC=0.000

Modified:
    trunk/lib/dispersion/b14.py

Modified: trunk/lib/dispersion/b14.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/dispersion/b14.py?rev=23316&amp;r1=23315&amp;r2=23316&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/lib/dispersion/b14.py?rev=23316&amp;r1=23315&amp;r2=23316&amp;view=diff</a>
==============================================================================
--- trunk/lib/dispersion/b14.py (original)
+++ trunk/lib/dispersion/b14.py Wed May 21 20:36:36 2014
@@ -111,7 +111,7 @@

 # Python module imports.
 import numpy
-from numpy import arccosh, array, cos, cosh, in1d, log, nonzero, sin, 
sinh, sqrt, power
+from numpy import arccosh, arctan2, array, cos, cosh, in1d, log, nonzero, 
sin, sinh, sqrt, power

 # Repetitive calculations (to speed up calculations).
 g_fact = 1/sqrt(2)
@@ -161,11 +161,12 @@
     # Repetitive calculations (to speed up calculations).
     dw2 = dw**2
     two_tcp = 2.0 * tcp
-    sqrt_zeta2_Psi2 = sqrt(zeta**2 + Psi**2)

     # Get the real and imaginary components of the exchange induced shift.
-    g3 = g_fact * sqrt( Psi + sqrt_zeta2_Psi2)
-    g4 = g_fact * sqrt(-Psi + sqrt_zeta2_Psi2)
+    # Trigonometric functions faster than square roots.
+    quad_zeta2_Psi2 = (zeta**2 + Psi**2)**0.25
+    g3 = cos(0.5 * arctan2(-zeta, Psi)) * quad_zeta2_Psi2
+    g4 = sin(0.5 * arctan2(-zeta, Psi)) * quad_zeta2_Psi2

     # Repetitive calculations (to speed up calculations).
     g32 = g3**2


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00437" href="msg00437.html">Re: r23316 - /trunk/lib/dispersion/b14.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00427" href="msg00427.html">Re: r23316 - /trunk/lib/dispersion/b14.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu May 22 11:00:24 2014</div>  
</body>
</html>
