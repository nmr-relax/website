<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: how to parallelise model_free minimise -->
<!--X-From-R13: "Unel E. Fubzcfba" <tnelgNozo.yrrqf.np.hx> -->
<!--X-Date: Tue, 27 Mar 2007 18:08:32 +0200 -->
<!--X-Message-Id: 4609415B.3040407@bmb.leeds.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7f080ed10703191030h79036e06w56912aa1d9130f48@mail.gmail.com -->
<!--X-Reference: 45FFEC5C.7060205@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703200727l5fad8e72if4cf9aff74bc21@mail.gmail.com -->
<!--X-Reference: 45FFF714.7070903@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703200813x323ec212l471796641855a7ff@mail.gmail.com -->
<!--X-Reference: 4603EA08.60801@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703252217x7db43e6bxfe7324ad0379c778@mail.gmail.com -->
<!--X-Reference: 4607F0AB.6000807@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703261026l4d783b65o1e34f01315a95024@mail.gmail.com -->
<!--X-Reference: f001463a0703270020w381abf44t28eff5cd19b466a4@mail.gmail.com -->
<!--X-Reference: 7f080ed10703270801r3b875da4i6940031727653b10@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: how to parallelise model_free minimise -- March 27, 2007 - 18:08</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: how to parallelise model_free minimise</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00140" class="tabs">Index by Date</a> | <a href="threads.html#00140" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00139.html">Date Prev</a>] [<a href="msg00141.html">Date Next</a>] [<a href="msg00135.html">Thread Prev</a>] [<a href="msg00134.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 27 Mar 2007 17:07:55 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00140.html">4609415B.3040407@bmb.leeds.ac.uk</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00092.html">7f080ed10703191030h79036e06w56912aa1d9130f48@mail.gmail.com</a>&gt;	&lt;<a href="msg00107.html">45FFEC5C.7060205@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00110.html">7f080ed10703200727l5fad8e72if4cf9aff74bc21@mail.gmail.com</a>&gt;	&lt;<a href="msg00112.html">45FFF714.7070903@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00114.html">7f080ed10703200813x323ec212l471796641855a7ff@mail.gmail.com</a>&gt;	&lt;<a href="msg00124.html">4603EA08.60801@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00126.html">7f080ed10703252217x7db43e6bxfe7324ad0379c778@mail.gmail.com</a>&gt;	&lt;<a href="msg00128.html">4607F0AB.6000807@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00130.html">7f080ed10703261026l4d783b65o1e34f01315a95024@mail.gmail.com</a>&gt;	&lt;<a href="msg00132.html">f001463a0703270020w381abf44t28eff5cd19b466a4@mail.gmail.com</a>&gt;	&lt;<a href="msg00135.html">7f080ed10703270801r3b875da4i6940031727653b10@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla Thunderbird 1.0.8 (X11/20060411)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Gary S. Thompson</strong> on March 27, 2007 - 18:08:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>Edward d'Auvergne wrote:
</tt><blockquote class="blockquote"><tt>On 3/27/07, gary thompson &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><tt>On 3/26/07, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:<br>
&gt; &gt; &gt;&gt; i.e for six residues and 3 nodes<br>
&gt; &gt; &gt;&gt;<br>
&gt; &gt; &gt;&gt; node 1 calculates<br>
&gt; &gt; &gt;&gt; res 1 [m1 m2 m3...]<br>
&gt; &gt; &gt;&gt; res 2 [[m1 m2 m3..]<br>
&gt; &gt; &gt;&gt;<br>
&gt; &gt; &gt;&gt; node 2 calculates<br>
&gt; &gt; &gt;&gt; res 3 [m1 m2 m3...]<br>
&gt; &gt; &gt;&gt; res 4 [[m1 m2 m3..]<br>
&gt; &gt; &gt;&gt;<br>
&gt; &gt; &gt;&gt; node 3 calculates<br>
&gt; &gt; &gt;&gt; res 5 [m1 m2 m3...]<br>
&gt; &gt; &gt;&gt; res 6 [[m1 m2 m3..]<br>
&gt; &gt; &gt;&gt;<br>
&gt; &gt; &gt;&gt; this obviously places some limitations of the design of the<br>
&gt; &gt; &gt;&gt; minimisation function as it might needs to have a set and tear 
down<br>
&gt; &gt; &gt;&gt; region that cope with this batched data....<br>
&gt; &gt; &gt;<br>
&gt; &gt; &gt; The minimise() main loop is the finest grain parallelisation 
you can<br>
&gt; &gt; &gt; get without writing a specific parallelised optimisation 
algorithm.<br>
&gt; &gt; &gt;<br>
&gt; &gt;<br>
&gt; &gt; actually what i was aiming for was as coarse grained and well load<br>
&gt; &gt; balanced a set of calculations as possible (i.e. minimum of<br>
&gt; &gt; communication overhead (i.e. bigger chunks of data with similar<br>
&gt; &gt; computations times going over the wire))<br>
&gt;<br>
&gt; The coarse grained target of the looping over data pipes, which the<br>
&gt; user must specifically ask for, will limit the number of active nodes<br>
&gt; to the number of data pipes, which could be a specific list of<br>
&gt; model-free models (assuming this is the only target).  The next level<br>
&gt; is the main loop over the minimisation instances.  Finally, the finest<br>
&gt; grain is from the parallelised grid search of grid searches (as<br>
&gt; discussed in the thread starting at<br>
&gt; <a  href="http://www.nmr-relax.com/mail.gna.org/public/relax-devel/2007-03/msg00088.html">https://mail.gna.org/public/relax-devel/2007-03/msg00088.html</a>,<br>
&gt; Message-id: &lt;45FEAC46.8020307@xxxxxxxxxxxxxxx&gt;).  Can you see anything<br>
&gt; else which could be targeted for parallelisation?<br>
&gt;<br>
no see above if you combine the calculations from the various models<br>
with those by spin etc you get the largest number of calculations that<br>
need/can to be carried out together...
</tt></blockquote><pre style="margin: 0em;"><br>The model-free minimisations for the different model-free models need
not be carried out together.  There is no efficiency gain there.  I
don't have any numbers because this was a long time ago, but I have
tested this approach out before.  Otherwise I would have designed the
relax UI to fit this approach.</pre><br>
</blockquote><tt>Why isn't there an efficiency gain? all the calculations are independant 
and for a limited set of processors you can transfer larger blocks of 
data so there is less communication overhead. Furthermore there are two 
other advantages</tt><br>
<br>
<tt>1. if the rate of calculation between minimisations is not particularily 
constant you could for example end up with processors idle at the end of 
minimising model 1 sos starting on model 2 straight away will improve 
the rate of calculation (especially if your grid computer is hetrogenous<br>
2. if you have an insane number of processors (which will come soon)  
you can end up with situatiosn where you have 1 spin per processor which 
wouldb be highly inefficient
</tt><blockquote class="blockquote"><br>
<blockquote class="blockquote"><pre style="margin: 0em;">&gt; &gt; just as another comment (or two)
&gt; &gt;
&gt; &gt; 1. why does do we send no arguments to the fucntions e.g.
&gt; &gt; -#-num_frq [2]
&gt; &gt; -#-frq [[750800000.0, 599.71900000000005]]
&gt;
&gt; Sorry, again I don't understand the question.  I'll try to answer it
&gt; anyway.  The num_frq value is used to deconvolute the 'remap_table',
&gt; 'frq', 'ri_labels', and 'relax_data'.  This can vary for different
&gt; spin systems.  The frequencies are essential for the calculation of
&gt; the spectral density values (and hence the chi-squared value).
&gt;</pre><br>
<pre style="margin: 0em;"><br>what is the difference between
num_frq
and the number of numbers in
frq [[750800000.0, 599.71900000000005]]
</pre></blockquote><pre style="margin: 0em;"><br>Nothing, it's historical baggage (with the added computational benefit
of not executing the len() builtin function during calculations).</pre><br>
</blockquote><tt>one len call at the start of a minimisation should be a tiny overhead 
and I guess that aray store there length in a variable anyway so the 
overhead should be tiny
</tt><blockquote class="blockquote"><br>
<blockquote class="blockquote"><tt>&gt; &gt; 2. how does the data return from minimisation work (specifically 
why is<br>
&gt; &gt; param_vector  a  instance vaiable of  Model_free<br>
&gt; &gt; e.g. we have<br>
&gt; &gt;<br>
&gt; &gt; self.param_vector, self.func, iter, fc, gc, hc, self.warning = 
results<br>
&gt; &gt;<br>
&gt; &gt; ....<br>
&gt; &gt;<br>
&gt; &gt; # Disassemble the parameter vector.<br>
&gt; &gt; self.disassemble_param_vector(index=index, sim_index=sim_index)<br>
&gt; &gt;<br>
&gt; &gt;<br>
&gt; &gt;<br>
&gt; &gt; inside a tight loop. So even though self.param_vector is an instance<br>
&gt; &gt; variable it doesn't contain state for a Model_free object it just 
keeps<br>
&gt; &gt; being overwritten by the latest contents of the result<br>
&gt; &gt;<br>
&gt; &gt; so why not<br>
&gt; &gt;<br>
&gt; &gt; param_vector, self.func, iter, fc, gc, hc, self.warning = results<br>
&gt; &gt;<br>
&gt; &gt; ....<br>
&gt; &gt;<br>
&gt; &gt; # Disassemble the parameter vector.<br>
&gt; &gt; self.disassemble_param_vector(param_vector, index=index,<br>
&gt; &gt; sim_index=sim_index)<br>
&gt;<br>
&gt; Yes, this is probably how this should be done.  Grep for<br>
&gt; 'self.param_vector' in 'specific_fns/model_free.py' to see why there<br>
&gt; has been an inertia for me to make this change.  If necessary for the<br>
&gt; MPI code, please try to minimise the number of changes to this setup<br>
&gt; as possible.</tt><br>
<br>
<pre style="margin: 0em;">I will</pre><br>
<pre style="margin: 0em;">Sorry about the legacy code, but because of the nature
&gt; of the multi_processor branch you may need to work with it.</pre><br>
<pre style="margin: 0em;">of course, I have made my bed and (be it nails or feathers)  am having
a good go at lying in it!</pre><br>
<pre style="margin: 0em;">Hopefully
&gt; I'll have all these legacy issues completely removed in the 1.3 line
&gt; once the data model redesign is complete.  That being said, if you
&gt; need to, please feel free to make the above changes.
&gt;</pre><br>
<pre style="margin: 0em;">I don't need to change this ;-) it was more a question trying to
understand the way things are, ask the obvious question, and check
that I am not missing something deep...
</pre></blockquote><pre style="margin: 0em;"><br>I was planning on fixing all this up anyway.  I like clean, readable,
and simple code bases to allow anyone to dive straight into it.
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">regards
gary
</pre><blockquote class="blockquote"><pre style="margin: 0em;"><br>Regards,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<pre style="margin: 0em;">.</pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
-------------------------------------------------------------------
Dr Gary Thompson
Astbury Centre for Structural Molecular Biology,
University of Leeds, Astbury Building,
Leeds, LS2 9JT, West-Yorkshire, UK             Tel. +44-113-3433024
email: garyt@xxxxxxxxxxxxxxx                   Fax  +44-113-2331407
-------------------------------------------------------------------</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00092" href="msg00092.html">relax and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00107" href="msg00107.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00110" href="msg00110.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00112" href="msg00112.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00114" href="msg00114.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00124" href="msg00124.html">how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00126" href="msg00126.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00128" href="msg00128.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00130" href="msg00130.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00132" href="msg00132.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> gary thompson</li></ul></li>
<li><strong><a name="00135" href="msg00135.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Mar 27 18:42:37 2007</div>  
</body>
</html>
