<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [bug #22017] LinAlgError, for all numerical CPMG models. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 19 May 2014 13:51:41 +0200 -->
<!--X-Message-Id: CAED9pY8__4W8vz8DAxPU+vnLSSEsdvdrgfxmCHd58=fWzJTzHw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140507&#45;150749.sv20529.5081@gna.org -->
<!--X-Reference: 20140508&#45;183035.sv20529.13474@gna.org -->
<!--X-Reference: 20140509&#45;083940.sv20529.7512@gna.org -->
<!--X-Reference: 20140515&#45;124009.sv2782.7199@gna.org -->
<!--X-Reference: 20140518&#45;203218.sv20529.2682@gna.org -->
<!--X-Reference: 20140518&#45;204120.sv20529.126@gna.org -->
<!--X-Reference: CAED9pY&#45;miXq+RyiUaUYtQdq6GByy&#45;&#45;eLisiBCU0oR95hznCWhw@mail.gmail.com -->
<!--X-Reference: CA+CBx2PdcoDc2Tb2pwEKjGfQuJAJhvGMRXDy_JHtbqmoV1CFkQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [bug #22017] LinAlgError, for all numerical CPMG models. -- May 19, 2014 - 13:51</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [bug #22017] LinAlgError, for all numerical CPMG models.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00368" class="tabs">Index by Date</a> | <a href="threads.html#00368" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00367.html">Date Prev</a>] [<a href="msg00369.html">Date Next</a>] [<a href="msg00360.html">Thread Prev</a>] [<a href="msg00413.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 19 May 2014 13:50:50 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=mTM6c/3d4RStOgedtR95LDuBCoYrttceRVCX9XHpg8g=; b=Qyrgiy+4hwmR2pKeroNB/EsqHTr1/8ZSlWKysdkycuBhKZOv3bqwWRJQSYtuoZ4KJ9 haNtWVOY1ldGYvdOJPch92UIsvcY19GaaUfjF0YoxZ+5t7fWwhaPYNJRGasMps2IWD/7 plBx3cURFst/gL5rJeXfSIAXY1q78fTMZYzohV5ri7RLxG+iFw6SRkqjfFhALsQb0jDt 5xK3b8QShYdY2CIAmnYE4aWcB3iH7Nq28rnnFur8s/oT2/Yfrx/bfVGdyVZ+n3h3j5rQ NgST/fgO89fpxEChUIun7zZlMiydVjZyCZNnCAI6UCi/t5vyrsQp3YsN2ExtObruy2MX vG7g==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY8__4W8vz8DAxPU+vnLSSEsdvdrgfxmCHd58=fWzJTzHw@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00194.html">20140507-150749.sv20529.5081@gna.org</a>&gt; &lt;<a href="msg00264.html">20140508-183035.sv20529.13474@gna.org</a>&gt; &lt;<a href="msg00268.html">20140509-083940.sv20529.7512@gna.org</a>&gt; &lt;<a href="msg00337.html">20140515-124009.sv2782.7199@gna.org</a>&gt; &lt;<a href="msg00340.html">20140518-203218.sv20529.2682@gna.org</a>&gt; &lt;<a href="msg00341.html">20140518-204120.sv20529.126@gna.org</a>&gt; &lt;<a href="msg00345.html">CAED9pY-miXq+RyiUaUYtQdq6GByy--eLisiBCU0oR95hznCWhw@mail.gmail.com</a>&gt; &lt;<a href="msg00360.html">CA+CBx2PdcoDc2Tb2pwEKjGfQuJAJhvGMRXDy_JHtbqmoV1CFkQ@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on May 19, 2014 - 13:51:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

Well, the target_functions.relax_disp and lib.dispersion code make
assumptions as to how the data they receive will look like.  If this
is violated, then it will be random how different code paths fail.  In
the numeric models, we use a special matrix_exponential() function
that I wrote, which itself calls numpy.linalg.eig().  The eig()
function is where the failure occurs.  This function is not used in
the analytic models, so the same failure cannot be observed.

The best approach in designing the interface between the user and the
functional code is to perform comprehensive checks of what the user
has supplied.  If things are missing or incorrect, raising a
RelaxError is the best way to give feedback to the user.  Then we make
sure that we package the data up for sending to the target functions
only when all required data is supplied.  Then the target functions
will always receive the data in the correct format.  So the idea is to
block this code path - the optimisation - until everything is as we
expect.  The only problem with the dispersion analysis is that I never
had the time to add fully comprehensive checking.  Therefore we can
add checks as users encounter and report problems.

Regards,

Edward

On 19 May 2014 12:41, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Ed.

That sounds fine.

But what troubles me, is that the methods differ.

Why can the numeric models not handle this?

This sets off an alarm for me, showing that something is not consistent
and designed correct.

Best
Troels


2014-05-19 9:53 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

There are two ways to solve this bug:

1)  Have the relaxation dispersion code which assembles the data from
the current data pipe into the form required for the target functions
handle the problem.

2)  Have relax give RelaxErrors preventing the user from doing anything.

Number 1) is by far the most difficult!  The reason is because there
are an incredible number of ways users can input data.  The number of
data combinations is huge.  Number 2) would be much easier - simply
present to the user:

RelaxError:  Two magnetic fields detected but data only present for one.

This could be a single function added to
specific_analyses.relax_disp.checks which is called at the start of
the minimise() API method (and any other user functions that require
it).  As users discover other invalid data combinations - which they
most definitely will - then we just add more and more check_*()
functions to raise RelaxErrors.  This is what happens in all the other
specific analyses.  Rather than handling all possible ways a user can
fit data into relax, which would require huge amounts of complex code,
we simply raise RelaxErrors telling the user what is wrong with their
data input.  This involves only a few 10 line max check_*() functions.
 In this case, the user can then decide to delete the metadata, not
set it up, or load the required data.  I would highly recommend this
simple solution.

Regards,

Edward





On 18 May 2014 22:41, Troels E. Linnet &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Follow-up Comment #5, bug #22017 (project relax):

This bug persists, since it will work when:

model_create = MODEL_NS_CPMG_2SITE_EXPANDED
model_create = MODEL_CR72

Somehow these models:

model_create = MODEL_NS_CPMG_2SITE_3D
model_create = MODEL_NS_CPMG_2SITE_3D_FULL
model_create = MODEL_NS_CPMG_2SITE_STAR
model_create = MODEL_NS_CPMG_2SITE_STAR_FULL

will fail to produce the data.

The point of fails, is before the R2eff values have been created for the 
other
timepoint.
But it should not be necessary.

    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/bugs/?22017">http://gna.org/bugs/?22017</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>

</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00194" href="msg00194.html">[bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00264" href="msg00264.html">[bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00268" href="msg00268.html">[bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00337" href="msg00337.html">[bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Edward d Auvergne</li></ul></li>
<li><strong><a name="00340" href="msg00340.html">[bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00341" href="msg00341.html">[bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00345" href="msg00345.html">Re: [bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00360" href="msg00360.html">Re: [bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed May 21 18:00:16 2014</div>  
</body>
</html>
