<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r21920 &#45; /trunk/test_suite/system_tests/relax_disp.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 09 Dec 2013 18:03:24 +0100 -->
<!--X-Message-Id: CA+CBx2PAhiTx68GtHJodE8E0uonXpX4QxeYJZ5QiFpntn7aztw@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: E1Vq41l&#45;00058P&#45;HI@subversion.gna.org -->
<!--X-Reference: CAED9pY86aHgKdwdH&#45;Ds+FAGQWiKi0usQ&#45;gY6VDf0NRh+eW1Rtw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py -- December 09, 2013 - 18:03</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00084" class="tabs">Index by Date</a> | <a href="threads.html#00084" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00083.html">Date Prev</a>] [<a href="msg00085.html">Date Next</a>] [<a href="msg00083.html">Thread Prev</a>] [<a href="msg00085.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 9 Dec 2013 18:02:32 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:from:date:message-id	:subject:to:cc:content-type;	bh=YmhqwN2QO0VlBW289XkO/Sv/FrIB1BNvW3IqKMb+vkc=;	b=Gf7X02bIAk3midBXCQ/Kd/a045Qib5hVizAFTuMYriloYOhc8eB4kjtQPLOP6xV55z	5C43Ax/3tIEkCozgaveg7WQsGqcHz6YAMvLu5io+jd45ojO5GOaXFlEoLNgl0IzsARgO	QWS2jptoPQKc8nMqxtIzxxwh3tjQOZvmyzmnIo4C3uJZodKJt6TnSmeEuo4PKLQjw8cY	8i/m2gBXAxGT1e/JzrRWrDy946QTI8ZHIGVtbjP0r/6sG5vRryReAOLLTl8Ql+6jTM+C	uxtzFV1turBK1Ht9TPEIPI3TUNplzf0dVErzJfiGEVXtfEaYO+894W8oL3S2tKIkBrQm	rVLQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00084.html">CA+CBx2PAhiTx68GtHJodE8E0uonXpX4QxeYJZ5QiFpntn7aztw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Vq41l-00058P-HI@xxxxxxxxxxxxxxxxxx&gt;	&lt;CAED9pY86aHgKdwdH-Ds+FAGQWiKi0usQ-gY6VDf0NRh+eW1Rtw@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on December 09, 2013 - 18:03:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr">Hi Edward.<div><br></div><div style>The R1rho data is not constant time.</div><div style><br></div><div style>I have only included the models:</div><div style><span style="font-family:arial,sans-serif;font-size:13.333333969116211px">MODELS = [&#39;R2eff&#39;, &#39;No Rex&#39;, &#39;DPL94&#39;]</span><br>

</div><div style><br></div><div style>I have set it up, to find a solution for analysing R1rho data, where R1 data has not been acquired, but for </div><div style>different </div><div style><br></div><div style>It actually also fails at the moment, and will probably do for some time.</div>

<div style><br></div><div style>--------</div><div style>relax -s Relax_disp.test_r1rho_kjaergaar<br></div><div style><br></div><div style><div>relax&gt; calc(verbosity=1)</div><div>Traceback (most recent call last):</div>

<div>  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/test_suite/system_tests/relax_disp.py&quot;, line 2581, in test_r1rho_kjaergaard</div><div>    relax_disp.Relax_disp(pipe_name=pipe_name, pipe_bundle=pipe_bundle, results_dir=ds.tmpdir, models=MODELS, grid_inc=GRID_INC, mc_sim_num=MC_NUM, modsel=MODSEL)</div>

<div>  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/auto_analyses/relax_disp.py&quot;, line 116, in __init__</div><div>    self.run()</div><div>  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/auto_analyses/relax_disp.py&quot;, line 447, in run</div>

<div>    self.interpreter.calc()</div><div>  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/prompt/uf_objects.py&quot;, line 221, in __call__</div><div>    self._backend(*new_args, **uf_kargs)</div><div>  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/pipe_control/minimise.py&quot;, line 86, in calc</div>

<div>    calculate(verbosity=verbosity)</div><div>  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;, line 717, in calculate</div><div>    self._calculate_r2eff()</div>

<div>  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;, line 182, in _calculate_r2eff</div><div>    check_exp_type_fixed_time()</div><div>  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/checks.py&quot;, line 112, in check_exp_type_fixed_time</div>

<div>    raise RelaxError(&quot;The experiment &#39;%s&#39; is not of the fixed relaxation time period data type.&quot; % exp_type)</div><div>RelaxError: RelaxError: The experiment &#39;R1rho&#39; is not of the fixed relaxation time period data type.</div>

<div><br></div><div>--------------</div><div><br></div><div style>Is the R1rho analysis only implemented for fixed time periods?</div><div style><br></div><div style>Best<br>Troels</div></div><div style><br></div></div><div class="gmail_extra">

<br><br><div class="gmail_quote">2013/12/9 Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx" target="_blank">edward@xxxxxxxxxxxxx</a>&gt;</span><br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">

Hi Troels,<br>
<br>
When looking at this data and analysis, remember that I have not<br>
implemented Dmitry Korzhnev&#39;s &quot;correction&quot; for constant time R1rho<br>
data.  I don&#39;t know if that was used in the original publication for<br>
your data.  More details are given in the &#39;To do&#39; section of the<br>
manual (I only recently added this info).  I also don&#39;t know what the<br>
rest of the field think of his correction and how it applies to later<br>
models from the Palmer group.<br>
<br>
Regards,<br>
<br>
Edward<br>
<div><div class="h5"><br>
<br>
<br>
On 9 December 2013 17:49,  &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt; Author: tlinnet<br>
&gt; Date: Mon Dec  9 17:49:49 2013<br>
&gt; New Revision: 21920<br>
&gt;<br>
&gt; URL: <a rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=21920&amp;view=rev" target="_blank">http://svn.gna.org/viewcvs/relax?rev=21920&amp;view=rev</a><br>
&gt; Log:<br>
&gt; Added system test for the analysis of optimisation of the Kjaergaard et al., 2013 Off-resonance R1rho relaxation dispersion experiments using the &#39;DPL&#39; model.<br>
&gt;<br>
&gt; Work in progress for Support Request #3083, (<a rel="nofollow" href="https://gna.org/support/index.php?3083" target="_blank">https://gna.org/support/index.php?3083</a>) -  Addition of Data-set for R1rho analysis.<br>
&gt;<br>
&gt; Modified:<br>
&gt;     trunk/test_suite/system_tests/relax_disp.py<br>
&gt;<br>
&gt; Modified: trunk/test_suite/system_tests/relax_disp.py<br>
&gt; URL: <a rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/relax_disp.py?rev=21920&amp;r1=21919&amp;r2=21920&amp;view=diff" target="_blank">http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/relax_disp.py?rev=21920&amp;r1=21919&amp;r2=21920&amp;view=diff</a><br>


&gt; ==============================================================================<br>
&gt; --- trunk/test_suite/system_tests/relax_disp.py (original)<br>
&gt; +++ trunk/test_suite/system_tests/relax_disp.py Mon Dec  9 17:49:49 2013<br>
&gt; @@ -2450,6 +2450,137 @@<br>
&gt;          self.assertAlmostEqual(cdp.mol[0].res[0].spin[0].chi2, 0.030959849811015544, 3)<br>
&gt;<br>
&gt;<br>
&gt; +    def test_r1rho_kjaergaard(self):<br>
&gt; +        &quot;&quot;&quot;Optimisation of the Kjaergaard et al., 2013 Off-resonance R1rho relaxation dispersion experiments using the &#39;DPL&#39; model.<br>
&gt; +<br>
&gt; +        This uses the data from Kjaergaard&#39;s paper at U{DOI: 10.1021/bi4001062&lt;<a rel="nofollow" href="http://dx.doi.org/10.1021/bi4001062" target="_blank">http://dx.doi.org/10.1021/bi4001062</a>&gt;}.<br>
&gt; +<br>
&gt; +        &quot;&quot;&quot;<br>
&gt; +<br>
&gt; +        # The path to the data files.<br>
&gt; +        data_path = status.install_path + sep+&#39;test_suite&#39;+sep+&#39;shared_data&#39;+sep+&#39;dispersion&#39;+sep+&#39;Kjaergaard_et_al_2013&#39;<br>
&gt; +<br>
&gt; +        # Set pipe name, bundle and type.<br>
&gt; +        pipe_name = &#39;base pipe&#39;<br>
&gt; +        pipe_bundle = &#39;relax_disp&#39;<br>
&gt; +        pipe_type= &#39;relax_disp&#39;<br>
&gt; +<br>
&gt; +        # Create the data pipe.<br>
&gt; +        self.interpreter.pipe.create(pipe_name=pipe_name, bundle=pipe_bundle, pipe_type=pipe_type)<br>
&gt; +<br>
&gt; +        # Read the spins.<br>
&gt; +        self.interpreter.spectrum.read_spins(file=&#39;1_0_46_0_max_standard.ser&#39;, dir=data_path+sep+&#39;peak_lists&#39;)<br>
&gt; +<br>
&gt; +        # Test some of the sequence.<br>
&gt; +        self.assertEqual(len(cdp.mol), 1)<br>
&gt; +        self.assertEqual(cdp.mol[0].name, None)<br>
&gt; +        self.assertEqual(len(cdp.mol[0].res), 48)<br>
&gt; +<br>
&gt; +        # Name the isotope for field strength scaling.<br>
&gt; +        self.interpreter.spin.isotope(isotope=&#39;15N&#39;)<br>
&gt; +<br>
&gt; +        # Set number of experiments to be used.<br>
&gt; +        NR_exp = -1<br>
&gt; +<br>
&gt; +        # Load the experiments settings file.<br>
&gt; +        expfile = open(data_path+sep+&#39;exp_parameters_sort.txt&#39;,&#39;r&#39;)<br>
&gt; +        expfileslines = expfile.readlines()[:NR_exp]<br>
&gt; +        expfile.close()<br>
&gt; +<br>
&gt; +        # In MHz<br>
&gt; +        yOBS = 81.050<br>
&gt; +        # In ppm<br>
&gt; +        yCAR = 118.078<br>
&gt; +        centerPPM_N15 = yCAR<br>
&gt; +<br>
&gt; +        ## Read the chemical shift data.<br>
&gt; +        self.interpreter.chemical_shift.read(file=&#39;1_0_46_0_max_standard.ser&#39;, dir=data_path+sep+&#39;peak_lists&#39;)<br>
&gt; +<br>
&gt; +        # Test the chemical shift data.<br>
&gt; +        cs = [122.223, 122.162, 114.250, 125.852, 118.626, 117.449, 119.999, 122.610, 118.602, 118.291, 115.393,<br>
&gt; +        121.288, 117.448, 116.378, 116.316, 117.263, 122.211, 118.748, 118.103, 119.421, 119.317, 119.386, 117.279,<br>
&gt; +        122.103, 120.038, 116.698, 111.811, 118.639, 118.285, 121.318, 117.770, 119.948, 119.759, 118.314, 118.160,<br>
&gt; +        121.442, 118.714, 113.080, 125.706, 119.183, 120.966, 122.361, 126.675, 117.069, 120.875, 109.372, 119.811, 126.048]<br>
&gt; +<br>
&gt; +        i = 0<br>
&gt; +        for spin, spin_id in spin_loop(return_id=True):<br>
&gt; +            print <a rel="nofollow" href="http://spin.name" target="_blank">spin.name</a>, spin.num, spin_id, spin.chemical_shift, cs[i]<br>
&gt; +            # Check the chemical shift.<br>
&gt; +            self.assertEqual(spin.chemical_shift, cs[i])<br>
&gt; +<br>
&gt; +            # Increment the index.<br>
&gt; +            i += 1<br>
&gt; +<br>
&gt; +        # The lock power to field, has been found in an calibration experiment.<br>
&gt; +        spin_lock_field_strengths_Hz = {&#39;35&#39;: 431.0, &#39;39&#39;: 651.2, &#39;41&#39;: 800.5, &#39;43&#39;: 984.0, &#39;46&#39;: 1341.11, &#39;48&#39;: 1648.5}<br>
&gt; +<br>
&gt; +        # Apply spectra settings.<br>
&gt; +        for i in range(len(expfileslines)):<br>
&gt; +            line=expfileslines[i]<br>
&gt; +            if line[0] == &quot;#&quot;:<br>
&gt; +                continue<br>
&gt; +            else:<br>
&gt; +                # DIRN I deltadof2 dpwr2slock ncyc trim ss sfrq<br>
&gt; +                DIRN = line.split()[0]<br>
&gt; +                I = int(line.split()[1])<br>
&gt; +                deltadof2 = line.split()[2]<br>
&gt; +                dpwr2slock = line.split()[3]<br>
&gt; +                ncyc = int(line.split()[4])<br>
&gt; +                trim = float(line.split()[5])<br>
&gt; +                ss = int(line.split()[6])<br>
&gt; +                set_sfrq = float(line.split()[7])<br>
&gt; +                apod_rmsd = float(line.split()[8])<br>
&gt; +                spin_lock_field_strength = spin_lock_field_strengths_Hz[dpwr2slock]<br>
&gt; +<br>
&gt; +                # Calculate spin_lock time<br>
&gt; +                time_sl = 2*ncyc*trim<br>
&gt; +<br>
&gt; +                # Define file name for peak list.<br>
&gt; +                FNAME = &quot;%s_%s_%s_%s_max_standard.ser&quot;%(I, deltadof2, dpwr2slock, ncyc)<br>
&gt; +                sp_id = &quot;%s_%s_%s_%s&quot;%(I, deltadof2, dpwr2slock, ncyc)<br>
&gt; +<br>
&gt; +                # Load the peak intensities.<br>
&gt; +                self.interpreter.spectrum.read_intensities(file=FNAME, dir=data_path+sep+&#39;peak_lists&#39;, spectrum_id=sp_id, int_method=&#39;height&#39;)<br>
&gt; +<br>
&gt; +                # Set the peak intensity errors, as defined as the baseplane RMSD.<br>
&gt; +                self.interpreter.spectrum.baseplane_rmsd(error=apod_rmsd, spectrum_id=sp_id)<br>
&gt; +<br>
&gt; +                # Set the relaxation dispersion experiment type.<br>
&gt; +                self.interpreter.relax_disp.exp_type(spectrum_id=sp_id, exp_type=&#39;R1rho&#39;)<br>
&gt; +<br>
&gt; +                # Set The spin-lock field strength, nu1, in Hz<br>
&gt; +                self.interpreter.relax_disp.spin_lock_field(spectrum_id=sp_id, field=spin_lock_field_strength)<br>
&gt; +<br>
&gt; +                # Calculating the spin-lock offset in ppm, from offsets values provided in Hz.<br>
&gt; +                frq_N15_Hz = yOBS * 1E6<br>
&gt; +                offset_ppm_N15 = float(deltadof2) / frq_N15_Hz * 1E6<br>
&gt; +                omega_rf_ppm = centerPPM_N15 + offset_ppm_N15<br>
&gt; +<br>
&gt; +                # Set The spin-lock offset, omega_rf, in ppm.<br>
&gt; +                self.interpreter.relax_disp.spin_lock_offset(spectrum_id=sp_id, offset=omega_rf_ppm)<br>
&gt; +<br>
&gt; +                # Set the relaxation times (in s).<br>
&gt; +                self.interpreter.relax_fit.relax_time(time=time_sl, spectrum_id=sp_id)<br>
&gt; +<br>
&gt; +                # Set the spectrometer frequency.<br>
&gt; +                self.interpreter.spectrometer.frequency(id=sp_id, frq=set_sfrq, units=&#39;MHz&#39;)<br>
&gt; +<br>
&gt; +        # The dispersion models.<br>
&gt; +        MODELS = [&#39;R2eff&#39;, &#39;No Rex&#39;, &#39;DPL94&#39;]<br>
&gt; +<br>
&gt; +        # The grid search size (the number of increments per dimension).<br>
&gt; +        GRID_INC = 4<br>
&gt; +<br>
&gt; +        # The number of Monte Carlo simulations to be used for error analysis at the end of the analysis.<br>
&gt; +        MC_NUM = 3<br>
&gt; +<br>
&gt; +        # Model selection technique.<br>
&gt; +        MODSEL = &#39;AIC&#39;<br>
&gt; +<br>
&gt; +        # Run the analysis.<br>
&gt; +        relax_disp.Relax_disp(pipe_name=pipe_name, pipe_bundle=pipe_bundle, results_dir=ds.tmpdir, models=MODELS, grid_inc=GRID_INC, mc_sim_num=MC_NUM, modsel=MODSEL)<br>
&gt; +<br>
&gt; +<br>
&gt;      def test_r2eff_read(self):<br>
&gt;          &quot;&quot;&quot;Test the operation of the relax_disp.r2eff_read user function.&quot;&quot;&quot;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; _______________________________________________<br>
&gt; relax (<a rel="nofollow" href="http://www.nmr-relax.com" target="_blank">http://www.nmr-relax.com</a>)<br>
&gt;<br>
&gt; This is the relax-commits mailing list<br>
&gt; <a rel="nofollow" href="mailto:relax-commits@xxxxxxx">relax-commits@xxxxxxx</a><br>
&gt;<br>
&gt; To unsubscribe from this list, get a password<br>
&gt; reminder, or change your subscription options,<br>
&gt; visit the list information page at<br>
&gt; <a rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits" target="_blank">https://mail.gna.org/listinfo/relax-commits</a><br>
<br>
_______________________________________________<br>
relax (<a rel="nofollow" href="http://www.nmr-relax.com" target="_blank">http://www.nmr-relax.com</a>)<br>
<br>
</div></div>This is the relax-devel mailing list<br>
<a rel="nofollow" href="mailto:relax-devel@xxxxxxx">relax-devel@xxxxxxx</a><br>
<div class="im"><br>
To unsubscribe from this list, get a password<br>
reminder, or change your subscription options,<br>
visit the list information page at<br>
</div><a rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel" target="_blank">https://mail.gna.org/listinfo/relax-devel</a><br>
</blockquote></div><br></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00085" href="msg00085.html">Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00083" href="msg00083.html">Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Dec 09 18:20:08 2013</div>  
</body>
</html>
