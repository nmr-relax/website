<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r13246 &#45; /branches/xyz/prompt/structure.py -->
<!--X-From-R13: Vna Eha <unfhNaze.zcvocp.zct.qr> -->
<!--X-Date: Tue, 28 Jun 2011 15:17:28 +0200 -->
<!--X-Message-Id: 43B62336&#45;A690&#45;454A&#45;85D3&#45;9A7A6DA74D04@nmr.mpibpc.mpg.de -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1QbF6F&#45;0007K8&#45;NV@subversion.gna.org -->
<!--X-Reference: BANLkTimJ_J9E4gwifUe_LKeT9cGf&#45;_Lg7Q@mail.gmail.com -->
<!--X-Reference: 2B333AA5&#45;0419&#45;42EC&#45;9649&#45;1588CA349808@nmr.mpibpc.mpg.de -->
<!--X-Reference: BANLkTi=y7cFh8M3eALg0XJ7XfenF&#45;Fk1WQ@mail.gmail.com -->
<!--X-Reference: 54208F81&#45;CB0C&#45;440E&#45;9741&#45;B3436DC4856A@nmr.mpibpc.mpg.de -->
<!--X-Reference: BANLkTinrLNch+bMBD+yovz8VUG+Fi&#45;82jQ@mail.gmail.com -->
<!--X-Reference: CA7B177A&#45;0912&#45;434E&#45;95BC&#45;B4A72E880606@nmr.mpibpc.mpg.de -->
<!--X-Reference: BANLkTimkgETJTZMpfUoZws6VkQoBvyFS3Q@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r13246 - /branches/xyz/prompt/structure.py -- June 28, 2011 - 15:17</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r13246 - /branches/xyz/prompt/structure.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00253" class="tabs">Index by Date</a> | <a href="threads.html#00253" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00252.html">Date Prev</a>] [<a href="msg00254.html">Date Next</a>] [<a href="msg00252.html">Thread Prev</a>] [<a href="msg00245.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 28 Jun 2011 15:19:21 +0200</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00253.html">43B62336-A690-454A-85D3-9A7A6DA74D04@nmr.mpibpc.mpg.de</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1QbF6F-0007K8-NV@xxxxxxxxxxxxxxxxxx&gt;	&lt;BANLkTimJ_J9E4gwifUe_LKeT9cGf-_Lg7Q@xxxxxxxxxxxxxx&gt;	&lt;2B333AA5-0419-42EC-9649-1588CA349808@xxxxxxxxxxxxxxxxx&gt;	&lt;BANLkTi=y7cFh8M3eALg0XJ7XfenF-Fk1WQ@xxxxxxxxxxxxxx&gt;	&lt;54208F81-CB0C-440E-9741-B3436DC4856A@xxxxxxxxxxxxxxxxx&gt;	&lt;BANLkTinrLNch+bMBD+yovz8VUG+Fi-82jQ@xxxxxxxxxxxxxx&gt;	&lt;CA7B177A-0912-434E-95BC-B4A72E880606@xxxxxxxxxxxxxxxxx&gt;	&lt;BANLkTimkgETJTZMpfUoZws6VkQoBvyFS3Q@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Han Sun</strong> on June 28, 2011 - 15:17:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi,

</pre><tt>I also think this is the best approach. Then you means I can change  
</tt><tt>the current code accordingly?
</tt><pre style="margin: 0em;">

Best,
Han


On Jun 28, 2011, at 2:20 PM, Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

This should work automatically for relax as well then.  If you ask for
atom @9, then you get that unique atom.  So every proton will have
it's own unique number based on the position in the XYZ file.  The
current user functions will work with this without issue, so there
will be no need to come up with new ones.  The only problem with this
is that there would have to be a call to structure.vectors() for every
atom.  The attached argument will need to be modified though to accept
a spin ID string rather than the name of the attached atom.  So that
instead of:

relax&gt; structure.vectors(attached='H', spin_id='@C&amp;@1')

i.e. the proton attached to carbon 1, you would type:

relax&gt; structure.vectors(spin_id='@C&amp;@1', attached='@H&amp;@2')

or even more simply:

relax&gt; structure.vectors(spin_id='@1', attached='@2')

where atom 1 is the carbon loaded as a spin, and atom 2 is the
attached proton.  The user could come up with a loop over a list of
carbon atoms and protons to load all vectors.  I think this would be
the best approach.  Is there another way we could do this?

Regards,

Edward





On 28 June 2011 14:13, Han Sun &lt;hasu@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

</pre><tt>In NMRDev and in openbabel they name the atom after their atom  
</tt><tt>number,
</tt><pre style="margin: 0em;">
because the atom number is unique for its atom.

</pre><tt>And in NMRDev if I want to load a vector between two spins, then I  
</tt><tt>just give
</tt><pre style="margin: 0em;">
the two atom numbers. It works very well.

Best,
Han


On Jun 28, 2011, at 1:59 PM, Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

It sounds like we need to come up with a way of identifying the two
atoms in a consistent way.  Do you know how is this done in other
programs?  For example in NMRDev
(<a  rel="nofollow" href="http://magcid.uvigo.es/~armando/nmrdev/">http://magcid.uvigo.es/~armando/nmrdev/</a>)?  Or in other organic
chemistry software.  I have a feeling we will have to come up with a
way of naming the atoms.  We cannot use the atom number as these are
</pre><tt>sequential from the file and a number is only allowed to be used  
</tt><tt>once.
</tt><tt> Normally the atoms are differentiated using atom names such as  
</tt><tt>H1 and
</tt><pre style="margin: 0em;">
H2.  Should we attempt to determine connectivities and rename the
</pre><tt>atoms?  Essentially there is no atom name in the XYZ file, it is  
</tt><tt>more
</tt><tt>the element type.  I think we need to study other software to see  
</tt><tt>how
</tt><tt>this is handled.  We can then document what they do in an post to  
</tt><tt>the
</tt><pre style="margin: 0em;">
mailing list, and decide what the best way to do this in relax would
be.  What do you think?

Regards,

Edward


</pre><tt>P. S.  I may not be able to answer emails for a while as I'll  
</tt><tt>soon be
</tt><pre style="margin: 0em;">
catching the train to Goettingen.  I could answer questions tonight.


On 28 June 2011 13:01, Han Sun &lt;hasu@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Edward,

that is reason why I want to generate a new function for the xyz
yesterday.
I think the best way to do is to load atoms specific.
For example:

</pre><tt>self.interpreter.structure.vectors_xyz(spin_id1='#SSS-cluster4- 
</tt><tt>new-test_mol1@1',
</tt><pre style="margin: 0em;">
spin_id2='#SSS-cluster4-new-test_mol1@2')

</pre><tt>And we don't need to care whether it is bonded or not, because  
</tt><tt>in the RDC
</tt><tt>analysis sometime you have 2 or 3 bonded couplings. What do you  
</tt><tt>think?
</tt><pre style="margin: 0em;">

Best,
Han


On Jun 28, 2011, at 12:20 PM, Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

</pre><tt>Yes, this would be a problem.  The code is a temporary work  
</tt><tt>around,
</tt><pre style="margin: 0em;">
and is avoided if you specify a unique proton name (assuming the
</pre><tt>protons have different names).  The problem here is if you have  
</tt><tt>RDCs
</tt><tt>for both of the CH bonds in a CH2 group, how are we going to  
</tt><tt>specify
</tt><pre style="margin: 0em;">
which RDC belongs to which atom from the XYZ file?  How do we
</pre><tt>differentiate the different values?  We will need to think  
</tt><tt>about that
</tt><pre style="margin: 0em;">
one for a bit.  How did we previously do this?

Regards,

Edward



On 28 June 2011 12:09, Han Sun &lt;hasu@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Edward,

in the function __bonded_atom() I found following code:

     # Problem.
     if num_attached &gt; 1:
         # Get the atom names.
         matching_names = []
         for i in matching_list:
             matching_names.append(mol.atom_name[i])

         # Return nothing but a warning.
</pre><tt>         return None, None, None, None, None, 'More than one  
</tt><tt>attached
</tt><pre style="margin: 0em;">
atom
found: ' + repr(matching_names)

</pre><tt>This means that it can only load one atom. But this is often  
</tt><tt>not the
</tt><pre style="margin: 0em;">
case
</pre><tt>for small molecule. For example if I have a CH3 group and I  
</tt><tt>asked it to
</tt><pre style="margin: 0em;">
load
protons, all three protons should be loaded.

Best,
Han


On Jun 27, 2011, at 7:26 PM, Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi Han,

</pre><tt>This is another case were the current code can be used, and  
</tt><tt>if it
</tt><tt>doesn't work then it should be fixed rather than a new  
</tt><tt>function added.
</tt><tt> The structure.vectors() method is independent of the format  
</tt><tt>of the
</tt><tt>structural file.  Normally when I use it, the PDB file has  
</tt><tt>been read
</tt><tt>in and is in the internal structure format.  After reading  
</tt><tt>the XYZ
</tt><pre style="margin: 0em;">
file, it should also be in the internal format.  So the
</pre><tt>structure.vectors() user function should work on both.  So if  
</tt><tt>you load
</tt><tt>all the carbons as spins from the organic molecule, the CH  
</tt><tt>vectors
</tt><pre style="margin: 0em;">
should be extractable with:

relax&gt; structure.vectors(attached='H', spin_id='@C')

</pre><tt>The 'H' needs no '*' characters as all protons in the XYZ  
</tt><tt>file are
</tt><tt>called 'H'.  The internal structural object will then  
</tt><tt>determine which
</tt><tt>'H' atoms are attached to the C atoms.  This is either taken  
</tt><tt>from the
</tt><tt>structural file, or it uses a very basic distance based  
</tt><tt>algorithm in
</tt><tt>__bonded_atom() and __find_bonded_atoms().  I have a feeling  
</tt><tt>that this
</tt><pre style="margin: 0em;">
will work automatically.

Regards,

Edward



On 27 June 2011 18:55,  &lt;hasu@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Author: han87
Date: Mon Jun 27 18:55:51 2011
New Revision: 13246

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=13246&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=13246&amp;view=rev</a>
Log:
A new function vector_xyz() was generated.

</pre><tt>A new function vector_xyz() was generated in '/prompt/ 
</tt><tt>structure.py'
</tt><pre style="margin: 0em;">
for
extracting a vector of two given atoms in a xyz file.

Modified:
 branches/xyz/prompt/structure.py

Modified: branches/xyz/prompt/structure.py
URL:


</pre><tt><a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/xyz/prompt/">http://svn.gna.org/viewcvs/relax/branches/xyz/prompt/</a> 
</tt><tt>structure.py?rev=13246&amp;r1=13245&amp;r2=13246&amp;view=diff
</tt><pre style="margin: 0em;">



</pre><tt>=============================================================== 
</tt><tt>===============
</tt><pre style="margin: 0em;">
--- branches/xyz/prompt/structure.py (original)
+++ branches/xyz/prompt/structure.py Mon Jun 27 18:55:51 2011
@@ -686,6 +686,76 @@
     generic_fns.structure.main.vectors(attached=attached,
spin_id=spin_id, model=model, verbosity=verbosity, ave=ave,
unit=unit)


</pre><tt>+    def vectors_xyz(self, spin_id1=None, spin_id2=None,  
</tt><tt>model=None,
</tt><pre style="margin: 0em;">
verbosity=1, ave=True, unit=True):
+        &quot;&quot;&quot;Extract and store the bond vectors from the loaded
structures
in the spin container.
+
+        Keyword arguments
+        ~~~~~~~~~~~~~~~~~
+
</pre><tt>+        spin_id1:  The spin identification string of the  
</tt><tt>spin 1.
</tt><pre style="margin: 0em;">
+
</pre><tt>+        spin_id2:  The spin identification string of the  
</tt><tt>spin 2.
</tt><pre style="margin: 0em;">
+
</pre><tt>+        model:  The model to extract bond vectors from  
</tt><tt>(which if set
</tt><pre style="margin: 0em;">
to
None will cause the vectors
+        of all models to be extracted).
+
</pre><tt>+        verbosity:  The amount of information to print to  
</tt><tt>screen.
</tt><pre style="margin: 0em;">
 Zero
corresponds to minimal
</pre><tt>+        output while higher values increase the amount of  
</tt><tt>output.
</tt><pre style="margin: 0em;">
 The
default value is 1.
+
</pre><tt>+        ave:  A flag which if True will cause the bond  
</tt><tt>vectors from
</tt><pre style="margin: 0em;">
all
models to be averaged.  If
</pre><tt>+        vectors from only one model is extracted, this  
</tt><tt>argument will
</tt><pre style="margin: 0em;">
have no effect.
+
</pre><tt>+        unit:  A flag which if True will cause the unit  
</tt><tt>vector to
</tt><pre style="margin: 0em;">
calculated rather than the full
+        length bond vector.
+
+
+        Description
+        ~~~~~~~~~~~
+
</pre><tt>+        For a number of types of analysis, bond vectors or  
</tt><tt>unit bond
</tt><pre style="margin: 0em;">
vectors are required for the
</pre><tt>+        calculations.  This user function allows these  
</tt><tt>vectors to be
</tt><pre style="margin: 0em;">
extracted from the loaded
</pre><tt>+        structures. The bond vector will be that from the  
</tt><tt>two atoms
</tt><pre style="margin: 0em;">
of
a
xyz file loaded in relax.
+
</pre><tt>+        The extraction of vectors can occur in a number of  
</tt><tt>ways.
</tt><pre style="margin: 0em;">
 For
example if an NMR structure
</pre><tt>+        with N models is loaded or if multiple molecules,  
</tt><tt>from any
</tt><pre style="margin: 0em;">
source, of the same compound are
</pre><tt>+        loaded as different models, there are three options  
</tt><tt>for
</tt><pre style="margin: 0em;">
extracting the bond vector.  Firstly
+        the bond vector of a single model can be extracted by
setting
the 'model' argument.
</pre><tt>+        Secondly the bond vectors from all models can be  
</tt><tt>extracted
</tt><pre style="margin: 0em;">
if
'model' is None and 'ave' is
</pre><tt>+        set to False.  Thirdly, if 'model' is None and  
</tt><tt>'ave' is set
</tt><pre style="margin: 0em;">
to
True, then a single vector
</pre><tt>+        which is the average for all models will be  
</tt><tt>calculated.
</tt><pre style="margin: 0em;">
+
+
+        Example
+        ~~~~~~~
+
+        To extract a vector of two atoms from xyz file, type:
+
+        relax&gt;
structure.vectors(spin_id1='#SSS-cluster4-new-test_mol1@2',
spin_id1='#SSS-cluster4-new-test_mol1@1')
+        &quot;&quot;&quot;
+
+        # Function intro text.
+        if self._exec_info.intro:
+            text = self._exec_info.ps3 + &quot;structure.vectors(&quot;
+            text = text + &quot;spin_id1=&quot; + repr(spin_id1)
+            text = text + &quot;, spin_id2=&quot; + repr(spin_id2)
+            text = text + &quot;, model=&quot; + repr(model)
+            text = text + &quot;, verbosity=&quot; + repr(verbosity)
+            text = text + &quot;, ave=&quot; + repr(ave)
+            text = text + &quot;, unit=&quot; + repr(unit) + &quot;)&quot;
+            print(text)
+
+        # The argument checks.
</pre><tt>+        arg_check.is_str(spin_id1,  
</tt><tt>'spin_identification_string',
</tt><pre style="margin: 0em;">
can_be_none=True)
</pre><tt>+        arg_check.is_str(spin_id2, 'spin identification  
</tt><tt>string',
</tt><pre style="margin: 0em;">
can_be_none=True)
+        arg_check.is_int(model, 'model', can_be_none=True)
+        arg_check.is_int(verbosity, 'verbosity level')
+        arg_check.is_bool(ave, 'average vector flag')
+        arg_check.is_bool(unit, 'unit vector flag')
+
+        # Execute the functional code.
</pre><tt>+        generic_fns.structure.main.vectors_xyz 
</tt><tt>(spin_id1=spin_id1,
</tt><pre style="margin: 0em;">
spin_id2=spin_id2, model=model, verbosity=verbosity, ave=ave,
unit=unit)
+
+
 def write_pdb(self, file=None, dir=None, model_num=None,
force=False):
     &quot;&quot;&quot;The PDB writing function.



_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>

</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00244" href="msg00244.html">Re: r13246 - /branches/xyz/prompt/structure.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00247" href="msg00247.html">Re: r13246 - /branches/xyz/prompt/structure.py</a></strong>
<ul><li><em>From:</em> Han Sun</li></ul></li>
<li><strong><a name="00248" href="msg00248.html">Re: r13246 - /branches/xyz/prompt/structure.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00249" href="msg00249.html">Re: r13246 - /branches/xyz/prompt/structure.py</a></strong>
<ul><li><em>From:</em> Han Sun</li></ul></li>
<li><strong><a name="00250" href="msg00250.html">Re: r13246 - /branches/xyz/prompt/structure.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00251" href="msg00251.html">Re: r13246 - /branches/xyz/prompt/structure.py</a></strong>
<ul><li><em>From:</em> Han Sun</li></ul></li>
<li><strong><a name="00252" href="msg00252.html">Re: r13246 - /branches/xyz/prompt/structure.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Jun 29 12:20:15 2011</div>  
</body>
</html>
