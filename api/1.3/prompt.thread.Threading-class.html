<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>prompt.thread.Threading</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://nmr-relax.com">relax</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="prompt-module.html">Package&nbsp;prompt</a> ::
        <a href="prompt.thread-module.html">Module&nbsp;thread</a> ::
        Class&nbsp;Threading
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="prompt.thread.Threading-class.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== CLASS DESCRIPTION ==================== -->
<h1 class="epydoc">Class Threading</h1><span class="codelink"><a href="prompt.thread-pysrc.html#Threading">source&nbsp;code</a></span><br /><br />
<!-- ==================== INSTANCE METHODS ==================== -->
<a name="section-InstanceMethods"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Instance Methods</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-InstanceMethods"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
  <td width="15%" align="right" valign="top" class="summary">
    <span class="summary-type">&nbsp;</span>
  </td><td class="summary">
    <span class="summary-sig"><a href="prompt.thread.Threading-class.html#__init__" class="summary-sig-name">__init__</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">relax</span>)</span>
  </td>
</tr>
<tr>
  <td width="15%" align="right" valign="top" class="summary">
    <span class="summary-type">&nbsp;</span>
  </td><td class="summary">
    <span class="summary-sig"><a href="prompt.thread.Threading-class.html#read" class="summary-sig-name">read</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">file</span>=<span class="summary-sig-default">&quot;hosts&quot;</span>,
        <span class="summary-sig-arg">dir</span>=<span class="summary-sig-default">&quot;~/.relax&quot;</span>)</span><br />
      Function for reading a file containing entries for each computer to run calculations on.
  </td>
</tr>
</table>

<br />
<!-- ==================== METHOD DETAILS ==================== -->
<a name="section-MethodDetails"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Method Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-MethodDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="__init__"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">__init__</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">relax</span>)</span>
    <br /><em class="fname">(Constructor)</em>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="prompt.thread-pysrc.html#Threading.__init__">source&nbsp;code</a></span>&nbsp;
    </td>
  </table>
  
  
  <dl><dt></dt><dd>
  </dd></dl>
</td></tr></table>
</div>
<a name="read"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">read</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">file</span>=<span class="sig-default">&quot;hosts&quot;</span>,
        <span class="sig-arg">dir</span>=<span class="sig-default">&quot;~/.relax&quot;</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="prompt.thread-pysrc.html#Threading.read">source&nbsp;code</a></span>&nbsp;
    </td>
  </table>
  
  <br /><pre class="literalblock">
Function for reading a file containing entries for each computer to run calculations on.

Keyword Arguments
~~~~~~~~~~~~~~~~~

file:  The name of the file containing the host entries.

dir:  The directory where the hosts file is located.


Description
~~~~~~~~~~~

Certain functions within relax are coded to handle threading.  This is achieved by running
multiple instances of relax on different processes or computers for each thread.  The
default behaviour is that the parent instance of relax will execute all the code, however if
a hosts file is read or a hosts entry manually entered, then the threaded code will run on
the specified hosts.  This function is for reading a hosts file which should contain an
an entry for each computer on which to run calculations.

For remote computers, a SSH connection will be attempted.  Public key authentication must be
enabled to run calculations on remote machines so that thread can be created without asking
for a password.  Details on how to do this are given below.


The format of the hosts file is as follows.  Default values are specified by placing the
character '-' in the corresponding column.  Columns can be separated by any whitespace
character, and all columns must contain an entry.  Any lines beginning with a hash will be
ignored.

Column 1:  The host name or IP address of the computer on which to run a thread.

Column 2:  The login name of the user on the remote machine.  The default is to use the same
name as the current user.

Column 3:  The full program path.  The default is to run 'relax'.  This only works if relax
can be found in the environmental variable $PATH, as alias are not recognised.

Column 4:  The working directory where thread specific files are stored.  The default is
'~/.relax' where the tilde '~' symbol represents the user's home directory on the remote
machine.

Column 5:  The priority value for running the program.  The default is 15.  The remote
instances of relax will be niced to this value.

Column 6:  The number of CPU or CPU cores on the machine.  The default is 1.  A thread is
started for each CPU.

An example is:

-------------------------------------------------------------------------------------------
# Host          User name       Program path            Working directory    Priority  CPUs
localhost       -               -                       -                    0         2
192.168.0.10    dauvergne       /usr/local/bin/relax    -                    -         -
192.168.0.11    edward          -                       -                    -         -
-------------------------------------------------------------------------------------------

In this case, two threads will be run on the parent computer which would be either a dual
CPU system or a dual core 'Hyper threaded' Pentium processor.  These threads will have the
highest level user priority of 0.  The other two machines will have single threads running
with a low priority of 15.

Once threading is enabled, to allow calculations to run on the parent machine a 'localhost'
entry should be included.


If the keyword argument 'dir' is set to None, the hosts file will be assumed to be in the
current working directory.


SSH Public Key Authentication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To enable SSH Public Key Authentication for the use of ssh, sftp, and scp without having to
type a password, use the following steps.  This is essential for running a thread on a
remote machine.

If the files 'id_rsa' and 'id_rsa.pub' do not exist in the directory '~/.ssh', type:

$ ssh-keygen -t rsa

Press enter three times when asked for input.  This will generate the two identification
files.  Then, to copy the public key into the 'authorized_keys' file on the remote machine,
type:

$ ssh zucchini &quot;echo $(cat ~/.ssh/id_rsa.pub) &gt;&gt; ~/.ssh/authorized_keys&quot;

Make sure you replace 'zucchini' with the name or IP address of the remote machine.  To use
DSA rather than RSA authentication, replace 'rsa' with 'dsa' in the above commands.
Normally the sshd keyword StrictModes, which is found in the file '/etc/ssh/sshd_config', is
set to 'yes' or, if unspecified, defaults to 'yes'.  In this case, public key authentication
may fail as the permissions of the remote file '~/.ssh/authorized_keys' may be too
permissive.  The file should only be read/write for the user, ie 600.  To remotely change
the permissions, type:

$ ssh zucchini &quot;chmod 600 ~/.ssh/authorized_keys&quot;

One last keyword may need to be changed in the file '/etc/ssh/sshd_config'.  If the keyword
PubkeyAuthentication is set to 'no', change this to 'yes'.  The default is yes, so if the
keyword is missing or is commented out, nothing needs to be done.

Public key authentication should now work.  To test, type:

$ ssh zucchini

This should securely login into the remote machine without asking for a password.  If a
password prompt appears, check all the permissions on the directory '~/.ssh' and all files
within or set the sshd_config keyword StrictModes to 'no'.

$ ssh zucchini &quot;chmod 700 ~/.ssh/&quot;
$ ssh zucchini &quot;chmod 600 ~/.ssh/*&quot;
$ ssh zucchini &quot;chmod 644 ~/.ssh/*.pub&quot;

Finally, if all else fails, make sure the three lines

-----
RSAAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile      .ssh/authorized_keys
-----

of the file 'sshd_config' found within the directory '/etc/ssh/' are uncommented and not set
to 'no' or the 'AuthorizedKeysFile' set to another file name.

</pre>
  <dl><dt></dt><dd>
  </dd></dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://nmr-relax.com">relax</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">Generated by Epydoc
        3.0alpha3 on Mon Feb 19 20:57:44 2007</td>
    <td align="right" class="footer">
      <a href="http://epydoc.sourceforge.net">http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie()
  // -->
</script>
  
</body>
</html>
