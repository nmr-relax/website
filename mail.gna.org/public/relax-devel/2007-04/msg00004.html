<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: how to parallelise model_free minimise -->
<!--X-From-R13: "Unel E. Fubzcfba" <tnelgNozo.yrrqf.np.hx> -->
<!--X-Date: Thu, 29 Mar 2007 17:08:52 +0200 -->
<!--X-Message-Id: 460BD62D.2090500@bmb.leeds.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7f080ed10703191030h79036e06w56912aa1d9130f48@mail.gmail.com -->
<!--X-Reference: 7f080ed10703252217x7db43e6bxfe7324ad0379c778@mail.gmail.com -->
<!--X-Reference: 4607F0AB.6000807@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703261002i7cc384a6n8bf20be7aaad4e0e@mail.gmail.com -->
<!--X-Reference: f001463a0703270015n76d1b728m749f70fba54d8213@mail.gmail.com -->
<!--X-Reference: f001463a0703270022iec6830fs2aec68f942d16cb2@mail.gmail.com -->
<!--X-Reference: 7f080ed10703270907h3e882251v6b66b329ecfeb910@mail.gmail.com -->
<!--X-Reference: f001463a0703271218n67b2f3a3oe5aff06a4810d178@mail.gmail.com -->
<!--X-Reference: 7f080ed10703271746n2c675b79ib07e7c7c13f99671@mail.gmail.com -->
<!--X-Reference: f001463a0703280928o53a5896fn65bb90cf89144915@mail.gmail.com -->
<!--X-Reference: 7f080ed10703290724r4c858382p37c2a2ac834af435@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: how to parallelise model_free minimise -- March 29, 2007 - 17:08</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: how to parallelise model_free minimise</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00004" class="tabs">Index by Date</a> | <a href="threads.html#00004" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00003.html">Date Prev</a>] [<a href="msg00005.html">Date Next</a>] [<a href="msg00003.html">Thread Prev</a>] [<a href="msg00007.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 29 Mar 2007 16:07:25 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00004.html">460BD62D.2090500@bmb.leeds.ac.uk</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;7f080ed10703191030h79036e06w56912aa1d9130f48@mail.gmail.com&gt;	&lt;7f080ed10703252217x7db43e6bxfe7324ad0379c778@mail.gmail.com&gt;	&lt;4607F0AB.6000807@bmb.leeds.ac.uk&gt;	&lt;7f080ed10703261002i7cc384a6n8bf20be7aaad4e0e@mail.gmail.com&gt;	&lt;f001463a0703270015n76d1b728m749f70fba54d8213@mail.gmail.com&gt;	&lt;f001463a0703270022iec6830fs2aec68f942d16cb2@mail.gmail.com&gt;	&lt;7f080ed10703270907h3e882251v6b66b329ecfeb910@mail.gmail.com&gt;	&lt;f001463a0703271218n67b2f3a3oe5aff06a4810d178@mail.gmail.com&gt;	&lt;7f080ed10703271746n2c675b79ib07e7c7c13f99671@mail.gmail.com&gt;	&lt;f001463a0703280928o53a5896fn65bb90cf89144915@mail.gmail.com&gt;	&lt;<a href="msg00003.html">7f080ed10703290724r4c858382p37c2a2ac834af435@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla Thunderbird 1.0 (X11/20041206)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Gary S. Thompson</strong> on March 29, 2007 - 17:08:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Edward d'Auvergne wrote:</pre><br>
<blockquote class="blockquote"><tt>You have found some more ancient relax legacies.  There is a lot of<br>
perfectly functional legacy code in there!  
</tt></blockquote><pre style="margin: 0em;"><br>I suspected so ;-)</pre><br>
<blockquote class="blockquote"><tt>These counters should<br>
probably not be placed into 'self'.  They are re-initialised to zero<br>
at the start of each iteration of the main model-free minimise() loop.<br>
The only place these are now accessed from is the minimise()<br>
function.  The placement into 'self' is not always for storing state,<br>
it has been used so that other functions can access the data without<br>
having to pass arguments between the instance methods (which<br>
technically is state anyway :).  
</tt></blockquote><pre style="margin: 0em;"><br></pre><br>
<tt>I would definitley call that an anti pattern It confuses the design of 
the program in nasty ways (I spent ages trying to work out what all the 
apparent state of model_free was when there was virtually none).  
Another way to look at this is why do we have functions: they are 
interfaces between one piece of code and another and are designed to 
make code flow clearer. Storing non-state in an objects fields  or a s a 
way to pass state from one function to another is somewhat equivalent to 
how some  people use  common block in fortran in some situations and we 
all know how tractable that is ;-)</tt><br>
<br>
<pre style="margin: 0em;">anyway rant off</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Yet in this situation this is no
longer the case.</pre><br>
<pre style="margin: 0em;">The model_free instance is not singleton.  There is a single instance
located at 'self.relax.specific.model_free' which all of relax
accesses.  But the class can be reinitialised as many times as you
like, although there probably isn't much use for this (then again I
can't foresee what others will do with the module).</pre><br>
</blockquote><tt><br>Thats fine I can cope with this (as you see from the latest code I save 
a reference to model_free on each call in a memo)  All I needed to do 
was realize that these variables were reinitialise each time through 
the  model_free minimise instance creation loop. I was just worried 
about unexpected side effects I hadn't spotted.</tt><br>
<br>
<pre style="margin: 0em;">regards
gary</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Cheers,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<pre style="margin: 0em;"><br>On 3/29/07, gary thompson &lt;garyt.and.sarahb@xxxxxxxxx&gt; wrote:</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Another question about parallelising model_free minimise</pre><br>
<pre style="margin: 0em;">model_free.py carrys around a grab bag of state and some of what might
be called pseudo state for the object (some of the state is only
relevant within one function call and effectively is a hidden local
variable and method/function argument e.g param_vector and
self.disassemble_param_vector). Now specific_fns.model_free.minimise
has the following code  after the minimise  and self.f_count etc are
clearly state</pre><br>
<pre style="margin: 0em;">self.f_count = self.f_count + fc
self.g_count = self.g_count + gc
self.h_count = self.h_count + hc</pre><br>
<pre style="margin: 0em;">who and what is this state save for and where is it accessed? because
i might well not have the same minimise instance when I get back from
multiprocessing to save it to (or is there only one instance of
model_free? is it a singleton? it certainly looks so from my tests
and in actual fact effectively this data is module level data in
specific_functions.model_free am I correct ;-)</pre><br>
</blockquote><pre style="margin: 0em;"><br>.</pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
-------------------------------------------------------------------
Dr Gary Thompson
Astbury Centre for Structural Molecular Biology,
University of Leeds, Astbury Building,
Leeds, LS2 9JT, West-Yorkshire, UK             Tel. +44-113-3433024
email: garyt@xxxxxxxxxxxxxxx                   Fax  +44-113-2331407
-------------------------------------------------------------------</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00007" href="msg00007.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00003" href="msg00003.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Sun Apr 01 00:05:54 2007</div>  
</body>
</html>
