<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sr #3155] An R1rho expression for a spin in chemical exchange between two sites with unequal transverse relaxation rates -->
<!--X-From-R13: Oaqerj Pnyqjva &#60;naqerj.onyqjvaNpurz.bk.np.hx> -->
<!--X-Date: Mon, 19 May 2014 12:53:11 +0200 -->
<!--X-Message-Id: 5379E265.9060901@chem.ox.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140429&#45;225947.sv20529.58155@gna.org -->
<!--X-Reference: CAED9pY_EqTXxWh&#45;UU9d3epa0JJG9UOR66kYNDzUCsQC59EO9Aw@mail.gmail.com -->
<!--X-Reference: 5360CDCF.8020809@chem.ox.ac.uk -->
<!--X-Reference: CAED9pY9F7_&#45;s2tDvsYRv=2oyA4VN28NpzdAd4dv6eiZJ70mnGw@mail.gmail.com -->
<!--X-Reference: 536209BC.4080300@chem.ox.ac.uk -->
<!--X-Reference: CAED9pY_5tQ&#45;e&#45;nqFw_TQeyUhU1kvkteouC=KAy=F+LhJEFCDig@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sr #3155] An R1rho expression for a spin in chemical exchange between two sites with unequal transverse relaxation rates -- May 19, 2014 - 12:53</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [sr #3155] An R1rho expression for a spin in chemical exchange between two sites with unequal transverse relaxation rates</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00361" class="tabs">Index by Date</a> | <a href="threads.html#00361" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00360.html">Date Prev</a>] [<a href="msg00362.html">Date Next</a>] [<a href="msg00058.html">Thread Prev</a>] [<a href="msg00054.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 19 May 2014 11:52:21 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00361.html">5379E265.9060901@chem.ox.ac.uk</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;20140429-225947.sv20529.58155@gna.org&gt;	&lt;CAED9pY_EqTXxWh-UU9d3epa0JJG9UOR66kYNDzUCsQC59EO9Aw@mail.gmail.com&gt;	&lt;<a href="msg00001.html">5360CDCF.8020809@chem.ox.ac.uk</a>&gt;	&lt;CAED9pY9F7_-s2tDvsYRv=2oyA4VN28NpzdAd4dv6eiZJ70mnGw@mail.gmail.com&gt;	&lt;<a href="msg00011.html">536209BC.4080300@chem.ox.ac.uk</a>&gt; &lt;CAED9pY_5tQ-e-nqFw_TQeyUhU1kvkteouC=KAy=F+LhJEFCDig@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:24.0) Gecko/20100101 Thunderbird/24.5.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Andrew Baldwin</strong> on May 19, 2014 - 12:53:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Edward,

Took a while to get back to this:

</pre><tt>Dimitri's function 'peak correct' is exactly what you need. From what 
</tt><tt>you describe below, Dimitri implemented Nikolai's formula for the 
</tt><tt>exchange induced fit. This is good approximation from the 2002 
</tt><tt>reconstructing invisible states paper and will be right almost always.
</tt><pre style="margin: 0em;">

</pre><tt>The exchange induced fit is the factor that the ground state moves by 
</tt><tt>when experiencing exchange. It's zero when slow, PgDeltaOmega when fast, 
</tt><tt>and somewhere between when somewhere in between. The exact value is the 
</tt><tt>imaginary part of the ground state eigenvalue from the 2x2 (f00i in my 
</tt><tt>paper), though Nikolai's formula is good.
</tt><pre style="margin: 0em;">

</pre><tt>Again, in a real spectrum, you observe a peak. If it's in intermediate 
</tt><tt>exchange, it's not actually sitting at the ground state position - it'll 
</tt><tt>be shifted more or less depending on the above. So when you set an 
</tt><tt>offset in an experiment in an R1rho experiment, pragmatically you do 
</tt><tt>this from its observed position, not the ground state position.
</tt><pre style="margin: 0em;">

</pre><tt>The limiting case is fast exchange. In this case, your peak is sitting 
</tt><tt>of course at the population average. This is going to maximally far from 
</tt><tt>the ground state in terms of chemical shift, and when things are going 
</tt><tt>to be maximally wrong.
</tt><pre style="margin: 0em;">

Have a read of this:

J. Biol. NMR (2012) 53(1): 1



</pre><tt>It's not a controversial thing. Think about it. I'm happy to send some 
</tt><tt>code that incorporates this implicitly if this is helpful. Literally 
</tt><tt>just take the experimental offsets and add or subtract the exchange 
</tt><tt>induced fit (depending on how exactly you the offset frequencies have 
</tt><tt>been defined).
</tt><pre style="margin: 0em;">

The devil is in the details.

</pre><tt>By the way, the manual you have written for relax is very impressive 
</tt><tt>indeed. That's probably the largest collection of modern NMR relaxation 
</tt><tt>theory and references anywhere. At least as far as I've seen. There's 
</tt><tt>not much more to add I think to take you from cutting edge to bleeding edge.
</tt><pre style="margin: 0em;">

Best,

Andy.




On 02/05/2014 17:26, Edward d'Auvergne wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

Continuing the tread at
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/5414/focus=5457:">http://thread.gmane.org/gmane.science.nmr.relax.devel/5414/focus=5457:</a>


</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">
For the spin-lock offset, it is input and stored as ppm units.  The
ppm to rad.s^-1 conversion code is visible at
<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/lib.nmr-pysrc.html#frequency_to_rad_per_s">http://www.nmr-relax.com/api/3.1/lib.nmr-pysrc.html#frequency_to_rad_per_s</a>.
  Then the w_eff values are calculated from this in the code at
<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/specific_analyses.relax_disp.disp_data-pysrc.html#return_offset_data">http://www.nmr-relax.com/api/3.1/specific_analyses.relax_disp.disp_data-pysrc.html#return_offset_data</a>.
  Can you see a bug there?  Are you talking about the +/-
0.5*delta_omega factor for slow exchange?  Or the Korzhnev 2005
correction for constant time R1rho experiments (in the TODO list at
<a  rel="nofollow" href="http://www.nmr-relax.com/manual/do_dispersion_features_yet_be_implemented.html">http://www.nmr-relax.com/manual/do_dispersion_features_yet_be_implemented.html</a>,
hence it is not implemented yet).
</pre></blockquote><pre style="margin: 0em;">

There's another trick that doesn't seem to be there.

Note that the observed peak position (O_obs) is not the same as the ground
state peak position (O_G). Exchange of course moves our peaks around.
Experimentally you'll see your peak, and work out where to put the carrier
using this as a reference (eg, 100Hz north of peak BLAH). So the apparent
measured offset from the data is O_obs not O_G (which I think you assume
here). In the analysis, you can account for this simply by subtracting the
exchange induced shift from the observed resonance position (taking care to
get the sign right).

For doing things like determining signs using R1rho eg:

J. Biol. NMR (2012) 53(1): 1

You very much need this for example, if you have small deltaOmegas, and/or
small offsets and you want to get things right. Again, if you adjust the
offset used by the equations by the exchange induced shift, and use this
value in the formulas, you'll get an answer that best reflects the data
coming off the spectrometer.
</pre></blockquote><pre style="margin: 0em;">
Do you know the primary reference for this?  Are you referring to the
invisible paper:

     - Skrynnikov NR, Dahlquist FW, Kay LE (2002).  Reconstructing NMR
spectra of ‘‘invisible’’ excited protein states using HSQC and HMQC
experiments.  J. Am. Chem. Soc., 124, 12352-12360.
(<a  rel="nofollow" href="http://dx.doi.org/10.1021/ja0207089">http://dx.doi.org/10.1021/ja0207089</a>).

As far as I was aware, this is only for the skewed population (pA &gt;&gt;
pB) and slow exchange case.  How do you handle non-skewed or fast
exchange?  Or different model types?

Anyway, this is handled at the model level in relax.  As a reference
for the R1rho models handling slow exchange:

   <a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/lib.dispersion.tp02-pysrc.html">http://www.nmr-relax.com/api/3.1/lib.dispersion.tp02-pysrc.html</a>
   <a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/lib.dispersion.tap03-pysrc.html">http://www.nmr-relax.com/api/3.1/lib.dispersion.tap03-pysrc.html</a>
   <a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/lib.dispersion.mp05-pysrc.html">http://www.nmr-relax.com/api/3.1/lib.dispersion.mp05-pysrc.html</a>
   <a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/lib.dispersion.ns_r1rho_2site-pysrc.html">http://www.nmr-relax.com/api/3.1/lib.dispersion.ns_r1rho_2site-pysrc.html</a>

As can be seen, the implementations match the model equations in the
original publications.  But the assumption is made that exchange is
slow and that the peak observed is that of the dominant population A
(pA &gt; pB &gt; pC) and that it has the chemical shift of state A.  And
that dw is positive.  In all cases:

     Wa = omega                  # Larmor frequency [s^-1].
     Wb = omega + dw             # Larmor frequency [s^-1].

This could clearly be improved if the user specifies if the exchange
is fast or slow.  The numeric R1rho model is different as it comes
directly from Nikolai and Martin's Matlab code, but the same
assumption is made:

     % we assume that A resonates at 0 [s^-1], without loss of generality
     dw=nu_0(k)*optpar(3)*2*pi;       % [s^-1]
     Wa=0*2*pi;                     % Larmor frequ. [s^-1]
     Wb=dw;                     % Larmor frequ. [s^-1]
     Wsl=offset*2*pi;               % Larmor frequ. of spin lock [s^-1]
     da=Wa-Wsl;                % offset of sl from A
     db=Wb-Wsl;                % offset of sl from B

In relax this is shifted so that Wa has the chemical shift observed in
the spectrum (omega) and Wb=omega+dw, the same as the Palmer models.
For the fast exchange models in relax, the rotating frame tilt angle
is calculated here:

<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/specific_analyses.relax_disp.disp_data-pysrc.html#return_offset_data">http://www.nmr-relax.com/api/3.1/specific_analyses.relax_disp.disp_data-pysrc.html#return_offset_data</a>

The key part, see line 2892, is that Delta_Omega is calculated as the
user input chemical shift minus the spin-lock offset (the carrier
frequency).

In Dmitry Korzhnev's cpmg_fit program, this correction factor is what
I think is called the PEAK_SHIFT definition (this hardcoded into the
source code).  He describes it as:

   #define PEAK_SHIFT /* If not commented, program performs correction
of the offset scale of R1r data assuming that zero offset was set
according to peak position in HSQC spectrum.  Offsets are corrected by
the calculated difference of peak shift with the frequency of the
major state (A). */

He has implemented the TP02 model (<a  rel="nofollow" href="http://wiki.nmr-relax.com/TP02">http://wiki.nmr-relax.com/TP02</a>)
with the PEAK_SHIFT definition modifying the shifts with da, db -=
pB*kex^2*dw/(kex^2+dw^2):

   #ifdef PEAK_SHIFT  /* Correction of the offset scale */
   if(KEX==0 &amp;&amp; DW==0)sh=0;
   else sh=(1-PA)*KEX*KEX*DW/(KEX*KEX+DW*DW);
   Ga = Ga-sh;
   Gb = Gb-sh;
   /* printf(&quot;%10.1f %g\n&quot;,OFF,(double)sh); */
   #endif

Note that there is no R20a - R20b factor.  For the numeric R1rho
model, Dmitry uses a different, more complicated definition which I
have not found in the literature yet, probably because it is in a
supplement somewhere (see the Rex3R1R() function in his clcrex.c
file).  These definitions are hardcoded for both fast and slow
exchange and all pA values.  I have compared some results with this
turned on and off at the end of the file
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/*checkout*/relax/trunk/test_suite/shared_data/dispersion/software_comparison?revision=HEAD">http://svn.gna.org/viewcvs/*checkout*/relax/trunk/test_suite/shared_data/dispersion/software_comparison?revision=HEAD</a>.
  For these 2 examples, the differences are minimal and clearly below
the parameter errors you would expect from experimental noise.

I have not implemented this for the Palmer R1rho models, as Art
himself does not reference these correction factors.  And the
pB*kex^2*dw/(kex^2+dw^2) factor is only good for skewed populations
(pA &gt;&gt; pB) so it doesn't hold for the TAP03 and MP05 models
(<a  rel="nofollow" href="http://wiki.nmr-relax.com/TAP03">http://wiki.nmr-relax.com/TAP03</a>, <a  rel="nofollow" href="http://wiki.nmr-relax.com/MP05">http://wiki.nmr-relax.com/MP05</a>)
which are valid for the non-skewed case and fast exchange.  I actually
have no idea how a non-skewed or fast exchange correction factor would
look like or if anything along those lines have ever been published.
Have I missed a fundamental paper on this subject?  Is there any
consensus on a general technique for correcting the observed chemical
shift valid for all pA, either for separate fast and slow exchange or
for all exchange regimes simultaneously?

Cheers,

Edward
</pre></blockquote><pre style="margin: 0em;">



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00001" href="msg00001.html">Re: [sr #3155] An R1rho expression for a spin in chemical exchange between two sites with unequal transverse relaxation rates</a></strong>
<ul><li><em>From:</em> Andrew Baldwin</li></ul></li>
<li><strong><a name="00011" href="msg00011.html">Re: [sr #3155] An R1rho expression for a spin in chemical exchange between two sites with unequal transverse relaxation rates</a></strong>
<ul><li><em>From:</em> Andrew Baldwin</li></ul></li>
<li><strong><a name="00053" href="msg00053.html">Re: [sr #3155] An R1rho expression for a spin in chemical exchange between two sites with unequal transverse relaxation rates</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon May 19 13:20:25 2014</div>  
</body>
</html>
