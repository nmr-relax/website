<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r21920 &#45; /trunk/test_suite/system_tests/relax_disp.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 10 Dec 2013 08:36:46 +0100 -->
<!--X-Message-Id: CA+CBx2NE32wcqqjM6gk5WKUnsheUOXSucd5g1PGHW7YGZbc=Gg@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: E1Vq41l&#45;00058P&#45;HI@subversion.gna.org -->
<!--X-Reference: CAED9pY86aHgKdwdH&#45;Ds+FAGQWiKi0usQ&#45;gY6VDf0NRh+eW1Rtw@mail.gmail.com -->
<!--X-Reference: CA+CBx2PAhiTx68GtHJodE8E0uonXpX4QxeYJZ5QiFpntn7aztw@mail.gmail.com -->
<!--X-Reference: CAED9pY_oO&#45;_2yHttw6XfmE2p9HVs5xbia9Bs&#45;&#45;pb2xdXOfAxKQ@mail.gmail.com -->
<!--X-Reference: CAED9pY832RNpU=QQGQi8t8u7eVFe_AcOtPYUzoRazmbWZnB4Kg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py -- December 10, 2013 - 08:36</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00088" class="tabs">Index by Date</a> | <a href="threads.html#00088" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00087.html">Date Prev</a>] [<a href="msg00089.html">Date Next</a>] [<a href="msg00086.html">Thread Prev</a>] [<a href="msg00092.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 10 Dec 2013 08:35:56 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:from:date:message-id	:subject:to:cc:content-type;	bh=AkQMMhRk2osDVCC33zQ6pX+PxWJc5kHmvdvscSY/R4Y=;	b=i+RYiSp1ogg1W1MIcawE0Vrbdwwt5qYRIZdTWDF+/e4vm2WTsjUgY+HcJMdkDNlUui	mZUR1RMW0bvvIsBYE5SGP4jQfHtiz8+0NylwZw7MVeBb9RZJJz4aRXK46Q19Pst9Q3Op	6NivbZzgeOqP216uU2DJ5bzi4ykCHb5wkiC6Qf366D25s1Nz3vQGZN3kgEw0cfas4X59	KyUK+p1azscYjMy+hDZ7zWsDiSypdK5DqUj/7BdR+Juz4pcjjEyA2s9ahJrjk6UK19Rp	ambVP8yJk9H53NmvejXG0zq4mVRcNPj4oSXD+Q09O5L9UYHZp16s1tPnt8a/OhCWRVSX	LQfw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00088.html">CA+CBx2NE32wcqqjM6gk5WKUnsheUOXSucd5g1PGHW7YGZbc=Gg@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Vq41l-00058P-HI@xxxxxxxxxxxxxxxxxx&gt;	&lt;CAED9pY86aHgKdwdH-Ds+FAGQWiKi0usQ-gY6VDf0NRh+eW1Rtw@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2PAhiTx68GtHJodE8E0uonXpX4QxeYJZ5QiFpntn7aztw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY_oO-_2yHttw6XfmE2p9HVs5xbia9Bs--pb2xdXOfAxKQ@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY832RNpU=QQGQi8t8u7eVFe_AcOtPYUzoRazmbWZnB4Kg@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on December 10, 2013 - 08:36:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr">Hi Edward.<div><br></div><div>I will try to look into it today.</div><div><br></div><div>Best</div><div>Troels</div></div><div class="gmail_extra"><br><br><div class="gmail_quote">2013/12/9 Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx" target="_blank">edward@xxxxxxxxxxxxx</a>&gt;</span><br>

<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">Hi Troels,<br>
<br>
Note that I will soon release relax 3.1.1 with all of the recent fixes<br>
(possibly tomorrow).  This includes the &#39;NS MMQ 3-site&#39;, &#39;NS MMQ<br>
3-site linear&#39;, &#39;NS R1rho 3-site&#39;, and &#39;NS R1rho 3-site linear&#39;<br>
dispersion models which are now implemented, tested, and find similar<br>
results to Dmitry Korzhnev&#39;s cpmg_fit software.  If the test is not<br>
functional by then, I will disable it for the release.  It would be<br>
very useful to have fixed though as it looks like variable relaxation<br>
time data (SQ CPMG, MMQ CPMG, or R1rho) will all currently fail in the<br>
auto-analysis.  I&#39;ve had a look and have another hint for you - the<br>
problem is that has_exponential_exp_type() function is not returning<br>
the correct answer ;)<br>
<br>
Regards,<br>
<br>
Edward<br>
<div class="HOEnZb"><div class="h5"><br>
<br>
<br>
On 9 December 2013 18:12, Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt; Hi,<br>
&gt;<br>
&gt; This is a strange failure!  The auto-analysis should not be running<br>
&gt; the calc user function for this.  That is the problem, you cannot run<br>
&gt; the calc user function for non-constant relaxation time experiments.<br>
&gt; The error message is the standard one to tell the user that.  The<br>
&gt; grid_search and minimise user functions should be used instead (maybe<br>
&gt; the error message can be modified to clarify this and include this<br>
&gt; info).  But it is the auto-analysis that is running this.  So the<br>
&gt; problem is there.  relax can of course handle variable relaxation<br>
&gt; times for any dispersion data type.<br>
&gt;<br>
&gt; Regards,<br>
&gt;<br>
&gt; Edward<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; On 9 December 2013 18:02, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt;&gt; Hi Edward.<br>
&gt;&gt;<br>
&gt;&gt; The R1rho data is not constant time.<br>
&gt;&gt;<br>
&gt;&gt; I have only included the models:<br>
&gt;&gt; MODELS = [&#39;R2eff&#39;, &#39;No Rex&#39;, &#39;DPL94&#39;]<br>
&gt;&gt;<br>
&gt;&gt; I have set it up, to find a solution for analysing R1rho data, where R1 data<br>
&gt;&gt; has not been acquired, but for<br>
&gt;&gt; different<br>
&gt;&gt;<br>
&gt;&gt; It actually also fails at the moment, and will probably do for some time.<br>
&gt;&gt;<br>
&gt;&gt; --------<br>
&gt;&gt; relax -s Relax_disp.test_r1rho_kjaergaar<br>
&gt;&gt;<br>
&gt;&gt; relax&gt; calc(verbosity=1)<br>
&gt;&gt; Traceback (most recent call last):<br>
&gt;&gt;   File<br>
&gt;&gt; &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/test_suite/system_tests/relax_disp.py&quot;,<br>
&gt;&gt; line 2581, in test_r1rho_kjaergaard<br>
&gt;&gt;     relax_disp.Relax_disp(pipe_name=pipe_name, pipe_bundle=pipe_bundle,<br>
&gt;&gt; results_dir=ds.tmpdir, models=MODELS, grid_inc=GRID_INC, mc_sim_num=MC_NUM,<br>
&gt;&gt; modsel=MODSEL)<br>
&gt;&gt;   File<br>
&gt;&gt; &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/auto_analyses/relax_disp.py&quot;,<br>
&gt;&gt; line 116, in __init__<br>
&gt;&gt;     self.run()<br>
&gt;&gt;   File<br>
&gt;&gt; &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/auto_analyses/relax_disp.py&quot;,<br>
&gt;&gt; line 447, in run<br>
&gt;&gt;     self.interpreter.calc()<br>
&gt;&gt;   File<br>
&gt;&gt; &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/prompt/uf_objects.py&quot;,<br>
&gt;&gt; line 221, in __call__<br>
&gt;&gt;     self._backend(*new_args, **uf_kargs)<br>
&gt;&gt;   File<br>
&gt;&gt; &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/pipe_control/minimise.py&quot;,<br>
&gt;&gt; line 86, in calc<br>
&gt;&gt;     calculate(verbosity=verbosity)<br>
&gt;&gt;   File<br>
&gt;&gt; &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;,<br>
&gt;&gt; line 717, in calculate<br>
&gt;&gt;     self._calculate_r2eff()<br>
&gt;&gt;   File<br>
&gt;&gt; &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;,<br>
&gt;&gt; line 182, in _calculate_r2eff<br>
&gt;&gt;     check_exp_type_fixed_time()<br>
&gt;&gt;   File<br>
&gt;&gt; &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/checks.py&quot;,<br>
&gt;&gt; line 112, in check_exp_type_fixed_time<br>
&gt;&gt;     raise RelaxError(&quot;The experiment &#39;%s&#39; is not of the fixed relaxation<br>
&gt;&gt; time period data type.&quot; % exp_type)<br>
&gt;&gt; RelaxError: RelaxError: The experiment &#39;R1rho&#39; is not of the fixed<br>
&gt;&gt; relaxation time period data type.<br>
&gt;&gt;<br>
&gt;&gt; --------------<br>
&gt;&gt;<br>
&gt;&gt; Is the R1rho analysis only implemented for fixed time periods?<br>
&gt;&gt;<br>
&gt;&gt; Best<br>
&gt;&gt; Troels<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt; 2013/12/9 Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; Hi Troels,<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; When looking at this data and analysis, remember that I have not<br>
&gt;&gt;&gt; implemented Dmitry Korzhnev&#39;s &quot;correction&quot; for constant time R1rho<br>
&gt;&gt;&gt; data.  I don&#39;t know if that was used in the original publication for<br>
&gt;&gt;&gt; your data.  More details are given in the &#39;To do&#39; section of the<br>
&gt;&gt;&gt; manual (I only recently added this info).  I also don&#39;t know what the<br>
&gt;&gt;&gt; rest of the field think of his correction and how it applies to later<br>
&gt;&gt;&gt; models from the Palmer group.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; Regards,<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; Edward<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; On 9 December 2013 17:49,  &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt;&gt;&gt; &gt; Author: tlinnet<br>
&gt;&gt;&gt; &gt; Date: Mon Dec  9 17:49:49 2013<br>
&gt;&gt;&gt; &gt; New Revision: 21920<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; URL: <a rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=21920&amp;view=rev" target="_blank">http://svn.gna.org/viewcvs/relax?rev=21920&amp;view=rev</a><br>
&gt;&gt;&gt; &gt; Log:<br>
&gt;&gt;&gt; &gt; Added system test for the analysis of optimisation of the Kjaergaard et<br>
&gt;&gt;&gt; &gt; al., 2013 Off-resonance R1rho relaxation dispersion experiments using the<br>
&gt;&gt;&gt; &gt; &#39;DPL&#39; model.<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; Work in progress for Support Request #3083,<br>
&gt;&gt;&gt; &gt; (<a rel="nofollow" href="https://gna.org/support/index.php?3083" target="_blank">https://gna.org/support/index.php?3083</a>) -  Addition of Data-set for R1rho<br>
&gt;&gt;&gt; &gt; analysis.<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; Modified:<br>
&gt;&gt;&gt; &gt;     trunk/test_suite/system_tests/relax_disp.py<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; Modified: trunk/test_suite/system_tests/relax_disp.py<br>
&gt;&gt;&gt; &gt; URL:<br>
&gt;&gt;&gt; &gt; <a rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/relax_disp.py?rev=21920&amp;r1=21919&amp;r2=21920&amp;view=diff" target="_blank">http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/relax_disp.py?rev=21920&amp;r1=21919&amp;r2=21920&amp;view=diff</a><br>


&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; ==============================================================================<br>
&gt;&gt;&gt; &gt; --- trunk/test_suite/system_tests/relax_disp.py (original)<br>
&gt;&gt;&gt; &gt; +++ trunk/test_suite/system_tests/relax_disp.py Mon Dec  9 17:49:49 2013<br>
&gt;&gt;&gt; &gt; @@ -2450,6 +2450,137 @@<br>
&gt;&gt;&gt; &gt;          self.assertAlmostEqual(cdp.mol[0].res[0].spin[0].chi2,<br>
&gt;&gt;&gt; &gt; 0.030959849811015544, 3)<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; +    def test_r1rho_kjaergaard(self):<br>
&gt;&gt;&gt; &gt; +        &quot;&quot;&quot;Optimisation of the Kjaergaard et al., 2013 Off-resonance<br>
&gt;&gt;&gt; &gt; R1rho relaxation dispersion experiments using the &#39;DPL&#39; model.<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        This uses the data from Kjaergaard&#39;s paper at U{DOI:<br>
&gt;&gt;&gt; &gt; 10.1021/bi4001062&lt;<a rel="nofollow" href="http://dx.doi.org/10.1021/bi4001062" target="_blank">http://dx.doi.org/10.1021/bi4001062</a>&gt;}.<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        &quot;&quot;&quot;<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # The path to the data files.<br>
&gt;&gt;&gt; &gt; +        data_path = status.install_path +<br>
&gt;&gt;&gt; &gt; sep+&#39;test_suite&#39;+sep+&#39;shared_data&#39;+sep+&#39;dispersion&#39;+sep+&#39;Kjaergaard_et_al_2013&#39;<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Set pipe name, bundle and type.<br>
&gt;&gt;&gt; &gt; +        pipe_name = &#39;base pipe&#39;<br>
&gt;&gt;&gt; &gt; +        pipe_bundle = &#39;relax_disp&#39;<br>
&gt;&gt;&gt; &gt; +        pipe_type= &#39;relax_disp&#39;<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Create the data pipe.<br>
&gt;&gt;&gt; &gt; +        self.interpreter.pipe.create(pipe_name=pipe_name,<br>
&gt;&gt;&gt; &gt; bundle=pipe_bundle, pipe_type=pipe_type)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Read the spins.<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; self.interpreter.spectrum.read_spins(file=&#39;1_0_46_0_max_standard.ser&#39;,<br>
&gt;&gt;&gt; &gt; dir=data_path+sep+&#39;peak_lists&#39;)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Test some of the sequence.<br>
&gt;&gt;&gt; &gt; +        self.assertEqual(len(cdp.mol), 1)<br>
&gt;&gt;&gt; &gt; +        self.assertEqual(cdp.mol[0].name, None)<br>
&gt;&gt;&gt; &gt; +        self.assertEqual(len(cdp.mol[0].res), 48)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Name the isotope for field strength scaling.<br>
&gt;&gt;&gt; &gt; +        self.interpreter.spin.isotope(isotope=&#39;15N&#39;)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Set number of experiments to be used.<br>
&gt;&gt;&gt; &gt; +        NR_exp = -1<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Load the experiments settings file.<br>
&gt;&gt;&gt; &gt; +        expfile = open(data_path+sep+&#39;exp_parameters_sort.txt&#39;,&#39;r&#39;)<br>
&gt;&gt;&gt; &gt; +        expfileslines = expfile.readlines()[:NR_exp]<br>
&gt;&gt;&gt; &gt; +        expfile.close()<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # In MHz<br>
&gt;&gt;&gt; &gt; +        yOBS = 81.050<br>
&gt;&gt;&gt; &gt; +        # In ppm<br>
&gt;&gt;&gt; &gt; +        yCAR = 118.078<br>
&gt;&gt;&gt; &gt; +        centerPPM_N15 = yCAR<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        ## Read the chemical shift data.<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; self.interpreter.chemical_shift.read(file=&#39;1_0_46_0_max_standard.ser&#39;,<br>
&gt;&gt;&gt; &gt; dir=data_path+sep+&#39;peak_lists&#39;)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Test the chemical shift data.<br>
&gt;&gt;&gt; &gt; +        cs = [122.223, 122.162, 114.250, 125.852, 118.626, 117.449,<br>
&gt;&gt;&gt; &gt; 119.999, 122.610, 118.602, 118.291, 115.393,<br>
&gt;&gt;&gt; &gt; +        121.288, 117.448, 116.378, 116.316, 117.263, 122.211, 118.748,<br>
&gt;&gt;&gt; &gt; 118.103, 119.421, 119.317, 119.386, 117.279,<br>
&gt;&gt;&gt; &gt; +        122.103, 120.038, 116.698, 111.811, 118.639, 118.285, 121.318,<br>
&gt;&gt;&gt; &gt; 117.770, 119.948, 119.759, 118.314, 118.160,<br>
&gt;&gt;&gt; &gt; +        121.442, 118.714, 113.080, 125.706, 119.183, 120.966, 122.361,<br>
&gt;&gt;&gt; &gt; 126.675, 117.069, 120.875, 109.372, 119.811, 126.048]<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        i = 0<br>
&gt;&gt;&gt; &gt; +        for spin, spin_id in spin_loop(return_id=True):<br>
&gt;&gt;&gt; &gt; +            print <a rel="nofollow" href="http://spin.name" target="_blank">spin.name</a>, spin.num, spin_id, spin.chemical_shift,<br>
&gt;&gt;&gt; &gt; cs[i]<br>
&gt;&gt;&gt; &gt; +            # Check the chemical shift.<br>
&gt;&gt;&gt; &gt; +            self.assertEqual(spin.chemical_shift, cs[i])<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +            # Increment the index.<br>
&gt;&gt;&gt; &gt; +            i += 1<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # The lock power to field, has been found in an calibration<br>
&gt;&gt;&gt; &gt; experiment.<br>
&gt;&gt;&gt; &gt; +        spin_lock_field_strengths_Hz = {&#39;35&#39;: 431.0, &#39;39&#39;: 651.2, &#39;41&#39;:<br>
&gt;&gt;&gt; &gt; 800.5, &#39;43&#39;: 984.0, &#39;46&#39;: 1341.11, &#39;48&#39;: 1648.5}<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Apply spectra settings.<br>
&gt;&gt;&gt; &gt; +        for i in range(len(expfileslines)):<br>
&gt;&gt;&gt; &gt; +            line=expfileslines[i]<br>
&gt;&gt;&gt; &gt; +            if line[0] == &quot;#&quot;:<br>
&gt;&gt;&gt; &gt; +                continue<br>
&gt;&gt;&gt; &gt; +            else:<br>
&gt;&gt;&gt; &gt; +                # DIRN I deltadof2 dpwr2slock ncyc trim ss sfrq<br>
&gt;&gt;&gt; &gt; +                DIRN = line.split()[0]<br>
&gt;&gt;&gt; &gt; +                I = int(line.split()[1])<br>
&gt;&gt;&gt; &gt; +                deltadof2 = line.split()[2]<br>
&gt;&gt;&gt; &gt; +                dpwr2slock = line.split()[3]<br>
&gt;&gt;&gt; &gt; +                ncyc = int(line.split()[4])<br>
&gt;&gt;&gt; &gt; +                trim = float(line.split()[5])<br>
&gt;&gt;&gt; &gt; +                ss = int(line.split()[6])<br>
&gt;&gt;&gt; &gt; +                set_sfrq = float(line.split()[7])<br>
&gt;&gt;&gt; &gt; +                apod_rmsd = float(line.split()[8])<br>
&gt;&gt;&gt; &gt; +                spin_lock_field_strength =<br>
&gt;&gt;&gt; &gt; spin_lock_field_strengths_Hz[dpwr2slock]<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Calculate spin_lock time<br>
&gt;&gt;&gt; &gt; +                time_sl = 2*ncyc*trim<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Define file name for peak list.<br>
&gt;&gt;&gt; &gt; +                FNAME = &quot;%s_%s_%s_%s_max_standard.ser&quot;%(I, deltadof2,<br>
&gt;&gt;&gt; &gt; dpwr2slock, ncyc)<br>
&gt;&gt;&gt; &gt; +                sp_id = &quot;%s_%s_%s_%s&quot;%(I, deltadof2, dpwr2slock, ncyc)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Load the peak intensities.<br>
&gt;&gt;&gt; &gt; +                self.interpreter.spectrum.read_intensities(file=FNAME,<br>
&gt;&gt;&gt; &gt; dir=data_path+sep+&#39;peak_lists&#39;, spectrum_id=sp_id, int_method=&#39;height&#39;)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Set the peak intensity errors, as defined as the<br>
&gt;&gt;&gt; &gt; baseplane RMSD.<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; self.interpreter.spectrum.baseplane_rmsd(error=apod_rmsd, spectrum_id=sp_id)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Set the relaxation dispersion experiment type.<br>
&gt;&gt;&gt; &gt; +                self.interpreter.relax_disp.exp_type(spectrum_id=sp_id,<br>
&gt;&gt;&gt; &gt; exp_type=&#39;R1rho&#39;)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Set The spin-lock field strength, nu1, in Hz<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; self.interpreter.relax_disp.spin_lock_field(spectrum_id=sp_id,<br>
&gt;&gt;&gt; &gt; field=spin_lock_field_strength)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Calculating the spin-lock offset in ppm, from offsets<br>
&gt;&gt;&gt; &gt; values provided in Hz.<br>
&gt;&gt;&gt; &gt; +                frq_N15_Hz = yOBS * 1E6<br>
&gt;&gt;&gt; &gt; +                offset_ppm_N15 = float(deltadof2) / frq_N15_Hz * 1E6<br>
&gt;&gt;&gt; &gt; +                omega_rf_ppm = centerPPM_N15 + offset_ppm_N15<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Set The spin-lock offset, omega_rf, in ppm.<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; self.interpreter.relax_disp.spin_lock_offset(spectrum_id=sp_id,<br>
&gt;&gt;&gt; &gt; offset=omega_rf_ppm)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Set the relaxation times (in s).<br>
&gt;&gt;&gt; &gt; +                self.interpreter.relax_fit.relax_time(time=time_sl,<br>
&gt;&gt;&gt; &gt; spectrum_id=sp_id)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +                # Set the spectrometer frequency.<br>
&gt;&gt;&gt; &gt; +                self.interpreter.spectrometer.frequency(id=sp_id,<br>
&gt;&gt;&gt; &gt; frq=set_sfrq, units=&#39;MHz&#39;)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # The dispersion models.<br>
&gt;&gt;&gt; &gt; +        MODELS = [&#39;R2eff&#39;, &#39;No Rex&#39;, &#39;DPL94&#39;]<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # The grid search size (the number of increments per<br>
&gt;&gt;&gt; &gt; dimension).<br>
&gt;&gt;&gt; &gt; +        GRID_INC = 4<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # The number of Monte Carlo simulations to be used for error<br>
&gt;&gt;&gt; &gt; analysis at the end of the analysis.<br>
&gt;&gt;&gt; &gt; +        MC_NUM = 3<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Model selection technique.<br>
&gt;&gt;&gt; &gt; +        MODSEL = &#39;AIC&#39;<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +        # Run the analysis.<br>
&gt;&gt;&gt; &gt; +        relax_disp.Relax_disp(pipe_name=pipe_name,<br>
&gt;&gt;&gt; &gt; pipe_bundle=pipe_bundle, results_dir=ds.tmpdir, models=MODELS,<br>
&gt;&gt;&gt; &gt; grid_inc=GRID_INC, mc_sim_num=MC_NUM, modsel=MODSEL)<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt; +<br>
&gt;&gt;&gt; &gt;      def test_r2eff_read(self):<br>
&gt;&gt;&gt; &gt;          &quot;&quot;&quot;Test the operation of the relax_disp.r2eff_read user<br>
&gt;&gt;&gt; &gt; function.&quot;&quot;&quot;<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; _______________________________________________<br>
&gt;&gt;&gt; &gt; relax (<a rel="nofollow" href="http://www.nmr-relax.com" target="_blank">http://www.nmr-relax.com</a>)<br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; This is the relax-commits mailing list<br>
&gt;&gt;&gt; &gt; <a rel="nofollow" href="mailto:relax-commits@xxxxxxx">relax-commits@xxxxxxx</a><br>
&gt;&gt;&gt; &gt;<br>
&gt;&gt;&gt; &gt; To unsubscribe from this list, get a password<br>
&gt;&gt;&gt; &gt; reminder, or change your subscription options,<br>
&gt;&gt;&gt; &gt; visit the list information page at<br>
&gt;&gt;&gt; &gt; <a rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits" target="_blank">https://mail.gna.org/listinfo/relax-commits</a><br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; _______________________________________________<br>
&gt;&gt;&gt; relax (<a rel="nofollow" href="http://www.nmr-relax.com" target="_blank">http://www.nmr-relax.com</a>)<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; This is the relax-devel mailing list<br>
&gt;&gt;&gt; <a rel="nofollow" href="mailto:relax-devel@xxxxxxx">relax-devel@xxxxxxx</a><br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; To unsubscribe from this list, get a password<br>
&gt;&gt;&gt; reminder, or change your subscription options,<br>
&gt;&gt;&gt; visit the list information page at<br>
&gt;&gt;&gt; <a rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel" target="_blank">https://mail.gna.org/listinfo/relax-devel</a><br>
&gt;&gt;<br>
&gt;&gt;<br>
</div></div></blockquote></div><br></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00092" href="msg00092.html">Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00083" href="msg00083.html">Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00084" href="msg00084.html">Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00085" href="msg00085.html">Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00086" href="msg00086.html">Re: r21920 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Dec 10 09:40:07 2013</div>  
</body>
</html>
