<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r22198 &#45; /trunk/test_suite/system_tests/relax_disp.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 18 Feb 2014 15:50:36 +0100 -->
<!--X-Message-Id: CAED9pY&#45;C&#45;wDr29w7wHrn3nUQEFJ5nLEb3QjYFhNBcgLx5+ez2g@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1WFiiD&#45;00042V&#45;Sv@subversion.gna.org -->
<!--X-Reference: CA+CBx2Pi9M498m3KpCVWCBCHou8N8_=4kC6=eBecgFCUuzPeBw@mail.gmail.com -->
<!--X-Reference: CA+CBx2PmZDwa8BKd1c3P2gUvi46riQgy&#45;DuO=cwMaQAF3&#45;w20g@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;OWmP1MCEiYQH=Vi42_VS69vG=A5J7kz9Z74tLjUXSVA@mail.gmail.com -->
<!--X-Reference: CA+CBx2P+V6sW&#45;N5P+Sk60gpgMHTHExXpPffjjhrsU36ihOqdbQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r22198 - /trunk/test_suite/system_tests/relax_disp.py -- February 18, 2014 - 15:50</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r22198 - /trunk/test_suite/system_tests/relax_disp.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00104" class="tabs">Index by Date</a> | <a href="threads.html#00104" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00103.html">Date Prev</a>] [<a href="msg00105.html">Date Next</a>] [<a href="msg00103.html">Thread Prev</a>] [<a href="msg00105.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 18 Feb 2014 15:50:04 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date:message-id:subject	:from:to:cc:content-type:content-transfer-encoding;	bh=iuQe1Nw9b9g81esSiLnUDfCUnxQfqRuJne3RTmPaoCE=;	b=evgT3ony4CVa0qOzbi/tv42JWnUmtxIhxWOV5a1Sh0ElXBNTTpleuE1pKDkljmv2yg	sYdJTcCq/78ZMYWBMydKtFUrxzhruYIOmeYqXpggR5hzJhTdKoBAEHld1wjev55yT6CC	9xcNZyoYEZ9fboAnYjQvaece60WAz9/0Z+iKZScFjFwVXmAAokvK4k7iuLIDYxKcGrtE	/a/AbShjlc7WX/g5tHIDuMEp3sU6LKGrxNP+FBmix6Oc5LYOsxb5VNnhwXHHcsJVvFsP	AU8LPcxIzv74EkiMu5Ks8faEeniEofYLczDckMfS6ey4Zof5Yzj+3KLbIclfU7WMJoC1	qA9g==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00104.html">CAED9pY-C-wDr29w7wHrn3nUQEFJ5nLEb3QjYFhNBcgLx5+ez2g@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1WFiiD-00042V-Sv@xxxxxxxxxxxxxxxxxx&gt;	&lt;CA+CBx2Pi9M498m3KpCVWCBCHou8N8_=4kC6=eBecgFCUuzPeBw@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2PmZDwa8BKd1c3P2gUvi46riQgy-DuO=cwMaQAF3-w20g@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-OWmP1MCEiYQH=Vi42_VS69vG=A5J7kz9Z74tLjUXSVA@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2P+V6sW-N5P+Sk60gpgMHTHExXpPffjjhrsU36ihOqdbQ@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on February 18, 2014 - 15:50:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Ah, that's the problem.  You'll need to replace this with one of the
relaxation dispersion loops, have a look at the loop_*() functions in
specific_analyses.relax_disp.disp_data.  You could for example use the
loop_exp_frq_offset_point() and then count the time points for each of
these iterations.  This is only one of many alternatives.

If you feel more adventurous, you could make the count_relax_times()
function dependent on ei, mi, oi, and di (see the module docstring for
a description of this:
<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/specific_analyses.relax_disp.disp_data-module.html">http://www.nmr-relax.com/api/3.1/specific_analyses.relax_disp.disp_data-module.html</a>).
 You would then have to delete the use of loop_time() and do something
as in the insignificance() function.

There are other ways too.  The key is to loop over each experiment
collection of {ei, mi, oi, di} and check the times for each.  If there
is only one time for the experiment block, then this is the 2-point
calculation.  If there is more, then exponential curve fitting is
needed.  If one block of {ei, mi, oi, di} is 2-point and another is
exponential, then relax will fail.  But this type of data combination
is very unlikely to ever be encountered and we can deal with that when
a user complains ;)

Anyway, have a look at specific_analyses.relax_disp.disp_data for
inspiration, as all the code you need to write can be copied from
various functions of that module.  The logic you need is repeated in
about 10 functions there.  I hope this helps.

Regards,

Edward




On 18 February 2014 15:35, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

Do you have a feeling for how much modification of relax is needed?

There is a dependency check, that the length of cdp.relax_time_list is
not larger than 1.

Is it within range to allow more than one delay time?

Best
Troels

2014-02-18 14:21 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

I would then recommend you create 2 tests, as it looks to me like the
fundamental issues are the same - that the detection of 2-point verses
full exponential curves is not functioning correctly.  The two tests,
once the bug is fixed, will the make sure that both these errors will
never again be seen by relax users!

Cheers,

Edward



On 18 February 2014 12:40, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">If the systemtest is modified to:

        self.interpreter.calc(verbosity=1)

The error is:

Traceback (most recent call last):
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/test_suite/system_tests/relax_disp.py&quot;,
line 278, in test_bug_21665_cpmg_two_fields_two_delaytimes_fail
    self.interpreter.calc(verbosity=1)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/prompt/uf_objects.py&quot;,
line 221, in __call__
    self._backend(*new_args, **uf_kargs)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/pipe_control/minimise.py&quot;,
line 86, in calc
    calculate(verbosity=verbosity)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;,
line 717, in calculate
    self._calculate_r2eff()
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;,
line 182, in _calculate_r2eff
    check_exp_type_fixed_time()
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/checks.py&quot;,
line 112, in check_exp_type_fixed_time
    raise RelaxError(&quot;The experiment '%s' is not of the fixed
relaxation time period data type.&quot; % exp_type)
RelaxError: RelaxError: The experiment 'SQ CPMG' is not of the fixed
relaxation time period data type.


2014-02-18 12:24 GMT+01:00 Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

The systemtest is now implemented.
I think this bug is related to:
bug #21344 (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?21344">https://gna.org/bugs/?21344</a>): Handling of in sparse
acquired R1rho dataset with missing combinations of time and spin-lock
field strengths.

The output of the systemtest gives:
------------
Fitting to spin :2@N, frequency 499862140.0 and dispersion point 50.0
---------------------------------------------------------------------

Unconstrained grid search size: 9 (constraints may decrease this size).

Traceback (most recent call last):
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/test_suite/system_tests/relax_disp.py&quot;,
line 281, in test_bug_21665_cpmg_two_fields_two_delaytimes_fail
    relax_disp.Relax_disp(pipe_name=&quot;compare_128_FT_R2eff&quot;,
pipe_bundle=&quot;cpmg_disp_sod1d90a&quot;, results_dir=self.tmpdir,
models=['R2eff'], grid_inc=3, mc_sim_num=5, modsel='AIC',
pre_run_dir=None, insignificance=1.0, numeric_only=False,
mc_sim_all_models=False, eliminate=True)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/auto_analyses/relax_disp.py&quot;,
line 116, in __init__
    self.run()
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/auto_analyses/relax_disp.py&quot;,
line 451, in run
    self.optimise(model=model)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/auto_analyses/relax_disp.py&quot;,
line 350, in optimise
    self.interpreter.grid_search(inc=self.grid_inc)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/prompt/uf_objects.py&quot;,
line 221, in __call__
    self._backend(*new_args, **uf_kargs)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/pipe_control/minimise.py&quot;,
line 152, in grid_search
    grid_search(lower=lower, upper=upper, inc=inc,
constraints=constraints, verbosity=verbosity)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;,
line 1093, in grid_search
    self.minimise(min_algor='grid', lower=lower, upper=upper, inc=inc,
constraints=constraints, verbosity=verbosity, sim_index=sim_index)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;,
line 1142, in minimise
    self._minimise_r2eff(min_algor=min_algor, min_options=min_options,
func_tol=func_tol, grad_tol=grad_tol, max_iterations=max_iterations,
constraints=constraints, scaling=scaling, verbosity=verbosity,
sim_index=sim_index, lower=lower, upper=upper, inc=inc)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/api.py&quot;,
line 382, in _minimise_r2eff
    values.append(average_intensity(spin=spin, exp_type=exp_type,
frq=frq, offset=offset, point=point, time=time, sim_index=sim_index))
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/disp_data.py&quot;,
line 114, in average_intensity
    int_keys = find_intensity_keys(exp_type=exp_type, frq=frq,
offset=offset, point=point, time=time)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/disp_data.py&quot;,
line 347, in find_intensity_keys
    raise RelaxError(&quot;No intensity data could be found corresponding
to the spectrometer frequency of %s MHz, dispersion point of %s and
relaxation time of %s s.&quot; % (frq*1e-6, point, time))
RelaxError: RelaxError: No intensity data could be found corresponding
to the spectrometer frequency of 499.86214 MHz, dispersion point of
50.0 and relaxation time of 0.06 s.

-----------------------------

This is true.
For the relaxation time of 0.06 s, there is no dispersion point of 50.0.

Best
Troels

2014-02-18 12:19 GMT+01:00  &lt;tlinnet@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Tue Feb 18 12:19:41 2014
New Revision: 22198

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=22198&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=22198&amp;view=rev</a>
Log:
Added systemtest to catch bug: relax -s 
Relax_disp.test_bug_21665_cpmg_two_fields_two_delaytimes_fail

Regarding bug #21665, (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?21665">https://gna.org/bugs/?21665</a>) - Running a CPMG 
analysis with two fields at two delay times.

Modified:
    trunk/test_suite/system_tests/relax_disp.py

Modified: trunk/test_suite/system_tests/relax_disp.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/relax_disp.py?rev=22198&amp;r1=22197&amp;r2=22198&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/relax_disp.py?rev=22198&amp;r1=22197&amp;r2=22198&amp;view=diff</a>
==============================================================================
--- trunk/test_suite/system_tests/relax_disp.py (original)
+++ trunk/test_suite/system_tests/relax_disp.py Tue Feb 18 12:19:41 2014
@@ -264,6 +264,21 @@
         relax_disp.Relax_disp.opt_max_iterations = 1000
         relax_disp.Relax_disp(pipe_name=&quot;origin - relax_disp (Thu Jan  
2 13:46:44 2014)&quot;, pipe_bundle=&quot;relax_disp (Thu Jan  2 13:46:44 2014)&quot;, 
results_dir=self.tmpdir, models=['R2eff', 'No Rex', 'CR72', 'NS CPMG 
2-site expanded'], grid_inc=3, mc_sim_num=5, modsel='AIC', 
pre_run_dir=None, insignificance=1.0, numeric_only=False, 
mc_sim_all_models=False, eliminate=True)

+
+    def test_bug_21665_cpmg_two_fields_two_delaytimes_fail(self):
+        &quot;&quot;&quot;U{Bug #21665&lt;<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?21665">https://gna.org/bugs/?21665</a>&gt;} catch, the 
failure due to a a CPMG analysis recorded at two fields at two delay 
times.&quot;&quot;&quot;
+
+        # Clear the data store.
+        self.interpreter.reset()
+
+        # Load the state.
+        state = status.install_path + 
sep+'test_suite'+sep+'shared_data'+sep+'dispersion'+sep+'bug_21665.bz2'
+        self.interpreter.state.load(state, force=True)
+
+        # Execute the auto-analysis (fast).
+        relax_disp.Relax_disp.opt_func_tol = 1e-5
+        relax_disp.Relax_disp.opt_max_iterations = 1000
+        relax_disp.Relax_disp(pipe_name=&quot;compare_128_FT_R2eff&quot;, 
pipe_bundle=&quot;cpmg_disp_sod1d90a&quot;, results_dir=self.tmpdir, 
models=['R2eff'], grid_inc=3, mc_sim_num=5, modsel='AIC', 
pre_run_dir=None, insignificance=1.0, numeric_only=False, 
mc_sim_all_models=False, eliminate=True)


     def test_curve_type_cpmg_fixed_time(self):


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00105" href="msg00105.html">Re: r22198 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00100" href="msg00100.html">Re: r22198 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00101" href="msg00101.html">Re: r22198 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00102" href="msg00102.html">Re: r22198 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00103" href="msg00103.html">Re: r22198 - /trunk/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Feb 19 12:40:12 2014</div>  
</body>
</html>
