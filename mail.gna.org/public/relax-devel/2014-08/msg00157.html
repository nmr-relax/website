<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r25036 &#45; /trunk/specific_analyses/relax_disp/api.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 19 Aug 2014 17:18:51 +0200 -->
<!--X-Message-Id: CAED9pY91R20Y2O8+4mnkJYk35ysUqnHOWTiVPBr5sTsnJ=vw&#45;w@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XIKlO&#45;0007tt&#45;3m@subversion.gna.org -->
<!--X-Reference: CAED9pY&#45;ejc6V=bMXGZFiysD3hwv5jUWKWZfS&#45;Y2B8kHvuu+ojQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2NZgF2G=NK&#45;PsGhxwst7gCn0UJaTg1vnO78RGMcJScRdw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r25036 - /trunk/specific_analyses/relax_disp/api.py -- August 19, 2014 - 17:18</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r25036 - /trunk/specific_analyses/relax_disp/api.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00157" class="tabs">Index by Date</a> | <a href="threads.html#00157" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00156.html">Date Prev</a>] [<a href="msg00158.html">Date Next</a>] [<a href="msg00156.html">Thread Prev</a>] [<a href="msg00153.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 19 Aug 2014 17:18:19 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=F0zP2qoXJcMPq4yiRim5imEX6g42dA2uREjtX6QlRRc=; b=oZExt4kfajclyqyjNilG155tov6BpYAZzumxI09UzquA50frWRAfh5ptMt2q7L9abe glDs3bXYxZsFgXCquS1fZpfzwTFaibHJay1KE41SJZmFnK9svqa2vfSUQV1h75luce0r +Fgc0clGuIPsOP1PiW2yZk56lYcVWOv3Vv0ngpWutjD2dSMhCgKrBfV6O1Y7WH8brkzA YuXbrxu4rM6OZt/Yj/H6/gHuTVFC2kvpLOtK/XDz3LqJrwQbHfwYYwzHDpiQBPkj7kxY 5O5JVws3OI3dprs0VknhAlH+aNsJcVJEWgyS9Hu/nG7BzbUWrSC26qQyCqJoU3tZpc4c qGBw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY91R20Y2O8+4mnkJYk35ysUqnHOWTiVPBr5sTsnJ=vw-w@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XIKlO-0007tt-3m@subversion.gna.org&gt; &lt;CAED9pY-ejc6V=bMXGZFiysD3hwv5jUWKWZfS-Y2B8kHvuu+ojQ@mail.gmail.com&gt; &lt;CA+CBx2NZgF2G=NK-PsGhxwst7gCn0UJaTg1vnO78RGMcJScRdw@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on August 19, 2014 - 17:18:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hmmm, I don't think it's related.  Maybe it is time to unify
'ri_data', at least between the model-free analysis and relaxation
dispersion.  This might be the best solution for handling fixed and
optimised R1 values as the same thing (as well as optimised R2/R1rho
values).

The 'ri_data' concept is the key behind the relax_data user functions.
The relax_data.read user function is used to read in R1 data and store
it in 'ri_data', so maybe we should use this for the optimised values
as well.  This would of course include the R2 parameter as well.  The
values are then written out with the relax_data.write user function.
For the grace.write function, the relevant key needs to be supplied to
obtain the correct values.

Note that the current relaxation data design creates a number of data
structures.  In the base data pipe 'cdp', it creates the cdp.ri_ids
list and cdp.ri_type dictionary, and stores the spectrometer frequency
in a dictionary.  For the spins it creates the ri_data and ri_data_err
dictionaries which contain the values and errors.  So you would need
to create a key for each R1 data set per experiment and field strength
(it is offset, spin, and dispersion point independent), store the key,
data type, and frequency in cdp, and store the values and errors in
the spin containers.  See the pipe_control.relax_data.pack_data()
function, as that will do it automatically for you:

<a  rel="nofollow" href="/api/3.2/pipe_control.relax_data-module.html#pack_data">http://www.nmr-relax.com/api/3.2/pipe_control.relax_data-module.html#pack_data</a>
<a  rel="nofollow" href="/api/3.2/pipe_control.relax_data-pysrc.html#pack_data">http://www.nmr-relax.com/api/3.2/pipe_control.relax_data-pysrc.html#pack_data</a>

I think that using this approach will solve all of the strange
problems.  And is will allow you to use the relax_data user functions
so you can access a lot of already implemented infrastructure.  If you
are interested in this clean solution, I would suggest that you copy
the 'r1' and 'r2' parameter object definition into the base class into
a new _add_ri_data() method, as is done for the other analysis
independent parameters, and merge the two into one 'ri_data'
parameter.  Then use the pack_data() function to store data.  You also
have access to the create_frq_label(), delete(), return_value(), and
write() functions.  You could then replace calls to the value.write
user function with relax_data.write.  The grace.write user function
should work without changes, if you pass in the correct key.

Regards,

Edward



On 19 August 2014 16:54, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

Well, it seemed that my problems was fixed.

I haven't met any problems since then.

There was though an issue, with the test script you just provided.

I could not find any values in the: 'r1rho_prime.out' file.

If I add: 'TP02 R1 fit' to the model list, I get r1.out to also be empty.

I wonder if that was my fix to:
<a  rel="nofollow" href="https://gna.org/support/index.php?3121">https://gna.org/support/index.php?3121</a>

Best
Troels

2014-08-19 16:36 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

This is a difficult problem as R1 values are normally stored in the
ri_data dictionary object, the same place that R2 values are stored.
I don't have an easy solution for this, but future attempts at
unifying the handling of relaxation data in all analyses will affect
your current work.  For example the 'r1' parameter here will probably
be converted into 'ri_data', and the 'ri_data' object set up with a
special method in the base Parameter_object class.  The 'ri_data'
object is correctly handled by value.set and grace.write, but the
current implementation in the model-free parameter object is ugly.
Does your implementation now work correctly?

Regards,

Edward



On 15 August 2014 18:54,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Fri Aug 15 18:54:01 2014
New Revision: 25036

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=25036&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=25036&amp;view=rev</a>
Log:
Fix in relax_disp API, how to handle the r1_fit parameter type.

bug #22470(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/index.php?22470">https://gna.org/bugs/index.php?22470</a>): value.set does not work 
for parameter r1_fit.

Modified:
    trunk/specific_analyses/relax_disp/api.py

Modified: trunk/specific_analyses/relax_disp/api.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/api.py?rev=25036&amp;r1=25035&amp;r2=25036&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/api.py?rev=25036&amp;r1=25035&amp;r2=25036&amp;view=diff</a>
==============================================================================
--- trunk/specific_analyses/relax_disp/api.py   (original)
+++ trunk/specific_analyses/relax_disp/api.py   Fri Aug 15 18:54:01 2014
@@ -1001,8 +1001,29 @@
                 if error:
                     obj_name += '_err'

+                # Handle the R10 parameters.
+                if param[i] in ['r1_fit']:
+                    # Loop over the current keys.
+                    for exp_type, frq, ei, mi in 
loop_exp_frq(return_indices=True):
+                        # The parameter key.
+                        key = generate_r20_key(exp_type=exp_type, 
frq=frq)
+
+                        # Initialise the structure if needed.
+                        if not hasattr(spin, obj_name):
+                            setattr(spin, obj_name, {})
+
+                        # Set the value.
+                        if index == None:
+                            obj = getattr(spin, obj_name)
+                            obj[key] = value[i]
+
+                        # If the index is specified, let it match the 
frequency index
+                        elif mi == index:
+                            obj = getattr(spin, obj_name)
+                            obj[key] = value[i]
+
                 # Handle the R20 parameters.
-                if param[i] in PARAMS_R20:
+                elif param[i] in PARAMS_R20:
                     # Loop over the current keys.
                     for exp_type, frq, ei, mi in 
loop_exp_frq(return_indices=True):
                         # The parameter key.


_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00152" href="msg00152.html">Re: r25036 - /trunk/specific_analyses/relax_disp/api.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00156" href="msg00156.html">Re: r25036 - /trunk/specific_analyses/relax_disp/api.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Aug 19 17:40:13 2014</div>  
</body>
</html>
