<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: How is the R2eff data collected and processed for clustered analysis? -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 05 Jun 2014 15:31:10 +0200 -->
<!--X-Message-Id: CAED9pY&#45;wULJp0dQBD08ZMtW4sRdH00WorYhHvuWM7mS74cQHvw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CA+CBx2Mkmn7AyX1O=CVFbG68BSq9nEMBcZUUMnMBJ8vAAkSm1w@mail.gmail.com -->
<!--X-Reference: CA+CBx2NCC_GGBpMBma6&#45;tiC1ReoEywG=DazwxmBUEZ2pLGEh4g@mail.gmail.com -->
<!--X-Reference: CAED9pY_t+Zw96Xiw&#45;18rpqzTxQyTG3w=omLOLmRp9jmNceuCpA@mail.gmail.com -->
<!--X-Reference: CA+CBx2PKFSm9bNv+dLsJ+1wLQ1xHTD5mNvg67wH&#45;R1Km0aq0cQ@mail.gmail.com -->
<!--X-Reference: CAED9pY8JFpwfRjuXgO_F4SMen&#45;7cRXNGgkusy_Wi4QmtUao+xg@mail.gmail.com -->
<!--X-Reference: CAED9pY_o1gC8jgnxHqFyW3&#45;GObKiQ9dcQ=M1T9GKyZe=2_vR=g@mail.gmail.com -->
<!--X-Reference: CA+CBx2PH2QOtDS7HnnDkHZwM9NeegFZNuE5e1mTGXFxcM=EkXA@mail.gmail.com -->
<!--X-Reference: CAED9pY_D62Btc7oDtvK+jysTk6z4O3PV&#45;1wK3m43kWv9eY4Tjw@mail.gmail.com -->
<!--X-Reference: CA+CBx2OkLkN0L3KyX6ATY+V2W7SPjAMVaFx8AD6_6_&#45;e6W2hpA@mail.gmail.com -->
<!--X-Reference: CAED9pY9FjHtEK2hLTQXJeHeVV5NGLNwTng7_kBLyqaTD+Rj4Bg@mail.gmail.com -->
<!--X-Reference: CA+CBx2Mp&#45;L5gwcZ=snL3jcKdh9ugnxrbOJqz2bDwsZ+VkhUDfg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: How is the R2eff data collected and processed for clustered analysis? -- June 05, 2014 - 15:31</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: How is the R2eff data collected and processed for clustered analysis?</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00028" class="tabs">Index by Date</a> | <a href="threads.html#00028" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00027.html">Date Prev</a>] [<a href="msg00029.html">Date Next</a>] [<a href="msg00027.html">Thread Prev</a>] [<a href="msg00006.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 5 Jun 2014 15:30:38 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=3XrRs+kOaANVszWK1jpIzS7A5hW0uhCjhJttbGsurgw=; b=ylmOiugXVYLvzDRiayFto9I6iBnm4nDD5lUGaJdbbzZwnb3fJaUmxAhLlUfyt0M9rf nT5VgEGmH86EQ1iDThsfv9hvawG/ASDLenEJdFhK0Q/Clo0MqYxG4TYsifD10zCsUSPu fAhf0Zg86D9L4eFziB/FPsXD1DypZ2d8r6uaZQcAM+4IpFf+zvDoezZVEdUqPINsncMH 8yzP/9WGbN7wfwJhly11BKQCVuMjWPV3wE53ZU092yUeYhlIo20t+vkg8vvc0QjVw0aD 7mhsaPzQrxHFzTSQssd4jHGKj6l+68y76J98F/IORLNaiR5p7188J5sm5DvsB3P8V0zU v1DQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00028.html">CAED9pY-wULJp0dQBD08ZMtW4sRdH00WorYhHvuWM7mS74cQHvw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2Mkmn7AyX1O=CVFbG68BSq9nEMBcZUUMnMBJ8vAAkSm1w@mail.gmail.com&gt; &lt;CA+CBx2NCC_GGBpMBma6-tiC1ReoEywG=DazwxmBUEZ2pLGEh4g@mail.gmail.com&gt; &lt;CAED9pY_t+Zw96Xiw-18rpqzTxQyTG3w=omLOLmRp9jmNceuCpA@mail.gmail.com&gt; &lt;<a href="msg00010.html">CA+CBx2PKFSm9bNv+dLsJ+1wLQ1xHTD5mNvg67wH-R1Km0aq0cQ@mail.gmail.com</a>&gt; &lt;<a href="msg00011.html">CAED9pY8JFpwfRjuXgO_F4SMen-7cRXNGgkusy_Wi4QmtUao+xg@mail.gmail.com</a>&gt; &lt;CAED9pY_o1gC8jgnxHqFyW3-GObKiQ9dcQ=M1T9GKyZe=2_vR=g@mail.gmail.com&gt; &lt;CA+CBx2PH2QOtDS7HnnDkHZwM9NeegFZNuE5e1mTGXFxcM=EkXA@mail.gmail.com&gt; &lt;<a href="msg00024.html">CAED9pY_D62Btc7oDtvK+jysTk6z4O3PV-1wK3m43kWv9eY4Tjw@mail.gmail.com</a>&gt; &lt;<a href="msg00025.html">CA+CBx2OkLkN0L3KyX6ATY+V2W7SPjAMVaFx8AD6_6_-e6W2hpA@mail.gmail.com</a>&gt; &lt;<a href="msg00026.html">CAED9pY9FjHtEK2hLTQXJeHeVV5NGLNwTng7_kBLyqaTD+Rj4Bg@mail.gmail.com</a>&gt; &lt;CA+CBx2Mp-L5gwcZ=snL3jcKdh9ugnxrbOJqz2bDwsZ+VkhUDfg@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 05, 2014 - 15:31:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">On 5 June 2014 15:15, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

So, I have tried to implement directly the infrastructure data format for NO
* NM * NS * NE.
And the speed up is 4.1x-4.5x times faster.

I think that is a very nice message to the release list.

It is obvious, that the largest speed-up will be gained by getting rid of
the NS loop.

Could one just re-shape the numpy arrays in the target function?
</pre></blockquote><pre style="margin: 0em;">

Yes!  Ok, you will need a little more than that.  The reshape will be
inside the lib.dispersion modules where we have the code:

back_calc[:] = R2eff

This would need to be replaced with:

back_calc[:] = R2eff.reshape(NE, NS, NM, NO, ND)

Or maybe keep the experiments separate, i.e. don't delete that loop in
target_functions.relax_disp, as different experiments are sometimes
associated with different lib.dispersion models, and then use:

back_calc[:] = R2eff.reshape(NS, NM, NO, ND)

As in your script
(<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/6022/focus=6028">http://thread.gmane.org/gmane.science.nmr.relax.devel/6022/focus=6028</a>),
you will need to increase the dimensionality of some data structures:

g_ncyc = array(ncyc_list*100)

So, just as you have done in your script, you calculate a large 1D
array of R2eff values for all spins, all magnetic field strengths, all
offsets, and all dispersion points.

Difficulties might occur for cases with missing data, but that is why
I have implemented a number of system tests checking what happens when
data is missing :)  The large speedups are not just for large spin
clusters.  You also have large speedups for R1rho experiments where
many offsets are collected.  And there is a nice speedup when you have
data at 2 or 3 magnetic fields.  Anyway, for testing your script can
be expanded for multi-field and multi-offset cases.  Or maybe make a
new script for that profiling in
test_suite/shared_data/dispersion/profiling/.

Regards,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00004" href="msg00004.html">How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00005" href="msg00005.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00007" href="msg00007.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00010" href="msg00010.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00011" href="msg00011.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00021" href="msg00021.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00023" href="msg00023.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00024" href="msg00024.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00025" href="msg00025.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00026" href="msg00026.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00027" href="msg00027.html">Re: How is the R2eff data collected and processed for clustered analysis?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Jun 06 09:20:10 2014</div>  
</body>
</html>
