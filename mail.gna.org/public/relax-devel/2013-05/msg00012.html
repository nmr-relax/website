<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Development of the relax&#45;disp branch. -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNtznvy.pbz> -->
<!--X-Date: Wed, 08 May 2013 20:46:49 +0200 -->
<!--X-Message-Id: CA+CBx2O8FG56SAbxgpZ6o0qU+OZNpDoS3rLkh4pJ0ydaOi4swQ@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAED9pY9kV+O_p19tRmhh3ESWWpc9k6VrtkCeKFY9&#45;ijbQrJ70Q@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;MnbcyDHZ0T6mLCbGaU9LpFArvA9d_1pGf6kA6Bcsh3A@mail.gmail.com -->
<!--X-Reference: CA+CBx2PdT6ZfOrVsGqLJgiwmH0xxu8rh9ef41TPeSW76&#45;RtuBg@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;iYo2NWDSBsw77mMENeBt0tiKKyjLOLbdbb9+bucy3oA@mail.gmail.com -->
<!--X-Reference: CA+CBx2OjKjGaUx9XsDyEL+&#45;mQ9B==6rj+U3O6swjR7jnwg=b6g@mail.gmail.com -->
<!--X-Reference: CAED9pY8Kyiv4d05pD4x6_C=H_mnW2FLHY0futeHEGHEex4tnSQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Development of the relax-disp branch. -- May 08, 2013 - 20:46</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Development of the relax-disp branch.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00012" class="tabs">Index by Date</a> | <a href="threads.html#00012" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00011.html">Date Prev</a>] [<a href="msg00013.html">Date Next</a>] [<a href="msg00009.html">Thread Prev</a>] [<a href="msg00013.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 8 May 2013 20:45:58 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=x-received:mime-version:in-reply-to:references:from:date:message-id	:subject:to:cc:content-type;	bh=KdNy2P24fZy4fMRrgoGsnV/YuJ6hP9i767X6FiUQYJs=;	b=T0eXmYW4BR0WX9YVhofrLitpOpKwr08NyfZ0dW/oRcobfPQ46Qr63CrnMwAA8MAsom	UP4i9eD235fzlMFsdwREZaXP3Z8LuZ9FKH2M/qxR9JJRS6Tz394VoKFQCt2AsjiswNXh	kmPM9OCoGrk4Mq+BItL0S1F2AIJyLkxnL8KXQIDX5ETE1iZKERWVPfjaWSoDBHSY4bem	Mk+aDkv9WSec/mQjyepIeXIxXoEKfgeD7tIxHOGfX0/KYz03Rh7S3WuzGvCYNRcaSHQ4	TQM+hSoH4zkh9GBlqqhPd1eicY4uUWbuLNt6HARYyAvmJ9ZFDOzGoSBsZTcNhjL+M9EM	fJeA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00012.html">CA+CBx2O8FG56SAbxgpZ6o0qU+OZNpDoS3rLkh4pJ0ydaOi4swQ@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CAED9pY9kV+O_p19tRmhh3ESWWpc9k6VrtkCeKFY9-ijbQrJ70Q@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-MnbcyDHZ0T6mLCbGaU9LpFArvA9d_1pGf6kA6Bcsh3A@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2PdT6ZfOrVsGqLJgiwmH0xxu8rh9ef41TPeSW76-RtuBg@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-iYo2NWDSBsw77mMENeBt0tiKKyjLOLbdbb9+bucy3oA@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2OjKjGaUx9XsDyEL+-mQ9B==6rj+U3O6swjR7jnwg=b6g@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY8Kyiv4d05pD4x6_C=H_mnW2FLHY0futeHEGHEex4tnSQ@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on May 08, 2013 - 20:46:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi Edward.<div><br></div><div>So that helped, but just showed another problem:</div><div>---------------------------------------------</div><div><div>C:\Python27\github\relax_disp&gt;scons</div><div>scons: Reading SConscript files ...</div>

<div>scons: done reading SConscript files.</div><div>scons: Building targets ...</div><div>link /nologo /dll /out:target_functions\relax_fit.pyd /implib:target_functions\r</div><div>elax_fit.lib /LIBPATH:C:\Python27\libs target_functions\c_chi2.obj target_functi</div>

<div>ons\exponential.obj target_functions\relax_fit.obj</div><div>   Creating library target_functions\relax_fit.lib and object target_functions\r</div><div>elax_fit.exp</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp__PyFloat_FromDou</div>

<div>ble referenced in function _func</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp__PyFloat_AsDoubl</div><div>e referenced in function _setup</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp__PyList_New refe</div>

<div>renced in function _back_calc_I</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp__PyList_SetItem</div><div>referenced in function _back_calc_I</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp__PyArg_ParseTupl</div>

<div>e referenced in function _func</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp__PyArg_ParseTupl</div><div>eAndKeywords referenced in function _setup</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp__Py_InitModule4</div>

<div>referenced in function _initrelax_fit</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp__PySequence_GetI</div><div>tem referenced in function _setup</div><div>relax_fit.obj : error LNK2019: unresolved external symbol __imp___Py_NoneStruct</div>

<div>referenced in function _setup</div><div>target_functions\relax_fit.pyd : fatal error LNK1120: 9 unresolved externals</div><div>scons: *** [target_functions\relax_fit.pyd] Error 1120</div><div>scons: building terminated because of errors.</div>

<div><br></div><div>C:\Python27\github\relax_disp&gt;</div><div>-----------------------------------------------------------</div><div><br></div><div>Searching for the problem, seems that &quot;many&quot; run into the same problem.</div>

<div>But I don&#39;t know how to fix it?</div><div><br></div><div>Do you?</div><div><br>Troels Emtekær Linnet<div style="display:inline"></div></div>
<br><br><div class="gmail_quote">2013/5/8 Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx" target="_blank">edward@xxxxxxxxxxxxx</a>&gt;</span><br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">

Hi,<br>
<br>
This &quot;&#39;cl&#39; is not recognized as an internal or external command&quot; error<br>
is quite common.  For example one solution for older SCons and MSVC is<br>
given at <a rel="nofollow" href="http://www.nmr-relax.com/windows_devel.html#MSVS_scons_issues" target="_blank">http://www.nmr-relax.com/windows_devel.html#MSVS_scons_issues</a>.<br>
 If you have 64-bit windows, then you have probably been bitten by an<br>
SCons bug that I reported a long time ago and that the SCons<br>
developers stubbornly refuse to fix:<br>
<br>
<a rel="nofollow" href="http://scons.tigris.org/issues/show_bug.cgi?id=2849" target="_blank">http://scons.tigris.org/issues/show_bug.cgi?id=2849</a><br>
<br>
It is a one line fix which you can see in the second comment.  Just<br>
change those lines in your installed SCons code and it should run.  If<br>
these two suggestions do not work, then we need to look for another<br>
solution.<br>
<br>
Regards,<br>
<br>
Edward<br>
<div class="HOEnZb"><div class="h5"><br>
<br>
<br>
<br>
<br>
On 7 May 2013 20:22, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxx">tlinnet@xxxxxxxxx</a>&gt; wrote:<br>
&gt; Hi Edward.<br>
&gt;<br>
&gt; I use pyscripter and Ipython for coding, but def. not vim.<br>
&gt; I am aware of Python PEP style guide, and the indention thing.<br>
&gt; Trying to remember to comply to the rules of style. :-)<br>
&gt;<br>
&gt; I would need to program at home, since I cannot spend effort when I am the<br>
&gt; lab.<br>
&gt;<br>
&gt; Still having troubles with scons. Tried following this:<br>
&gt; <a rel="nofollow" href="http://www.nmr-relax.com/windows_devel.html" target="_blank">http://www.nmr-relax.com/windows_devel.html</a><br>
&gt; I installed scons 2.3 for windows<br>
&gt; And Visual Studio Express 2012<br>
&gt;<br>
&gt; I don&#39;t understand this:<br>
&gt; &#39;cl&#39; is not recognized as an internal or external command, operable program<br>
&gt; or batch file.<br>
&gt; I can call cl from command line, so...<br>
&gt;<br>
&gt; Have you seen this before?<br>
&gt;<br>
&gt; -----------------------------------------<br>
&gt; C:\Python27\github\relax_disp&gt;&quot;C:\Program Files (x86)\Microsoft Visual<br>
&gt; Studio 11<br>
&gt; .0\VC\vcvarsall&quot;<br>
&gt;<br>
&gt; C:\Python27\github\relax_disp&gt;scons<br>
&gt; scons: Reading SConscript files ...<br>
&gt; scons: done reading SConscript files.<br>
&gt; scons: Building targets ...<br>
&gt;<br>
&gt; ###########################<br>
&gt; # Compiling the C modules #<br>
&gt; ###########################<br>
&gt;<br>
&gt; Building the relaxation curve fitting module<br>
&gt; &#39;target_functions\\relax_fit.pyd&#39;<br>
&gt;<br>
&gt; cl /Fotarget_functions\c_chi2.obj /c target_functions\c_chi2.c /nologo<br>
&gt; /I&quot;C:\Pyt<br>
&gt; hon27\Scripts\..\include&quot;<br>
&gt; &#39;cl&#39; is not recognized as an internal or external command,<br>
&gt; operable program or batch file.<br>
&gt; scons: *** [target_functions\c_chi2.obj] Error 1<br>
&gt; scons: building terminated because of errors.<br>
&gt;<br>
&gt; C:\Python27\github\relax_disp&gt;cl<br>
&gt; Microsoft (R) C/C++ Optimizing Compiler Version 17.00.50727.1 for x86<br>
&gt; Copyright (C) Microsoft Corporation.  All rights reserved.<br>
&gt;<br>
&gt; usage: cl [ option... ] filename... [ /link linkoption... ]<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; Troels Emtekær Linnet<br>
&gt;<br>
&gt;<br>
&gt; 2013/5/7 Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt;<br>
&gt;&gt; Hi Troels,<br>
&gt;&gt;<br>
&gt;&gt; I just noticed that you have a footer at the end of your messages.  It<br>
&gt;&gt; might be better to turn this off for mailing list messages - it&#39;s best<br>
&gt;&gt; that your work number and address is not archived permanently all over<br>
&gt;&gt; the internet.<br>
&gt;&gt;<br>
&gt;&gt; Regards,<br>
&gt;&gt;<br>
&gt;&gt; Edward<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt; On 7 May 2013 14:18, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxx">tlinnet@xxxxxxxxx</a>&gt; wrote:<br>
&gt;&gt; &gt; Hi Edward.<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Thanks for the lengthy explanation, and I hope that I can honor your<br>
&gt;&gt; &gt; effort<br>
&gt;&gt; &gt; in explaining. :-)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; I would be interested to get these things to work in relax, which we<br>
&gt;&gt; &gt; most<br>
&gt;&gt; &gt; often use in our lab:<br>
&gt;&gt; &gt; -  off-resonance T1rho<br>
&gt;&gt; &gt; - CPMG<br>
&gt;&gt; &gt; -- Fast (Meiboom)<br>
&gt;&gt; &gt; -- slow/intermediate (Richard-Carver)<br>
&gt;&gt; &gt; -- very slow (Tollinger/Kay equation)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; So I will go for the Tollinger, since that is the &quot;easiest&quot; next to the<br>
&gt;&gt; &gt; fast.<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; I would need to do the code development at my Windows machine, and<br>
&gt;&gt; &gt; I checked out the relax-disp branch yesterday.<br>
&gt;&gt; &gt; Should I/How do I compile with scons under windows?<br>
&gt;&gt; &gt; Or should I install the  pre-compiled Windows binaries, and replace the<br>
&gt;&gt; &gt; files?<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Best<br>
&gt;&gt; &gt; Troels<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Troels Emtekær Linnet<br>
&gt;&gt; &gt; Ved kløvermarken 9, <a rel="nofollow" href="http://1.th" target="_blank">1.th</a><br>
&gt;&gt; &gt; 2300 København S<br>
&gt;&gt; &gt; Mobil: <a rel="nofollow" href="tel:%2B45%2060210234" value="+4560210234">+45 60210234</a><br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; 2013/5/7 Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Hi again,<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Just for reference in the mailing list archives, the sub-thread has<br>
&gt;&gt; &gt;&gt; appeared as a new thread at<br>
&gt;&gt; &gt;&gt; <a rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/3835" target="_blank">http://thread.gmane.org/gmane.science.nmr.relax.devel/3835</a>.<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Regards,<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Edward<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; On 7 May 2013 11:36, Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt; Hi Troels,<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; This sub-thread (which will appear at<br>
&gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/3833" target="_blank">http://thread.gmane.org/gmane.science.nmr.relax.devel/3833</a>) will<br>
&gt;&gt; &gt;&gt; &gt; hopefully be a mini-tutorial covering the development of the<br>
&gt;&gt; &gt;&gt; &gt; relax_disp branch.  Before you can be accepted as a relax developer<br>
&gt;&gt; &gt;&gt; &gt; with commit access to the source code repository, you should first<br>
&gt;&gt; &gt;&gt; &gt; submit changes as patches.  This takes longer initially, but it<br>
&gt;&gt; &gt;&gt; &gt; allows<br>
&gt;&gt; &gt;&gt; &gt; the other relax developers to see how you code and if you are<br>
&gt;&gt; &gt;&gt; &gt; following the coding conventions as described in the development<br>
&gt;&gt; &gt;&gt; &gt; chapter of the relax manual<br>
&gt;&gt; &gt;&gt; &gt; (<a rel="nofollow" href="http://www.nmr-relax.com/manual/relax_development.html" target="_blank">http://www.nmr-relax.com/manual/relax_development.html</a>).  I can give<br>
&gt;&gt; &gt;&gt; &gt; you feedback as you go as to how to improve the code to fit into<br>
&gt;&gt; &gt;&gt; &gt; relax.  We, the relax developers, will after a few patches have a<br>
&gt;&gt; &gt;&gt; &gt; private vote to accept you as a relax developer.  This is standard<br>
&gt;&gt; &gt;&gt; &gt; practice in an open source project.  The full procedure for becoming<br>
&gt;&gt; &gt;&gt; &gt; a<br>
&gt;&gt; &gt;&gt; &gt; developer is detailed in the &#39;Committers&#39; section of the manual<br>
&gt;&gt; &gt;&gt; &gt; (<a rel="nofollow" href="http://www.nmr-relax.com/manual/Committers.html" target="_blank">http://www.nmr-relax.com/manual/Committers.html</a>).  The PDF version<br>
&gt;&gt; &gt;&gt; &gt; of<br>
&gt;&gt; &gt;&gt; &gt; the manual is easier to read<br>
&gt;&gt; &gt;&gt; &gt; (<a rel="nofollow" href="http://download.gna.org/relax/manual/relax.pdf" target="_blank">http://download.gna.org/relax/manual/relax.pdf</a>).  Patches can be<br>
&gt;&gt; &gt;&gt; &gt; posted to the patch tracker (<a rel="nofollow" href="https://gna.org/patch/?group=relax" target="_blank">https://gna.org/patch/?group=relax</a>).<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; relax development begins and ends with the test suite.  The idea is<br>
&gt;&gt; &gt;&gt; &gt; that, before any code is present, a relax system test must be<br>
&gt;&gt; &gt;&gt; &gt; created.<br>
&gt;&gt; &gt;&gt; &gt;  This allows you to develop the ideas for how the UI should work with<br>
&gt;&gt; &gt;&gt; &gt; the analysis - i.e. which new user functions will need to be created<br>
&gt;&gt; &gt;&gt; &gt; and which ones will need to be expanded.  A script is added to<br>
&gt;&gt; &gt;&gt; &gt; test_suite/system_tests/scripts/relax_disp/ and then a test added to<br>
&gt;&gt; &gt;&gt; &gt; test_suite/system_tests/relax_disp.py which executes the script and<br>
&gt;&gt; &gt;&gt; &gt; then checks the data and results.  For example see the script<br>
&gt;&gt; &gt;&gt; &gt; &#39;test_suite/system_tests/scripts/relax_disp/hansen_data.py&#39; and the<br>
&gt;&gt; &gt;&gt; &gt; function test_hansen_cpmg_data_fast_2site() in the file<br>
&gt;&gt; &gt;&gt; &gt; &#39;test_suite/system_tests/relax_disp.py&#39;.  This is obviously not<br>
&gt;&gt; &gt;&gt; &gt; complete as only the script is executed - the results are not yet<br>
&gt;&gt; &gt;&gt; &gt; checked (as we do not know what the result for the optimised model<br>
&gt;&gt; &gt;&gt; &gt; should be yet).  This individual test can be executed with the<br>
&gt;&gt; &gt;&gt; &gt; command:<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; $ relax -s Relax_disp.test_hansen_cpmg_data_fast_2site<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; This test, as well as the other Relax_disp tests, were created by<br>
&gt;&gt; &gt;&gt; &gt; Sebastien Morin when he started the development of the relax_disp<br>
&gt;&gt; &gt;&gt; &gt; branch.  I have renamed everything since he added it, and will<br>
&gt;&gt; &gt;&gt; &gt; probably do so again soon.  It is best to develop for the script UI<br>
&gt;&gt; &gt;&gt; &gt; first - the GUI will later be modified around the graphical versions<br>
&gt;&gt; &gt;&gt; &gt; of the user functions, or directly accessing the back end of the user<br>
&gt;&gt; &gt;&gt; &gt; function.  Due to the advanced state of the relax_disp branch, you<br>
&gt;&gt; &gt;&gt; &gt; probably do not need to worry about new user functions.  This may be<br>
&gt;&gt; &gt;&gt; &gt; needed if you would like to expand the analysis to new types of data<br>
&gt;&gt; &gt;&gt; &gt; (for example off-resonance R1rho where R1 data need to be measured<br>
&gt;&gt; &gt;&gt; &gt; and<br>
&gt;&gt; &gt;&gt; &gt; used in the analysis, H/D exchange, etc.).<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; The test suite is one area which can be expanded to handle the<br>
&gt;&gt; &gt;&gt; &gt; different CPMG models.  The testing is currently not very extensive.<br>
&gt;&gt; &gt;&gt; &gt; For example before a new dispersion model is added to relax, it would<br>
&gt;&gt; &gt;&gt; &gt; be good if synthetic data were to be created in an external program<br>
&gt;&gt; &gt;&gt; &gt; (a<br>
&gt;&gt; &gt;&gt; &gt; Python script, Matlab, Mathematica, Maxima, etc.).  It is very<br>
&gt;&gt; &gt;&gt; &gt; important that relax is not used to create the data.  Synthetic data<br>
&gt;&gt; &gt;&gt; &gt; is very important for making sure that relax obtains the correct<br>
&gt;&gt; &gt;&gt; &gt; result, as you know what the result should be.  With measured data<br>
&gt;&gt; &gt;&gt; &gt; you<br>
&gt;&gt; &gt;&gt; &gt; can never really know what the true result is - this is the entire<br>
&gt;&gt; &gt;&gt; &gt; point of the mathematical field of modelling (this field makes that<br>
&gt;&gt; &gt;&gt; &gt; of<br>
&gt;&gt; &gt;&gt; &gt; NMR look very, very small).  Synthetic data is also useful for double<br>
&gt;&gt; &gt;&gt; &gt; checking results against other relaxation dispersion software (for<br>
&gt;&gt; &gt;&gt; &gt; reference: NESSY - <a rel="nofollow" href="http://home.gna.org/nessy/" target="_blank">http://home.gna.org/nessy/</a>;  CPMGFit -<br>
&gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="http://www.palmer.hs.columbia.edu/software/cpmgfit.html" target="_blank">http://www.palmer.hs.columbia.edu/software/cpmgfit.html</a>;  ShereKhan -<br>
&gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="http://sherekhan.bionmr.org/" target="_blank">http://sherekhan.bionmr.org/</a>;  CATIA -<br>
&gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="http://www.biochem.ucl.ac.uk/hansen/catia/" target="_blank">http://www.biochem.ucl.ac.uk/hansen/catia/</a>).  Data could also be<br>
&gt;&gt; &gt;&gt; &gt; taken<br>
&gt;&gt; &gt;&gt; &gt; from Art Palmer&#39;s CPMGFit manual<br>
&gt;&gt; &gt;&gt; &gt; (<a rel="nofollow" href="http://www.palmer.hs.columbia.edu/software/cpmgfit_manual.html" target="_blank">http://www.palmer.hs.columbia.edu/software/cpmgfit_manual.html</a>).<br>
&gt;&gt; &gt;&gt; &gt; This would need to be converted into peak intensities in a peak list<br>
&gt;&gt; &gt;&gt; &gt; file, but that is easy enough by simply picking random I0 values for<br>
&gt;&gt; &gt;&gt; &gt; the exponential curves.  The data could be passed quickly through<br>
&gt;&gt; &gt;&gt; &gt; each<br>
&gt;&gt; &gt;&gt; &gt; of the models of the CPMGFit program and results noted.  Then the<br>
&gt;&gt; &gt;&gt; &gt; results would be added to the checks of different relax system tests.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; Each different data set used in the testing process should be located<br>
&gt;&gt; &gt;&gt; &gt; in its own directory in test_suite/shared_data/dispersion/.  That<br>
&gt;&gt; &gt;&gt; &gt; directory can include the data and all scripts used to generate the<br>
&gt;&gt; &gt;&gt; &gt; data and, for reference, it can also contain subdirectories for<br>
&gt;&gt; &gt;&gt; &gt; holding the input and output for different programs (as long as the<br>
&gt;&gt; &gt;&gt; &gt; files are not too big).<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; The current state of the branch is that all of the user functions are<br>
&gt;&gt; &gt;&gt; &gt; pretty close to complete.  The user function consists of a front end<br>
&gt;&gt; &gt;&gt; &gt; definition in user_functions/, and a backend either in pipe_control/<br>
&gt;&gt; &gt;&gt; &gt; or specific_analyses/.  The relaxation dispersion target function<br>
&gt;&gt; &gt;&gt; &gt; setup for optimisation is close to complete.  You can see this in the<br>
&gt;&gt; &gt;&gt; &gt; minimise() method of the specific_analyses/relax_disp/__init__.py<br>
&gt;&gt; &gt;&gt; &gt; file, and then the __init__() method of the class in<br>
&gt;&gt; &gt;&gt; &gt; target_functions/relax_disp.py.  As you will see in the model_loop()<br>
&gt;&gt; &gt;&gt; &gt; method of the specific_analyses/relax_disp/__init__.py code,<br>
&gt;&gt; &gt;&gt; &gt; clustering of spin systems is already part of this design -<br>
&gt;&gt; &gt;&gt; &gt; everything<br>
&gt;&gt; &gt;&gt; &gt; handles a group of spins assuming the same parameter values.  One<br>
&gt;&gt; &gt;&gt; &gt; missing feature that I might work on soon is the handling of missing<br>
&gt;&gt; &gt;&gt; &gt; input data, as this affects my current work.  This is a problem<br>
&gt;&gt; &gt;&gt; &gt; currently caught by the<br>
&gt;&gt; &gt;&gt; &gt; test_suite/shared_data/dispersion/Hansen/relax_disp.py script, as<br>
&gt;&gt; &gt;&gt; &gt; residue :71 is missing data at one field strength.  But once the<br>
&gt;&gt; &gt;&gt; &gt; dispersion tests have been expanded, this can be tested properly by<br>
&gt;&gt; &gt;&gt; &gt; deleting data for single points on the exponential curves, deleting<br>
&gt;&gt; &gt;&gt; &gt; entire exponential curves (or dispersion points for the two-point<br>
&gt;&gt; &gt;&gt; &gt; analysis type), or all data from a single spectrometer field strength<br>
&gt;&gt; &gt;&gt; &gt; for a single spin.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; So I would suggest that you pick one of the dispersion models you are<br>
&gt;&gt; &gt;&gt; &gt; interested in and try to implement that.  I am working on the Luz and<br>
&gt;&gt; &gt;&gt; &gt; Meiboom, 1963 model, but all of the other models are safe to work on.<br>
&gt;&gt; &gt;&gt; &gt; Just say which you are interested in so that we don&#39;t both change the<br>
&gt;&gt; &gt;&gt; &gt; same code.  The system test data would come first.  The formula can<br>
&gt;&gt; &gt;&gt; &gt; be<br>
&gt;&gt; &gt;&gt; &gt; taken, a set of parameters for 2-3 spins chosen, and a simple script<br>
&gt;&gt; &gt;&gt; &gt; written to generate the R2eff data, importantly at multiple magnetic<br>
&gt;&gt; &gt;&gt; &gt; field strengths.  That data can then be converted into a generic peak<br>
&gt;&gt; &gt;&gt; &gt; list for different time periods on a basic 2-parameter exponential<br>
&gt;&gt; &gt;&gt; &gt; curve.  See the &#39;File formats&#39; section of the<br>
&gt;&gt; &gt;&gt; &gt; spectrum.read_intensities user function docstring, for example by<br>
&gt;&gt; &gt;&gt; &gt; typing help(spectrum.read_intensities) in the prompt UI.  In the same<br>
&gt;&gt; &gt;&gt; &gt; script the creation of input files for other programs could be added,<br>
&gt;&gt; &gt;&gt; &gt; possibly at a later stage, and the data quickly run through CPMGFit,<br>
&gt;&gt; &gt;&gt; &gt; for example, for a sanity check.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; If you do test the other programs, you may encounter a severe bug in<br>
&gt;&gt; &gt;&gt; &gt; one of their models.  No software is bug free.  In such a case, we<br>
&gt;&gt; &gt;&gt; &gt; should communicate with the authors in private and they can decide<br>
&gt;&gt; &gt;&gt; &gt; what to do.  You can see that I did this with Art Palmer&#39;s Modelfree<br>
&gt;&gt; &gt;&gt; &gt; program at<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="http://biochemistry.hs.columbia.edu/labs/palmer/software/modelfree.html" target="_blank">http://biochemistry.hs.columbia.edu/labs/palmer/software/modelfree.html</a>.<br>
&gt;&gt; &gt;&gt; &gt;  Versions 4.16 and 4.20 consist of patches that I send to Art to fix<br>
&gt;&gt; &gt;&gt; &gt; compilation issues and other bugs (I pointed out the grid search<br>
&gt;&gt; &gt;&gt; &gt; problem due to the singular matrix failure of the Levenberg-Marquardt<br>
&gt;&gt; &gt;&gt; &gt; algorithm and Art made that change himself).<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; Once some data has been created and files attached to the patch<br>
&gt;&gt; &gt;&gt; &gt; tracker (<a rel="nofollow" href="https://gna.org/patch/?group=relax" target="_blank">https://gna.org/patch/?group=relax</a>), then the relax script<br>
&gt;&gt; &gt;&gt; &gt; can be written and added to<br>
&gt;&gt; &gt;&gt; &gt; test_suite/system_tests/scripts/relax_disp/.  The best way would<br>
&gt;&gt; &gt;&gt; &gt; probably be for one of the current scripts to be copied (by me to<br>
&gt;&gt; &gt;&gt; &gt; start with) in the repository and then you make small changes to it<br>
&gt;&gt; &gt;&gt; &gt; and send the patches created with:<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; $ svn diff &gt; patch<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; Then the script execution and data and parameter checking code can be<br>
&gt;&gt; &gt;&gt; &gt; added to test_suite/system_tests/relax_disp.py - again you can look<br>
&gt;&gt; &gt;&gt; &gt; at<br>
&gt;&gt; &gt;&gt; &gt; the other methods in that file and create a new one by copying how an<br>
&gt;&gt; &gt;&gt; &gt; old method operates.  In that system test you would check that the<br>
&gt;&gt; &gt;&gt; &gt; original parameters have been found.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; At this stage, the test should run fine up to the grid_search user<br>
&gt;&gt; &gt;&gt; &gt; function, and then fail (or possibly at the relax_disp.select_model<br>
&gt;&gt; &gt;&gt; &gt; user function call in the script depending on whether you use the<br>
&gt;&gt; &gt;&gt; &gt; auto-analysis code in auto_analyses.relax_disp or not).  This is the<br>
&gt;&gt; &gt;&gt; &gt; point where the model can be implemented.  Then you would take the<br>
&gt;&gt; &gt;&gt; &gt; following steps:<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; - Add a description of the new model with the equation and reference<br>
&gt;&gt; &gt;&gt; &gt; to the user_functions.relax_disp module.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; - Add the model and its parameters to the _select_model() method of<br>
&gt;&gt; &gt;&gt; &gt; the specific_analyses/relax_disp/__init__.py file.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; - Add any new parameter definitions to the top of the<br>
&gt;&gt; &gt;&gt; &gt; specific_analyses/relax_disp/__init__.py file in the __init__()<br>
&gt;&gt; &gt;&gt; &gt; method<br>
&gt;&gt; &gt;&gt; &gt; as needed.  If new parameters are needed, then there are various<br>
&gt;&gt; &gt;&gt; &gt; places in the specific_analyses.relax_disp package where support will<br>
&gt;&gt; &gt;&gt; &gt; be needed, mainly in the specific_analyses.relax_disp.parameters<br>
&gt;&gt; &gt;&gt; &gt; module.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; - Create a new module in the lib.dispersion package for the model<br>
&gt;&gt; &gt;&gt; &gt; function.  This module will eventually hold the model function, the<br>
&gt;&gt; &gt;&gt; &gt; gradient (each partial derivative with respect to each parameter<br>
&gt;&gt; &gt;&gt; &gt; would<br>
&gt;&gt; &gt;&gt; &gt; be in a different function), and the Hessian (the matrix of second<br>
&gt;&gt; &gt;&gt; &gt; partial derivatives).  Having the gradient and Hessian will allow for<br>
&gt;&gt; &gt;&gt; &gt; the more powerful optimisation algorithms to be used.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; - Add a new method to target_functions/relax_disp.py which uses the<br>
&gt;&gt; &gt;&gt; &gt; new code in lib.dispersion to calculate R2eff values, combine this<br>
&gt;&gt; &gt;&gt; &gt; with the chi2 function, and return the chi-squared value (see the<br>
&gt;&gt; &gt;&gt; &gt; current func_LM63() method for how to do this).<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; - Finally, see if the system test passes.  If not, then it is time to<br>
&gt;&gt; &gt;&gt; &gt; debug.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; During these steps, the unit test part of the test suite can be used<br>
&gt;&gt; &gt;&gt; &gt; to make sure that individual functions and methods behave correctly.<br>
&gt;&gt; &gt;&gt; &gt; This is useful as users will always find a way to break your code.<br>
&gt;&gt; &gt;&gt; &gt; Once the system test passes, then you will know that the<br>
&gt;&gt; &gt;&gt; &gt; implementation is complete and fully functional.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; If your interest is in the numerical integration of the<br>
&gt;&gt; &gt;&gt; &gt; Bloch-McConnell equations, then the procedure might be slightly<br>
&gt;&gt; &gt;&gt; &gt; different.  We would have to discuss this in more detail, with paper<br>
&gt;&gt; &gt;&gt; &gt; references and the necessary equations.  But I think that all of this<br>
&gt;&gt; &gt;&gt; &gt; can be handled in a module of the lib.dispersion package, and the<br>
&gt;&gt; &gt;&gt; &gt; rest<br>
&gt;&gt; &gt;&gt; &gt; of the above detailed procedure would be the same.  I hope this post<br>
&gt;&gt; &gt;&gt; &gt; wasn&#39;t too long for you!<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; Edward<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; On 6 May 2013 21:14, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxx">tlinnet@xxxxxxxxx</a>&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; Hi Edward.<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; When you have completed your ideas of change to the<br>
&gt;&gt; &gt;&gt; &gt;&gt; disp branch, could you send me a notits?<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; And maybe a script file, how to launch the code?<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Then I could try to figure out where I should extend new code.<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Best<br>
&gt;&gt; &gt;&gt; &gt;&gt; Troels<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; _______________________________________________<br>
&gt;&gt; &gt;&gt; &gt;&gt; relax (<a rel="nofollow" href="http://www.nmr-relax.com" target="_blank">http://www.nmr-relax.com</a>)<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; This is the relax-devel mailing list<br>
&gt;&gt; &gt;&gt; &gt;&gt; <a rel="nofollow" href="mailto:relax-devel@xxxxxxx">relax-devel@xxxxxxx</a><br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; To unsubscribe from this list, get a password<br>
&gt;&gt; &gt;&gt; &gt;&gt; reminder, or change your subscription options,<br>
&gt;&gt; &gt;&gt; &gt;&gt; visit the list information page at<br>
&gt;&gt; &gt;&gt; &gt;&gt; <a rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel" target="_blank">https://mail.gna.org/listinfo/relax-devel</a><br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;<br>
&gt;<br>
</div></div></blockquote></div><br></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00014" href="msg00014.html">Re: Development of the relax-disp branch.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re: Development of the relax-disp branch.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00002" href="msg00002.html">Development of the relax-disp branch.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00003" href="msg00003.html">Re: Development of the relax-disp branch.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00005" href="msg00005.html">Re: Development of the relax-disp branch.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00007" href="msg00007.html">Re: Development of the relax-disp branch.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00008" href="msg00008.html">Re: Development of the relax-disp branch.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00009" href="msg00009.html">Re: Development of the relax-disp branch.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu May 09 22:40:08 2013</div>  
</body>
</html>
