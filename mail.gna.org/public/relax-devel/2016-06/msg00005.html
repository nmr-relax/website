<!-- MHonArc v2.6.19+ -->
<!--X-Subject: Re: [sr #3345] Inversion recovery curve fitting -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 03 Jun 2016 11:10:06 +0200 -->
<!--X-Message-Id: CAED9pY_Bkf0&#45;PNtmzE&#45;SBU3sBozWA&#45;nH1RzstyxRvXGuEUUHzQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20160513&#45;020709.sv22362.61994@gna.org -->
<!--X-Reference: CAED9pY9_i3GNZbWhyyOSO0OL4u=xTUCR_nCV0t1i8gSX&#45;bxqDQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sr #3345] Inversion recovery curve fitting -- June 03, 2016 - 11:10</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [sr #3345] Inversion recovery curve fitting</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00005" class="tabs">Index by Date</a> | <a href="threads.html#00005" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00004.html">Date Prev</a>] [<a href="msg00006.html">Date Next</a>] [<a href="msg00003.html">Thread Prev</a>] [<a href="msg00004.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Henry &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 3 Jun 2016 11:09:26 +0200</li>
<li class="menuitem">
<em>Cc</em>: Henry &lt;u5376227@xxxxxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc; bh=SY0cEa0VmNJlgqlis5AyOZj3Cw6yuFKgKhFgaan7Alk=; b=d9UJVcaOB4gKgotLQqAQVKdF1PWil2Z8OkgBodgHQSy9OwH/gdaD1LOMe/Ys2uEaGO 5Fo49WP0AIuG9udp1NQsr207ekZJr8vNpm0nl9YRsnnqVUslbolbbscFVPAW1M9mQbfR 0AHYigaNK8eTZSUhJ+epnjQmBtjmSf+LN3NfC7xhD49EPnQzQryFE2I0PbINCwKfzuM8 tSMiX1s9axgPPkIeBtjAQ/Ykp7UYtnD/Ab8KV1hDEBHEuXNYNBCRWpCmGDIz4VEn/gDd Eeh59xo9NhaEt+8TkZ7QAAzQksSp+vJQzrWQDamthYB31gXaZTRMLcDJLKHoWNBXTZfk BNcg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00005.html">CAED9pY_Bkf0-PNtmzE-SBU3sBozWA-nH1RzstyxRvXGuEUUHzQ@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;20160513-020709.sv22362.61994@gna.org&gt; &lt;CAED9pY9_i3GNZbWhyyOSO0OL4u=xTUCR_nCV0t1i8gSX-bxqDQ@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 03, 2016 - 11:10:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">On 3 June 2016 at 10:28, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">On 13 May 2016 at 04:07, Henry &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">URL:
  &lt;<a  rel="nofollow" href="http://gna.org/support/?3345">http://gna.org/support/?3345</a>&gt;

                 Summary: Inversion recovery curve fitting
                 Project: relax
            Submitted by: orton_henry
            Submitted on: Fri 13 May 2016 02:07:09 UTC
                Category: None
                Priority: 5 - Normal
                Severity: 4 - Important
                  Status: None
             Assigned to: None
        Originator Email:
             Open/Closed: Open
         Discussion Lock: Any
        Operating System: GNU/Linux

    _______________________________________________________

Details:

Hi Edward,

The relax software has been working well for exponential curve fitting of 
R2
relaxation, however I have run into a few problems fitting the R1 
parameter.

The grid search seems to fail to provide a good starting point for initial
parameters when the 'inv' model is chosen and always sets the R1 parameter 
to
zero. The subsequent minimisation then seems to fail to converge giving 
either
n&gt; I(t) = Iinf - (Iinf - I0) * exp(-R1 * t)egative or very small values. 
The minimisation gives the same results when I
constrain the grid search to the exact parameters also.

I'm wondering if the functional form of the inversion recovery model is 
right.
The model is given as:

I(t) = Iinf - I0 * exp(-R1 * t)

This model claims that the intensity at t=0 is (Iinf - I0) which doesn't 
seem
right. Maybe the following model could work better?

I(t) = Iinf - (Iinf - I0) * exp(-R1 * t)

However, even with the default model, I would expect it to fit the data 
well
(at least for the R1 parameter) despite the Iinf and I0 parameters maybe 
being
fit incorrectly.

In order to avoid the general complexity that seems to come with 3 
parameter
models over 2 parameter models, it would be great to see the inclusion of 
a 2
parameter inversion recovery model that is something like this:

I(t) = Iinf * (1 - 2 * exp(-R1 * t))

I had a go at implementing this model simply by modifying the definition of
the saturation recovery model in the 'exponential_sat.c' file as it is very
similar. However I got poor results again where the R1 parameter was 4 
orders
of magnitude too large (even when constraining the parameters in the grid
search). The R1 should be around 0.6 /s

One final thing, I noticed that relax can't handle negative intensities for
the inversion recovery  model so I had to convert my data to positive.

I've included the script and data I have been using. My data has fairly 
short
relaxation delays as I wanted to prevent NOE biexponentials and I'm not 
sure
if this is contributing to errors.

Any help would be greatly appreciated.
Thanks so much,
Henry

P.S. The data 'gb1Y_t1_relax.csv' is arranged in the following columns and 
is
read directly using the script 'relaxmac_t1.py'

[Assignment, 1Hppm, 15Nppm, 1H point, 15N point, tot. num peaks, contrib. 
num
peaks, RMSD noise, delay1, delay2, delay3, delay4, intens. 1, intens. 2,
intens. 3, intens. 4]

The delays are in milliseconds but the script converts this to seconds 
before
fitting.
</pre></blockquote><pre style="margin: 0em;">

Hi Henry,

Welcome to the relax mailing lists!  Sorry for the late response.
I've been quite busy, and double and triple checking a challenge of an
implementation takes rather some time.  I think you might be correct
with the inversion recovery experiment.  I went back to my original
source:

    Palmer, A. G. and Rance, M. and Wright, P. E. (1991)
Intramolecular Motions of a Zinc Finger DNA-Binding Domain from Xfin
Characterized by Proton-Detected Natural Abundance 3C Heteronuclear
NMR Spectroscopy.  J. Am. Chem.Soc., 113, 4371-4380

There the equation is:

    I(t) = Iinf - (Iinf - I0) * exp(-R1 * t)

This was the equation as I knew it. I checked the
target_functions/exponential_inv.c and can see that our implementation
is:

    I(t) = Iinf - I0 * exp(-R1 * t)

This is clearly incorrect.  And I have no idea how this happened, as I
am quite familiar with this equation.  However no one has picked this
up as, in the 15 year history of relax, no one has measured the
inversion recovery experiment and tested relax with it.  The
experiment is far inferior to the saturation recovery experiment (the
3 parameter fit absorbs significantly more noise into the R1 value
compared to a 2 parameter fit).  Are you sure you measured the
inversion recovery experiment?  Anyway, this is why this bug has never
been seen before.  I am in the process of updating the code and will
get back to you once this bug is fixed.
</pre></blockquote><pre style="margin: 0em;">

Hi Henry,

I have now re-derived the gradients and Hessians for the inversion
recovery equation, and implemented these and the correct equation in
the corresponding optimisation target function
(target_functions/exponential_inv.c).  If you would like to test this
out, I would suggest obtaining relax from the source code repository:

    <a  rel="nofollow" href="http://www.nmr-relax.com/download.html#Source_code_repository">http://www.nmr-relax.com/download.html#Source_code_repository</a>

I do not know when the next relax release will be made, so this would
be the quickest way to obtain the fixes.

Cheers,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00003" href="msg00003.html">Re: [sr #3345] Inversion recovery curve fitting</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Jun 03 11:20:13 2016</div>  
</body>
</html>
