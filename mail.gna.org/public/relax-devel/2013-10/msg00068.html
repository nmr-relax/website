<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Help with settings script for R1rho analysis. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 22 Oct 2013 15:12:27 +0200 -->
<!--X-Message-Id: CAED9pY&#45;vYtxFYNaAtwTg&#45;Uu+p=9cfsYeESbSQDYzusN0GmacRA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CA+CBx2Otwm3tdPgfzVduw9gDZxtwjq82Y8iAp7q_OJeQ2LKZ8g@mail.gmail.com -->
<!--X-Reference: CAED9pY8QeGe=P4G+=6YD7EitmkKW82HCpTapFsnKfmCiBAZMzg@mail.gmail.com -->
<!--X-Reference: CA+CBx2O=c47Fug5LwhmnFMQLxxnntDr0SHLXR3=SAW_k6bHovg@mail.gmail.com -->
<!--X-Reference: CAED9pY9FZ8ihwpDvHhyxz3ec0QwTeV=FOG9zfn+LPeD6xVZUsw@mail.gmail.com -->
<!--X-Reference: CA+CBx2OEmeEWsvWNL283avhzjb1zBV3=qT&#45;N7q&#45;8Jo8Dn7WgZw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Help with settings script for R1rho analysis. -- October 22, 2013 - 15:12</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Help with settings script for R1rho analysis.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00068" class="tabs">Index by Date</a> | <a href="threads.html#00068" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00067.html">Date Prev</a>] [<a href="msg00069.html">Date Next</a>] [<a href="msg00067.html">Thread Prev</a>] [<a href="msg00075.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 22 Oct 2013 15:11:55 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date:message-id:subject	:from:to:cc:content-type:content-transfer-encoding;	bh=CscdvvT7w5fsnKDaXQbG9XsdcZw6uKb1Cm14r7o5Vc4=;	b=T2Dhy1AyIkedLn6WIb5PjjniWxJiFx3V6edq9i/kauF8zEILi14TfI/mN3wSL+IXXx	ZFSZU3fDTnpsRoUet2HKICes1NMfEXXbQDKJ/32bewS/n+aBGY424d0cklTkHg86pPBO	GQqwGxq6UB16jAhSn7tXbOIf8BBtjCgSHbbsNLVdWbw72CXowVd8+p0puGxoUuKpGMB5	T6c4YsdISMBORGRQJJC7d0ot0LLnY9n1GmpuZhjOiMEwPBSS2gZdd5NbWRQ4GcSVMfet	O0DnSC63gAa+fbIGQeVRcoJRUMSXvxDPDTP1X24BuOePX3isH51Ut5vcTIgBxMoyCGVN	Im2Q==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00068.html">CAED9pY-vYtxFYNaAtwTg-Uu+p=9cfsYeESbSQDYzusN0GmacRA@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2Otwm3tdPgfzVduw9gDZxtwjq82Y8iAp7q_OJeQ2LKZ8g@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY8QeGe=P4G+=6YD7EitmkKW82HCpTapFsnKfmCiBAZMzg@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2O=c47Fug5LwhmnFMQLxxnntDr0SHLXR3=SAW_k6bHovg@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY9FZ8ihwpDvHhyxz3ec0QwTeV=FOG9zfn+LPeD6xVZUsw@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2OEmeEWsvWNL283avhzjb1zBV3=qT-N7q-8Jo8Dn7WgZw@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on October 22, 2013 - 15:12:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

You could look at the relax code for how omega_eff is calculated.
However you will never use this - it is never input into relax.  If
you have a look at the sample_scripts/relax_disp/R1rho_analysis.py
script, you will see that all is needed is an equivalent of the table:

# The spectral data - spectrum ID, peak list file name, spin-lock
field strength (Hz), the spin-lock offset (ppm), the relaxation time
(s), spectrometer frequency (Hz), and experimental error (RMSD of the
base plane noise for each spectrum).
data = [
    ['ref_500MHz',       'ref_500MHz.list',     ,   None, 110.0, 0.1,
500e6, 200000.0]
    ['nu_1000.0_500MHz', 'nu_1000.0_500MHz.list', 1000.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_1500.0_500MHz', 'nu_1500.0_500MHz.list', 1500.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_2000.0_500MHz', 'nu_2000.0_500MHz.list', 2000.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_2500.0_500MHz', 'nu_2500.0_500MHz.list', 2500.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_3000.0_500MHz', 'nu_3000.0_500MHz.list', 3000.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_3500.0_500MHz', 'nu_3500.0_500MHz.list', 3500.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_4000.0_500MHz', 'nu_4000.0_500MHz.list', 4000.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_4500.0_500MHz', 'nu_4500.0_500MHz.list', 4500.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_5000.0_500MHz', 'nu_5000.0_500MHz.list', 5000.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_5500.0_500MHz', 'nu_5500.0_500MHz.list', 5500.0, 110.0, 0.1,
500e6, 200000.0]
    ['nu_6000.0_500MHz', 'nu_6000.0_500MHz.list', 6000.0, 110.0, 0.1,
500e6, 200000.0]
    ['ref_800MHz',       'ref_800MHz.list',     ,   None, 110.0, 0.1,
800e6, 200000.0]
    ['nu_1000.0_800MHz', 'nu_1000.0_800MHz.list', 1000.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_1500.0_800MHz', 'nu_1500.0_800MHz.list', 1500.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_2000.0_800MHz', 'nu_2000.0_800MHz.list', 2000.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_2500.0_800MHz', 'nu_2500.0_800MHz.list', 2500.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_3000.0_800MHz', 'nu_3000.0_800MHz.list', 3000.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_3500.0_800MHz', 'nu_3500.0_800MHz.list', 3500.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_4000.0_800MHz', 'nu_4000.0_800MHz.list', 4000.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_4500.0_800MHz', 'nu_4500.0_800MHz.list', 4500.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_5000.0_800MHz', 'nu_5000.0_800MHz.list', 5000.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_5500.0_800MHz', 'nu_5500.0_800MHz.list', 5500.0, 110.0, 0.1,
800e6, 200000.0]
    ['nu_6000.0_800MHz', 'nu_6000.0_800MHz.list', 6000.0, 110.0, 0.1,
800e6, 200000.0]
]

These values can be hardcoded into a script.  There is no need to do
this programatically - they will not change.  Though you could
programmatically generate such a table in a separate script, if you
wish.  You almost have this table anyway with the
exp_parameters_sort.txt file.  It is good, for sanity's sake, to have
such a complete summary table in the standard units.  As for
omega_eff, it uses the data in this table together with the chemical
shifts loaded via the chemical_shift.read user function to
automatically determine the values.  It would be best read these
shifts from one of your *.ser files.

I would recommend to use the
sample_scripts/relax_disp/R1rho_analysis.py script as a template for
your whole analysis.  For the test suite, I would recommend copying
test_suite/system_tests/scripts/relax_disp/r1rho_off_res_tp02.py and
making a few minor modifications.  For example using a table as in the
sample script.  This r1rho_off_res_tp02.py script does not have a
table as it deals with perfect synthetic data.

Regards,

Edward

On 22 October 2013 14:54, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I am digging through old perl scripts, which is preparing data for our
analysis in IgorPro.

So I guess my challenge is now to match this to the procedures of relax, and
establish the difference.

-----------
$expList=&quot;expList.txt&quot;;
$peakFile='peaks.dat';
$centerPPM=118.085;
$frq=81.050;
-----------

expList.txt contains lines with: &quot;fit_R1_filename&quot;  &quot;spin_lock_offset_HZ&quot;
&quot;spin_lock_field_Hz&quot;

----------------------
open IN, &quot;$expList&quot; or die &quot;Cannot open $expList for read&quot;;
while (&lt;IN&gt;){
@process = split (/\s+/, $_);
if ($process[0] ne &quot;#&quot;){
$fileName{$i}=$process[0];
$offset{$i}=$process[1];
$omega1{$i}=$process[2];
$i++;
};
};
close (IN);
-------------------

And then it read the peak file to extract ppm for N15.

-------------
open IN , &quot;$peakFile&quot; or die &quot;Cannot open $peakFile for read&quot;;
while (&lt;IN&gt;) {
@process = split (/\s+/, $_);
if ($process[0] eq &quot;&quot;){splice (@process, 0, 1)};
if ($process[0] == 1){ $read = 1};
if ($read == 1){
$chemShift{$process[6]}=$process[4];
};
};
close (IN);
-----------
The chemical shifts are stored in a dictionary under the residue name
($process[6]) with the ppm values of N15 ($process[4]).

Then R1r and R1r_err are read in from external exponential fit files.
------------
for ($i = 1; $i &lt;= $numFiles; $i++){
open IN, &quot;$fileName{$i}&quot; or die &quot;Cannot open $fileName{$i} for read&quot;;
while (&lt;IN&gt;){
@process = split (/\s+/, $_);
if ($process[0] ne &quot;#&quot;){
$R1r{$process[0]}{$i}=$process[1];
$R1r_err{$process[0]}{$i}=$process[2];
};
};
close(IN);
};
-------------------


Then omega is calculated.
------------
foreach $peakName (keys %chemShift) {
open (OUT, &quot;&gt;../residueFiles/$peakName.dat&quot;);
for ($i=1;$i&lt;=$numFiles;$i++){
$OMEGA=($centerPPM-$chemShift{$peakName})*$frq+$offset{$i};
$omegaEFF=sqrt($OMEGA**2+$omega1{$i}**2);
if (($omega1{$i}/$OMEGA) &gt; 0){
$theta=180/$PI*abs(atan($omega1{$i}/$OMEGA));
}else{
$theta=180-180/$PI*abs(atan($omega1{$i}/$OMEGA));
};
printf OUT &quot;%s %s %s %s %s
%s\n&quot;,$OMEGA,$omega1{$i},$omegaEFF,$theta,$R1r{$peakName}{$i},$R1r_err{$peakName}{$i};
};
close (OUT);
};
--------------

I guess I would need to find out how relax calculates omegaEFF, the
effective field in the rotating frame ?

Best
Troels




2013/10/22 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi,

Ok, I made the assumption that deltadof2 was not the spin-lock offset
(in ppm) but rather the spin-lock field strength (in Hz).  The ppm
values as printed out from the r1rho_1_ini.py script are far too low
for 15N.  They should be in the range of 100-120 ppm!  I.e. around the
15N chemical shifts.  They can be much higher and much lower for
off-resonance data, but having many at an offset of 0.0 ppm seems a
little strange.

Regards,

Edward

On 22 October 2013 13:18, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

Thanks for looking at this.

The offset for N15 spinlock is given in Hz as parameter deltadof2
for our pulse sequence.

So I guess that this conversions should be appropriate:
omega_rf_ppm = float(deltadof2) / (set_sfrq * 1E6) * 1E6

where set_sfrq=799.7773991 is the spectrometer frequency.

Best
Troels


2013/10/22 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi,

In the relax prompt, have a look at:

relax&gt; help(relax_disp.spin_lock_offset)

The unit you need is ppm.  You can find this number directly from the
Bruker acqus or Varian procpar files.  It is the ppm offset of the
spin-lock pulse which is manually set by the person recording for each
spectrum.  You may need to go to the original pulse sequence to know
which pulse this is.  It will be a fixed value for each spectrum
collected and you can use that value directly.  The calculations in
your scripts seem far to complicated and it looks like the internal
conversions performed within relax.  You should never need
gyromagnetic ratios, factors of pi, etc.  If you do, you should
probably go back to the original experiments and pull out the correct
offset number in ppm for each spectrum.  I hope this helps.

Regards,

Edward




On 22 October 2013 10:46, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I wonder if would have time to look at the settings script in:
test_suite/shared_data/dispersion/Kjaergaard_et_al_2013

It is the scripts:
r1rho_1_ini.py
r1rho_3_spectra_settings.py

In r1rho, I am unsure if I do the correct conversion from Hz to ppm
for
omega_rf.

Again, if there is hidden radian units?

It is when I set:
relax_disp.spin_lock_offset

And I wonder, how to start modifying, so R1 rates can be read per
spectra?

Best
Troels





_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>

</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00075" href="msg00075.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00063" href="msg00063.html">Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00064" href="msg00064.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00065" href="msg00065.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00066" href="msg00066.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00067" href="msg00067.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Oct 22 19:20:09 2013</div>  
</body>
</html>
