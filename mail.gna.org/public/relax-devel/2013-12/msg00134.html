<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r21949 &#45; in /trunk: lib/spectrum/sparky.py	test_suite/system_tests/peak_lists.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 12 Dec 2013 11:26:50 +0100 -->
<!--X-Message-Id: CAED9pY&#45;TPBm3zA93Eb1mahpvaeGrqCiTPnqAAFVjhpf58G59nQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Vr35l&#45;0008AF&#45;Az@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r21949 - in /trunk: lib/spectrum/sparky.py	test_suite/system_tests/peak_lists.py -- December 12, 2013 - 11:26</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r21949 - in /trunk: lib/spectrum/sparky.py	test_suite/system_tests/peak_lists.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00134" class="tabs">Index by Date</a> | <a href="threads.html#00134" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00133.html">Date Prev</a>] [<a href="msg00135.html">Date Next</a>] [<a href="msg00125.html">Thread Prev</a>] [<a href="msg00138.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 12 Dec 2013 11:26:19 +0100</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date:message-id:subject	:from:to:content-type;	bh=b3io2YAM0g1ngbO0TfZiIZ5ITGqueNdI/Z1Bmw38e8o=;	b=0zQn8vXnvWekr8O9gCyMoIG72GPaaJ2v05iQCSQnGCRnHIw/NsT+c4GHCrlnvL80pC	RR2Oue2O5Yujgp9B7TfPBm4aAkTKPWQLzUCK2kbQLJNCCbT1fzOcITble65ciqcA9YQu	p73SLtyNjoCqbR8gKZmfTq/1y5S7DA5lktvOJFfOS3px7muHC2f9+i1HxxSut2ZIYdXj	R5KUC3mNRqQ/rddFqP+0kPrKvT1titePH+9qF330GYSRR+F8WxId5jZguSBqQ7YMe84O	9A1nt9Z5NVVVme7NUAkIOGneLCswAea2NSYJBpdww2ziG+7C2RrG27ZzTO6NIjd9zs30	E+dw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00134.html">CAED9pY-TPBm3zA93Eb1mahpvaeGrqCiTPnqAAFVjhpf58G59nQ@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Vr35l-0008AF-Az@xxxxxxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on December 12, 2013 - 11:26:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

What do you think about the 3D and 4D lists, especially the code such
as &quot;res_nums=[res_num1, res_num2, res_num1, res_num1]&quot;?  This seems to
be a little counter to the algorithm you have implemented.  Maybe you
need to nest this so that if you get an residue number for the second
dimension, then you should try to get the residue number for the 3rd
and 4th dimensions, if 'dim' is set to that.  It is probably safe to
assume two formats.  One where the residue name and number is only
located in the first part, and the other where the residue name and
number is found in each part for each dimension.  But I don't have
enough experience with 3D and 4D sparky peak lists to tell.  Actually,
according to the Sparky manual you can have 'C30CA-Q31N-H':

<a  rel="nofollow" href="http://www.cgl.ucsf.edu/home/sparky/manual/images/assignlist.gif">http://www.cgl.ucsf.edu/home/sparky/manual/images/assignlist.gif</a>

That really complicates things!  That format is repeated here:

<a  rel="nofollow" href="http://www.nmr2.buffalo.edu/nesg.wiki/Sparky#Figure_5:_Sparky_peak_list">http://www.nmr2.buffalo.edu/nesg.wiki/Sparky#Figure_5:_Sparky_peak_list</a>

</pre><blockquote class="blockquote"><pre style="margin: 0em;">From these, maybe the res_num and res_name should be set to the 2nd
</pre></blockquote><pre style="margin: 0em;">dimension for the 3rd and 4th dimensions.  Here is an example where
the 3rd dimension matches the 1st:

<a  rel="nofollow" href="http://pine.nmrfam.wisc.edu/ADAPT-NMR/sparky_peak_list.htm">http://pine.nmrfam.wisc.edu/ADAPT-NMR/sparky_peak_list.htm</a>

That has a peak list which could be copied (duplicated below).  But
this has the residue number and name in the 3rd dimension to show
this.  So if the information is missing in the Nth dimension, it
should probably match the dimension N-1.  What do you think?

Regards,

Edward


P. S.  For reference, here are the peak lists from
<a  rel="nofollow" href="http://pine.nmrfam.wisc.edu/ADAPT-NMR/sparky_peak_list.htm">http://pine.nmrfam.wisc.edu/ADAPT-NMR/sparky_peak_list.htm</a>, just in
case that link disappears:


a)     Non-assigned peak list

Assignment     w1       w2        w3
   ?-?-?     7.826    32.039    116.080
   ?-?-?     9.324    29.130    116.029
   ?-?-?     8.868    36.809    127.984
   ?-?-?     8.372    58.423    118.945
   ?-?-?     8.111    28.686    120.113
   ?-?-?     8.136    32.232    119.999
   ?-?-?     9.072    52.226    118.013
   ?-?-?     6.581    40.419    111.959
   ?-?-?     7.826    59.383    116.080

b)    Assigned  peak list

           Assignment         w1         w2         w3
       C16H-K15CB-C16N      7.826     32.039    116.080
        N10H-E9CB-N10N      9.324     29.130    116.029
          V7H-K6CB-V7N      8.868     36.809    127.984
       C24H-Q23CA-C24N      8.372     58.423    118.945
       K44H-E43CB-K44N      8.111     28.686    120.113
       L30H-K29CB-L30N      8.136     32.232    119.999
       E43H-D42CA-E43N      9.072     52.226    118.013
       K32H-D31CB-K32N      6.581     40.419    111.959
       C16H-K15CA-C16N      7.826     59.383    116.080



On 12 December 2013 11:02,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Thu Dec 12 11:02:00 2013
New Revision: 21949

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=21949&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=21949&amp;view=rev</a>
Log:
Implemented to read spins from a SPARKY list, when no intensity column is 
present.

Addition to Support Request #3044, (<a  rel="nofollow" href="https://gna.org/support/index.php?3044">https://gna.org/support/index.php?3044</a>) 
- Load spins from SPARKY list.

Modified:
    trunk/lib/spectrum/sparky.py
    trunk/test_suite/system_tests/peak_lists.py

Modified: trunk/lib/spectrum/sparky.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/spectrum/sparky.py?rev=21949&amp;r1=21948&amp;r2=21949&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/lib/spectrum/sparky.py?rev=21949&amp;r1=21948&amp;r2=21949&amp;view=diff</a>
==============================================================================
--- trunk/lib/spectrum/sparky.py (original)
+++ trunk/lib/spectrum/sparky.py Thu Dec 12 11:02:00 2013
@@ -204,15 +204,29 @@
             except ValueError:
                 raise RelaxError(&quot;The peak intensity value from the line 
%s is invalid.&quot; % line)

-        # Add the assignment to the peak list object.
-        if dim == 1:
-            peak_list.add(res_nums=[res_num1], res_names=[res_name1], 
spin_names=[name1], shifts=[w1], intensity=intensity)
-        elif dim == 2:
-            peak_list.add(res_nums=[res_num1, res_num2], 
res_names=[res_name1, res_name2], spin_names=[name1, name2], shifts=[w1, 
w2], intensity=intensity)
-        elif dim == 3:
-            peak_list.add(res_nums=[res_num1, res_num2, res_num1], 
res_names=[res_name1, res_name2, res_name1], spin_names=[name1, name2, 
name3], shifts=[w1, w2, w3], intensity=intensity)
-        elif dim == 4:
-            peak_list.add(res_nums=[res_num1, res_num2, res_num1, 
res_num1], res_names=[res_name1, res_name2, res_name1, res_name1], 
spin_names=[name1, name2, name3, name4], shifts=[w1, w2, w3, w4], 
intensity=intensity)
+            # Add the assignment to the peak list object.
+            if dim == 1:
+                peak_list.add(res_nums=[res_num1], res_names=[res_name1], 
spin_names=[name1], shifts=[w1], intensity=intensity)
+            elif dim == 2:
+                peak_list.add(res_nums=[res_num1, res_num2], 
res_names=[res_name1, res_name2], spin_names=[name1, name2], shifts=[w1, 
w2], intensity=intensity)
+            elif dim == 3:
+                peak_list.add(res_nums=[res_num1, res_num2, res_num1], 
res_names=[res_name1, res_name2, res_name1], spin_names=[name1, name2, 
name3], shifts=[w1, w2, w3], intensity=intensity)
+            elif dim == 4:
+                peak_list.add(res_nums=[res_num1, res_num2, res_num1, 
res_num1], res_names=[res_name1, res_name2, res_name1, res_name1], 
spin_names=[name1, name2, name3, name4], shifts=[w1, w2, w3, w4], 
intensity=intensity)
+
+        # If no intensity column, for example when reading spins from a 
spectrum list.
+        elif int_col == None:
+            warn(RelaxWarning((&quot;The peak intensity value from the line %s 
is invalid. The return value will be without intensity.&quot; % line)))
+
+            # Add the assignment to the peak list object.
+            if dim == 1:
+                peak_list.add(res_nums=[res_num1], res_names=[res_name1], 
spin_names=[name1], shifts=[w1])
+            elif dim == 2:
+                peak_list.add(res_nums=[res_num1, res_num2], 
res_names=[res_name1, res_name2], spin_names=[name1, name2], shifts=[w1, 
w2])
+            elif dim == 3:
+                peak_list.add(res_nums=[res_num1, res_num2, res_num1], 
res_names=[res_name1, res_name2, res_name1], spin_names=[name1, name2, 
name3], shifts=[w1, w2, w3])
+            elif dim == 4:
+                peak_list.add(res_nums=[res_num1, res_num2, res_num1, 
res_num1], res_names=[res_name1, res_name2, res_name1, res_name1], 
spin_names=[name1, name2, name3, name4], shifts=[w1, w2, w3, w4])


 def write_list(file_prefix=None, dir=None, res_names=None, res_nums=None, 
atom1_names=None, atom2_names=None, w1=None, w2=None, data_height=None, 
force=True):

Modified: trunk/test_suite/system_tests/peak_lists.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/peak_lists.py?rev=21949&amp;r1=21948&amp;r2=21949&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/peak_lists.py?rev=21949&amp;r1=21948&amp;r2=21949&amp;view=diff</a>
==============================================================================
--- trunk/test_suite/system_tests/peak_lists.py (original)
+++ trunk/test_suite/system_tests/peak_lists.py Thu Dec 12 11:02:00 2013
@@ -456,6 +456,76 @@
         # Read the spins from peak list.
         self.interpreter.spectrum.read_spins(file=&quot;sparky2dim.list&quot;, 
dir=status.install_path + 
sep+'test_suite'+sep+'shared_data'+sep+'peak_lists', dim=1)
         self.interpreter.spectrum.read_spins(file=&quot;sparky2dim.list&quot;, 
dir=status.install_path + 
sep+'test_suite'+sep+'shared_data'+sep+'peak_lists', dim=2)
+
+        # Test some of the sequence.
+        self.assertEqual(len(cdp.mol), 1)
+        self.assertEqual(cdp.mol[0].name, None)
+        self.assertEqual(len(cdp.mol[0].res), 7)
+
+        # 1st residue.
+        self.assertEqual(cdp.mol[0].res[0].num, 62)
+        self.assertEqual(cdp.mol[0].res[0].name, 'W')
+        self.assertEqual(len(cdp.mol[0].res[0].spin), 2)
+        self.assertEqual(cdp.mol[0].res[0].spin[0].num, None)
+        self.assertEqual(cdp.mol[0].res[0].spin[0].name, 'NE1')
+        self.assertEqual(cdp.mol[0].res[0].spin[1].num, None)
+        self.assertEqual(cdp.mol[0].res[0].spin[1].name, 'HE1')
+
+        # 2nd residue.
+        self.assertEqual(cdp.mol[0].res[1].num, 10)
+        self.assertEqual(cdp.mol[0].res[1].name, 'L')
+        self.assertEqual(len(cdp.mol[0].res[1].spin), 2)
+        self.assertEqual(cdp.mol[0].res[1].spin[0].num, None)
+        self.assertEqual(cdp.mol[0].res[1].spin[0].name, 'N')
+        self.assertEqual(cdp.mol[0].res[1].spin[1].num, None)
+        self.assertEqual(cdp.mol[0].res[1].spin[1].name, 'HN')
+
+        # 3rd residue.
+        self.assertEqual(cdp.mol[0].res[2].num, 6)
+        self.assertEqual(cdp.mol[0].res[2].name, 'V')
+        self.assertEqual(len(cdp.mol[0].res[2].spin), 2)
+        self.assertEqual(cdp.mol[0].res[2].spin[0].num, None)
+        self.assertEqual(cdp.mol[0].res[2].spin[0].name, 'N')
+        self.assertEqual(cdp.mol[0].res[2].spin[1].num, None)
+        self.assertEqual(cdp.mol[0].res[2].spin[1].name, 'HN')
+
+        # 4th residue.
+        self.assertEqual(cdp.mol[0].res[3].num, 2)
+        self.assertEqual(cdp.mol[0].res[3].name, 'T')
+        self.assertEqual(len(cdp.mol[0].res[3].spin), 2)
+        self.assertEqual(cdp.mol[0].res[3].spin[0].num, None)
+        self.assertEqual(cdp.mol[0].res[3].spin[0].name, 'N')
+        self.assertEqual(cdp.mol[0].res[3].spin[1].num, None)
+        self.assertEqual(cdp.mol[0].res[3].spin[1].name, 'HN')
+
+        # 5th residue.
+        self.assertEqual(cdp.mol[0].res[4].num, 3)
+        self.assertEqual(cdp.mol[0].res[4].name, 'K')
+        self.assertEqual(len(cdp.mol[0].res[4].spin), 1)
+        self.assertEqual(cdp.mol[0].res[4].spin[0].num, None)
+        self.assertEqual(cdp.mol[0].res[4].spin[0].name, 'N')
+
+        # 6th residue.
+        self.assertEqual(cdp.mol[0].res[5].num, 4)
+        self.assertEqual(cdp.mol[0].res[5].name, 'A')
+        self.assertEqual(len(cdp.mol[0].res[5].spin), 1)
+        self.assertEqual(cdp.mol[0].res[5].spin[0].num, None)
+        self.assertEqual(cdp.mol[0].res[5].spin[0].name, 'N')
+
+        # 7th residue.
+        self.assertEqual(cdp.mol[0].res[6].num, 5)
+        self.assertEqual(cdp.mol[0].res[6].name, 'V')
+        self.assertEqual(len(cdp.mol[0].res[6].spin), 1)
+        self.assertEqual(cdp.mol[0].res[6].spin[0].num, None)
+        self.assertEqual(cdp.mol[0].res[6].spin[0].name, 'N')
+
+
+    def test_read_spins_peak_list_sparky_with_no_int_col(self):
+        &quot;&quot;&quot;Test the reading of spins from a Sparky peak list with no 
intensity column.&quot;&quot;&quot;
+
+        # Read the spins from peak list.
+        self.interpreter.spectrum.read_spins(file=&quot;sparky_wo_int.list&quot;, 
dir=status.install_path + 
sep+'test_suite'+sep+'shared_data'+sep+'peak_lists', dim=1)
+        self.interpreter.spectrum.read_spins(file=&quot;sparky_wo_int.list&quot;, 
dir=status.install_path + 
sep+'test_suite'+sep+'shared_data'+sep+'peak_lists', dim=2)

         # Test some of the sequence.
         self.assertEqual(len(cdp.mol), 1)


_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00138" href="msg00138.html">Re: r21949 - in /trunk: lib/spectrum/sparky.py	test_suite/system_tests/peak_lists.py</a></strong>
<ul><li><em>From:</em> Troels Emtek√¶r Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Dec 13 14:40:10 2013</div>  
</body>
</html>
