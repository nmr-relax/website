<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r3245 &#45; /1.3/generic_fns/selection.py -->
<!--X-From-R13: "Quevf [npDnvyq" <p.znpenvyqNtbbtyrznvy.pbz> -->
<!--X-Date: Thu, 12 Apr 2007 17:31:03 +0200 -->
<!--X-Message-Id: 3b3f50350704120830o2f2d4284l3454fcec4fbee3c@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: E1HWxlQ&#45;0000ED&#45;Hw@subversion.gna.org -->
<!--X-Reference: 7f080ed10703300001v5b66f9cerff78035f5b0cd09e@mail.gmail.com -->
<!--X-Reference: 1175246582.16998.91.camel@mrspell -->
<!--X-Reference: 1175621482.16998.149.camel@mrspell -->
<!--X-Reference: 7f080ed10704120056p6103fca3h7b237c91720f1727@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r3245 - /1.3/generic_fns/selection.py -- April 12, 2007 - 17:31</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r3245 - /1.3/generic_fns/selection.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00045" class="tabs">Index by Date</a> | <a href="threads.html#00045" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00041.html">Date Prev</a>] [<a href="msg00042.html">Date Next</a>] [<a href="msg00036.html">Thread Prev</a>] [<a href="msg00042.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 12 Apr 2007 16:30:15 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00045.html">3b3f50350704120830o2f2d4284l3454fcec4fbee3c@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1HWxlQ-0000ED-Hw@xxxxxxxxxxxxxxxxxx&gt;	&lt;7f080ed10703300001v5b66f9cerff78035f5b0cd09e@xxxxxxxxxxxxxx&gt;	&lt;<a href="msg00027.html">1175246582.16998.91.camel@mrspell</a>&gt;	&lt;<a href="msg00030.html">1175621482.16998.149.camel@mrspell</a>&gt;	&lt;7f080ed10704120056p6103fca3h7b237c91720f1727@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Chris MacRaild</strong> on April 12, 2007 - 17:31:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<br><div><span class="gmail_quote">On 4/12/07, <b class="gmail_sendername">Edward d&#39;Auvergne</b> &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt; wrote:</span><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
On 4/4/07, Chris MacRaild &lt;<a rel="nofollow" href="mailto:c.a.macraild@xxxxxxxxxxx">c.a.macraild@xxxxxxxxxxx</a>&gt; wrote:<br>&gt; I&#39;ve spent a bit of time in the last week or so trying to impliment<br>&gt; boolean operators in the mol-res-spin selection language. I&#39;ve come to
<br>&gt; the conclusion that this will not be possible in the current<br>&gt; implimentation of the spin loop and related functions.<br><br>I have been looking at the changes (commit by commit message) and they<br>look good.&nbsp;&nbsp;I like the idea of a selection object.&nbsp;&nbsp;A useful speed up
<br>that is made possible with this structure is that the selection string<br>could be stored and the __init__() function return without doing<br>anything if the string passed to it is the same.&nbsp;&nbsp;This would require<br>either a singleton or that the code of __init__() be shifted into
<br>another method of the object.<br><br><br>&gt; Consider the selection &quot;#Ap4Aase:4 | #RNA&quot;. We mean this to select<br>&gt; residue 4 of the molecule Ap4Aase, and all residues of the molecule RNA.<br>&gt; In the current implimentation, however, it selects all residues of both
<br>&gt; molecules. The residue_loop look like:<br>&gt;<br>&gt; for mol in data:<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp; if not mol in selection_object:<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; continue<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp; # both Ap4Aase and RNA get to here; Ap4Aase from the first clause
<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp; # of the selection, RNA from the second<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp; for res in mol.residues:<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if not res in selection_object:<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; continue<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yield res<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # All residues get here, thanks to the second clause of the
<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # selection. Because it doesn&#39;t explicitly select residues,<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # all residues are implicitly selected, and there is no way of<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # knowing which molecule res belongs to.<br><br>
We will need a new approach to the spin_loop, residue_loop, and<br>molecule_loop, that&#39;s for sure.<br><br><br>&gt; I see two solutions to the problems I&#39;m running into:<br>&gt;<br>&gt; 1) Subtly change the data structure so that each spin &#39;knows&#39; what
<br>&gt; residue it belongs to, and each residue knows what molecule it belongs<br>&gt; to. (ie. instances of the SpinContainer class have an attribute residue,<br>&gt; that is a pointer to the residue instance that contains that spin). Then
<br>&gt; restructure the spin-loop as:<br>&gt;<br>&gt; for spin in data.spins:<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp; if spin in selection_object:<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yield spin<br>&gt;<br>&gt;<br>&gt; This has a drawback in terms of efficiency, in that all spins in the
<br>&gt; data structure must be explicitly considered, whereas the current nested<br>&gt; spin-loop only considers spins that belong to selected residues, and<br>&gt; only residues of selected spins. I&#39;m not sure how much of a hit this
<br>&gt; will amount to in real situations.<br><br>I don&#39;t know if I like the idea of an object accessing back through<br>the dictionary object it belongs to followed by accessing the<br>namespace of the object holding the dictionary.&nbsp;&nbsp;There will be better
<br>ways of solving the problem.<br><br><br>&gt; 2) More radically change the implimentation of the spin loop, such that<br>&gt; it is subsumed into the Selection class. ie. instances of the selection<br>&gt; class will have a method called spin_loop (and residue_loop, and
<br>&gt; molecule_loop), which returns the equivalent iterator object. Then we<br>&gt; effectively (though not literally) do the boolean operations on the list<br>&gt; of selected spins, not on the abstract selection object.
<br>&gt;<br>&gt;<br>&gt;<br>&gt; Clearly option 2 is a more radical departure from the agreed design, but<br>&gt; it is likely to have better performance characteristics. Any thoughts on<br>&gt; the best way forward?<br><br>
I prefer option 2.&nbsp;&nbsp;However I would prefer another approach so that<br>someone can just import the spin_loop function from the<br>&#39;generic_fns.selection&#39; module and utilise it without needing to set<br>up the Selection object.&nbsp;&nbsp;It would simplify the API.&nbsp;&nbsp;Although another
<br>idea would be to implement the Selection.test() function (or a<br>function with a more appropriate name).&nbsp;&nbsp;This function could accept<br>the mol, res, and spin containers and hence have access to all the<br>info about that spin.&nbsp;&nbsp;Then the spin_loop would become:
<br><br>def spin_loop(selection=None):<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Generator function for looping over all the spin systems of the<br>given selection.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;@param selection:&nbsp;&nbsp; The spin system selection identifier.<br>&nbsp;&nbsp;&nbsp;&nbsp;@type selection:&nbsp;&nbsp;&nbsp;&nbsp;str
<br>&nbsp;&nbsp;&nbsp;&nbsp;@return:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The
spin system specific data container.<br>&nbsp;&nbsp;&nbsp;&nbsp;@rtype:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
instance of the SpinContainer class.<br>&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;# Parse the selection string.<br>&nbsp;&nbsp;&nbsp;&nbsp;select_obj = Selection(selection)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;# Loop over the molecules.<br>&nbsp;&nbsp;&nbsp;&nbsp;for mol in relax_data_store[relax_data_store.current_pipe].mol:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Skip the molecule if there is no match to the selection.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if not select_obj.test(mol):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Loop over the residues.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for res in mol.res:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#
Skip the residue if there is no match to the selection.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if not select_obj.test(mol, res):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Loop over the spins.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for spin in res.spin:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#
Skip the spin if there is no match to the selection.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if
not select_obj.test(mol, res, spin):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#
Yield the spin system data container.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield spin<br><br>The test function could then iterate over each part of the selection<br>string delineated by boolean operators and brackets and return True or<br>
False as necessary.&nbsp;&nbsp;What do you think of this idea Chris?</blockquote><div><br>
This should be reasonably easy to impliment. A couple of immediate
questions: should we ever allow the simpler syntax
select_obj.test(spin) (ie. without the mol, res arguments). My feeling
is that this will just lead to confusion, and should not be allowed,
but perhaps there is an important application for such a call that I&#39;ve
not anticipated? Also, we could impliment this same functionality
inside the __contains__ method of the Selection class, using tuples as
appropriate. so we would have:<br>
<br>
&nbsp; if (mol, res, spin) in select_obj:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>
<br>
rather than a seperate test method. This might give a bit more clarity, perhaps?<br>
<br>
<br>
I&#39;m also in the process of changing labs (and continents), so probably
won&#39;t have a chance to impliment anything in the next couple of weeks.
If the job still needs doing when I&#39;m back on my feet I&#39;ll have a hack
at it then.<br>
<br>
<br>
Chris<br>
<br>
</div><br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">Regards,<br><br>Edward<br><br></blockquote></div><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00042" href="msg00042.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00015" href="msg00015.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00027" href="msg00027.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00030" href="msg00030.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00036" href="msg00036.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Apr 13 16:00:25 2007</div>  
</body>
</html>
