<!-- MHonArc v2.6.16 -->
<!--X-Subject: r18405 &#45; in /branches/frame_order_testing: ./ gui/ gui/analyses/	test_suite/gui_tests/ test_suite/shared_data/saved_states/ -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Mon, 04 Feb 2013 18:17:35 +0100 -->
<!--X-Message-Id: E1U2Pfj&#45;0004if&#45;Tp@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r18405 - in /branches/frame_order_testing: ./ gui/ gui/analyses/	test_suite/gui_tests/ test_suite/shared_data/saved_states/ -- February 04, 2013 - 18:17</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r18405 - in /branches/frame_order_testing: ./ gui/ gui/analyses/	test_suite/gui_tests/ test_suite/shared_data/saved_states/</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00077" class="tabs">Index by Date</a> | <a href="threads.html#00077" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00076.html">Date Prev</a>] [<a href="msg00078.html">Date Next</a>] [<a href="msg00076.html">Thread Prev</a>] [<a href="msg00078.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Mon, 04 Feb 2013 17:17:35 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00077.html">E1U2Pfj-0004if-Tp@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on February 04, 2013 - 18:17:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Mon Feb  4 18:17:35 2013
New Revision: 18405

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=18405&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=18405&amp;view=rev</a>
Log:
Merged revisions 18401-18404 via svnmerge from 
svn+ssh://bugman@xxxxxxxxxxx/svn/relax/trunk

........
  r18401 | bugman | 2013-02-04 17:55:53 +0100 (Mon, 04 Feb 2013) | 9 lines
  
  Created the State.test_bug_20480 system test to catch bug #20480 
(<a  rel="nofollow" href="https://gna.org/bugs/?20480">https://gna.org/bugs/?20480</a>).
  
  This bug was reported by Stanislava Panova (<a  rel="nofollow" href="https://gna.org/users/stacy">https://gna.org/users/stacy</a>).  
The file
  test_suite/shared_data/saved_states/bug_20480.bz2 is the same as that 
attached to the bug report but
  with all residues except for 9 and 10 deleted.
  
  Currently the bug is not triggered!
........
  r18402 | bugman | 2013-02-04 17:59:01 +0100 (Mon, 04 Feb 2013) | 7 lines
  
  Fix for the failed loading of states in the GUI.
  
  This problem was caught by the State.test_bug_20480 GUI test.  If the 
loading of a state file fails,
  sometimes the relax data store can contain partial information from that 
file.  Now if the loading
  fails in the GUI, relax is reset.
........
  r18403 | bugman | 2013-02-04 17:59:30 +0100 (Mon, 04 Feb 2013) | 3 lines
  
  Removed a debugging line from the State.test_bug_20480 GUI test.
........
  r18404 | bugman | 2013-02-04 18:10:32 +0100 (Mon, 04 Feb 2013) | 10 lines
  
  Fix for bug #20480 (<a  rel="nofollow" href="https://gna.org/bugs/?20480">https://gna.org/bugs/?20480</a>).
  
  This was reported by Stanislava Panova (<a  rel="nofollow" href="https://gna.org/users/stacy">https://gna.org/users/stacy</a>).
  
  The problem was that the state file was saved after a RelaxError occurred 
during the model-free
  analysis.  The GUI data store information states that the active data pipe 
is called 'final'.  But
  an error occurred prior to the 'final' data pipe being created.  The fix 
was to allow the state to
  be loaded even if the GUI data store information has been corrupted.
........

Added:
    
branches/frame_order_testing/test_suite/shared_data/saved_states/bug_20480.bz2
      - copied unchanged from r18404, 
trunk/test_suite/shared_data/saved_states/bug_20480.bz2
Modified:
    branches/frame_order_testing/   (props changed)
    branches/frame_order_testing/gui/analyses/base.py
    branches/frame_order_testing/gui/relax_gui.py
    branches/frame_order_testing/test_suite/gui_tests/state.py

Propchange: branches/frame_order_testing/
------------------------------------------------------------------------------
--- svnmerge-integrated (original)
+++ svnmerge-integrated Mon Feb  4 18:17:35 2013
@@ -1,1 +1,1 @@
-/trunk:1-18399
+/trunk:1-18404

Modified: branches/frame_order_testing/gui/analyses/base.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/gui/analyses/base.py?rev=18405&amp;r1=18404&amp;r2=18405&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/gui/analyses/base.py?rev=18405&amp;r1=18404&amp;r2=18405&amp;view=diff</a>
==============================================================================
--- branches/frame_order_testing/gui/analyses/base.py (original)
+++ branches/frame_order_testing/gui/analyses/base.py Mon Feb  4 18:17:35 2013
@@ -1,7 +1,7 @@
 
###############################################################################
 #                                                                            
 #
 # Copyright (C) 2009 Michael Bieri                                           
 #
-# Copyright (C) 2010-2012 Edward d'Auvergne                                  
 #
+# Copyright (C) 2010-2013 Edward d'Auvergne                                  
 #
 #                                                                            
 #
 # This file is part of the program relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>).         
 #
 #                                                                            
 #
@@ -31,7 +31,7 @@
  
 # relax module imports.
 from generic_fns.mol_res_spin import count_spins
-from generic_fns.pipes import cdp_name
+from generic_fns.pipes import cdp_name, has_pipe
 from user_functions.data import Uf_info; uf_info = Uf_info()
 from user_functions.data import Uf_tables; uf_tables = Uf_tables()
 
@@ -448,7 +448,10 @@
             pipe = cdp_name()
 
         # The count.
-        num = count_spins(pipe=pipe)
+        if not has_pipe(pipe):
+            num = 0
+        else:
+            num = count_spins(pipe=pipe)
 
         # Return the formatted string.
         return &quot;%s spins loaded and selected&quot; % num

Modified: branches/frame_order_testing/gui/relax_gui.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/gui/relax_gui.py?rev=18405&amp;r1=18404&amp;r2=18405&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/gui/relax_gui.py?rev=18405&amp;r1=18404&amp;r2=18405&amp;view=diff</a>
==============================================================================
--- branches/frame_order_testing/gui/relax_gui.py (original)
+++ branches/frame_order_testing/gui/relax_gui.py Mon Feb  4 18:17:35 2013
@@ -846,6 +846,9 @@
 
             # File loading failure.
             else:
+                # Reset relax to clear any partially loaded data.
+                reset()
+
                 # Reinitialise the GUI data store structure.
                 self.init_data()
 

Modified: branches/frame_order_testing/test_suite/gui_tests/state.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/test_suite/gui_tests/state.py?rev=18405&amp;r1=18404&amp;r2=18405&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/test_suite/gui_tests/state.py?rev=18405&amp;r1=18404&amp;r2=18405&amp;view=diff</a>
==============================================================================
--- branches/frame_order_testing/test_suite/gui_tests/state.py (original)
+++ branches/frame_order_testing/test_suite/gui_tests/state.py Mon Feb  4 
18:17:35 2013
@@ -37,6 +37,21 @@
 
 class State(GuiTestCase):
     &quot;&quot;&quot;Class for testing various aspects specific to saved states.&quot;&quot;&quot;
+
+    def test_bug_20480(self):
+        &quot;&quot;&quot;Catch bug #20480 (<a  rel="nofollow" href="https://gna.org/bugs/?20480">https://gna.org/bugs/?20480</a>), the failure to 
load a relax state in the GUI.&quot;&quot;&quot;
+
+        # Simulate the 'Open relax state' menu entry.
+        file = status.install_path + sep + 'test_suite' + sep + 
'shared_data' + sep + 'saved_states' + sep + 'bug_20480.bz2'
+        self.app.gui.state_load(file_name=file)
+
+        # Check that the data has been loaded.
+        self.assertEqual(cdp_name(), &quot;aic - mf (Mon Feb  4 13:30:01 2013)&quot;)
+        self.assertEqual(cdp.frq['NOE_800'], 800000031.0)
+        self.assertEqual(cdp.frq['R1_800'], 800000031.0)
+        self.assertEqual(cdp.frq['R2_800'], 800000031.0)
+        self.assertEqual(cdp.frq['R2_600'], 599999000.0)
+
 
     def test_old_state_loading(self):
         &quot;&quot;&quot;Test the loading of an old relax 1.3 save state with GUI 
information.&quot;&quot;&quot;



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Feb 04 18:40:02 2013</div>  
</body>
</html>
