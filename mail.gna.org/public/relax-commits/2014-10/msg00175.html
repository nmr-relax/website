<!-- MHonArc v2.6.18 -->
<!--X-Subject: r26279 &#45; in /branches/frame_order_cleanup: ./ pipe_control/ test_suite/system_tests/ -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Tue, 14 Oct 2014 13:44:21 +0200 -->
<!--X-Message-Id: E1Xe0Wb&#45;0008Pn&#45;Kk@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r26279 - in /branches/frame_order_cleanup: ./ pipe_control/ test_suite/system_tests/ -- October 14, 2014 - 13:44</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r26279 - in /branches/frame_order_cleanup: ./ pipe_control/ test_suite/system_tests/</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00175" class="tabs">Index by Date</a> | <a href="threads.html#00175" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00174.html">Date Prev</a>] [<a href="msg00176.html">Date Next</a>] [<a href="msg00174.html">Thread Prev</a>] [<a href="msg00176.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Tue, 14 Oct 2014 11:44:21 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00175.html">E1Xe0Wb-0008Pn-Kk@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on October 14, 2014 - 13:44:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Tue Oct 14 13:44:21 2014
New Revision: 26279

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=26279&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=26279&amp;view=rev</a>
Log:
Merged revisions 26261-26267 via svnmerge from 
svn+ssh://bugman@xxxxxxxxxxx/svn/relax/trunk

........
  r26261 | tlinnet | 2014-10-13 18:19:34 +0200 (Mon, 13 Oct 2014) | 1 line
  
  Inserted a z_axis limit for the plotting of 2D surfaces in matplotlib.
........
  r26262 | tlinnet | 2014-10-13 18:19:36 +0200 (Mon, 13 Oct 2014) | 1 line
  
  Added better figure control of chi2 values on z-axis for surface plots.
........
  r26263 | tlinnet | 2014-10-13 18:19:38 +0200 (Mon, 13 Oct 2014) | 5 lines
  
  Narrowed in dx_map in systemtest 
Relax_disp.test_dx_map_clustered_create_par_file()
  
  This is to illustrate the failure of relax finding the global minimum.
  
  It seems there is a shallow barrier, which relax failed to climb over, in 
order to find the minimum value.
........
  r26264 | bugman | 2014-10-13 19:07:30 +0200 (Mon, 13 Oct 2014) | 3 lines
  
  Removed a debugging printout.
........
  r26265 | bugman | 2014-10-13 22:57:11 +0200 (Mon, 13 Oct 2014) | 6 lines
  
  Added the verbosity argument to the pipe_control.minimise.reset_min_stats() 
function.
  
  All of the minimisation code which calls this now send in their verbosity 
arguments.  This allows
  the text &quot;Resetting the minimisation statistics.&quot; to be suppressed.
........
  r26266 | bugman | 2014-10-13 22:58:22 +0200 (Mon, 13 Oct 2014) | 6 lines
  
  Added the verbosity argument to the pipe_control.value.set() function.
  
  This is passed into the pipe_control.minimise.reset_min_stats() function so 
its printouts can be
  silenced.
........
  r26267 | bugman | 2014-10-13 22:59:51 +0200 (Mon, 13 Oct 2014) | 6 lines
  
  The pipe_control.opendx space mapping code now calls the value.set() 
function with verbosity=0.
  
  This is to silence the very repetitive statistics resetting messages when 
executing the dx.map user
  function.
........

Modified:
    branches/frame_order_cleanup/   (props changed)
    branches/frame_order_cleanup/pipe_control/minimise.py
    branches/frame_order_cleanup/pipe_control/opendx.py
    branches/frame_order_cleanup/pipe_control/value.py
    branches/frame_order_cleanup/test_suite/system_tests/palmer.py
    branches/frame_order_cleanup/test_suite/system_tests/relax_disp.py

Propchange: branches/frame_order_cleanup/
------------------------------------------------------------------------------
--- svnmerge-integrated (original)
+++ svnmerge-integrated Tue Oct 14 13:44:21 2014
@@ -1 +1 @@
-/trunk:1-26205,26208-26260
+/trunk:1-26278

Modified: branches/frame_order_cleanup/pipe_control/minimise.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/pipe_control/minimise.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/pipe_control/minimise.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff</a>
==============================================================================
--- branches/frame_order_cleanup/pipe_control/minimise.py       (original)
+++ branches/frame_order_cleanup/pipe_control/minimise.py       Tue Oct 14 
13:44:21 2014
@@ -96,7 +96,7 @@
     check_pipe()
 
     # Reset the minimisation statistics.
-    reset_min_stats()
+    reset_min_stats(verbosity=verbosity)
 
     # The specific analysis API object.
     api = return_api()
@@ -183,7 +183,7 @@
         # Loop over the simulations.
         for i in range(cdp.sim_number):
             # Reset the minimisation statistics.
-            reset_min_stats(sim_index=i)
+            reset_min_stats(sim_index=i, verbosity=verbosity)
 
             # Status.
             if status.current_analysis:
@@ -207,7 +207,7 @@
     # Grid search.
     else:
         # Reset the minimisation statistics.
-        reset_min_stats()
+        reset_min_stats(verbosity=verbosity)
 
         # Optimise.
         api.grid_search(lower=model_lower, upper=model_upper, inc=model_inc, 
scaling_matrix=scaling_matrix, constraints=constraints, verbosity=verbosity)
@@ -489,7 +489,7 @@
     # Single Monte Carlo simulation.
     if sim_index != None:
         # Reset the minimisation statistics.
-        reset_min_stats(sim_index=sim_index)
+        reset_min_stats(sim_index=sim_index, verbosity=verbosity)
 
         # Optimise.
         api.minimise(min_algor=min_algor, min_options=min_options, 
func_tol=func_tol, grad_tol=grad_tol, max_iterations=max_iter, 
constraints=constraints, scaling_matrix=scaling_matrix, verbosity=verbosity, 
sim_index=sim_index)
@@ -498,7 +498,7 @@
     elif hasattr(cdp, 'sim_state') and cdp.sim_state == 1:
         for i in range(cdp.sim_number):
             # Reset the minimisation statistics.
-            reset_min_stats(sim_index=i)
+            reset_min_stats(sim_index=i, verbosity=verbosity)
 
             # Status.
             if status.current_analysis:
@@ -522,7 +522,7 @@
     # Standard minimisation.
     else:
         # Reset the minimisation statistics.
-        reset_min_stats()
+        reset_min_stats(verbosity=verbosity)
 
         # Optimise.
         api.minimise(min_algor=min_algor, min_options=min_options, 
func_tol=func_tol, grad_tol=grad_tol, max_iterations=max_iter, 
constraints=constraints, scaling_matrix=scaling_matrix, verbosity=verbosity)
@@ -531,13 +531,15 @@
     processor.run_queue()
 
 
-def reset_min_stats(data_pipe=None, sim_index=None):
+def reset_min_stats(data_pipe=None, sim_index=None, verbosity=1):
     &quot;&quot;&quot;Function for resetting all minimisation statistics.
 
     @keyword data_pipe:     The name of the data pipe to reset the 
minimisation statistics of.  This defaults to the current data pipe.
     @type data_pipe:        str
     @keyword sim_index:     The optional Monte Carlo simulation index.
     @type sim_index:        int
+    @keyword verbosity:     The amount of information to print.  The higher 
the value, the greater the verbosity.
+    @type verbosity:        int
     &quot;&quot;&quot;
 
     # The data pipe.
@@ -600,7 +602,7 @@
                         sim_obj[sim_index] = None
 
     # Printout.
-    if flag and sim_index == None:
+    if verbosity and flag and sim_index == None:
         print(&quot;Resetting the minimisation statistics.&quot;)
 
 

Modified: branches/frame_order_cleanup/pipe_control/opendx.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/pipe_control/opendx.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/pipe_control/opendx.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff</a>
==============================================================================
--- branches/frame_order_cleanup/pipe_control/opendx.py (original)
+++ branches/frame_order_cleanup/pipe_control/opendx.py Tue Oct 14 13:44:21 
2014
@@ -356,9 +356,9 @@
                 for k in range((self.inc + 1)):
                     # Set the parameter values.
                     if self.spin_id:
-                        value.set(val=values, param=self.params, 
spin_id=self.spin_id, force=True)
+                        value.set(val=values, param=self.params, 
spin_id=self.spin_id, verbosity=0, force=True)
                     else:
-                        value.set(val=values, param=self.params, force=True)
+                        value.set(val=values, param=self.params, 
verbosity=0, force=True)
 
                     # Calculate the function values.
                     if self.spin_id:
@@ -470,6 +470,7 @@
         plot_file = open_write_file(file_name=self.file_prefix+'.py', 
dir=self.dir, force=True)
 
         matplotlib_file = [
+            'from copy import deepcopy'+&quot;\n&quot;,
             'import numpy as np'+&quot;\n&quot;,
             'import scipy.interpolate'+&quot;\n&quot;,
             'from numpy.ma import masked_where'+&quot;\n&quot;,
@@ -565,21 +566,24 @@
             '    # Set which x, y, z to plot'+&quot;\n&quot;,
             '    x_p = xi'+&quot;\n&quot;,
             '    y_p = yi'+&quot;\n&quot;,
-            '    c_p = ci'+&quot;\n&quot;,
+            '    c_p = deepcopy(ci)'+&quot;\n&quot;,
             ''+&quot;\n&quot;,
             '    # Cut map at a certain height.'+&quot;\n&quot;,
             '    # First get index os largest values'+&quot;\n&quot;,
-            '    #out_val = 5*map_mask_c_min'+&quot;\n&quot;,
-            '    out_val = map_mask_c_max'+&quot;\n&quot;,
-            '    ci_mask = masked_where(ci &gt;= out_val, ci)'+&quot;\n&quot;,
+            '    #z_max = map_mask_c_max'+&quot;\n&quot;,
+            '    z_max = map_mask_c_min + 0.5*map_mask_c_min'+&quot;\n&quot;,
+            '    ci_mask = masked_where(ci &gt;= z_max, ci)'+&quot;\n&quot;,
             ''+&quot;\n&quot;,
             '    # Replace with 0.0'+&quot;\n&quot;,
-            '    ci[ci_mask.mask] = 0.0'+&quot;\n&quot;,
+            '    c_p[ci_mask.mask] = 0.0'+&quot;\n&quot;,
             '    # Find new max'+&quot;\n&quot;,
-            '    new_max = np.max(ci)'+&quot;\n&quot;,
+            '    new_max = np.max(c_p)'+&quot;\n&quot;,
             ''+&quot;\n&quot;,
             '    # Insert values in array.'+&quot;\n&quot;,
-            '    ci[ci_mask.mask] = new_max'+&quot;\n&quot;,
+            '    c_p[ci_mask.mask] = new_max'+&quot;\n&quot;,
+            ''+&quot;\n&quot;,
+            '    # Define min.'+&quot;\n&quot;,
+            '    z_min = map_mask_c_min - 0.5*map_mask_c_min'+&quot;\n&quot;,
             ''+&quot;\n&quot;,
             '    # Create figure and plot'+&quot;\n&quot;,
             '    ax = fig.add_subplot(nr_rows, nr_cols, 1, 
projection=&quot;3d&quot;)'+&quot;\n&quot;,
@@ -592,7 +596,7 @@
             '    ##ax.scatter(x_p, y_p, c_p, c=&quot;y&quot;, marker=&quot;o&quot;, s=5)'+&quot;\n&quot;,
             ''+&quot;\n&quot;,
             '    # Add contour levels on sides.'+&quot;\n&quot;,
-            '    ax.contour(x_p, y_p, c_p, zdir=&quot;z&quot;, offset=0, 
cmap=cm.coolwarm)'+&quot;\n&quot;,
+            '    ax.contour(x_p, y_p, c_p, zdir=&quot;z&quot;, offset=z_min, 
cmap=cm.coolwarm)'+&quot;\n&quot;,
             '    ax.contour(x_p, y_p, c_p, zdir=&quot;x&quot;, offset=map_mask_x_min, 
cmap=cm.coolwarm)'+&quot;\n&quot;,
             '    ax.contour(x_p, y_p, c_p, zdir=&quot;y&quot;, offset=map_mask_y_min, 
cmap=cm.coolwarm)'+&quot;\n&quot;,
             ''+&quot;\n&quot;,
@@ -651,6 +655,11 @@
             '    ax.set_ylabel(&quot;%s&quot;%y_par)'+&quot;\n&quot;,
             '    ax.set_zlabel(&quot;%s&quot;%c_par)'+&quot;\n&quot;,
             ''+&quot;\n&quot;,
+            ''+&quot;\n&quot;,
+            '    # Set limits'+&quot;\n&quot;,
+            '    ax.set_zlim(z_min, z_max)'+&quot;\n&quot;,
+            ''+&quot;\n&quot;,
+            ''+&quot;\n&quot;,
             '    # Create figure and plot'+&quot;\n&quot;,
             '    ax = fig.add_subplot(nr_rows, nr_cols, 2)'+&quot;\n&quot;,
             '    fig_imshow = ax.imshow(ci, vmin=map_mask_c_min, 
vmax=map_mask_c_max, origin=&quot;lower&quot;, extent=[map_mask_x_min, map_mask_x_max, 
map_mask_y_min, map_mask_y_max])'+&quot;\n&quot;,

Modified: branches/frame_order_cleanup/pipe_control/value.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/pipe_control/value.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/pipe_control/value.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff</a>
==============================================================================
--- branches/frame_order_cleanup/pipe_control/value.py  (original)
+++ branches/frame_order_cleanup/pipe_control/value.py  Tue Oct 14 13:44:21 
2014
@@ -351,7 +351,7 @@
         minimise.reset_min_stats()
 
 
-def set(val=None, param=None, index=None, pipe=None, spin_id=None, 
error=False, force=True, reset=True):
+def set(val=None, param=None, index=None, pipe=None, spin_id=None, 
verbosity=1, error=False, force=True, reset=True):
     &quot;&quot;&quot;Set global or spin specific data values.
 
     @keyword val:       The parameter values.
@@ -364,6 +364,8 @@
     @type pipe:         None or str
     @keyword spin_id:   The spin identification string.
     @type spin_id:      str
+    @keyword verbosity: The amount of information to print.  The higher the 
value, the greater the verbosity.
+    @type verbosity:    int
     @keyword error:     A flag which if True will allow the parameter errors 
to be set instead of the values.
     @type error:        bool
     @keyword force:     A flag forcing the overwriting of current values.
@@ -425,7 +427,7 @@
 
     # Reset all minimisation statistics.
     if reset:
-        minimise.reset_min_stats()
+        minimise.reset_min_stats(verbosity=verbosity)
 
     # Switch back.
     if pipe:

Modified: branches/frame_order_cleanup/test_suite/system_tests/palmer.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/test_suite/system_tests/palmer.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/test_suite/system_tests/palmer.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff</a>
==============================================================================
--- branches/frame_order_cleanup/test_suite/system_tests/palmer.py      
(original)
+++ branches/frame_order_cleanup/test_suite/system_tests/palmer.py      Tue 
Oct 14 13:44:21 2014
@@ -225,7 +225,6 @@
 
                 # Get the spin.
                 spin = return_spin(spin_names[spin_index], 
pipe=models[model_index])
-                print spin
 
                 # Conversions.
                 if rex[model_index][spin_index]:

Modified: branches/frame_order_cleanup/test_suite/system_tests/relax_disp.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/test_suite/system_tests/relax_disp.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/test_suite/system_tests/relax_disp.py?rev=26279&amp;r1=26278&amp;r2=26279&amp;view=diff</a>
==============================================================================
--- branches/frame_order_cleanup/test_suite/system_tests/relax_disp.py  
(original)
+++ branches/frame_order_cleanup/test_suite/system_tests/relax_disp.py  Tue 
Oct 14 13:44:21 2014
@@ -3204,9 +3204,7 @@
         self.assertAlmostEqual(pre_chi2, calc_chi2)
 
         # Define dx.map settings.
-        dx_inc = 2
-        dx_inc_sides = dx_inc / 2
-
+        dx_inc = 5
         dx_params = ['dw', 'k_AB', 'r2a']
         dx_point_clustered_min = [cur_spin.dw, cur_spin.k_AB, 
cur_spin.r2a['SQ CPMG - 499.86214000 MHz']]
 
@@ -3220,36 +3218,15 @@
         file_name_map = &quot;%s_map%s&quot; % (cur_model, cur_spin_id_str)
         file_name_point = &quot;%s_point%s&quot; % (cur_model, cur_spin_id_str)
 
-        # Step-size of parameter is 10 %
-        param_delta = 0.1
-
         # Determine bounds for lower and upper
-        #lower = [0.0, 0.0, 5.0]
-        #upper = [20.0, 6.0, 15.0]
-
-        lower = []
-        upper = []
-        for i, param_val in enumerate(dx_point_clustered_min):
-            param = dx_params[i]
-            step_val = param_delta * param_val
-            step_length = step_val * dx_inc_sides
-
-            # Calculate value
-            low_val = param_val - step_length
-            lower.append(low_val)
-
-            upp_val = param_val + step_length
-            upper.append(upp_val)
-
-            print(&quot;For param %s, lower=%3.3f, upper=%3.3f, step_value=%3.3f, 
steps=%i, centered at=%3.3f&quot;% (param, low_val, upp_val, step_val, dx_inc, 
param_val))
+        lower = [dx_point_clustered_min[0], dx_point_clustered_min[1], 
dx_point_clustered_min[2]]
+        upper = [19.0, 2.4, 9.5]
 
         # Define temporary folder.
         result_dir = self.tmpdir
 
         # For testing.
         #result_dir = None
-        #lower = None
-        #upper = None
         #self.interpreter.relax_disp.cluster(cluster_id='free spins', 
spin_id=cur_spin_id)
 
         # Then do the map.



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Oct 14 18:00:02 2014</div>  
</body>
</html>
