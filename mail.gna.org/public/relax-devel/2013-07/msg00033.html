<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: numerical cpmg fit -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 15 Jul 2013 10:30:18 +0200 -->
<!--X-Message-Id: CAED9pY_kXeq2wTeG=iFDz6ey_h086=b0p1OO7mO0SfzDSaevoA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 35036407&#45;39A6&#45;4B59&#45;B529&#45;7074D5F10DBA@gmx.at -->
<!--X-Reference: CAED9pY_zKf+1kML6UNezswM1NQtvZh7n7Jdz_Ss1H5Kn2cj5kw@mail.gmail.com -->
<!--X-Reference: CAED9pY9HUHQ1X6zQpY8CmPR3NFoSXJwgeP02Nme1Y447&#45;6U9RQ@mail.gmail.com -->
<!--X-Reference: CAED9pY_cN9pSyBX2F+ji1gYHN7RkwY72PwE4_&#45;8dEVNU&#45;4R1jg@mail.gmail.com -->
<!--X-Reference: 390EF589&#45;7B7E&#45;466A&#45;BE67&#45;021D16E7E12B@gmx.at -->
<!--X-Reference: CAED9pY8cqOqAhYDFxVCK+Sm8rJ7=p8GFPwKTHwdzg2U8DZsd_w@mail.gmail.com -->
<!--X-Reference: 0B2A8433&#45;C5BE&#45;4388&#45;A04C&#45;9AF1D365A60D@gmx.at -->
<!--X-Reference: 31C0AA64&#45;20F3&#45;4A55&#45;AC58&#45;2E332C675ADE@gmx.at -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: numerical cpmg fit -- July 15, 2013 - 10:30</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: numerical cpmg fit</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00033" class="tabs">Index by Date</a> | <a href="threads.html#00033" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00032.html">Date Prev</a>] [<a href="msg00034.html">Date Next</a>] [<a href="msg00031.html">Thread Prev</a>] [<a href="msg00032.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Paul Schanda &lt;paul.schanda@xxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 15 Jul 2013 10:29:43 +0200</li>
<li class="menuitem">
<em>Cc</em>: mathilde lescanne &lt;mathilde.lescanne@xxxxxxxxx&gt;,	&quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date	:x-google-sender-auth:message-id:subject:from:to:cc:content-type;	bh=tj9SkyEEUUeHaRLGjSeSz0Vi7HsN+p1NNpdtXrEsAvo=;	b=v12Fzj3ShWCz5ROhskypF9UGEL8Ny09vsM2cD2ThOSWSET8iBcp7ke93EPmVRc0GzD	99YzbCFnoZVAuNAJLKR6oco2yBfXmlbfRjdC7Z3RgmGGbSW9yCOv1w3/7fLDMapCK7Gy	ArN81Sa2pmUjbvih3bbaZYMsUFoeYK/iFNUT/cx2Gan6LXlkK0zjMcLqDvxLF9qb62uh	CEcV1z1eKgqaguwE7nubHn/vQNk4w6zVuKZ31OY64wZd8cpM5LNlBTS7bachcDblSUKM	981taT46G6yk7dimoO/t1Crz+8oUDPtFMDJbkudB/tM1lWuaH9l8Z31nPKdhZ487+a8+	DrHg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00033.html">CAED9pY_kXeq2wTeG=iFDz6ey_h086=b0p1OO7mO0SfzDSaevoA@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;35036407-39A6-4B59-B529-7074D5F10DBA@xxxxxx&gt;	&lt;CAED9pY_zKf+1kML6UNezswM1NQtvZh7n7Jdz_Ss1H5Kn2cj5kw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY9HUHQ1X6zQpY8CmPR3NFoSXJwgeP02Nme1Y447-6U9RQ@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY_cN9pSyBX2F+ji1gYHN7RkwY72PwE4_-8dEVNU-4R1jg@xxxxxxxxxxxxxx&gt;	&lt;390EF589-7B7E-466A-BE67-021D16E7E12B@xxxxxx&gt;	&lt;CAED9pY8cqOqAhYDFxVCK+Sm8rJ7=p8GFPwKTHwdzg2U8DZsd_w@xxxxxxxxxxxxxx&gt;	&lt;0B2A8433-C5BE-4388-A04C-9AF1D365A60D@xxxxxx&gt;	&lt;31C0AA64-20F3-4A55-AC58-2E332C675ADE@xxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on July 15, 2013 - 10:30:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

</pre><blockquote class="blockquote"><pre style="margin: 0em;">I should also comment the matrices, in addition to the other comments.
</pre></blockquote><pre style="margin: 0em;">

I think the code in lib/dispersion/ns_2site_star.py is now excellently
documented.  A novice NMR user can now learn everything from it!  I
don't think that anything else is needed, though see what you think.
Note that this code is currently evolving.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Edward, I also have a question to line 75: where does the factor 2 come 
from? that was not in the original version.
I don't see what it does. I think it should not be there.
</pre></blockquote><pre style="margin: 0em;">

I shifted it from the inside of the for loop.  Specifically the
original expression &quot;sci.expm(cR*2.*tcp))&quot; has been changed to
&quot;expm(cR2*tcp))&quot;, where cR2 is cR pre-multiplied by 2.  This decreases
the number of cR*2. multiplications from the number of dispersion
points to 1.  It is just one of a number of small speed ups.

I plan on identifying more places in the code where calculations can
be shifted up the code chain to absolutely minimise the total number
of mathematical operations.  For example I am shifting some
calculations outside of the
lib.dispersion.ns_2site_star.r2eff_ns_2site_star() function to be
inside the func_ns_2site_star() target function of the
target_functions.relax_disp.Dispersion class.  This is to minimise
calculations for each spin in the cluster and magnetic field strength,
i.e. the number of calculations drops from N_spins*N_B0 to 1.  For
large spin clusters this is significant.

Another speed up used within relax target functions is the matrix
creation.  Currently this involves first automatic memory allocation
at the start of each call followed by memory deallocation.  The way
this is handled in relax is that when the target function class is
initialised, then all of the needed matrices are initialised.  Then
the target function calls just update the pre-existing matrices.  This
often has a significant effect on optimisation speed by minimising the
calls to the Python garbage collection and memory allocation routines.
 In some cases, scalar multiplication and dot products for example, a
new matrix is created automatically hence this trick cannot always be
used (though faster alternatives can be created if desired).

Cheers,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00010" href="msg00010.html">numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Paul Schanda</li></ul></li>
<li><strong><a name="00011" href="msg00011.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00012" href="msg00012.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00017" href="msg00017.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00018" href="msg00018.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Paul Schanda</li></ul></li>
<li><strong><a name="00025" href="msg00025.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00030" href="msg00030.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Paul Schanda</li></ul></li>
<li><strong><a name="00031" href="msg00031.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Paul Schanda</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jul 15 11:00:08 2013</div>  
</body>
</html>
