<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r24323 &#45; in /branches/disp_spin_speed: dep_check.py target_functions/relax_disp.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 26 Jun 2014 17:26:53 +0200 -->
<!--X-Message-Id: CAED9pY&#45;nHopfXJpAqBLeZq4hrWW9K7_xrzEHUiNCf&#45;tJddMT7A@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Wzr2r&#45;00038v&#45;DS@subversion.gna.org -->
<!--X-Reference: CAED9pY_Jf69=R4bvecNhsUKSUb4Me1RYk4hxcxs8s&#45;1kXsG66w@mail.gmail.com -->
<!--X-Reference: CA+CBx2NZ+J+=Zxf8_x=CPK9zkCXYPHFBfPaD2n7a&#45;QacZxuBVQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r24323 - in /branches/disp_spin_speed: dep_check.py target_functions/relax_disp.py -- June 26, 2014 - 17:26</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r24323 - in /branches/disp_spin_speed: dep_check.py target_functions/relax_disp.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00442" class="tabs">Index by Date</a> | <a href="threads.html#00442" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00441.html">Date Prev</a>] [<a href="msg00443.html">Date Next</a>] [<a href="msg00439.html">Thread Prev</a>] [<a href="msg00444.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 26 Jun 2014 17:26:19 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=mWsn8WcqzVGEgPpZJWkkCX/O10ruNKsOABGhNkkFdHY=; b=LvOuS8gElY2EBbNy59xmYZ9UplDNNn8wkF/oeo70Kw57b8QDStHSQG2USUZmQ3IwHI T1gZV4azoMRghooXva6vHi09KnC9jbZJPl0Fv14oH2C2TKVnfjgrwkX75WogZWse8iBq nEBpg7VpRpDU+yo6LoR0gOlIKSF5cVe1iOfduI+jQzYPp2lniaulZZUK5geT2jPyiAeO +dPGv69mnTe0GpTLM0IuP0+5wX69IlgABNbooqAXIy/3LBZmqaPHDstNpKj62QOO+dvb UlaW0IIxD/gT1mKt0U3eSy1GszqC0Gmvp+PsAP9mV4qXvTo2d3SFEUvugCbaKrB2TLlZ u27g==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00442.html">CAED9pY-nHopfXJpAqBLeZq4hrWW9K7_xrzEHUiNCf-tJddMT7A@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Wzr2r-00038v-DS@subversion.gna.org&gt; &lt;CAED9pY_Jf69=R4bvecNhsUKSUb4Me1RYk4hxcxs8s-1kXsG66w@mail.gmail.com&gt; &lt;CA+CBx2NZ+J+=Zxf8_x=CPK9zkCXYPHFBfPaD2n7a-QacZxuBVQ@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 26, 2014 - 17:26:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

I can look at it later.  For requiring numpy 1.6, the following could be done:

- If you could delete the printout in dep_check, that would be good.
The printouts are only used for the essential packages before calling
sys.exit().  If you are interested in a message to the user, the
message needs to be modified to say something like &quot;numpy &gt;= 1.6 is
required for...&quot;, rather than &quot;numpy einsum is not installed&quot;, and
this needs to be used like the C_module_exp_fn_mesg variable in the
dep_check and info modules rather than calling sys.stderr.write().

- Blacklist the system tests requiring this.  This is absolutely
essential for me to release the changes in a new relax version.  Maybe
you could tackle that one, as the problem is of your own doing ;)
It's just a simple duplication of code in the setUp() method.  Do you
have a system with numpy &lt; 1.6 to test on?

- A RelaxError in the relax_disp.select_model user function for just
these models.  Could you give a list of these models, as I don't know
if all numeric models are affected, or if non-numeric models are
affected.  The best would be to create a new variable in
specific_analyses.relax_disp.variables for this model list.

- A GUI error blocking the execution of the analysis.  This would
require the model list in specific_analyses.relax_disp.variables to
identify the problem.  But I can look at this one.

Cheers,

Edward



On 25 June 2014 20:14, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

Do you fix this?

Thanks.

Best
Troels


2014-06-25 20:06 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Troels,

For this change, it might be better to not output a message to
sys.stderr.  For relax users who are not interested in a dispersion
analysis, there is no need to bother them.  What I would suggest for
safety is, in the backend for the relax_disp.select_model user
function, that we raise a RelaxError if one of these models are
selected but numpy.einsum does not exist.  The RelaxError message
could be that numpy version 1.6 or greater is required for the numeric
dispersion models.  A message could also appear in the GUI when the
execute button is clicked on, if these models have been selected.
That should be the best for the user experience when they have numpy &lt;
1.6.

Regards,

Edward



On 25 June 2014 19:31,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Wed Jun 25 19:31:40 2014
New Revision: 24323

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=24323&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=24323&amp;view=rev</a>
Log:
Implemented a dependency check for numpy einsum, so relax can still
start.

Task #7807 (<a  rel="nofollow" href="https://gna.org/task/index.php?7807">https://gna.org/task/index.php?7807</a>): Speed-up of dispersion
models for Clustered analysis.

Modified:
    branches/disp_spin_speed/dep_check.py
    branches/disp_spin_speed/target_functions/relax_disp.py

Modified: branches/disp_spin_speed/dep_check.py
URL:
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/dep_check.py?rev=24323&amp;r1=24322&amp;r2=24323&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/dep_check.py?rev=24323&amp;r1=24322&amp;r2=24323&amp;view=diff</a>

==============================================================================
--- branches/disp_spin_speed/dep_check.py       (original)
+++ branches/disp_spin_speed/dep_check.py       Wed Jun 25 19:31:40 2014
@@ -57,6 +57,14 @@

 # Optional packages.
 ####################
+
+# numpy einsum import.
+try:
+    from numpy import einsum
+    einsum_module = True
+except ImportError:
+    sys.stderr.write(&quot;The dependency 'numpy einsum' has not been
installed.  Numerical models in dispersion analysis will not be
possible.\n&quot;)
+    einsum_module = False

 # Bmrblib python package check.
 try:

Modified: branches/disp_spin_speed/target_functions/relax_disp.py
URL:
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/target_functions/relax_disp.py?rev=24323&amp;r1=24322&amp;r2=24323&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/target_functions/relax_disp.py?rev=24323&amp;r1=24322&amp;r2=24323&amp;view=diff</a>

==============================================================================
--- branches/disp_spin_speed/target_functions/relax_disp.py
(original)
+++ branches/disp_spin_speed/target_functions/relax_disp.py     Wed Jun
25 19:31:40 2014
@@ -30,6 +30,7 @@
 from numpy.ma import masked_equal

 # relax module imports.
+import dep_check
 from lib.dispersion.b14 import r2eff_B14
 from lib.dispersion.cr72 import r2eff_CR72
 from lib.dispersion.dpl94 import r1rho_DPL94
@@ -40,13 +41,7 @@
 from lib.dispersion.m61b import r1rho_M61b
 from lib.dispersion.mp05 import r1rho_MP05
 from lib.dispersion.mmq_cr72 import r2eff_mmq_cr72
-from lib.dispersion.ns_cpmg_2site_3d import r2eff_ns_cpmg_2site_3D
 from lib.dispersion.ns_cpmg_2site_expanded import
r2eff_ns_cpmg_2site_expanded
-from lib.dispersion.ns_cpmg_2site_star import r2eff_ns_cpmg_2site_star
-from lib.dispersion.ns_mmq_3site import r2eff_ns_mmq_3site_mq,
r2eff_ns_mmq_3site_sq_dq_zq
-from lib.dispersion.ns_mmq_2site import r2eff_ns_mmq_2site_mq,
r2eff_ns_mmq_2site_sq_dq_zq
-from lib.dispersion.ns_r1rho_2site import ns_r1rho_2site
-from lib.dispersion.ns_r1rho_3site import ns_r1rho_3site
 from lib.dispersion.ns_matrices import r180x_3d
 from lib.dispersion.tp02 import r1rho_TP02
 from lib.dispersion.tap03 import r1rho_TAP03
@@ -56,6 +51,14 @@
 from target_functions.chi2 import chi2, chi2_rankN
 from specific_analyses.relax_disp.variables import EXP_TYPE_CPMG_DQ,
EXP_TYPE_CPMG_MQ, EXP_TYPE_CPMG_PROTON_MQ, EXP_TYPE_CPMG_PROTON_SQ,
EXP_TYPE_CPMG_SQ, EXP_TYPE_CPMG_ZQ, EXP_TYPE_LIST_CPMG, EXP_TYPE_R1RHO,
MODEL_B14, MODEL_B14_FULL, MODEL_CR72, MODEL_CR72_FULL, MODEL_DPL94,
MODEL_IT99, MODEL_LIST_CPMG, MODEL_LIST_CPMG_FULL, MODEL_LIST_FULL,
MODEL_LIST_MMQ, MODEL_LIST_MQ_CPMG, MODEL_LIST_R1RHO, 
MODEL_LIST_R1RHO_FULL,
MODEL_LM63, MODEL_LM63_3SITE, MODEL_M61, MODEL_M61B, MODEL_MP05,
MODEL_MMQ_CR72, MODEL_NOREX, MODEL_NS_CPMG_2SITE_3D,
MODEL_NS_CPMG_2SITE_3D_FULL, MODEL_NS_CPMG_2SITE_EXPANDED,
MODEL_NS_CPMG_2SITE_STAR, MODEL_NS_CPMG_2SITE_STAR_FULL, 
MODEL_NS_MMQ_2SITE,
MODEL_NS_MMQ_3SITE, MODEL_NS_MMQ_3SITE_LINEAR, MODEL_NS_R1RHO_2SITE,
MODEL_NS_R1RHO_3SITE, MODEL_NS_R1RHO_3SITE_LINEAR, MODEL_TAP03, 
MODEL_TP02,
MODEL_TSMFK01

+# Check if eisum is available for numerical models.
+if dep_check.einsum_module:
+    from lib.dispersion.ns_cpmg_2site_3d import r2eff_ns_cpmg_2site_3D
+    from lib.dispersion.ns_cpmg_2site_star import
r2eff_ns_cpmg_2site_star
+    from lib.dispersion.ns_mmq_3site import r2eff_ns_mmq_3site_mq,
r2eff_ns_mmq_3site_sq_dq_zq
+    from lib.dispersion.ns_mmq_2site import r2eff_ns_mmq_2site_mq,
r2eff_ns_mmq_2site_sq_dq_zq
+    from lib.dispersion.ns_r1rho_2site import ns_r1rho_2site
+    from lib.dispersion.ns_r1rho_3site import ns_r1rho_3site

 class Dispersion:
     def __init__(self, model=None, num_params=None, num_spins=None,
num_frq=None, exp_types=None, values=None, errors=None, missing=None,
frqs=None, frqs_H=None, cpmg_frqs=None, spin_lock_nu1=None,
chemical_shifts=None, offset=None, tilt_angles=None, r1=None,
relax_times=None, scaling_matrix=None, recalc_tau=True):


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx


To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00444" href="msg00444.html">Re: r24323 - in /branches/disp_spin_speed: dep_check.py target_functions/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00438" href="msg00438.html">Re: r24323 - in /branches/disp_spin_speed: dep_check.py target_functions/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00439" href="msg00439.html">Re: r24323 - in /branches/disp_spin_speed: dep_check.py target_functions/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Jun 27 10:40:14 2014</div>  
</body>
</html>
