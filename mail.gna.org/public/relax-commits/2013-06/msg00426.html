<!-- MHonArc v2.6.16 -->
<!--X-Subject: r20237 &#45; in /branches/relax_disp: ./ docs/latex/	graphics/relax_icons/128x128/ -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Thu, 20 Jun 2013 16:42:28 +0200 -->
<!--X-Message-Id: E1Upg4C&#45;0004hV&#45;9P@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r20237 - in /branches/relax_disp: ./ docs/latex/	graphics/relax_icons/128x128/ -- June 20, 2013 - 16:42</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r20237 - in /branches/relax_disp: ./ docs/latex/	graphics/relax_icons/128x128/</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00426" class="tabs">Index by Date</a> | <a href="threads.html#00426" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00425.html">Date Prev</a>] [<a href="msg00427.html">Date Next</a>] [<a href="msg00425.html">Thread Prev</a>] [<a href="msg00427.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Thu, 20 Jun 2013 14:42:28 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00426.html">E1Upg4C-0004hV-9P@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on June 20, 2013 - 16:42:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Thu Jun 20 16:42:27 2013
New Revision: 20237

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=20237&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=20237&amp;view=rev</a>
Log:
Merged revisions 20231-20236 via svnmerge from 
svn+ssh://bugman@xxxxxxxxxxx/svn/relax/trunk

........
  r20231 | bugman | 2013-06-20 15:21:06 +0200 (Thu, 20 Jun 2013) | 5 lines
  
  Created a new listings language definition for relax for the user manual.
  
  This is for better highlighting of relax scripts and code in the relax 
manual.
........
  r20232 | bugman | 2013-06-20 15:43:20 +0200 (Thu, 20 Jun 2013) | 6 lines
  
  Fix for the scons fetch_docstrings target.
  
  The user functions need to be explicitly initialised in the 
fetch_docstrings script as this is not
  running through relax.
........
  r20233 | bugman | 2013-06-20 16:10:00 +0200 (Thu, 20 Jun 2013) | 3 lines
  
  Added an EPS version of the 128x128 J coupling icon for use in the relax 
user manual.
........
  r20234 | bugman | 2013-06-20 16:14:10 +0200 (Thu, 20 Jun 2013) | 3 lines
  
  Removed some junk text from the relax script text in section 6.3.8 of the 
user manual.
........
  r20235 | bugman | 2013-06-20 16:21:15 +0200 (Thu, 20 Jun 2013) | 8 lines
  
  The relax language definition is now auto-generated by the 
fetch_docstrings.py script.
  
  This is for use in the relax user manual using the listings package.  The 
fetch_docstrings.py
  script now creates the docs/latex/script_definition.tex file.  This is used 
by the relax.tex file
  via an \include{} statement.  This setup allows all of the relax user 
functions to be dynamically
  set as keywords for the relax language definition.
........
  r20236 | bugman | 2013-06-20 16:37:03 +0200 (Thu, 20 Jun 2013) | 5 lines
  
  Converted all of the Development chapter of the user manual to use the 
listing package.
  
  This is for all of the code examples, which are now much more colourful.
........

Added:
    branches/relax_disp/graphics/relax_icons/128x128/j_coupling.eps.gz
      - copied unchanged from r20236, 
trunk/graphics/relax_icons/128x128/j_coupling.eps.gz
Modified:
    branches/relax_disp/   (props changed)
    branches/relax_disp/docs/latex/curvefit.tex
    branches/relax_disp/docs/latex/develop.tex
    branches/relax_disp/docs/latex/fetch_docstrings.py
    branches/relax_disp/docs/latex/relax.tex

Propchange: branches/relax_disp/
------------------------------------------------------------------------------
--- svnmerge-integrated (original)
+++ svnmerge-integrated Thu Jun 20 16:42:27 2013
@@ -1,1 +1,1 @@
-/trunk:1-20228
+/trunk:1-20236

Modified: branches/relax_disp/docs/latex/curvefit.tex
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/relax_disp/docs/latex/curvefit.tex?rev=20237&amp;r1=20236&amp;r2=20237&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/relax_disp/docs/latex/curvefit.tex?rev=20237&amp;r1=20236&amp;r2=20237&amp;view=diff</a>
==============================================================================
--- branches/relax_disp/docs/latex/curvefit.tex (original)
+++ branches/relax_disp/docs/latex/curvefit.tex Thu Jun 20 16:42:27 2013
@@ -501,7 +501,7 @@
 
 \begin{lstlisting}[firstnumber=95]
 # Save the program state.
-\example{state.save(file='rx.save', force=True)
+state.save(file='rx.save', force=True)
 \end{lstlisting}
 
 

Modified: branches/relax_disp/docs/latex/develop.tex
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/relax_disp/docs/latex/develop.tex?rev=20237&amp;r1=20236&amp;r2=20237&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/relax_disp/docs/latex/develop.tex?rev=20237&amp;r1=20236&amp;r2=20237&amp;view=diff</a>
==============================================================================
--- branches/relax_disp/docs/latex/develop.tex (original)
+++ branches/relax_disp/docs/latex/develop.tex Thu Jun 20 16:42:27 2013
@@ -79,17 +79,14 @@
 
 An example of a single line docstring is:
 
-\begin{footnotesize}
-\begin{verbatim}
+\begin{lstlisting}
     def delete(self):
         &quot;&quot;&quot;Function for deleting all model-free data.&quot;&quot;&quot;
-\end{verbatim}
-\end{footnotesize}
+\end{lstlisting}
 
 An example of a multiline docstring is:
 
-\begin{footnotesize}
-\begin{verbatim}
+\begin{lstlisting}
 def aic(chi2, k, n):
     &quot;&quot;&quot;Akaike's Information Criteria (AIC).
 
@@ -109,8 +106,7 @@
     &quot;&quot;&quot;
 
     return chi2 + 2.0*k
-\end{verbatim}
-\end{footnotesize}
+\end{lstlisting}
 
 In addition to the text descriptions, the docstrings use the 
\href{<a  rel="nofollow" href="http://epydoc.sourceforge.net/}{Epydoc}\index{epydoc}">http://epydoc.sourceforge.net/}{Epydoc}\index{epydoc}</a> markup language 
to describe arguments, return values, and other information about the code.  
See 
\href{<a  rel="nofollow" href="http://epydoc.sourceforge.net/fields.html}{http://epydoc.sourceforge.net/fields.html}">http://epydoc.sourceforge.net/fields.html}{http://epydoc.sourceforge.net/fields.html}</a>
 for a listing of all the epydoc fields allowed.  This mark up language is 
important for the creation of the \href{<a  rel="nofollow" href="http://www.nmr-relax.com/api/}{API">http://www.nmr-relax.com/api/}{API</a> 
documentation}\index{API documentation} and to help developers understand the 
purpose and operation of the code.
 
@@ -127,8 +123,7 @@
 
 For both variables and functions lower case with underscores between words 
is always used.  This is for readability as the convention is much more 
fluent than camel case.  A few rare exceptions exist, an example is the 
Brownian diffusion tensor parameter of anisotropy $\Diff_a$ which is 
referenced as \prompt{cdp.diff\_tensor.Da}.  As a rule though all new 
variable or function names should be kept as lower case.  An example of this 
convention for both the variable name and function name is:
 
-\begin{footnotesize}
-\begin{verbatim}
+\begin{lstlisting}
     def assemble_param_vector(self, spin=None, spin_id=None, sim_index=None, 
model_type=None):
         &quot;&quot;&quot;Assemble the model-free parameter vector (as numpy array).
 
@@ -140,8 +135,7 @@
         @type spin_id:          str
         @keyword sim_index:     The optional MC simulation index.
         @type sim_index:        int
-        @keyword model_type:    The optional parameter set, one of 'all', 
'diff', 'mf', or
-                                'local_tm'. 
+        @keyword model_type:    The optional parameter set, one of 'all', 
'diff', 'mf', or 'local_tm'. 
         @type model_type:       str or None
         @return:                An array of the parameter values of the 
model-free model.
         @rtype:                 numpy array
@@ -161,8 +155,7 @@
                 # Spherical diffusion.
                 if cdp.diff_tensor.type == 'sphere':
                     param_vector.append(cdp.diff_tensor.tm)
-\end{verbatim}
-\end{footnotesize}
+\end{lstlisting}
 
 
 
@@ -171,8 +164,7 @@
 
 For classes relax uses a mix of camel case (for example all the 
\prompt{RelaxError} objects) and underscores (for example 
\pycode{Model\_free}).  The first letter in all cases is always capitalised.  
Generally the camel case is reserved for very low level classes which are 
involved in the program's infrastructure.  Examples include the RelaxError 
code, the threading code, and the relax data store code.  All the data 
analysis specific code, generic code, interface code, etc.\ uses underscores 
between the words with only the first letter capitalised.  One exception is 
the space mapping class \pycode{OpenDX}, the reason being that the program is 
called \prompt{OpenDX}.  An example is:
 
-\begin{footnotesize}
-\begin{verbatim}
+\begin{lstlisting}
 class Model_free_main:
     &quot;&quot;&quot;Class containing functions specific to model-free analysis.&quot;&quot;&quot;
 
@@ -181,17 +173,14 @@
 
         @param spin:    The spin container object.
         @type spin:     SpinContainer instance
-        @return:        The name of the first parameter in the parameter 
list in which the
-                        corresponding parameter value is None.  If all 
parameters are set, then None
-                        is returned.
+        @return:        The name of the first parameter in the parameter 
list in which the corresponding parameter value is None.  If all parameters 
are set, then None is returned.
         @rtype:         str or None
         &quot;&quot;&quot;
 
         # Deselected residue.
         if spin.select == 0:
             return
-\end{verbatim}
-\end{footnotesize}
+\end{lstlisting}
 
 
 
@@ -216,14 +205,11 @@
 \end{itemize}
 
 An example which shows most of these conventions is:
-\begin{footnotesize}
-\begin{verbatim*}
+\begin{lstlisting}
 class Internal:
     &quot;&quot;&quot;The internal relax structural data object.
 
-    The structural data object for this class is a container possessing a 
number of different arrays
-    corresponding to different structural information.  These objects are 
described in the
-    structural container docstring.
+    The structural data object for this class is a container possessing a 
number of different arrays corresponding to different structural information. 
 These objects are described in the structural container docstring.
     &quot;&quot;&quot;
 
     def _bonded_atom(self, attached_atom, index, mol):
@@ -247,8 +233,7 @@
             # Determine the molecule type if needed.
             if not hasattr(mol, 'type'):
                 self._mol_type(mol)
-\end{verbatim*}
-\end{footnotesize}
+\end{lstlisting}
 
 
 

Modified: branches/relax_disp/docs/latex/fetch_docstrings.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/relax_disp/docs/latex/fetch_docstrings.py?rev=20237&amp;r1=20236&amp;r2=20237&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/relax_disp/docs/latex/fetch_docstrings.py?rev=20237&amp;r1=20236&amp;r2=20237&amp;view=diff</a>
==============================================================================
--- branches/relax_disp/docs/latex/fetch_docstrings.py (original)
+++ branches/relax_disp/docs/latex/fetch_docstrings.py Thu Jun 20 16:42:27 
2013
@@ -23,6 +23,8 @@
 &quot;&quot;&quot;User function definition conversion to LaTeX for the relax manual.&quot;&quot;&quot;
 
 # Python module imports.
+from os import sep
+from os.path import dirname
 from re import search
 from string import ascii_letters, ascii_lowercase, punctuation, whitespace
 import sys
@@ -33,8 +35,13 @@
 
 # relax module imports.
 from graphics import fetch_icon
+import user_functions
 from user_functions.data import Uf_info; uf_info = Uf_info()
 from user_functions.data import Uf_tables; uf_tables = Uf_tables()
+
+
+# Set up the user functions.
+user_functions.initialise()
 
 
 class Fetch_docstrings:
@@ -45,6 +52,7 @@
         self.in_quote = False
         self.table_count = 1
         self.uf_table_labels = []
+        self.path = dirname(file)
 
         # Set up the words to index.
         self.index_entries()
@@ -53,7 +61,10 @@
         self.file = open(file, 'w')
 
         # Loop over the user functions.
+        uf_names = []
         for self.uf_name, self.uf in uf_info.uf_loop():
+            # Add to the list.
+            uf_names.append(self.uf_name)
             # The user function class.
             self.uf_class = None
             if search('\.', self.uf_name):
@@ -78,6 +89,9 @@
 
         # Close the LaTeX file.
         self.file.close()
+
+        # Create the relax lstlisting definition.
+        self.script_definitions(uf_names)
 
 
     def break_functions(self, text):
@@ -735,6 +749,92 @@
 
         # Return the string.
         return string
+
+
+    def script_definitions(self, uf_names):
+        &quot;&quot;&quot;Create a LaTeX file defining the relax language syntax for the 
listings package.
+
+        @param uf_names:    The list of all user function names.
+        @type uf_names:     list of str
+        &quot;&quot;&quot;
+
+        # Open the file.
+        file = open(self.path + sep + 'script_definition.tex', 'w')
+
+        # Python keywords.
+        py_keywords = [
+            'and',
+            'assert',
+            'break',
+            'continue',
+            'del',
+            'else',
+            'exec',
+            'global',
+            'if',
+            'in',
+            'is',
+            'for',
+            'not',
+            'or',
+            'pass',
+            'print',
+            'raise',
+            'return',
+            'while',
+            'yield'
+        ]
+        py_keywords2 = [
+            'as',
+            'from',
+            'import',
+        ]
+        py_keywords3 = [
+            'class',
+            'def',
+        ]
+
+        # The relax language.
+        file.write(&quot;\lstdefinelanguage{relax}{\n&quot;)
+
+        # Allow the user function '.' character to be part of the keywords.
+        file.write(&quot;    alsoletter={.},\n&quot;)
+
+        # Output the first set of Python keywords.
+        file.write(&quot;    morekeywords={&quot;)
+        for name in py_keywords:
+            file.write(&quot;%s,&quot; % name)
+        file.write(&quot;},\n&quot;)
+
+        # Output the second set of Python keywords.
+        file.write(&quot;    morekeywords=[2]{&quot;)
+        for name in py_keywords2:
+            file.write(&quot;%s,&quot; % name)
+        file.write(&quot;},\n&quot;)
+
+        # Output the third set of Python keywords.
+        file.write(&quot;    morekeywords=[3]{&quot;)
+        for name in py_keywords3:
+            file.write(&quot;%s,&quot; % name)
+        file.write(&quot;},\n&quot;)
+
+        # Output the relax user functions as keywords.
+        file.write(&quot;    morekeywords=[4]{&quot;)
+        for name in uf_names:
+            file.write(&quot;%s,&quot; % name)
+        file.write(&quot;},\n&quot;)
+
+        # The rest of the definition.
+        file.write(&quot;    moreprocnamekeys={def,class},\n&quot;)
+        file.write(&quot;    sensitive=true,\n&quot;)
+        file.write(&quot;    morecomment=[l]{\#},\n&quot;)
+        file.write(&quot;    morestring=[b]',\n&quot;)
+        file.write(&quot;    morestring=[b]\&quot;,\n&quot;)
+        file.write(&quot;    morestring=[b]\&quot;\&quot;\&quot;,\n&quot;)
+        file.write(&quot;}\n&quot;)
+
+        # Close the file.
+        file.close()
 
 
     def tabular_wrapping(self, table, max_char=100):

Modified: branches/relax_disp/docs/latex/relax.tex
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/relax_disp/docs/latex/relax.tex?rev=20237&amp;r1=20236&amp;r2=20237&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/relax_disp/docs/latex/relax.tex?rev=20237&amp;r1=20236&amp;r2=20237&amp;view=diff</a>
==============================================================================
--- branches/relax_disp/docs/latex/relax.tex (original)
+++ branches/relax_disp/docs/latex/relax.tex Thu Jun 20 16:42:27 2013
@@ -40,9 +40,10 @@
             urlcolor=blue}
 
 % Source code and scripts.
-\usepackage{listings}
+\usepackage[procnames]{listings}
 \usepackage[svgnames]{xcolor}
 \usepackage{textcomp}
+\include{script_definition}
 \lstset{
     backgroundcolor=\color{white},
     basewidth=0.5em,
@@ -51,23 +52,26 @@
     breaklines=true,
     captionpos=b,
     columns=fixed,
-    commentstyle=\color{blue},
+    commentstyle=\color{Blue},
     frame=none,
     keepspaces=true,
     keywordstyle=\bfseries \color{ForestGreen},
-    language=Python,
+    keywordstyle=[2]\bfseries \color{BlueViolet},
+    keywordstyle=[3]\bfseries \color{SaddleBrown},
+    keywordstyle=[4]\bfseries \color{MidnightBlue},
+    language=relax,
     numbers=left,
     numbersep=15pt,
-    numberstyle=\tiny \color{orange},
+    numberstyle=\tiny \color{DarkOrange},
+    procnamestyle=\color{LightSeaGreen},
     showspaces=false,
     showstringspaces=false,
     showtabs=false,
     stepnumber=1,
-    stringstyle=\color{Crimson},
+    stringstyle=\color{FireBrick},
     tabsize=4,
     upquote=true,
 }
-
 
 % New commands.
 \newcommand{\example}[1]{\vspace{-1ex} \sloppy{\footnotesize \texttt{#1}}}



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Jun 20 17:00:02 2013</div>  
</body>
</html>
