<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Wed, 21 May 2014 19:26:07 +0200 -->
<!--X-Message-Id: CA+CBx2OgAXUPXu4VAqhS9bFyqvzfXByA&#45;zmBWt4oE5ffZzF7hg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140521&#45;104012.sv20529.25181@gna.org -->
<!--X-Reference: 20140521&#45;104836.sv20529.94249@gna.org -->
<!--X-Reference: 20140521&#45;123919.sv2782.24964@gna.org -->
<!--X-Reference: 20140521&#45;164657.sv20529.30032@gna.org -->
<!--X-Reference: CAED9pY_wiLTcDgkt+3CmjfUpq6j2BO6w+7gXjXjgS7WVDNYoEQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan -- May 21, 2014 - 19:26</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00420" class="tabs">Index by Date</a> | <a href="threads.html#00420" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00419.html">Date Prev</a>] [<a href="msg00421.html">Date Next</a>] [<a href="msg00417.html">Thread Prev</a>] [<a href="msg00422.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 21 May 2014 19:24:55 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type; bh=Fr4oIp3oC8DUJgbOGH6wH4kM6PBEKAekgYJwavdJ6mA=; b=pEloqDQeK74GoBzwm0ObaYSwRjIzXq5RU/41NQfoMeMWUJPkNCN56VJ3WYGQf3Vab6 qIssxtGwOOEyhgkOzCJBzPbQl+BihSAiTdmOC6bSR745pSROt744UP5IR9ZFZjfEIZJJ rLBvDbFY29w8aOGEsZ8QLSLiHClMTz/nrIhHjnMhcUbR/rm7mTutSUAiS8zRrI10fqmt svr2MRQhmQDrZHXRg362fbVXEaFdxRL48hpVpRthOpPvAQEWdk5O23aVCtDoJRCYiVFU t9gqWYIxZCSE6r1JLysCNNW3MZ/hfqTz+TaRFxzcHyadPKnFEyOphkPqYDk7acPI10OJ Y1Vg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00420.html">CA+CBx2OgAXUPXu4VAqhS9bFyqvzfXByA-zmBWt4oE5ffZzF7hg@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00408.html">20140521-104012.sv20529.25181@gna.org</a>&gt; &lt;<a href="msg00409.html">20140521-104836.sv20529.94249@gna.org</a>&gt; &lt;<a href="msg00410.html">20140521-123919.sv2782.24964@gna.org</a>&gt; &lt;<a href="msg00416.html">20140521-164657.sv20529.30032@gna.org</a>&gt; &lt;<a href="msg00417.html">CAED9pY_wiLTcDgkt+3CmjfUpq6j2BO6w+7gXjXjgS7WVDNYoEQ@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on May 21, 2014 - 19:26:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Ed.

The trunk code says:
    t113 = t97_nt99 - t112
    t115 = num_cpmg
    t116 = power(0.5*(t97_t99 + t112), t115)

I have tried to catch the underflow of t116, the power function.
This is when a number is represented as less than 1.e-307 (something).

</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">import numpy as np
print np.finfo('d')
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">Machine parameters for float64
---------------------------------------------------------------------
precision= 15   resolution= 1.0000000000000001e-15
machep=   -52   eps=        2.2204460492503131e-16
negep =   -53   epsneg=     1.1102230246251565e-16
minexp= -1022   tiny=       2.2250738585072014e-308
maxexp=  1024   max=        1.7976931348623157e+308
nexp  =    11   min=        -max
---------------------------------------------------------------------

So, in the array, I look for the maximum power, and match the value
with the list, and see if that value is below the limit.

Hm, maybe I should delete it again.
But I caught other numpy-raises error, found in the test-suite.

But here this bug is triggered by an array, which is sent in with tcp
array of nan.

I think it is because spin :71@N miss data from field 800.

Best
Troels

2014-05-21 19:03 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

Maybe this shouldn't be a bug?  It's only present in your 'disp_speed'
branch and is only seen with a debugging flag turned on.  If you add
the check I mentioned at
<a  rel="nofollow" href="http://www.mail-archive.com/relax-devel@xxxxxxx/msg05731.html">http://www.mail-archive.com/relax-devel@xxxxxxx/msg05731.html</a> to the
first line of this function, maybe all the checks you have added
compared to the trunk could be removed and this issue will just
disappear.  It would be worth trying.  Also, what does the following
line do?

    # Calculate lowest positive val, which raised to the power will
not be represented less than 1.-e300.
    low_pos_rep = power(1.e-300, 1./max_t115)

Why is max_t115 inverted when the original code from Nikolai and Martin is:

        t115 = N/2;
        t116 = (t69/2+t83/2+t92/2+t96/2+t112/2).^t115;
        t118 = 1./t112;
        t120 = t69+t83-t92-t96+t112;
        t122 = (t69/2+t83/2+t92/2+t96/2-t112/2).^t115;

Here t115 is never inverted.  The 1/max_t115 is causing this divide by
zero error.  Anyway, adding the 'No Rex' check in the above link will
likely make all of this redundant.

Regards,

Edward




On 21 May 2014 18:46, Troels E. Linnet &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Follow-up Comment #3, bug #22065 (project relax):

This only fails when --numpy-raise is set on.

    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/bugs/?22065">http://gna.org/bugs/?22065</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>

</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00422" href="msg00422.html">Re: [bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00408" href="msg00408.html">[bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00409" href="msg00409.html">[bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00410" href="msg00410.html">[bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan</a></strong>
<ul><li><em>From:</em> Edward d Auvergne</li></ul></li>
<li><strong><a name="00416" href="msg00416.html">[bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00417" href="msg00417.html">Re: [bug #22065] Systemtest Relax_disp.test_hansen_cpmg_data_missing_auto_analysis has tcp array with multiple nan</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed May 21 19:40:14 2014</div>  
</body>
</html>
