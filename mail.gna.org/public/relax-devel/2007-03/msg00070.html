<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: Vote for the design of the relax data storage object singleton. -->
<!--X-From-R13: "Unel E. Fubzcfba" <tnelgNozo.yrrqf.np.hx> -->
<!--X-Date: Thu, 15 Mar 2007 18:29:24 +0100 -->
<!--X-Message-Id: 45F98244.4080902@bmb.leeds.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7f080ed10703140609p70d35295ye10ee5939da494a2@mail.gmail.com -->
<!--X-Reference: 1173960604.8066.341.camel@mrspell -->
<!--X-Reference: 7f080ed10703150700v2c7296behc146501949d618bf@mail.gmail.com -->
<!--X-Reference: 1173968940.8066.351.camel@mrspell -->
<!--X-Reference: 7f080ed10703150750k3c2b765fpfad3030a1db9ed12@mail.gmail.com -->
<!--X-Reference: 1173971938.8066.377.camel@mrspell -->
<!--X-Reference: 7f080ed10703150921g7469b0d6ia5506c3c47c537c8@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Vote for the design of the relax data storage object singleton. -- March 15, 2007 - 18:29</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Vote for the design of the relax data storage object singleton.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00070" class="tabs">Index by Date</a> | <a href="threads.html#00070" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00069.html">Date Prev</a>] [<a href="msg00071.html">Date Next</a>] [<a href="msg00068.html">Thread Prev</a>] [<a href="msg00077.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 15 Mar 2007 17:28:36 +0000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00070.html">45F98244.4080902@bmb.leeds.ac.uk</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00046.html">7f080ed10703140609p70d35295ye10ee5939da494a2@mail.gmail.com</a>&gt;	&lt;<a href="msg00057.html">1173960604.8066.341.camel@mrspell</a>&gt;	&lt;<a href="msg00058.html">7f080ed10703150700v2c7296behc146501949d618bf@mail.gmail.com</a>&gt;	&lt;<a href="msg00063.html">1173968940.8066.351.camel@mrspell</a>&gt;	&lt;<a href="msg00065.html">7f080ed10703150750k3c2b765fpfad3030a1db9ed12@mail.gmail.com</a>&gt;	&lt;<a href="msg00066.html">1173971938.8066.377.camel@mrspell</a>&gt;	&lt;<a href="msg00068.html">7f080ed10703150921g7469b0d6ia5506c3c47c537c8@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla Thunderbird 1.0 (X11/20041206)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Gary S. Thompson</strong> on March 15, 2007 - 18:29:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Edward d'Auvergne wrote:</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">On 3/16/07, Chris MacRaild &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:</pre><br>
<blockquote class="blockquote"><tt>On Fri, 2007-03-16 at 01:50 +1100, Edward d'Auvergne wrote:<br>
&gt; On 3/16/07, Chris MacRaild &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:<br>
&gt; &gt; On Fri, 2007-03-16 at 01:00 +1100, Edward d'Auvergne wrote:<br>
&gt; &gt; &gt; On 3/15/07, Chris MacRaild &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:<br>
&gt; &gt; &gt; &gt; On Thu, 2007-03-15 at 00:09 +1100, Edward d'Auvergne wrote:<br>
&gt; &gt; &gt; &gt; &gt; On 3/14/07, Chris MacRaild &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:<br>
&gt; &gt; &gt; &gt; &gt; &gt; On Tue, 2007-03-13 at 19:51 +1100, Edward d'Auvergne wrote:<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Gary,<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; I've written some unit tests which are located in the file<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 'test_suite/unit_tests/data/__init__.py'.  Would you 
know what<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; modifications I need to apply to make these tests run?  
These tests<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; are for the methods of the Data singleton class (the 
relax data<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; storage object) which is located in 
'data/__init__.py'.  I haven't<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; used the statement 'from x import Data' for this class 
so it is the<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; legal and ubiquitous usage of an __init__.py file.  Would<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 'unit_test_runner.py' handle this code?<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Thanks,<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Edward<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; P.S.  These tests demonstrate the utility of 
subclassing the singleton<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; and is one reason I was arguing for the use of the 
class import rather<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; than reference import.<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; It is of course correct that the Singleton implimentation 
I proposed<br>
&gt; &gt; &gt; &gt; &gt; &gt; does not allow for subclassing. This however might well 
be seen as a<br>
&gt; &gt; &gt; &gt; &gt; &gt; design feature, given the well known conceptual problems 
with<br>
&gt; &gt; &gt; &gt; &gt; &gt; subclassing Singleton. Essentially, subclassing violates 
the Singleton<br>
&gt; &gt; &gt; &gt; &gt; &gt; Design Pattern:<br>
&gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; class Singleton:<br>
&gt; &gt; &gt; &gt; &gt; &gt;     def __new__(self):<br>
&gt; &gt; &gt; &gt; &gt; &gt;         ...<br>
&gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; class Sub(Singleton): pass<br>
&gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;&gt;&gt; a = Singleton()<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;&gt;&gt; b = Sub()<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;&gt;&gt; isinstance(a,Singleton)<br>
&gt; &gt; &gt; &gt; &gt; &gt; True<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;&gt;&gt; isinstance(b,Singleton)<br>
&gt; &gt; &gt; &gt; &gt; &gt; True<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;&gt;&gt; a is b<br>
&gt; &gt; &gt; &gt; &gt; &gt; False<br>
&gt; &gt; &gt; &gt; &gt; &gt; &gt;&gt;&gt; a == b<br>
&gt; &gt; &gt; &gt; &gt; &gt; False<br>
&gt; &gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; &gt; ie. we have 2 instances of Singleton that are not the 
same thing, and<br>
&gt; &gt; &gt; &gt; &gt; &gt; not even equal! If this is the behaviour you want, then 
you need<br>
&gt; &gt; &gt; &gt; &gt; &gt; something other than Singleton. On the other hand, if you 
really want<br>
&gt; &gt; &gt; &gt; &gt; &gt; Singleton, then you can't also hope for subclassability.<br>
&gt; &gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; &gt; Actually one is an instance of Singleton and the other is 
an instance<br>
&gt; &gt; &gt; &gt; &gt; of Sub.<br>
&gt; &gt; &gt; &gt;<br>
&gt; &gt; &gt; &gt; The definition of inheritance is that an instance of the 
subclass is<br>
&gt; &gt; &gt; &gt; also an instance of the parent class. ie. b is an instance of 
both Sub<br>
&gt; &gt; &gt; &gt; and Singleton. Inheritance from a Singleton class is 
therefore a logical<br>
&gt; &gt; &gt; &gt; contradiction.<br>
&gt; &gt; &gt;<br>
&gt; &gt; &gt; That is actually incorrect!<br>
&gt; &gt;<br>
&gt; &gt; Sorry to drag this on, but I'm not incorrect here, and its a fairly<br>
&gt; &gt; fundamental point of OO philosophy and practice that is well worth<br>
&gt; &gt; getting right. This is pasted directly from my Python command 
line (the<br>
&gt; &gt; interpreter does not lie!):<br>
&gt; &gt;<br>
&gt; &gt; &gt;&gt;&gt; class A: pass<br>
&gt; &gt; ...<br>
&gt; &gt; &gt;&gt;&gt; class B(A): pass<br>
&gt; &gt; ...<br>
&gt; &gt; &gt;&gt;&gt; a= A()<br>
&gt; &gt; &gt;&gt;&gt; b = B()<br>
&gt; &gt; &gt;&gt;&gt; isinstance(a,A)<br>
&gt; &gt; True<br>
&gt; &gt; &gt;&gt;&gt; isinstance(a,B)<br>
&gt; &gt; False<br>
&gt; &gt; &gt;&gt;&gt; isinstance(b,B)<br>
&gt; &gt; True<br>
&gt; &gt; &gt;&gt;&gt; isinstance(b,A)<br>
&gt; &gt; True<br>
&gt; &gt;<br>
&gt; &gt; Because B is a subclass of A, all instances of B are also 
instances of A<br>
&gt;<br>
&gt; The 'isinstance()' built-in function will return true if object x is<br>
&gt; an instance of the supplied class or, importantly, a subclass.  This<br>
&gt; is what it's docstring says.  Try the following instead (after<br>
&gt; reissuing the above statements):<br>
&gt;<br>
&gt; &gt;&gt;&gt; a is b<br>
&gt; False<br>
&gt; &gt;&gt;&gt; hash(a)<br>
&gt; -1217311764<br>
&gt; &gt;&gt;&gt; hash(b)<br>
&gt; -1214788020<br>
&gt; &gt;&gt;&gt; id(a)<br>
&gt; -1217311764<br>
&gt; &gt;&gt;&gt; id(b)<br>
&gt; -1214788020<br>
&gt;<br>
&gt; If b was the same instance as a, then the first statement would return<br>
&gt; true.  The two hash() statements show that a and b are different.  The<br>
&gt; two id() statements show that they occupy different locations in<br>
&gt; memory - the number is the object's memory address.  Another test is<br>
&gt; populating the empty containers:<br>
&gt;<br>
&gt; &gt;&gt;&gt; a.x = 1<br>
&gt; &gt;&gt;&gt; b.y = 2<br>
&gt; &gt;&gt;&gt; dir(a)<br>
&gt; ['__doc__', '__module__', 'x']<br>
&gt; &gt;&gt;&gt; dir(b)<br>
&gt; ['__doc__', '__module__', 'y']<br>
&gt;<br>
&gt; The instances a and b are very much different!</tt><br>
<br>
<pre style="margin: 0em;">This is all true, but misses the point. a and b are different objects,
but they are of the same type:</pre><br>
<pre style="margin: 0em;">&gt;&gt;&gt; type(a) is type(b)
True
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<tt>They are necessarily the same type, both are &lt;type 'instance'&gt;.
</tt></blockquote><pre style="margin: 0em;"><br></pre><br>
<tt>yes but that isn't the class you need to look at object.__class__ and 
object.__bases__ and so on resursivley...</tt><br>
<br>
<blockquote class="blockquote"><br>
<blockquote class="blockquote"><pre style="margin: 0em;">and both of them are instances of the parent class A. So to go back to
where we started: for almost any implimentation of Singleton
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">Both are not instances of A.  The Python builtin function
'isinstance()' is poorly named.  It returns True if object b is an
instance of class B.  But it also returns true if object b is an
instance of class B which is subclassed from A (isinstance(b, A)).
Note that there is no reference to an instance of A in this second
test, either here or when typing 'help(isinstance)').
</pre></blockquote><tt><br>I beg to disagree, it isn't (however type is ;-)) It does exactly what 
is says on the packet</tt><br>
<br>
<pre style="margin: 0em;">if you have class A and class B(A)
and instances a and b thereof</pre><br>
<pre style="margin: 0em;">a is an A
and b is an A and a B</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;"><br></pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">&gt;&gt;&gt; single = Singleton()
&gt;&gt;&gt; class Sub(Singleton): pass
...
&gt;&gt;&gt; sub = Sub()
&gt;&gt;&gt; isinstance(sub,Singleton)
True
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">This is the second part of the isinstance test, seeing if sub is and
instance of some class which is itself subclassed from Singleton.</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">&gt;&gt;&gt; isinstance(single,Singleton)
True
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">This is the first part of the isinstance test, the actual testing if
it is an instance.</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">&gt;&gt;&gt; sub is single
False</pre><br>
<pre style="margin: 0em;">This breaches the Singleton design because we have two *different*
objects that are both instances of the Singleton class.
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">WRONG!!!  We now have two different singletons!  They occupy different
memory addresses and will have different contents.  For example one
dictionary type can be the relax data storage object and the other can
be an object storing the various components used in the chi-squared
equation, relaxation equations, spectral density values, and geometric
components all calculated by the module 'maths_fns.mf'.  Both these
two objects benefit by being singletons - the alternative currently
used by 'maths_fns.mf' is to pass a single data object into the
hundreds of functions which use that object.</pre><br>
</blockquote><tt>NO... you have two object ot type Singleton i.e. sub.__base__==singleton 
it is a singleton as is single.__class__ both can be accepted in the 
sample place and behave the same way this breaks the contract for 
anything that is is a singleton. There can only be one instance of 
singleton  within the interpreter. You can never have  two singletons 
which share the same  type other than being an object.</tt><br>
<br>
<blockquote class="blockquote"><br>
<blockquote class="blockquote"><pre style="margin: 0em;">To put this in terms of the favourite metaphore, because apple is a
subclass of fruit, all apples are also fruits (ie. all instances of
class Apple in also instances of class Fruit). Even if you have several
different apples, this does not make them any less fruity.
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
</blockquote><pre style="margin: 0em;">[snip to the chase]</pre><br>
<tt>I don't know where to start quite. Chris's explanation is clear (and 
correct).</tt><br>
<br>
<pre style="margin: 0em;">If one class derives from another it has an is a or inheritance contract.</pre><br>
<tt>An apple is a fruit, a fruit is a fruit and a pear is a fruit. any where 
you accept a fruit you have to accpet apples pears or straight fruit.</tt><br>
<br>
<tt>Now the singleton pattern is behavioural not inheritance based. For each 
class you call a singleton there can only be one instance of that type 
in memory. So if you can have a print queue singleton there can only 
ever be __one__ instance of a print queue singleton in memory. i.e. only 
one memory address is associated with the class print queue. if you 
subclass print queue to give you say an advanced print queue any object 
is of type advanced print queue  is a  print queue and and an advanced 
print queue all at the same time. now print queue was a singleton and so 
must advanced print queue be. so again there can only be one memory 
location associated with type advanced print queue and print queue. If 
you make an instance of print queue which is not and advanced print 
queue while you have an instance of advanced print queue in memory you 
have broken the contract.</tt><br>
<br>
<tt>Lets take it one step further.  Now consider if you sub class print 
queue again to give a dumb print queue. That object is a print queue and 
a dumb print queue all at the same time.  A print queue is a singleton 
and so must be a dumb print queue. If you create an object of dumb print 
queue no other memory location other than that __instance__ may be 
associated with a print queue or an advanced print queue (which by its 
inheritance relationsship to print queue has __to be a print queue__) . 
As soon as you create another isntance  of either of these you break the 
singleton contract because otf the inheritance contract. Except under 
very strict conditions  there is a  very big impedance mismatch between 
singleton and inheritance (which I can go into if need be).</tt><br>
<br>
<tt>I am pretty secure with my undertanding of inheritance and this pattern  
and it is just one of those unavoidable thing. If you label something as 
a  singleton and there can only ever be one instance of that type in 
memory. Anything you call a singleton  must be the only instance of that 
type in memory whehter it is of that type directly or because you can 
follow an  ineritance relationhsip to it.</tt><br>
<br>
<tt>It would somethimes be nice two have to fermions that could both 
occupied the same space (ever wanted to walk through a wall when someone 
was cross at you) but they can't (tip you hat to mr pauli) they just are 
not made that way and the same goes here!</tt><br>
<br>
<pre style="margin: 0em;"><br>regards
gary</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<pre style="margin: 0em;"><br>P.S.  For those still following this thread, this argument is not
related to what was voted upon :)</pre><br>
<pre style="margin: 0em;">_______________________________________________
relax (<a  href="http://nmr-relax.com">http://nmr-relax.com</a>)</pre><br>
<pre style="margin: 0em;">This is the relax-devel mailing list
relax-devel@xxxxxxx</pre><br>
<pre style="margin: 0em;">To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a></pre><br>
<pre style="margin: 0em;">.</pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
-------------------------------------------------------------------
Dr Gary Thompson
Astbury Centre for Structural Molecular Biology,
University of Leeds, Astbury Building,
Leeds, LS2 9JT, West-Yorkshire, UK             Tel. +44-113-3433024
email: garyt@xxxxxxxxxxxxxxx                   Fax  +44-113-2331407
-------------------------------------------------------------------</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00077" href="msg00077.html">Re: Vote for the design of the relax data storage object singleton.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00046" href="msg00046.html">Vote for the design of the relax data storage object singleton.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00057" href="msg00057.html">Re: Vote for the design of the relax data storage object singleton.</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00058" href="msg00058.html">Re: Vote for the design of the relax data storage object singleton.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00063" href="msg00063.html">Re: Vote for the design of the relax data storage object singleton.</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00065" href="msg00065.html">Re: Vote for the design of the relax data storage object singleton.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00066" href="msg00066.html">Re: Vote for the design of the relax data storage object singleton.</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00068" href="msg00068.html">Re: Vote for the design of the relax data storage object singleton.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Sat Mar 17 02:40:17 2007</div>  
</body>
</html>
