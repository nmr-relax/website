<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r24771 &#45; /branches/r1rho_plotting/specific_analyses/relax_disp/data.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 31 Jul 2014 15:14:10 +0200 -->
<!--X-Message-Id: CA+CBx2Out3+Y+m3KNOWZ27hzRDt_DDRBKA9w3sSBswD2pjnzNw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XB0Em&#45;0004T3&#45;Dc@subversion.gna.org -->
<!--X-Reference: CAED9pY8HEP_L2W4yWT54woZcwphe+&#45;R78Tk_JQSzjuRZDDS9QA@mail.gmail.com -->
<!--X-Reference: CA+CBx2PhNROsW=OopiUXAtPjygdwHHgt0c99EbE0xbT_VqF&#45;Aw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;bix+9gUcTuHo5VJZmsJbhynAgTDq7QW5qe3U3R&#45;8ieA@mail.gmail.com -->
<!--X-Reference: CAED9pY9sjp5we2V4gscS&#45;yxd0kumaLkKCCM+5KCrUS7FVqO+KQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r24771 - /branches/r1rho_plotting/specific_analyses/relax_disp/data.py -- July 31, 2014 - 15:14</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r24771 - /branches/r1rho_plotting/specific_analyses/relax_disp/data.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00015" class="tabs">Index by Date</a> | <a href="threads.html#00015" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00014.html">Date Prev</a>] [<a href="msg00016.html">Date Next</a>] [<a href="msg00011.html">Thread Prev</a>] [<a href="msg00014.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 31 Jul 2014 15:13:17 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type:content-transfer-encoding; bh=IFBMO+Onu0aSKWgcQjnCbKhhHoTdXEmUZWc0klkwIts=; b=ou+yJkRa8BgcnKOiIO79cU68V+a6lDtfPn77tSq1uUMG99vV7yMc4uT085Gk+QFjwh bcNEbh94jzcUEReSZZNbjgFuanpkTZG5rlrRqDQP8zUgQD8K0MDqR6/jVOS5VCbykf9H 7LiKeg0RDDIDpjsZHy4hf5RkZF7PCM+gVF5teCMjEHGMAwjQcdL1gHoCDoWSULQ4Gl9e SfnlgVanZ7oGAg8HxmPpyUHpw++u4U+VJlcAzezVtZEKM/Nq1C1twXDUrw5auv2ssG8C NJlHjGkaSXfYDpZ5toc5kb4KXdBnujSH1bEiAOLpDKih1j0VDwhRx+NP/SiyX+Ip+J/1 VUEw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00015.html">CA+CBx2Out3+Y+m3KNOWZ27hzRDt_DDRBKA9w3sSBswD2pjnzNw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XB0Em-0004T3-Dc@subversion.gna.org&gt; &lt;CAED9pY8HEP_L2W4yWT54woZcwphe+-R78Tk_JQSzjuRZDDS9QA@mail.gmail.com&gt; &lt;CA+CBx2PhNROsW=OopiUXAtPjygdwHHgt0c99EbE0xbT_VqF-Aw@mail.gmail.com&gt; &lt;<a href="msg00010.html">CAED9pY-bix+9gUcTuHo5VJZmsJbhynAgTDq7QW5qe3U3R-8ieA@mail.gmail.com</a>&gt; &lt;<a href="msg00011.html">CAED9pY9sjp5we2V4gscS-yxd0kumaLkKCCM+5KCrUS7FVqO+KQ@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on July 31, 2014 - 15:14:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Ok.

I will raise Errors until this feature is implemented.

But it should be straight forward to extend the code from now on.

Best
Troels

2014-07-31 14:04 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">If we design everything to work for both CPMG and R1rho, then this
will be incredibly easy to implement.  The concept of off-resonance
effects in the CPMG is identical as in R1rho, except that the angle
theta is much, much smaller as we are using hard pulses whereas the
spin lock pulse is much weaker.  But the idea is identical between the
two.  Therefore to implement it only requires a new numeric model from
Flemming's papers, and the user function for inputting the CPMG pi
pulse power and length to convert to w_eff, theta, etc.  The same
infrastructure for the R1rho is then used for this off-resonance
handling CPMG model.

Regards,

Edward



On 31 July 2014 12:40, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

The reference for this is the CATIA software and Flemming Hansen's
papers on the subject.  This will require a new numeric model - the
one that CATIA uses.  And a new user function for specifying the
details about the hard pi pulse.  The current set of models in relax
will not handle this.  This effect can be significant the closer the
peaks are to the top and bottom edge of the spectrum (assuming the
hard pi pulse is near the centre of the spectrum), and even more for
folded peaks.  So glycines are most affected.  No other software
handles this yet, only CATIA.  But the plan is to add this in the
future, which is why it is on the to do list
(<a  rel="nofollow" href="/manual/do_dispersion_features_yet_be_implemented.html">http://www.nmr-relax.com/manual/do_dispersion_features_yet_be_implemented.html</a>).

Regards,

Edward


On 31 July 2014 12:17, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

For this to work, could all CPMG models be expanded?

Or how is CPMG models influenced by offset?

I guess that special offset CPMG models needs to be implemented?

Best
Troels



2014-07-28 12:01 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

I would suggest maybe the following function names called from
plot_disp_curves():

plot_disp_curves_vs_disp_point()
plot_disp_curves_vs_offset()

The reason would be that the R1rho plots you have created are not
R1rho specific.  There is nothing stopping someone from doing this
with CPMG data, by just setting the pi pulse offset to different
nitrogen or carbon frequencies.  That is why I have made the offset
structures the same between R1rho and CPMG analyses.  The CPMG
analysis has offsets too, and this is one huge advantage CATIA has
compared to all other dispersion software - it handles the offsets
correctly.  The offset effect is much weaker in the CPMG experiment
compared to R1rho because of the hard pulses, but it is always present
and cannot be eliminated.

So if we design the offset parts in the dispersion analysis to work
for both R1rho and CPMG, that would be the best route for future
offset support in the CPMG analysis.  Just make the assumption that
CPMG data will be passed through everything you code into the
dispersion analysis - this will result in a cleaner design and allow
for powerful future advancements.  This is currently listed as the
first point in the TODO section of the dispersion chapter of the
manual 
(<a  rel="nofollow" href="/manual/do_dispersion_features_yet_be_implemented.html">http://www.nmr-relax.com/manual/do_dispersion_features_yet_be_implemented.html</a>).

Cheers,

Edward



On 26 July 2014 13:34,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Sat Jul 26 13:34:03 2014
New Revision: 24771

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=24771&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=24771&amp;view=rev</a>
Log:
Added functionality to plot R1rho R2 as function of effective field 
w_eff, for the R2eff model.

Also renamed a function, to better reflect is functionality.

The hard-coding of which models to plot, has been removed.
If the exp-type is R1rho, then the plotting will commence.

sr #3124(<a  rel="nofollow" href="https://gna.org/support/?3124">https://gna.org/support/?3124</a>): Grace graphs production for 
R1rho analysis with R2_eff as function of Omega_eff.
sr #3138(<a  rel="nofollow" href="https://gna.org/support/?3138">https://gna.org/support/?3138</a>): Interpolating theta through 
spin-lock offset [Omega], rather than spin-lock field strength [w1].

Modified:
    branches/r1rho_plotting/specific_analyses/relax_disp/data.py

Modified: branches/r1rho_plotting/specific_analyses/relax_disp/data.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/r1rho_plotting/specific_analyses/relax_disp/data.py?rev=24771&amp;r1=24770&amp;r2=24771&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/r1rho_plotting/specific_analyses/relax_disp/data.py?rev=24771&amp;r1=24770&amp;r2=24771&amp;view=diff</a>
==============================================================================
--- branches/r1rho_plotting/specific_analyses/relax_disp/data.py        
(original)
+++ branches/r1rho_plotting/specific_analyses/relax_disp/data.py        
Sat Jul 26 13:34:03 2014
@@ -1564,8 +1564,9 @@
     # Plot dispersion curves, extending over number of dispersion 
points.
     plot_disp_curves_disp(dir=dir, num_points=num_points, 
extend=extend, force=force, proton_mmq_flag=proton_mmq_flag, 
colour_order=colour_order)

-    # For R1rho models, interpolate theta through spin-lock offset 
rather than spin-lock field strength.
-    plot_disp_curves_r1rho(dir=dir, num_points=num_points, 
extend=extend, force=force, proton_mmq_flag=proton_mmq_flag, 
colour_order=colour_order)
+    # For R1rho models, interpolate through spin-lock field strength, 
and plot R1rho R2 as function of effective field in rotating frame 
w_eff.
+    if cdp.exp_type_list == [EXP_TYPE_R1RHO]:
+        plot_disp_curves_r1rho_r2_as_func_of_w_eff(dir=dir, 
num_points=num_points, extend=extend, force=force, 
proton_mmq_flag=proton_mmq_flag, colour_order=colour_order)

     # Write a python &quot;grace to PNG/EPS/SVG...&quot; conversion script.
     # Open the file for writing.
@@ -1703,7 +1704,7 @@
         add_result_file(type='grace', label='Grace', file=file_path)


-def plot_disp_curves_r1rho(dir=None, num_points=None, extend=None, 
force=None, proton_mmq_flag=None, colour_order=None):
+def plot_disp_curves_r1rho_r2_as_func_of_w_eff(dir=None, 
num_points=None, extend=None, force=None, proton_mmq_flag=None, 
colour_order=None):
     &quot;&quot;&quot;Custom 2D Grace plotting function for the dispersion curves, 
interpolating theta through spin-lock offset rather than spin-lock 
field strength.

     One file will be created per spin system.
@@ -1728,9 +1729,6 @@
         # Skip protons for MMQ data.
         if spin.model in MODEL_LIST_MMQ and spin.isotope == '1H':
             continue
-        # Skip for spin not in model list of r1rho models.
-        elif spin.model not in [MODEL_DPL94, MODEL_TP02, MODEL_TAP03, 
MODEL_MP05, MODEL_NS_R1RHO_2SITE]:
-            continue

         # Initialise some data structures.
         data = []
@@ -1749,7 +1747,7 @@
         interpolated_flag = False

         # The unique file name.
-        file_name = &quot;theta%s.agr&quot; % spin_id.replace('#', 
'_').replace(':', '_').replace('@', '_')
+        file_name = &quot;r1rho_r2_as_func_of_w_eff%s.agr&quot; % 
spin_id.replace('#', '_').replace(':', '_').replace('@', '_')

         if not spin.model in [MODEL_R2EFF]:
             # Interpolate through disp points.
@@ -1757,6 +1755,16 @@

         else:
             back_calc = None
+            spin_lock_nu1_new = None
+
+            # Number of spectrometer fields.
+            fields = [None]
+            field_count = 1
+            if hasattr(cdp, 'spectrometer_frq_count'):
+                fields = cdp.spectrometer_frq_list
+                field_count = cdp.spectrometer_frq_count
+
+            chemical_shifts, spin_lock_fields_inter, offsets_inter, 
tilt_angles_inter, Delta_omega_inter, w_eff_inter = 
return_offset_data(spins=[spin], spin_ids=[spin_id], 
field_count=field_count, fields=spin_lock_nu1_new)

         # Open the file for writing.
         file_path = get_file_path(file_name, dir)


_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00009" href="msg00009.html">Re: r24771 - /branches/r1rho_plotting/specific_analyses/relax_disp/data.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00010" href="msg00010.html">Re: r24771 - /branches/r1rho_plotting/specific_analyses/relax_disp/data.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00011" href="msg00011.html">Re: r24771 - /branches/r1rho_plotting/specific_analyses/relax_disp/data.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Aug 01 00:00:18 2014</div>  
</body>
</html>
