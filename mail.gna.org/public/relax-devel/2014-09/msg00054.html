<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r25348 &#45; /trunk/specific_analyses/relax_disp/data.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 02 Sep 2014 16:32:36 +0200 -->
<!--X-Message-Id: CAED9pY&#45;+3VT4FxUAn_ApphKi230a81yaoVuS9fw8e1GHvLFsxg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XMhc1&#45;0002D6&#45;LS@subversion.gna.org -->
<!--X-Reference: CAED9pY&#45;gfoK_Yt&#45;6AM49UNUJzCfmjN6nHe1iPMN0nsZqk36Vdw@mail.gmail.com -->
<!--X-Reference: CA+CBx2Nq1KD0sdkiLL0U7ahwHKO8Om_m6L+KreOJf8dHU==cAA@mail.gmail.com -->
<!--X-Reference: CAED9pY_wNn9O+RWwLuG8jwEJw2b60oN2Ozn6T+0OOB7FFE6FRQ@mail.gmail.com -->
<!--X-Reference: CAED9pY_Ewn=+iXefGNpdr4o130Ty+DUOxFRgUkdjCA7H&#45;chQxA@mail.gmail.com -->
<!--X-Reference: CA+CBx2Pe&#45;K4VNtL9oD1aapB+xfVqkJeJTFrwDEJA2n_BLSOLcw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;C7KkCqjcmtpPanzmPjcXqH7_WeFECzZm49zNWe&#45;vZ_A@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r25348 - /trunk/specific_analyses/relax_disp/data.py -- September 02, 2014 - 16:32</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r25348 - /trunk/specific_analyses/relax_disp/data.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00054" class="tabs">Index by Date</a> | <a href="threads.html#00054" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00053.html">Date Prev</a>] [<a href="msg00055.html">Date Next</a>] [<a href="msg00052.html">Thread Prev</a>] [<a href="msg00055.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 2 Sep 2014 16:32:05 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=uAm6LeUPByINWtzjNAiB3cXKtfS76HvI9O68e5RK6kU=; b=C+4/S1m5t24rINmAgwvReJ5Wz0Iye/VGnXN3Kl9rBUdeY7nelTUQwSNJHGFYYb4mY4 ar7KoDjhWIMZvPbrGw61Vwx9iaG/CXhkSDZyAfRFmP+vzQ6Mg6X+9yCmQWd0TKKg/ZgS Jq+vi/byw0RJdD03Q4LALA83vyppOXPEL4qy2DO+1aQBoy3FLuMgfTkHXcqpcHcuRRiu muOxhxXkKT3g6/k5Fu00p4f8mh/0Z+iPfsKlQM2ZUlmywaql5X1mSmHnwayUUl3mLbZ8 Go7toHqdOOFr0LU4ujNCwGoJA/xcGSD1KWF8AELToW9x7+ifBVMcYpVT9ldtE1GrM6yw vZ7Q==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00054.html">CAED9pY-+3VT4FxUAn_ApphKi230a81yaoVuS9fw8e1GHvLFsxg@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XMhc1-0002D6-LS@subversion.gna.org&gt; &lt;CAED9pY-gfoK_Yt-6AM49UNUJzCfmjN6nHe1iPMN0nsZqk36Vdw@mail.gmail.com&gt; &lt;CA+CBx2Nq1KD0sdkiLL0U7ahwHKO8Om_m6L+KreOJf8dHU==cAA@mail.gmail.com&gt; &lt;CAED9pY_wNn9O+RWwLuG8jwEJw2b60oN2Ozn6T+0OOB7FFE6FRQ@mail.gmail.com&gt; &lt;CAED9pY_Ewn=+iXefGNpdr4o130Ty+DUOxFRgUkdjCA7H-chQxA@mail.gmail.com&gt; &lt;CA+CBx2Pe-K4VNtL9oD1aapB+xfVqkJeJTFrwDEJA2n_BLSOLcw@mail.gmail.com&gt; &lt;CAED9pY-C7KkCqjcmtpPanzmPjcXqH7_WeFECzZm49zNWe-vZ_A@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on September 02, 2014 - 16:32:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

You'll now find that the spectrum.error_analysis user function button
in the spectrum list GUI element is now implemented.  I'm not sure
what I'll do with the other parts yet.

Regards,

Edward


On 28 August 2014 10:38, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

Right, it's missing from the GUI!  I assumed that it was part of the
peak intensity loading wizard, but that is not correct.  I'll have to
think where the best place for this would be.  It would have to be
after the 'Spectra list' GUI element.  Or maybe it could be a button
in that element, after the 'Add' and 'Delete' buttons.  Then I'd need
to check it when the 'Execute' button is clicked on so that the error
window is shown and the auto-analysis blocked.

Cheers,

Edward



On 28 August 2014 10:25, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I will know, that this will cause some problems.

The button should be part of the GUI, so it can be seen.

There should maybe be a &quot;helper&quot; function, or the error message show
what is wrong, AND give a suggestion.

For example:
  &quot;The error analysis is not set up&quot;.
  &quot;Based on your data, you could try:
     spectrum.error_analysis(subset=[''])
     spectrum.error_analysis(subset=[''])
     spectrum.error_analysis(subset=[''])

Best
Troels

2014-08-28 10:06 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

What is your opinion on forcing the user to perform the error analysis
themselves prior to starting the auto-analysis?  I have made the
change, though not committed it.  This will require the
spectrum.error_analysis user function to be added to 16 system tests
to allow them to pass again.

Cheers,

Edward



On 28 August 2014 09:56, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

I've just looked at the auto-analysis error_analysis() method and can
see how bad this code is!  It must be a remnant from very early on in
the implementation of the dispersion analysis.  I'll look at removing
this broken logic.  As for the backend function, if it's only for your
own purposes that's ok.

Cheers,

Edward



On 28 August 2014 09:48, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Dear Edward.

This method is a copy of the one implemented in the auto analysis 
protocol.

It was not intended to implement a new functionality.

Since this is a back-end function, and &quot;hard&quot; to reach, I will prefer
to let it stay there.
But let me know if I should remove it.

Best
Troels

2014-08-28 9:02 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

This should really be performed by the user and not automatically by
relax.  The current spectrum sub-setting you perform is no good.
Sometimes a user will have different settings for the same
spectrometer but for different offsets, for example they may change
the spectral width.  A good example is of HEHAHA experiments where you
only look at a spectrum with a single peak (you isolate each peak).
There is actually no sub-setting assumptions you can make
automatically here for the user that will be correct.  There are far
too many error analysis combinations that a user could come up with.
The best behaviour is to raise a RelaxError to tell the user that they
forgot to do something.  I would strongly prefer that this automatic
behaviour is not used, it's far to risky and will cause users to
perform something incorrectly without them ever knowing!

Cheers,

Edward





On 27 August 2014 20:06,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Wed Aug 27 20:06:24 2014
New Revision: 25348

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=25348&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=25348&amp;view=rev</a>
Log:
Added method to automatically perform error analysis on peak heights.

task #7822(<a  rel="nofollow" href="https://gna.org/task/index.php?7822">https://gna.org/task/index.php?7822</a>): Implement user 
function to estimate R2eff and associated errors for exponential 
curve fitting.

Modified:
    trunk/specific_analyses/relax_disp/data.py

Modified: trunk/specific_analyses/relax_disp/data.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/data.py?rev=25348&amp;r1=25347&amp;r2=25348&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/data.py?rev=25348&amp;r1=25347&amp;r2=25348&amp;view=diff</a>
==============================================================================
--- trunk/specific_analyses/relax_disp/data.py  (original)
+++ trunk/specific_analyses/relax_disp/data.py  Wed Aug 27 20:06:24 
2014
@@ -68,13 +68,14 @@
 from lib.physical_constants import g1H, return_gyromagnetic_ratio
 from lib.sequence import read_spin_data, write_spin_data
 from lib.software.grace import write_xy_data, write_xy_header, 
script_grace2images
+from lib.text.sectioning import section
 from lib.warnings import RelaxWarning, RelaxNoSpinWarning
 from pipe_control import pipes
 from pipe_control.mol_res_spin import check_mol_res_spin_data, 
exists_mol_res_spin_data, generate_spin_id_unique, 
generate_spin_string, return_spin, spin_loop
 from pipe_control.result_files import add_result_file
 from pipe_control.selection import desel_spin
 from pipe_control.sequence import return_attached_protons
-from pipe_control.spectrum import add_spectrum_id
+from pipe_control.spectrum import add_spectrum_id, error_analysis
 from pipe_control.spectrometer import check_frequency, get_frequency
 from pipe_control import value
 import specific_analyses
@@ -247,6 +248,50 @@

     # Return the dic and list of keys
     return [theta_spin_dic, Domega_spin_dic, w_eff_spin_dic, 
dic_key_list]
+
+
+def check_intensity_errors(spin_id=None):
+    &quot;&quot;&quot;Check if intensity errors have already been calculated by the 
user.
+
+    @keyword spin_id:           The spin identification string.
+    @type spin_id:              str
+    &quot;&quot;&quot;
+
+    # Check if intensity errors have already been calculated by the 
user.
+    precalc = True
+    for cur_spin, mol_name, resi, resn, cur_spin_id in 
spin_loop(selection=spin_id, full_info=True, return_id=True, 
skip_desel=True):
+        # No structure.
+        if not hasattr(cur_spin, 'peak_intensity_err'):
+            precalc = False
+            break
+
+        # Determine if a spectrum ID is missing from the list.
+        for id in cdp.spectrum_ids:
+            if id not in cur_spin.peak_intensity_err:
+                precalc = False
+                break
+
+    # If no error analysis of peak heights exists.
+    if not precalc:
+        # Printout.
+        section(file=sys.stdout, text=&quot;Error analysis&quot;, prespace=2)
+
+        # Loop over the spectrometer frequencies.
+        for frq in loop_frq():
+            # Generate a list of spectrum IDs matching the frequency.
+            ids = []
+            for id in cdp.spectrum_ids:
+                # Check that the spectrometer frequency matches.
+                match_frq = True
+                if frq != None and cdp.spectrometer_frq[id] != frq:
+                    match_frq = False
+
+                # Add the ID.
+                if match_frq:
+                    ids.append(id)
+
+            # Run the error analysis on the subset.
+            error_analysis(subset=ids)


 def count_exp():


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Sep 02 19:20:11 2014</div>  
</body>
</html>
