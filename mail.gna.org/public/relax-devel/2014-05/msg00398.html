<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor? -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 20 May 2014 19:40:11 +0200 -->
<!--X-Message-Id: CAED9pY8+yw1ERyMw=0ji0eFGych_GCKuTBvCpn5GW5irqa+u8A@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140520&#45;000356.sv20529.92877@gna.org -->
<!--X-Reference: 20140520&#45;000436.sv20529.46737@gna.org -->
<!--X-Reference: CAED9pY9dgTO=XEMitiXkucSttRHH4dwnV6KEwqz4jTxHRarvcQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2Pt5q2E0tnvhxq2ocY2NqYmiB1jqqb61M5cBZXeywtYPg@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;Wo4sSemWQG2AA5eEr&#45;h01oJz7UcsvKE86P35K107MoQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2MMboJqj56A8hohcCX1XtTjAVHNAP50O73QxAv8b9c9sA@mail.gmail.com -->
<!--X-Reference: CAED9pY9Wfa4bTRVE2rNs_3WsCL7STFEyQs_yFPW85YEnUSXfXw@mail.gmail.com -->
<!--X-Reference: CA+CBx2MHb9tGgkCOu=vJ2ibzp3DqQYSu=oO2ejHOZVfB7RkwAQ@mail.gmail.com -->
<!--X-Reference: CAED9pY_5PLxmULMB9vDV_afcE=ugrWVwRjp+nu2vu1F+nMfMOQ@mail.gmail.com -->
<!--X-Reference: CAED9pY9&#45;e=QUcjTzHJxqzL8aOhp2XtNXMdJuJi5Or4VCvzOt3g@mail.gmail.com -->
<!--X-Reference: CA+CBx2PLZH8emi0GhhDJBJhQdB1JmUeB_VBVvtzU8ggUXbvtNA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor? -- May 20, 2014 - 19:40</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00398" class="tabs">Index by Date</a> | <a href="threads.html#00398" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00397.html">Date Prev</a>] [<a href="msg00399.html">Date Next</a>] [<a href="msg00397.html">Thread Prev</a>] [<a href="msg00387.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 20 May 2014 19:39:20 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;, Gary Thompson &lt;garyt@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=YfgGGxVEFFm1XIKwwYDuU/xiFXeRVcbqPWBZxMi1brE=; b=nrHkFhfgCYm2EpN7LQ74A/hPtpe20vRo0OfAThxcvMtFa7EN79IbNUnY7nVNNEycsr 94FQ+0/RF+TcLmnKDa5bj4JNIsFjAsbgwech4jtSEkeFgFjD9EGQvTopyMBAd+neKCjs cVGgX8gAmvd3ZGPTR6GWMGsC/njXhIYVm19XNXSqYWO+xrVwDJsx8fLAYLvP91pRRg64 RFQEBFBJwv+Jk7HzAehyHJmuKJHk/zsLg8ezbfGIduw1zFPiGaLnrIeLEVeNMZfK04/A lBKlrF25J9bUrBT2WGqPdLh2F4m8TNJzEkl4MIbrpUBDdfLrS4jpKYpSm+we4JBc+bBJ 3wNQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY8+yw1ERyMw=0ji0eFGych_GCKuTBvCpn5GW5irqa+u8A@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00377.html">20140520-000356.sv20529.92877@gna.org</a>&gt; &lt;<a href="msg00378.html">20140520-000436.sv20529.46737@gna.org</a>&gt; &lt;CAED9pY9dgTO=XEMitiXkucSttRHH4dwnV6KEwqz4jTxHRarvcQ@mail.gmail.com&gt; &lt;<a href="msg00386.html">CA+CBx2Pt5q2E0tnvhxq2ocY2NqYmiB1jqqb61M5cBZXeywtYPg@mail.gmail.com</a>&gt; &lt;<a href="msg00390.html">CAED9pY-Wo4sSemWQG2AA5eEr-h01oJz7UcsvKE86P35K107MoQ@mail.gmail.com</a>&gt; &lt;<a href="msg00391.html">CA+CBx2MMboJqj56A8hohcCX1XtTjAVHNAP50O73QxAv8b9c9sA@mail.gmail.com</a>&gt; &lt;<a href="msg00392.html">CAED9pY9Wfa4bTRVE2rNs_3WsCL7STFEyQs_yFPW85YEnUSXfXw@mail.gmail.com</a>&gt; &lt;CA+CBx2MHb9tGgkCOu=vJ2ibzp3DqQYSu=oO2ejHOZVfB7RkwAQ@mail.gmail.com&gt; &lt;CAED9pY_5PLxmULMB9vDV_afcE=ugrWVwRjp+nu2vu1F+nMfMOQ@mail.gmail.com&gt; &lt;CAED9pY9-e=QUcjTzHJxqzL8aOhp2XtNXMdJuJi5Or4VCvzOt3g@mail.gmail.com&gt; &lt;<a href="msg00397.html">CA+CBx2PLZH8emi0GhhDJBJhQdB1JmUeB_VBVvtzU8ggUXbvtNA@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on May 20, 2014 - 19:40:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">It might be quite useful for you.  It may tell you that some of the
test cases that have really been bugging you can be safely ignored.

Regards,

Edward



On 20 May 2014 19:31, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Ed.

Hm, I have thought about this before.

And thought I had written it up as a task.

I will do it now.
My supervisor has also asked for this feature.

best
Troels



2014-05-20 18:56 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

In your testing, for sanity you may also want to look at calculating
the alpha value from:

    - Millet, O. et al. (2000) The static magnetic field dependence of
chemical exchange linebroadening defines the NMR chemical shift time
scale. J. Am. Chem. Soc., 122, 2867–2877.
(<a  rel="nofollow" href="http://dx.doi.org/10.1021/ja993511y">http://dx.doi.org/10.1021/ja993511y</a>).

Specifically equation (20).  This calculation could behind a user
function called relax_disp.calc_alpha.  You could calculate it
directly from the optimised parameters or from the experimental R2eff
values.  According to the paper:

    0 &lt;= alpha  &lt; 1     slow exchange,
    alpha = 1   intermediate exchange,
    1 &lt; alpha &lt;= 2    fast exchange.

This will help you determine if your parameters are in the correct
exchange regime for the model you are studying.  This is implemented
as part of the ShereKhan web interface, click on the [i] button next
to &quot;Residue Selection&quot; for details.

For your testing of the CR72 model, you will require an alpha value
between 0 and 1.  Fast exchange will cause the dw and pA values to
convolute and merge, so you cannot distinguish them.  Hence
optimisation will look like it has failed.  You can have different dw
and pA value combinations to produce the same phi_ex value, and it
will be impossible to find the original values again.  That is why
there are fast exchange models with the phi_ex parameter.

Regards,

Edward



On 20 May 2014 17:46, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

In this case, we need to perform a careful comparison between relax
and other software - by generating input data and see how both
programs respond.  The key is to identify if the problem is in the
implementation (i.e. the relax code) or in the theory (the equations).
 We can fix the first, not the second (the solution to the second is
to use a different model).  The problem also needs to be carefully
stated:  Using the parameter set {x: 1.0, y: 2.0} and model Z, and
setting the R2eff errors to 0.1, R2eff values were back calculated;
then this perfect R2eff data was optimised against model Q.

To standardise such a problem it might be worth creating a
relax_disp.r2eff_back_calc user function.  The contents of this is
already in your scripts.  This would simplify the scripts and help
with debugging.

The chi2 surface from the CR72_fail_one_field.py script also shows no
clear minimum which means, assuming the CR72 code in relax is correct
(and it matches ShereKhan perfectly), that the problem is not well
conditioned.  Why this is the case needs to be investigated.  Is it
relax's implementation?  Or is it the CR72 model itself?  You can set
up the exact same grid search relax uses in ShereKhan, so that is a
good reference test.  It is well known that the CR72 model does not
hold in all cases, so it is likely that you have hit such a case here.
 This is the reason why there are now so many alternative dispersion
models.

Regards,

Edward





On 20 May 2014 16:49, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Ed.

This is a very difficult case, but I am sure that relax has failed in
the error catching, making
the simplex algorithm to fail, when computing certain math domain errors.

The data I am referring to is:
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/5302">http://thread.gmane.org/gmane.science.nmr.relax.devel/5302</a>

I have proven in:
<a  rel="nofollow" href="https://gna.org/bugs/?22024">https://gna.org/bugs/?22024</a>
bug #22024: Minimisation space for CR72 is catastrophic. The chi2
surface over dw and pA is bounded.

That relax fail to find values, even when dw is 1 ppm.

I will fix the speed-up, and rerun the data to see if it has been fixed.

Best
Troels


2014-05-20 15:43 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Thanks for fixing the bug!
</pre></blockquote><pre style="margin: 0em;">

No problems.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">But I think the worst most pity thing, is that I have waster 1/4-1/2
year of my PhD to fix this bug:

bug #22032: Minimisation explodes when using Grid_INC=None
<a  rel="nofollow" href="https://gna.org/bugs/index.php?22032">https://gna.org/bugs/index.php?22032</a>
</pre></blockquote><pre style="margin: 0em;">

I'm still trying to work out what this bug is about.  But if you start
optimising with the dw = 0.0, this is not a bug!  You just cannot ever
start optimising from there.  Not many optimisation algorithms can
survive that and find the real solution (global optimisation
algorithms such as simulated annealing and genetic algorithms
excluded).  If you simplify the CR72 equations with dw = 0.0, you will
see that pA, pB, and kex fall out of the equation and you actually end
up with R2eff = R20.  This is expected as when the chemical shift
difference is zero, there is no chemical exchange.  Therefore when dw
= 0.0, then the pA and kex parameters are undefined.   Undefined
parameters kill many optimisation algorithms - this is why you'll see
order parameters of 1 often in a model-free analysis (prior to people
using relax), as in this case the tau_e correlation time parameter is
undefined.

This bug is however only 9 days old.  Do you mean one of the other bugs?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">My last three weeks analysis have shown that the error catching at
boundary values had a huge impact on the minimisation search. It
simply went to scrap.
</pre></blockquote><pre style="margin: 0em;">

Before or after?  Do you have an example that can be converted into a
system test?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">This was also the case when running grid search. Touching the math
domain errors, caught simplex to stop.
<a  rel="nofollow" href="https://gna.org/bugs/download.php?file_id=20704">https://gna.org/bugs/download.php?file_id=20704</a>
<a  rel="nofollow" href="https://gna.org/bugs/download.php?file_id=20698">https://gna.org/bugs/download.php?file_id=20698</a>
</pre></blockquote><pre style="margin: 0em;">

These files are not attached to bug #22032
(<a  rel="nofollow" href="https://gna.org/bugs/index.php?22032">https://gna.org/bugs/index.php?22032</a>).  This is rather bug #22024
(<a  rel="nofollow" href="https://gna.org/bugs/?22024">https://gna.org/bugs/?22024</a>).  However, it is clear from those
chi-squared surfaces that there is nothing to optimise to.  There is
no clear minimum within the space.  We should discuss things under
each separate bug report.

As I mentioned before, this one is not really a bug.  This is simply
what happens when you have very accurate optimisation combined with a
poorly conditioned problem - i.e. the parameter values are close to
insignificance.  This is an edge case, and no one in the field will
care for such a case as its statistical significance is orders of
magnitude less than zero ;)  I wouldn't bother wasting time on that
one, as the only real tool you can use from the field of mathematical
optimisation is a re-parametrisation of the problem.  I used this in
the model-free analysis to go from the {S2f, S2s, ts} parameters to
{S2, S2s, ts} for the 2 time scale models.  This had a huge effect on
optimisation and such problems.  But in the relaxation dispersion
analysis, it will be rather difficult to come up with a new parameter
set.  And rather pointless just to solve such a difficult edge case.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I have tried so hard to understand why the behaviour of relax is
different from other programs.
</pre></blockquote><pre style="margin: 0em;">

Do you have data showing that other software with the same input data
gives different results?  From all my testing, I don't see this:

<a  rel="nofollow" href="http://svn.gna.org/viewcvs/*checkout*/relax/trunk/test_suite/shared_data/dispersion/software_comparison?revision=HEAD">http://svn.gna.org/viewcvs/*checkout*/relax/trunk/test_suite/shared_data/dispersion/software_comparison?revision=HEAD</a>

Well, apart from the expected differences due to bugs, strange
assumptions of certain old software, and the differences Andy
mentioned (this never reached the mailing list as he had an
attachment!).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I have tested, and inspected code, and tried other programs. relax was
just stubborn.
</pre></blockquote><pre style="margin: 0em;">

Could you present such comparisons on the mailing list?  Which
software found the solution that relax could not?  And how was relax
set up?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Realising this issue has been a relieve!

I am happy that the processor.run_queue() bug only is related to the 
test-suite.
It hopefully did not affect production???
</pre></blockquote><pre style="margin: 0em;">

It is only visible in the test suite, and only if certain tests fail.
It is only annoying for relax developers.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I can have night-mares about these bugs, as that can mean that
scientists are wasting their time.
Including mine.
</pre></blockquote><pre style="margin: 0em;">

This bug is not an issue for relax users.  They cannot be affected by
it.  Other bugs can however, and that is why relax has a test suite.
It is also the reason for the existence of relax - because I found
insanely fatal bugs in other NMR dynamics software that had been used
for 20 years!

Anyway, to save your time with the dispersion work, you should follow
a few simple rules.  If the dispersion curve is insignificant, i.e.
the difference of the maximum and minimum R2eff value is less than a
certain value, say 0.5 rad.s^-1, then don't bother with it!  Most of
the dispersion bug reports where you report optimisation problems fall
into this category.  I strongly doubt that any other dispersion
software will handle these cases - they will give different results
but also not find the real solution (this is likely to be the source
of differences you see to published results).  And never start
optimisation for positions where other parameters are undefined - i.e.
dw = 0.0.  That covers the other half of the bug reports.  You are
otherwise battling nearly impossible battles.

Regards,

Edward
</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00377" href="msg00377.html">[bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00378" href="msg00378.html">[bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00379" href="msg00379.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00386" href="msg00386.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00390" href="msg00390.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00391" href="msg00391.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00392" href="msg00392.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00393" href="msg00393.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00394" href="msg00394.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00395" href="msg00395.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00397" href="msg00397.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue May 20 21:40:13 2014</div>  
</body>
</html>
