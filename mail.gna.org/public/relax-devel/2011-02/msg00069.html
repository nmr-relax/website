<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Wed, 23 Feb 2011 15:47:30 +0100 -->
<!--X-Message-Id: AANLkTiknvLRaCTK7Q&#45;EwJ1iqbtSqmnQk&#45;B=v=WvF7r=y@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: AANLkTin7c+5hh7DHW7B4V_xqTf8v3+O292FVFOsYtFBs@mail.gmail.com -->
<!--X-Reference: 4D6227A7.5040309@bruker&#45;biospin.de -->
<!--X-Reference: AANLkTikiVg1B3nDcGAu9hBZ57UJ=dVjOfazxaE&#45;Jw5UN@mail.gmail.com -->
<!--X-Reference: 4D6275CE.6040809@bruker&#45;biospin.de -->
<!--X-Reference: AANLkTikPDik5KkG717K7CsVtfStNPLDPELOVXObTSoa9@mail.gmail.com -->
<!--X-Reference: 4D63908C.5060101@bruker&#45;biospin.de -->
<!--X-Reference: AANLkTikfazUkXk+bD+bqK13ca6Hniek3n5g+rqNJQdtN@mail.gmail.com -->
<!--X-Reference: 4D64F093.6060803@bruker&#45;biospin.de -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation. -- February 23, 2011 - 15:47</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00069" class="tabs">Index by Date</a> | <a href="threads.html#00069" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00068.html">Date Prev</a>] [<a href="msg00070.html">Date Next</a>] [<a href="msg00068.html">Thread Prev</a>] [<a href="msg00070.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Dr. Klaus-Peter Neidig&quot; &lt;peter.neidig@xxxxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 23 Feb 2011 15:46:55 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;, &quot;Neidig,	Klaus-Peter&quot; &lt;Klaus-Peter.Neidig@xxxxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:mime-version:sender:in-reply-to:references:date	:x-google-sender-auth:message-id:subject:from:to:cc:content-type	:content-transfer-encoding;	bh=PP2Nr1Dss9JABI0RhaXxhdZh3x5rMGm0IomDobQOIEk=;	b=gMZzg9vZQSbK/AGy25q+BPQDdmuYOENUbBLcQjrJR4TW6mIMO8LBdcqbfsEymBcLjl	E7kr22fttUnpX1J0q+OYitoFypOVqTEVAkJ5qWDNR4NknnkQLow9Aq2I2cihEtZU30ip	smLEpL7hc1gxOAYvcASpoZ9HGp+uLa79Y3L0A=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00069.html">AANLkTiknvLRaCTK7Q-EwJ1iqbtSqmnQk-B=v=WvF7r=y@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;AANLkTin7c+5hh7DHW7B4V_xqTf8v3+O292FVFOsYtFBs@xxxxxxxxxxxxxx&gt;	&lt;4D6227A7.5040309@xxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTikiVg1B3nDcGAu9hBZ57UJ=dVjOfazxaE-Jw5UN@xxxxxxxxxxxxxx&gt;	&lt;4D6275CE.6040809@xxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTikPDik5KkG717K7CsVtfStNPLDPELOVXObTSoa9@xxxxxxxxxxxxxx&gt;	&lt;4D63908C.5060101@xxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTikfazUkXk+bD+bqK13ca6Hniek3n5g+rqNJQdtN@xxxxxxxxxxxxxx&gt;	&lt;4D64F093.6060803@xxxxxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on February 23, 2011 - 15:47:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Dear Peter,

Please see below:


On 23 February 2011 12:33, Dr. Klaus-Peter Neidig
&lt;peter.neidig@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Dear Edward,

I will provide the other output file examples  as soon as  the format is 
accepted by you. We still
have a few points open.

The relation between dialog window and ouput:
dialog                                            explanation               
                                              appears in output as
error estimation by fit                   all errors are unknown but the 
same for all y      &quot;from fit using arbitray y uncertainties&quot;
error estimation by weighted fit   errors as listed in the output are used  
              &quot;from fit using calculated y uncertainties&quot;
error estimation by Monte Carlo  N fits with synthetically modified y 
values          &quot;from Monte Carlo simulations&quot;
</pre></blockquote><pre style="margin: 0em;">

Ah, ok, that explanation helps.  Maybe the explanation could be
expanded a little as both &quot;error estimation by weighted fit&quot; and
&quot;error estimation by Monte Carlo&quot; use the same errors from the &quot;used
intergral error&quot; section.  The first appears to be the covariance
matrix estimate.  Is this correct?  What is the technique used in
&quot;error estimation by fit&quot;?  Is this where the target function is
actually the SSE (sum of squared errors) rather than the chi2, so that
the errors are coming from the residuals of the fit?  I think the
explanation should identify the exact source of the errors, the target
function, and the precise technique used (i.e. covariance matrix,
Monte Carlo, etc.).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">errorScale:
Matlab and other software packages  provide the fit results within 
confidence bounds which depend on a confidence
level and number of degrees of freedom. The formula is c  = f +/- t* fErr. 
f would be the fitted parameter value,
fErr is the fit parameter error as coming out of Marquardt or MC, t is 
calculated.
</pre></blockquote><pre style="margin: 0em;">

This is too complex :S  Most users will likely be confused by this -
they will not know that the standard deviation (sd) on the relaxation
rates is equal to t*fErr.  They will be reporting fErr rather than the
standard deviation as they should.  The error bars in R1 and R2
figures must be standard deviations
(<a  rel="nofollow" href="http://en.wikipedia.org/wiki/Error_bar">http://en.wikipedia.org/wiki/Error_bar</a>), or alternatively the
standard error.  The reported relaxation rates also need to be the
mean (from the fit) and sd.  All subsequent analyses require the sd
and not fErr.

There is a much simpler alternative.  It is simple error propagation
(<a  rel="nofollow" href="http://en.wikipedia.org/wiki/Propagation_of_uncertainty">http://en.wikipedia.org/wiki/Propagation_of_uncertainty</a>).  This
concept is much simpler and there is no confidence levels or degrees
of freedom used.  The aim is to transfer the errors (sd) in the peak
heights or volumes to the fitted R1 or R2 errors (sd).  So using Art
Palmer's notation from his 1991 paper, we are converting the peak
height sd sigma_h to sigma_R1 or sigma_R2 via Monte Carlo simulations.
We are going from the sd in the base data to the sd in the parameters.

All current NMR software that I know of follows this simple error
propagation principle.  The standard error propagation technique, if a
direct formula cannot be derived, is Monte Carlo simulations.  Other
lower quality techniques are sometimes used such as Jackknife
simulations and sometimes the very rough covariance matrix estimate.

The complexity used by the PDC is not necessary and most users will
not understand the errors they are presented with.  If they are not
using relax to read the PDC file and convert the times to rates and
the fErr to a sd, this will be very bad for model-free analysis,
reduced spectral density mapping, SRLS, etc. (ok, the word
catastrophic would be more apt).  Excluding this confusion, most users
will even have a problem converting from the sd of the times Tx to the
sd of the rates Rx, as required for all subsequent analyses!  relax,
Modelfree4, Dasha, and Tensor2 (the most commonly used programs) all
require rates and the sd of the rates - they do not accept times.

Would it be possible to extend the PDC format in the results section
to include not only all of the current columns but to also add the Tx
standard deviation (t*fErr), the Rx value, and the Rx sd?  If the user
is presented with the fErr value and the standard deviation, they will
instantly recognise which is the correct to use.  Also presenting the
rates and their errors:

R1 = 1/T1
sigma_R1 = sigma_T1 / T1^2

Then the user will not make mistakes in the absolutely required
conversion process.  So for example:

SECTION:         results
Peak name          F1 [ppm]        F2 [ppm]        T1 [s]          fErr    
errorScale   
T1 sd [s]          R1 [rad.s-1]    R1 sd [rad.s-1]
Gln [2]     122.508           8.898        0.4560        0.0068944         
2.2281       
0.0030942        2.192982          0.0148805


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The pdf output of the PDC shows f and (t*fErr) but you only want f and 
fErr. Therefore I have added an extra column
for you, called it errScale and put t into it. The column contains always 
the same number since at the moment
all peaks are fitted to the same model function and there is one user 
defined confidence level.
</pre></blockquote><pre style="margin: 0em;">

Most users won't know what to do with the fErr, or even how it is
useful, so I would recommend presenting both fErr and the basic sd.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">This whole thing has nothing to do with NC_Proc. NC_proc for the scaling of 
all datapoints of spectra. This is because
Bruker originally did the FTT in integer arithmetic. To use as many bits as 
possible in the integers the data are scaled up
by 2**NC_proc. The parameter NC_proc is stored and any software can do the 
reverse calculation to get different spectra
comparable.
</pre></blockquote><pre style="margin: 0em;">

Ok, I was not sure how t and fErr were derived.  I'm quite familiar
with nc_proc and the ancient convention of the integer storage of the
ser file.  The scaling concept is much clearer with the formula c  = f
+/- t* fErr.  I can see exactly what it is now.  fErr is the half
measure of 95% of the spread of the distribution, assuming a 95%
confidence limit.  And t is the parameter converting this back to the
standard deviation.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Monte Carlo:
We had a first initial internal meeting and there were some shaking heads 
here. I have furthermore searched
the internet for other software packages and articles and what we offer as 
Monte Carlo is indeed what many
others do as well offer as Monte Carlo. We agreed to go into some more 
details within  the next few days, one
collegue will do some Matlab simulations  and we will have another meeting 
then. So for the moment I would
not change anything in the PDC related to this topic.
</pre></blockquote><pre style="margin: 0em;">

One thing to be careful of is the direct calculation.  The R1 and R2
use optimisation.  But the NOE uses a direct calculation.  Hence the
back-calculated value for the NOE is the original value.  So if one
uses Monte Carlo simulations for the NOE, this collapses to the
bootstrap technique.

Also please don't be tricked by similarity of numbers.  Comparing the
numbers from Bootstrapping verses those of Monte Carlo simulations is
of no use, as one doesn't know the real errors.  This is not how one
should judge Bootstrapping verses Monte Carlo simulations.  There is
one case where Bootstrapping can be used.  This is when the original
errors in peak heights or volumes are not known.  Then it can be used.
 However it is still very bad and techniques such as Jackknife
simulations have been developed to improve this situation and remove
the Bootstrap bias.

This is a complex topic of information theory and numerical analysis
books will usually just state that Monte Carlo simulations is the gold
standard and that Bootstrapping is not the way to go.  A relatively
simple explanation is given in short PDF file at
<a  rel="nofollow" href="http://www.terry.uga.edu/~satkinso/8120/8120_montebs.pdf">http://www.terry.uga.edu/~satkinso/8120/8120_montebs.pdf</a>.  Here they
mention how the Jackknife technique is for removing the bias of the
Bootstrapping technique.  The also mention that bootstrapping is for
when there are no known original errors and that you use the residuals
of the fit, though this is one of the other Bootstrapping techniques
(this PDF talks about 3 of the many types).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">People here accept that Marquardt's covariance method might cause problems 
depending on function and
actual data but for the relaxation functions it worked well and gave very 
similar results to what you obtained.
So it can't be that bad. It might be a more serious problem for other 
functions of course.
</pre></blockquote><pre style="margin: 0em;">

I would consider it ok.  Note that the covariance matrix error
estimate and Levenberg-Marquardt are completely distinct concepts
derived 100% independently and coming from different areas of
numerical analysis.  The covariance estimate is not ideal, but the
exponential functions are not very complex and there is not much
convolution between the fitted parameters.  This can be seen in the
matrix, the off-diagonal elements of the covariance matrix should be
much lower than the diagonal, i.e. there should be not much
covariance.  If this is the case, then the covariance estimate should
be ok.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">So, tell me if you want to other output files at current status or are 
there small things that should be changed
first.
</pre></blockquote><pre style="margin: 0em;">

It might be best to attach the files to <a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/?7180">https://gna.org/task/?7180</a>
after things are sorted out a little.

Cheers,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00070" href="msg00070.html">RE: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation.</a></strong>
<ul><li><em>From:</em> Neidig, Klaus-Peter</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00054" href="msg00054.html">Addition of PDC support to relax 1.3.10 and an inconsistency in the	error calculation.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00057" href="msg00057.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency	in the error calculation.</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
<li><strong><a name="00059" href="msg00059.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00060" href="msg00060.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency	in the error calculation.</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
<li><strong><a name="00062" href="msg00062.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00066" href="msg00066.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency	in the error calculation.</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
<li><strong><a name="00067" href="msg00067.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00068" href="msg00068.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency	in the error calculation.</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Feb 23 19:40:13 2011</div>  
</body>
</html>
