<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Launching the GUI from relax. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 01 Dec 2009 11:06:08 +0100 -->
<!--X-Message-Id: 7f080ed10912010205i44e31b16g4ea6e5b1060eb90d@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7f080ed10911190611m1c309d9ela46671524abaf315@mail.gmail.com -->
<!--X-Reference: 4B0F5DF9.30407@gmx.ch -->
<!--X-Reference: 7f080ed10911270009p48d2d867g5ce5b1889b4ca29a@mail.gmail.com -->
<!--X-Reference: 4B14AC3A.6030702@gmx.ch -->
<!--X-Reference: 7f080ed10912010044j3e38ddeem4fc5e4a513567c83@mail.gmail.com -->
<!--X-Reference: 4B14DCD5.6050803@gmx.ch -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Launching the GUI from relax. -- December 01, 2009 - 11:06</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Launching the GUI from relax.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00004" class="tabs">Index by Date</a> | <a href="threads.html#00004" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00003.html">Date Prev</a>] [<a href="msg00005.html">Date Next</a>] [<a href="msg00003.html">Thread Prev</a>] [<a href="msg00005.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Michael Bieri &lt;michael.bieri@xxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 1 Dec 2009 11:05:28 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00004.html">7f080ed10912010205i44e31b16g4ea6e5b1060eb90d@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;7f080ed10911190611m1c309d9ela46671524abaf315@xxxxxxxxxxxxxx&gt;	&lt;4B0F5DF9.30407@xxxxxx&gt;	&lt;7f080ed10911270009p48d2d867g5ce5b1889b4ca29a@xxxxxxxxxxxxxx&gt;	&lt;4B14AC3A.6030702@xxxxxx&gt;	&lt;7f080ed10912010044j3e38ddeem4fc5e4a513567c83@xxxxxxxxxxxxxx&gt;	&lt;4B14DCD5.6050803@xxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on December 01, 2009 - 11:06:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Ah, right.  I found it.  The problem is that certain arguments are set
to None when they should have values.  Have a look at the code for the
prompt.minimise.Minimisation.minimise() method (the minimise() user
function).  Though the code is complex, you will see that default
values for func_tol, max_iterations, constraints, scaling, and
verbosity are set.  You will have to manually supply these defaults
with the same values as the minimise() user function defaults to, if
the GUI does not allow the user to change these properties yet.  This
should fix the problem.

Also, if you are making changes to the code, could you submit these as
patches, attaching them to the task?  If the patch is too big for me
to correctly review and comment on, that almost always results in a
rejection in a group developed software project.

Cheers,

Edward



2009/12/1 Michael Bieri &lt;michael.bieri@xxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Thank you!

Now, there is another problem in minimisation:

Traceback (most recent call last):
 File &quot;/home/michael/Programme/relax_bieri_gui/gui_bieri/relax_gui.py&quot;,
line 2695, in exec_t2_1
   make_tx(self.resultsdir_t11.GetValue(), t1_list, relax_times_t1_1,
self.structure_t11.GetValue(), self.nmrfreq_value_t11.GetValue(), 1, 1,
self.unresolved_t11.GetValue(), self, 1, global_setting, file_setting,
sequencefile)
 File
&quot;/home/michael/Programme/relax_bieri_gui/gui_bieri/res/calc_rx.py&quot;, line
121, in make_tx
   minimise.minimise('simplex', scaling=False, constraints=False)
 File
&quot;/home/michael/Programme/relax_bieri_gui/generic_fns/minimise.py&quot;, line
162, in minimise
   minimise(min_algor=min_algor, min_options=min_options,
func_tol=func_tol, grad_tol=grad_tol, max_iterations=max_iterations,
constraints=constraints, scaling=scaling, verbosity=verbosity)
 File
&quot;/home/michael/Programme/relax_bieri_gui/specific_fns/relax_fit.py&quot;,
line 783, in minimise
   results = generic_minimise(func=func, dfunc=dfunc, d2func=d2func,
args=(), x0=param_vector, min_algor=min_algor, min_options=min_options,
func_tol=func_tol, grad_tol=grad_tol, maxiter=max_iterations, A=A, b=b,
full_output=True, print_flag=verbosity)
 File &quot;/usr/local/lib/python2.6/dist-packages/minfx/generic.py&quot;, line
373, in generic_minimise
   raise NameError, &quot;Simplex minimisation cannot be setup.&quot;
NameError: Simplex minimisation cannot be setup.


Hope that's also an easy one..

Thank you.
Michael

Edward d'Auvergne schrieb:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

The problem here is that I have updated and cleaned up the grid search
component of the minfx project.  relax has been modified to handle the
newer code.  Therefore for this to work, you need to check out a copy
of minfx from SVN:

$ svn co svn+ssh://michaelbieri@xxxxxxxxxxx/svn/minfx/trunk

preferably in a directory called minfx.  Note you should also type
'svn up' in your branch to get all the updates that have been
happening there.

Regards,

Edward


2009/12/1 Michael Bieri &lt;michael.bieri@xxxxxx&gt;:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward

I have another problem by including the GUI into relax. By executing Rx
calculations, I get the following problem:

Traceback (most recent call last):
 File &quot;/home/michael/Programme/relax_bieri_gui/gui_bieri/relax_gui.py&quot;,
line 2695, in exec_t2_1
   make_tx(self.resultsdir_t11.GetValue(), t1_list, relax_times_t1_1,
self.structure_t11.GetValue(), self.nmrfreq_value_t11.GetValue(), 1, 1,
self.unresolved_t11.GetValue(), self, 1, global_setting, file_setting,
sequencefile)
 File
&quot;/home/michael/Programme/relax_bieri_gui/gui_bieri/res/calc_rx.py&quot;, line
119, in make_tx
   minimise.grid_search(inc=11)
 File
&quot;/home/michael/Programme/relax_bieri_gui/generic_fns/minimise.py&quot;, line
185, in grid_search
   grid_search(lower=lower, upper=upper, inc=inc,
constraints=constraints, verbosity=verbosity)
 File
&quot;/home/michael/Programme/relax_bieri_gui/specific_fns/relax_fit.py&quot;,
line 404, in grid_search
   self.minimise(min_algor='grid', lower=lower, upper=upper, inc=inc,
constraints=constraints, verbosity=verbosity, sim_index=sim_index)
 File
&quot;/home/michael/Programme/relax_bieri_gui/specific_fns/relax_fit.py&quot;,
line 684, in minimise
   results = grid(func=func, args=(), num_incs=inc, lower=lower,
upper=upper, A=A, b=b, verbosity=verbosity)
TypeError: grid() got an unexpected keyword argument 'num_incs'


This occurs after the command: minimise.grid_search(inc=11)

Do you have an idea what the problem is in this case?

I think the problem is buried somewhere in specific_fns/relax_fit.py.

Cheers
Michael

Edward d'Auvergne schrieb:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">2009/11/27 Michael Bieri &lt;michael.bieri@xxxxxx&gt;:


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward

Thank you very much for the branch. I made some modifications and 
included
your and Sébastien's comments.

Unfortunately,  I have a problem launching the relax functions. For 
example
by starting the noe calculation, an error appears:
Traceback (most recent call last):
 File &quot;/home/michael/Programme/relax_bieri_gui/gui_bieri/relax_gui.py&quot;, 
line
2645, in exec_noe1
  make_noe(self.res_noe1.GetValue(), self.noe_ref_1.GetValue(),
self.noe_sat_1.GetValue(), self.noe_ref_err_1.GetValue(),
self.noe_sat_err_1.GetValue(),
self.nmrfreq_value_noe1.GetValue(),self.structure_noe1.GetValue(),
self.unres_noe1.GetValue(), start_relax, self, 1, global_setting,
file_setting, sequencefile)
 File 
&quot;/home/michael/Programme/relax_bieri_gui/gui_bieri/res/calc_noe.py&quot;,
line 66, in make_noe
  pipe.create(pipename, 'noe')
NameError: global name 'pipe' is not defined



relaxGUI is not able to feed the commands into relax. Do  I have to 
import
other modules?

Imported relax modules:
from float import floatAsByteArray
from generic_fns.mol_res_spin import generate_spin_id, spin_index_loop,
spin_loop
from generic_fns import pipes, spectrum
from relax_errors import RelaxError

Do you have an idea how to solve this problem?


</pre></blockquote><pre style="margin: 0em;">Hi,

This is an easy one.  You can solve this by copying how the
prompt/script interface does this - and this is how you should replace
all calls to user functions.  Your GUI replaces the user functions and
should go directly to the core relax API.  So in this case, have a
look at the prompt.pipe module and look at the create() method on line
92 (1.3 line, r9986).  You'll see that all this method does is check
that what the user input is reasonable - i.e. both the name and method
must be strings.  Then at the end it passes everything to the
generic_fns.pipes.create() function:

# Execute the functional code.
pipes.create(pipe_name=pipe_name, pipe_type=pipe_type)

So all you need in your code, in this case, is to replace 'pipe' with
'pipes'.  For every single user function call you can do the same
thing - look at what is happening in the 'prompt' package and
implement the same thing in the 'bieri_gui' package.




</pre><blockquote class="blockquote"><pre style="margin: 0em;">I have another problem relating the OMP data. relaxGUI calculated 
local_tm
model, but it is not able to calculate the others (also the scripts 
can't
calculate). There seems to be a problem with the pdb file, I just don't 
see
at the moment:

Internal relax PDB parser.
Opening the file '/home/mbieri/LinuxBox/OMP/1F35_mono.pdb' for reading.
RelaxWarning: The atom number 80 from the CONECT record cannot be found
within the ATOM and HETATM records.
RelaxWarning: The atom number 88 from the CONECT record cannot be found
within the ATOM and HETATM records.
Traceback (most recent call last):
 File &quot;relaxGUI.py&quot;, line 4126, in exec_model_free
  start_model_free(self, which_model)
 File &quot;relaxGUI.py&quot;, line 1533, in start_model_free
  Model()
 File &quot;relaxGUI.py&quot;, line 1125, in __init__
  structure.read_pdb(PDB_FILE)
 File &quot;/usr/local/relax-1.3.4/prompt/structure.py&quot;, line 464, in 
read_pdb
  generic_fns.structure.main.read_pdb(file=file, dir=dir, 
read_mol=read_mol,
set_mol_name=set_mol_name, read_model=read_model,
set_model_num=set_model_num, parser=parser)
 File &quot;/usr/local/relax-1.3.4/generic_fns/structure/main.py&quot;, line 247, 
in
read_pdb
  cdp.structure.load_pdb(file_path, read_mol=read_mol,
set_mol_name=set_mol_name, read_model=read_model,
set_model_num=set_model_num, verbosity=verbosity)
 File &quot;/usr/local/relax-1.3.4/generic_fns/structure/internal.py&quot;, line 
628,
in load_pdb
  mol.fill_object_from_pdb(mol_records)
 File &quot;/usr/local/relax-1.3.4/generic_fns/structure/internal.py&quot;, line 
1373,
in fill_object_from_pdb
  self.atom_connect(index1=self.__atom_index(record[1]),
index2=self.__atom_index(record[i+2]))
 File &quot;/usr/local/relax-1.3.4/generic_fns/structure/internal.py&quot;, line 
1332,
in atom_connect
  if index2 not in self.bonded[index1]:
TypeError: list indices must be integers

I tried both, the monomer (extracted in pymol) and the dimer.


</pre></blockquote><pre style="margin: 0em;">This one here looks like an old bug I fixed a while ago.  Does the
same problem occur when using the 1.3 repository line rather than the
1.3.4 release?

As for changes to the code, these should be committed in small
packets.  For repository usage, a commit should only have one function
- and if not it should be split up.  The reason is because then it
allows for commits to be reverted, ported to other branches, etc. and
allows the code to be more easily reviewed.  When you have something,
just type:

$ svn diff &gt; patch

in the base directory and attach the file to the task
(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/?6847">https://gna.org/task/?6847</a>).  I can then check the code and commit
it.  Don't forget to write a commit message describing what the new
code does.  All of this is explained in greater depth in the manual.

Cheers,

Edward



</pre></blockquote><pre style="margin: 0em;">_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>


</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>

</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00000" href="msg00000.html">Re: Launching the GUI from relax.</a></strong>
<ul><li><em>From:</em> Michael Bieri</li></ul></li>
<li><strong><a name="00001" href="msg00001.html">Re: Launching the GUI from relax.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00002" href="msg00002.html">Re: Launching the GUI from relax.</a></strong>
<ul><li><em>From:</em> Michael Bieri</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Dec 02 12:40:10 2009</div>  
</body>
</html>
