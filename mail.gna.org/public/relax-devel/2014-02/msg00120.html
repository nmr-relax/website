<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Loading multiple spectra via the spectrum.read_intensities user	function. -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 20 Feb 2014 11:03:30 +0100 -->
<!--X-Message-Id: CA+CBx2OXFRBZKkQwr76SpS4=96kBkzh90tMo0dh9sy+uLSzyaA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CAED9pY9hRV0ZZcCAbmFx0hXCq+YHygaN6tQtVP3g+gfVyeT=Ww@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Loading multiple spectra via the spectrum.read_intensities user	function. -- February 20, 2014 - 11:03</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Loading multiple spectra via the spectrum.read_intensities user	function.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00120" class="tabs">Index by Date</a> | <a href="threads.html#00120" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00119.html">Date Prev</a>] [<a href="msg00121.html">Date Next</a>] [<a href="msg00116.html">Thread Prev</a>] [<a href="msg00121.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 20 Feb 2014 11:02:36 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:from:date:message-id	:subject:to:cc:content-type;	bh=a6kzvGAAiwMeE/gNYE9yzuN2DpMUOMno8NLwNixFj6o=;	b=O2vQgPkPdu8s26Gto8GyH6McRcf/Jmv8k79ZcUJn6ke62hfUfB1sY/0xgx4dfujKEz	YZFhzoqczLrTNto0I+92a9zM0Z5wyj1E5+Nmx5wkIr5PrFv9UyC2BW4mp2+trrdg/bh3	ZV2XXpnbHr0BkOAnXNrdqYTFryBBPBXgTskscInzj4K9nYYlhkiNxeZ9chfDmCq2wB6f	FAvLIVZywgrhjTGJIs+n4HXeKQE4iaFp6yab5rZDZlrVme2lfep1cnDHsoUn+ffl4Yr9	z4rO9BXGl7Wj7gCHLcSaqzDK0iN0iimAnrPhMvXf/T2wneKsfsszeui+UWjNtGFVkGhN	PPEA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00120.html">CA+CBx2OXFRBZKkQwr76SpS4=96kBkzh90tMo0dh9sy+uLSzyaA@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CAED9pY9hRV0ZZcCAbmFx0hXCq+YHygaN6tQtVP3g+gfVyeT=Ww@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on February 20, 2014 - 11:03:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Dear Edward.

The trick is to define a id list and intensity list of equal length.
(Even though the intensity list will not be used.)

This is a script I setup for doing:
<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?21665">https://gna.org/bugs/?21665</a>

----------
####### Get experiment settings from procpar
# Path to Varian procpar file
path_procpar_1 = os.path.join(os.getcwd(), &quot;..&quot;, &quot;..&quot;,
&quot;%s_060518&quot;%(setup_pipe_bundle),
&quot;%s_060518_%s.fid&quot;%(setup_pipe_bundle, current_setup),&quot;procpar_ori&quot;)
file_procpar_1 = open(path_procpar_1, &quot;r&quot;)
lines_procpar_1 = file_procpar_1.readlines()

path_procpar_2 = os.path.join(os.getcwd(), &quot;..&quot;, &quot;..&quot;,
&quot;%s_060521&quot;%(setup_pipe_bundle),
&quot;%s_060521_%s.fid&quot;%(setup_pipe_bundle, current_setup),&quot;procpar_ori&quot;)
file_procpar_2 = open(path_procpar_2, &quot;r&quot;)
lines_procpar_2 = file_procpar_2.readlines()

# Define regular search terms
search_ncyc = &quot;^ncyc &quot;
search_time_T2 = &quot;^time_T2 &quot;
search_sfrq = &quot;^sfrq &quot;

for i in range(len(lines_procpar_1)):
        line = lines_procpar_1[i]

        # Search ncycs_1
        if re.search(search_ncyc, line):
            ncycs_1 = map(int, lines_procpar_1[i+1].split(&quot; &quot;)[1:-1])
            print(&quot;Number of is:&quot;, ncycs_1)

        # Search time_T2_1
        if re.search(search_time_T2, line):
            time_T2_1 = float(lines_procpar_1[i+1].split(&quot; &quot;)[1])
            print(&quot;time_T2_1 is:&quot;, time_T2_1)

        # Search spectrometer frequency
        if re.search(search_sfrq, line):
            sfrq_1 = float(lines_procpar_1[i+1].split(&quot; &quot;)[1])
            print(&quot;Spectrometer frequency is:&quot;, sfrq_1)

for i in range(len(lines_procpar_2)):
        line = lines_procpar_2[i]

        # Search ncycs_2
        if re.search(search_ncyc, line):
            ncycs_2 = map(int, lines_procpar_2[i+1].split(&quot; &quot;)[1:-1])
            print(&quot;Number of is:&quot;, ncycs_2)

        # Search time_T2_2
        if re.search(search_time_T2, line):
            time_T2_2 = float(lines_procpar_2[i+1].split(&quot; &quot;)[1])
            print(&quot;time_T2_2 is:&quot;, time_T2_2)

        # Search spectrometer frequency
        if re.search(search_sfrq, line):
            sfrq_2 = float(lines_procpar_2[i+1].split(&quot; &quot;)[1])
            print(&quot;Spectrometer frequency is:&quot;, sfrq_2)

# Find dublicates of ncyc_1
dublicates_1 = map(lambda val: (val, [i for i in xrange(len(ncycs_1))
if ncycs_1[i] == val]), ncycs_1)
dublicates_2 = map(lambda val: (val, [i for i in xrange(len(ncycs_2))
if ncycs_2[i] == val]), ncycs_2)

# Sort dublicates_1 into list
dublicates_list_1 = []
for ncyc, list_index_occur in dublicates_1:
    if len(list_index_occur) &gt; 1:
        dub = []
        for list_index in list_index_occur:
            dub.append(list_index)
        dublicates_list_1.append(dub)
# Remove dublicate entries
dublicates_list_1.sort()
dublicates_list_1 = list(dublicates_list_1 for dublicates_list_1, _ in
itertools.groupby(dublicates_list_1))

# Sort dublicates_2 into list
dublicates_list_2 = []
for ncyc, list_index_occur in dublicates_2:
    if len(list_index_occur) &gt; 1:
        dub = []
        for list_index in list_index_occur:
            dub.append(list_index)
        dublicates_list_2.append(dub)
# Remove dublicate entries
dublicates_list_2.sort()
dublicates_list_2 = list(dublicates_list_2 for dublicates_list_2, _ in
itertools.groupby(dublicates_list_2))

# Test if dublicates is present
if len(dublicates_list_1) &gt; 0:
    dublicates_present_1 = True
    print(&quot;Index list of dublicates of ncyc:&quot;, dublicates_list_1,
&quot;From: &quot;, ncycs_1)
else:
    dublicates_present_1 = False

# Test if dublicates is present
if len(dublicates_list_2) &gt; 0:
    dublicates_present_2 = True
    print(&quot;Index list of dublicates of ncyc:&quot;, dublicates_list_2,
&quot;From: &quot;, ncycs_2)
else:
    dublicates_present_2 = False

############ Define function to setup experiment in relax
def setup_exp(id_list, ncycs, time_T2, sfrq, dublicates_present,
dublicates_list, id_name):
    list_of_ids = []
    for i in range(len(ncycs)):
        ncyc = ncycs[i]
        vcpmg = ncyc/time_T2

        # Test if spectrum is a reference
        if float(vcpmg) == 0.0:
            vcpmg = None
        else:
            vcpmg = round(float(vcpmg),3)

        # Set the current spectrum id
        current_id = id_list[i]
        list_of_ids.append(current_id)

        # Set the current experiment type.
        relax_disp.exp_type(spectrum_id=current_id, exp_type='SQ CPMG')

        # Set the NMR field strength of the spectrum.
        spectrometer.frequency(id=current_id, frq=sfrq, units='MHz')

        # Relaxation dispersion CPMG constant time delay T (in s).
        relax_disp.relax_time(spectrum_id=current_id, time=time_T2)

        # Set the relaxation dispersion CPMG frequencies.
        relax_disp.cpmg_frq(spectrum_id=current_id, cpmg_frq=vcpmg)

        # Set the peak intensity errors, as defined as the baseplane RMSD.
        #spectrum.baseplane_rmsd(error=rmsd_err, spectrum_id=current_id)

    # Specify the duplicated spectra.
    if dublicates_present:
        for dub_i in dublicates_list:
            dub_list = []
            for dub in dub_i:
                dub_list.append(&quot;%s%s&quot;%(id_name, dub))
        spectrum.replicated(spectrum_ids=dub_list)
    spectrum.error_analysis(subset=list_of_ids)

#######
####### Define compare to
compare_filename_1 = os.path.join(os.getcwd(), &quot;..&quot;, &quot;..&quot;,
&quot;%s_060518&quot;%(setup_pipe_bundle),
&quot;%s_060518_%s.fid&quot;%(setup_pipe_bundle, current_setup),'analysis_FT',
'ser_files', COMPARE, '%s_files.txt'%(COMPARE) )
compare_file_1 = open(compare_filename_1, 'r')
compare_filelines_1 = compare_file_1.readlines()
# Take the first line in list of files
compare_ni_file_1 = os.path.join(os.getcwd(), &quot;..&quot;, &quot;..&quot;,
&quot;%s_060518&quot;%(setup_pipe_bundle),
&quot;%s_060518_%s.fid&quot;%(setup_pipe_bundle, current_setup),'analysis_FT',
'ser_files', COMPARE, compare_filelines_1[0].strip())
compare_ni_1 = int(compare_filelines_1[0].split('_')[0])
compare_ni_pipe_name_1 = &quot;compare_%s_%s&quot;%(compare_ni_1, COMPARE)
print(&quot;compare file: %s&quot;%compare_ni_file_1)
print(&quot;compare ni: %i&quot;%compare_ni_1)

####### Define compare to
compare_filename_2 = os.path.join(os.getcwd(), &quot;..&quot;, &quot;..&quot;,
&quot;%s_060521&quot;%(setup_pipe_bundle),
&quot;%s_060521_%s.fid&quot;%(setup_pipe_bundle, current_setup),'analysis_FT',
'ser_files', COMPARE, '%s_files.txt'%(COMPARE) )
compare_file_2 = open(compare_filename_2, 'r')
compare_filelines_2 = compare_file_2.readlines()
# Take the first line in list of files
compare_ni_file_2 = os.path.join(os.getcwd(), &quot;..&quot;, &quot;..&quot;,
&quot;%s_060521&quot;%(setup_pipe_bundle),
&quot;%s_060521_%s.fid&quot;%(setup_pipe_bundle, current_setup),'analysis_FT',
'ser_files', COMPARE, compare_filelines_2[0].strip())
compare_ni_2 = int(compare_filelines_2[0].split('_')[0])
compare_ni_pipe_name_2 = &quot;compare_%s_%s&quot;%(compare_ni_2, COMPARE)
print(&quot;compare file: %s&quot;%compare_ni_file_2)
print(&quot;compare ni: %i&quot;%compare_ni_2)

##### Setup initial pipe data
# Create the setup data pipe.
setup_pipe_name = 'setup pipe'
pipe.create(pipe_name=setup_pipe_name, bundle=setup_pipe_bundle,
pipe_type='relax_disp')

# Create the spins
spectrum.read_spins(file=compare_ni_file_1)
spectrum.read_spins(file=compare_ni_file_2)

# Name the isotope for field strength scaling.
spin.isotope(isotope='15N')

# Save the variables to cdp
cdp.dublicates_list_1 = dublicates_list_1
cdp.dublicates_list_2 = dublicates_list_2
cdp.dublicates_present_1 = dublicates_present_1
cdp.dublicates_present_2 = dublicates_present_2

# Save the spin ids
spin_ids = []
for spin_cur, mol_name, res_num, res_name, spin_id in
spin_loop(full_info=True, return_id=True, skip_desel=True):
    spin_ids.append(spin_id)
cdp.spin_ids = spin_ids

####### Now doing - The 'R2eff' model - for initial compare to
# Copy the settings in the spin setup pipe to its own pipe.
compare_ni_pipe_name = compare_ni_pipe_name_1

pipe.copy(pipe_from=setup_pipe_name, pipe_to=compare_ni_pipe_name,
bundle_to=setup_pipe_bundle )
pipe.switch(pipe_name=compare_ni_pipe_name)

id_list_1 = []
int_col_1 = []
for i in range(len(ncycs_1)):
    id_list_1.append(&quot;Z_A%s&quot;%i)
    int_col_1.append(i)
spectrum.read_intensities(file=compare_ni_file_1,
spectrum_id=id_list_1, int_method='height', int_col=int_col_1)
setup_exp(id_list_1, ncycs_1, time_T2_1, sfrq_1, dublicates_present_1,
dublicates_list_1, &quot;Z_A&quot;)

id_list_2 = []
int_col_2 = []
for i in range(len(ncycs_2)):
    id_list_2.append(&quot;Z_B%s&quot;%i)
    int_col_2.append(i)
spectrum.read_intensities(file=compare_ni_file_2,
spectrum_id=id_list_2, int_method='height', int_col=int_col_2)
setup_exp(id_list_2, ncycs_2, time_T2_2, sfrq_2, dublicates_present_2,
dublicates_list_2, &quot;Z_B&quot;)

print(&quot;- The 'R2eff' model -&quot;)
compare_ni_pipe_name_r2eff = &quot;%s_R2eff&quot;%(compare_ni_pipe_name)
pipe.copy(pipe_from=compare_ni_pipe_name,
pipe_to=compare_ni_pipe_name_r2eff, bundle_to=setup_pipe_bundle)
pipe.switch(pipe_name=compare_ni_pipe_name_r2eff)
relax_disp.select_model(model='R2eff')

calc(verbosity=1)

2014-02-20 10:09 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

Troels, this question is mainly for you as I know you have looked at
this before.  I was wondering if you were able to simultaneously load
multiple peak lists via the spectrum.read_intensities user function?
I am busy making a tutorial for the manual for how to perform a
relaxation dispersion analysis using the GUI, using Flemming Hansen's
data in relax.

I noticed that the peak intensity wizard in the GUI is having
problems, specifically that the file selection dialog for the
spectrum.read_intensities user function will only allow single files
to be selected, but that the spectrum ID argument allows for a list of
spectrum IDs to be supplied.  Have you encountered the same problem?
If so, how did you solve it?

Cheers,

Edward

_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00121" href="msg00121.html">Re: Loading multiple spectra via the spectrum.read_intensities user	function.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00116" href="msg00116.html">Loading multiple spectra via the spectrum.read_intensities user	function.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Feb 20 11:20:10 2014</div>  
</body>
</html>
