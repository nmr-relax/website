<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Numerical integration of the Bloch&#45;McConnell equations for the	relaxation dispersion analysis in relax. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 12 Jul 2013 15:46:18 +0200 -->
<!--X-Message-Id: CAED9pY9r7RmoQ0a0ex2au&#45;52CZS4XUHrTsPF3agzucQxxjSnFA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CAED9pY&#45;geVxWf=PBv6g&#45;7gDjfKKmHni3LGBjCNMLQ88_Ecy9XQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2P__DLYjUGSMGSVkRf6tDdarVtsdYZEuE3SZsrORLgbiw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax. -- July 12, 2013 - 15:46</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00021" class="tabs">Index by Date</a> | <a href="threads.html#00021" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00020.html">Date Prev</a>] [<a href="msg00022.html">Date Next</a>] [<a href="msg00015.html">Thread Prev</a>] [<a href="msg00010.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 12 Jul 2013 15:45:44 +0200</li>
<li class="menuitem">
<em>Cc</em>: Dominique Marion &lt;Dominique.Marion@xxxxxx&gt;,	Sébastien M &lt;sebastien@xxxxxxxxxxxxx&gt;,	mathilde lescanne &lt;mathilde.lescanne@xxxxxx&gt;,	&quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;,	Paul Schanda &lt;paul.schanda@xxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date	:x-google-sender-auth:message-id:subject:from:to:cc:content-type;	bh=Mw3rzM+b02hWtAZKdUf8QZK/mcli8fUEv/eJGhBOIbs=;	b=WcWpjDE+RvUZ2mwWf+R24Fu3ncXKhe6fQwGHXAht+4qpsPDqa0+uZkRGHg7tF/SZqi	x0/JO2WU8J5waeBgyN4zHgStLXtO0Cu05KzPGaQSPjhOi5HKkkEwkv8Q6D5kr0wJgLSu	z4DXYjD02MtEpbNURa0DE7CzrUQtTyMeq/zPAPPR4uGeIGQk0nM+VsonbR5OcvYpzeRf	hvGkoSWV+ozxUYwC/o3opKk2kaXd/XX3ArcPC3ODITkr/6iRg5pOQxMJmLdcg7cTcehQ	brFD1PIqKzYS2FebXygDnv99kyVRYq1hJAJy7I1rkyjNrebwLD8vG8+dyJWXM3BlCipZ	JAFg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00021.html">CAED9pY9r7RmoQ0a0ex2au-52CZS4XUHrTsPF3agzucQxxjSnFA@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CAED9pY-geVxWf=PBv6g-7gDjfKKmHni3LGBjCNMLQ88_Ecy9XQ@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2P__DLYjUGSMGSVkRf6tDdarVtsdYZEuE3SZsrORLgbiw@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on July 12, 2013 - 15:46:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

Please see below:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">I find it very usefull, that xmgrace plots are produced during analysis and
the
graphs are exported as stand-alone files, so it not necessary to open relax
to view the files.
</pre></blockquote><pre style="margin: 0em;">

We could do the same with matplotlib, generating SVG files or some
other hardcopy version on the fly.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I have never used xmgrace before, but only gnuplot. But it seems that the
GUI for
xmgrace is a little more intuitive. And they kind-of do the same things.
With the latest tweak that plots are also exported to png files, I can
quickly go
through 100 residues in my folder, and modify a single residue without
opening
the saved data. That's good.
</pre></blockquote><pre style="margin: 0em;">

These additions are quite useful.  Note that these were specific to
the relax_disp.plot_disp_curves user function and not the more generic
grace.write user function used to generate the chi-squared or
parameter verses residue/spin number plots.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">But it is not good, that I probably sometimes would need to combine some
data into
one graph. With the current solution, this is not easily done.
</pre></blockquote><pre style="margin: 0em;">

This will always be difficult independent of the graphing method.
Such cases could therefore be identified and specifically handled.
Coming up with a general methodology might be too difficult.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Regarding matplotlib.
I am in favor of matplotlib, because it is a plotting language that I
understand (python)
and I can re-use old plot code, to get the graph I like.
And it is in development.
</pre></blockquote><pre style="margin: 0em;">

This reusing of your old code, as well as possibly code from Mathilde
and Paul, as well as NESSY, would make this much easier to implement.
Though if one knows Python and matplotlib, writing everything from
scratch, but using the relax code for Grace as a template, this should
be relatively trivial.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">As relax are now, one should be able to make an external &quot;plot file&quot;.
And then run the commands via: User functions (n-z) -&gt; script
That is how I load my data in. I write a script file, open relax gui, and
run the script.

In the file, one import matplotlib and write some line to extract data from
the the current data pipe &quot;cdp&quot;.
For example data for 1-3 residues.

I am still looking into, how to extract relevant data from the data pipe.
<a  rel="nofollow" href="http://nmr-relax.kimlinnet.dk/index.php?title=Category:List_objects">http://nmr-relax.kimlinnet.dk/index.php?title=Category:List_objects</a>

And then just write some matplotlib commands to plot it.
</pre></blockquote><pre style="margin: 0em;">

I do not believe that this would be the optimal solution - it would
require more work to implement it and doesn't fit well with the
current relax design.  For the simplest and quickest implementation, I
would suggest using the current relax_disp.plot_disp_curves user
function.  We then add an option for chosing between Grace and
matplotlib.  If the user chooses matplotlib but the matplotlib Python
module is not available, then a RelaxError is thrown explaining the
problem.  The plots would then be automatically created by relax on
the fly.

For the user function backend, the code would be the script you
suggest.  Instead of generating a script and writing it to the output
directory, that code could be instead permanently in the
plot_disp_curves() function of
specific_analyses/relax_disp/disp_data.py and a new
lib/software/matplotlib.py file, just as is currently done with Grace.
 The first module already deals with the relax data store and the
assembly of data from it (specifically the current data pipe, or cdp
data structure).  This then passes the assembled data to the second
module to generate the plots.  One question is, what should the
hardcopy output format from matplotlib be?  Maybe the different
options could be presented to the user?  Though a default format would
need to be chosen for the relaxation dispersion auto-analysis.

Using matplotlib for the plots of parameter values and chi-squared
value verses the residue sequence would use the same code in
lib.software.matplotlib.  But instead this would be called from code
in a new module pipe_control.matplotlib, which mimics that of the
pipe_control.grace module.  This would require a new user function
called matplotlib.write, again mimicking the grace.write user function
(i.e. copy file + slightly modify).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">For a future user friendly GUI solution, I imagine a menu where one can
select some template
matplotlib functions. Then modify them in a wxpython text editor or OS
editor,
and then save them in the relax folder, or in $HOME/.relax/xxx
or in the current working directory. And then of course push a &quot;execute&quot;
button.
</pre></blockquote><pre style="margin: 0em;">

The above idea handles this elegantly.  The only user visible
difference is a single option for the relax_disp.plot_disp_curves user
function.  However the user in the GUI would probably always use the
relaxation dispersion auto-analysis which will call this function for
the user for each model optimised.  Therefore the user will only see
the new matplotlib hardcopy images being dumped into the 'matplotlib'
directory for the current optimised model.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Another possibility would also just be, to have a matplotlib script
collection on the wiki.
</pre></blockquote><pre style="margin: 0em;">

I think having it in the relax backend would be a better option for
such code.  The problem is that relax changes incredibly quickly, and
any scripts touching the relax data store would have a half-life
measured in months (scripts which use the user functions instead can
last for years without modification).  If the code is part of relax,
we can add tests to the test suite to be sure that the code operates
bug-free forever.  Then if there are any internal data structure
changes in the future, the matplotlib code can be instantly fixed.

Cheers,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00009" href="msg00009.html">Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00015" href="msg00015.html">Re: Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Jul 12 16:20:07 2013</div>  
</body>
</html>
