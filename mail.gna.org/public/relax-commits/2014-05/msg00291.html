<!-- MHonArc v2.6.18 -->
<!--X-Subject: r23188 &#45; /trunk/lib/structure/internal/object.py -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Thu, 15 May 2014 13:07:50 +0200 -->
<!--X-Message-Id: E1WktVt&#45;0004Th&#45;SS@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r23188 - /trunk/lib/structure/internal/object.py -- May 15, 2014 - 13:07</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r23188 - /trunk/lib/structure/internal/object.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00291" class="tabs">Index by Date</a> | <a href="threads.html#00291" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00290.html">Date Prev</a>] [<a href="msg00292.html">Date Next</a>] [<a href="msg00290.html">Thread Prev</a>] [<a href="msg00292.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Thu, 15 May 2014 11:07:49 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00291.html">E1WktVt-0004Th-SS@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on May 15, 2014 - 13:07:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Thu May 15 13:07:49 2014
New Revision: 23188

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=23188&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=23188&amp;view=rev</a>
Log:
Fix for bug #22041, the PDB atom serial number error from the 
structure.write_pdb user function.

This was reported at <a  rel="nofollow" href="https://gna.org/bugs/?22041">https://gna.org/bugs/?22041</a>.

The problem is that the structure.write_pdb user function preserves the atom 
numbering from the
original structure and uses that for the atom serial number.  However the 
atom serial number must be
replaced with sequential values to produce a valid PDB file.  This is fatal 
for any CONECT records.

Modified:
    trunk/lib/structure/internal/object.py

Modified: trunk/lib/structure/internal/object.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/structure/internal/object.py?rev=23188&amp;r1=23187&amp;r2=23188&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/lib/structure/internal/object.py?rev=23188&amp;r1=23187&amp;r2=23188&amp;view=diff</a>
==============================================================================
--- trunk/lib/structure/internal/object.py      (original)
+++ trunk/lib/structure/internal/object.py      Thu May 15 13:07:49 2014
@@ -2657,6 +2657,7 @@
 
             # Loop over the molecules.
             index = 0
+            atom_serial = 0
             for mol in model.mol:
                 # Print out.
                 print(&quot;ATOM, HETATM, TER&quot;)
@@ -2668,10 +2669,8 @@
                     if mol.pdb_record[i] in [None, 'ATOM']:
                         atom_record = True
 
-                        # The atom number, if missing.
-                        atom_num = mol.atom_num[i]
-                        if atom_num == None:
-                            atom_num = i + 1
+                        # The atom number.
+                        atom_serial += 1
 
                         # Handle the funky atom name alignment.  From the 
PDB format documents:
                         # &quot;Alignment of one-letter atom name such as C 
starts at column 14, while two-letter atom name such as FE starts at column 
13.&quot;
@@ -2681,12 +2680,12 @@
                             atom_name = &quot;%s&quot; % mol.atom_name[i]
 
                         # Write out.
-                        pdb_write.atom(file, serial=atom_num, 
name=atom_name, res_name=mol.res_name[i], chain_id=CHAIN_ID_LIST[index], 
res_seq=mol.res_num[i], x=mol.x[i], y=mol.y[i], z=mol.z[i], occupancy=1.0, 
temp_factor=0, element=mol.element[i])
+                        pdb_write.atom(file, serial=atom_serial, 
name=atom_name, res_name=mol.res_name[i], chain_id=CHAIN_ID_LIST[index], 
res_seq=mol.res_num[i], x=mol.x[i], y=mol.y[i], z=mol.z[i], occupancy=1.0, 
temp_factor=0, element=mol.element[i])
                         num_atom += 1
                         ser_num += 1
 
                         # Info for the TER record.
-                        ter_num = atom_num + 1
+                        ter_num = atom_serial + 1
                         ter_name = mol.res_name[i]
                         ter_chain_id = CHAIN_ID_LIST[index]
                         ter_res_num = mol.res_num[i]
@@ -2702,16 +2701,14 @@
                 for i in range(len(mol.atom_name)):
                     # Write the HETATM record.
                     if mol.pdb_record[i] == 'HETATM':
-                        # The atom number, if missing.
-                        atom_num = mol.atom_num[i]
-                        if atom_num == None:
-                            atom_num = i + 1
+                        # The atom number.
+                        atom_serial += 1
 
                         # Increment the atom number if a TER record was 
created.
-                        if atom_record and atom_num == ter_num:
+                        if atom_record and atom_serial == ter_num:
                             count_shift = True
                         if atom_record and count_shift:
-                            atom_num += 1
+                            atom_serial += 1
 
                         # Write out.
                         pdb_write.hetatm(file, serial=ser_num, 
name=self._translate(mol.atom_name[i]), res_name=mol.res_name[i], 
chain_id=CHAIN_ID_LIST[index], res_seq=mol.res_num[i], x=mol.x[i], 
y=mol.y[i], z=mol.z[i], occupancy=1.0, temp_factor=0.0, 
element=mol.element[i])



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu May 15 16:00:02 2014</div>  
</body>
</html>
