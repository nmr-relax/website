<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r26812 &#45; /branches/nmrglue/lib/software/nmrglue.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 28 Nov 2014 22:42:29 +0100 -->
<!--X-Message-Id: CAED9pY&#45;wAEiAZp8VYRUxfbXL75AAPt+U0y=bKrH7h0&#45;_c7QLEA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XuTA6&#45;0008TH&#45;UX@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r26812 - /branches/nmrglue/lib/software/nmrglue.py -- November 28, 2014 - 22:42</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r26812 - /branches/nmrglue/lib/software/nmrglue.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00092" class="tabs">Index by Date</a> | <a href="threads.html#00092" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00091.html">Date Prev</a>] [<a href="msg00093.html">Date Next</a>] [<a href="msg00077.html">Thread Prev</a>] [<a href="msg00093.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 28 Nov 2014 22:42:00 +0100</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:content-type; bh=O9tA4uJJOEYBLY9/ILul0xM3V+/ckOcu7wUJqTfm2Js=; b=A4A+1+003Qzh9G6HvSLUz8QmwL+/jXRJkbfymJeA/20Ern+fE4bCOyLcl8unNrPEnl Cbrmu5FVYCIHqoU2KWcZV6EsDzNKTqgRni4Hxm4HSFDmGamKjsdL8GBv575H7sf3uS2i jC0TY/AO5NR3QsfGssdVu0f5VFlVq0XdCjFlZFIJPX7velfM7fXuMIsaFAtJ5UXKP3SE aqE4ghFMmnqvFBsF+bCuataue8sS5q2PhPk77gheWW/a8KH/AjFWKQLQI+3H8LJulUEz lNGysmDvovJAzpMR3/Jmr4kYdws9AlAtPwgrpODRmOh6+2tXghFrKNDAcuU4ly+blN19 xDyg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY-wAEiAZp8VYRUxfbXL75AAPt+U0y=bKrH7h0-_c7QLEA@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XuTA6-0008TH-UX@subversion.gna.org&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on November 28, 2014 - 22:42:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Interesting!  I would recommend that you consider a new module in the
target_functions package for this new Gaussian fitting target function
(using 'svn cp lib/software/nmrglue.py target_functions/gaussian.py').
It will simplify your optimisation if you can initialise a special
class with the required input data, convert these func_*() functions
into class methods, and then pass the class methods into minfx.
You'll benefit from the superior design and greater abstraction if you
need to expand on this.  You'll also quickly find out why this current
design will not work well with the design of optimisation algorithms
;)  The class and __init__() method for temporary data storage will be
the solution you need.

Regards,

Edward



On 28 November 2014 at 22:33,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Fri Nov 28 22:33:10 2014
New Revision: 26812

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=26812&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=26812&amp;view=rev</a>
Log:
Initial implementation of a gauss function and its chi2 function, to 
prepare for minfx minimisation.

Task #7873 (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/index.php?7873">https://gna.org/task/index.php?7873</a>): Write wrapper function to 
nmrglue, to read .ft2 files and process them.
Homepage: <a  rel="nofollow" href="http://www.nmrglue.com/">http://www.nmrglue.com/</a>
Link to nmrglue discussion: 
<a  rel="nofollow" href="https://groups.google.com/forum/#!forum/nmrglue-discuss">https://groups.google.com/forum/#!forum/nmrglue-discuss</a>
The code is develop at Github: <a  rel="nofollow" href="https://github.com/jjhelmus/nmrglue/">https://github.com/jjhelmus/nmrglue/</a>
Google code: <a  rel="nofollow" href="https://code.google.com/p/nmrglue/">https://code.google.com/p/nmrglue/</a>
Documentation: <a  rel="nofollow" href="http://nmrglue.readthedocs.org/en/latest/index.html">http://nmrglue.readthedocs.org/en/latest/index.html</a>

Modified:
    branches/nmrglue/lib/software/nmrglue.py

Modified: branches/nmrglue/lib/software/nmrglue.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/nmrglue/lib/software/nmrglue.py?rev=26812&amp;r1=26811&amp;r2=26812&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/nmrglue/lib/software/nmrglue.py?rev=26812&amp;r1=26811&amp;r2=26812&amp;view=diff</a>
==============================================================================
--- branches/nmrglue/lib/software/nmrglue.py    (original)
+++ branches/nmrglue/lib/software/nmrglue.py    Fri Nov 28 22:33:10 2014
@@ -23,7 +23,7 @@
 &quot;&quot;&quot;Module for the wrapper functions around the nmrglue module.&quot;&quot;&quot;

 # Python module imports.
-from numpy import arange, argmax, exp, log, pi, sqrt
+from numpy import arange, argmax, exp, log, ones, pi, sqrt
 import matplotlib.pyplot as plt
 import matplotlib.cm

@@ -32,6 +32,7 @@
 from lib.errors import RelaxError
 from lib.io import get_file_path
 from lib.spectrum.objects import Nmrglue_data
+from target_functions.chi2 import chi2_rankN


 def contour_plot(spectrum_id=None, contour_start=30000., contour_num=20, 
contour_factor=1.20, ppm=True, show=False):
@@ -109,6 +110,51 @@
     return ax


+def func_gauss(params=None, x=None):
+    &quot;&quot;&quot;Calculate the Gaussian distribution for a given x value.
+
+    @param params:  The vector of parameter values.
+    @type params:   numpy rank-1 float array
+    @keyword x:     The x value to calculate the probability for.
+    @type x:        numpy array
+    @return:        The probability corresponding to x.
+    @rtype:         float
+    &quot;&quot;&quot;
+
+    # Unpack,
+    # a: The amplitude of the distribution.
+    # x0: The center of the distribution.
+    # sigma: The standard deviation of the distribution.
+    a, x0, sigma = params
+
+    # Calculate and return the probability.
+    return a*exp(-(x-x0)**2/(2*sigma**2))
+
+
+def func_gauss_chi2(params=None, x=None, values=None):
+    &quot;&quot;&quot;Target function for minimising chi2 in minfx, for Gaussian function 
fit.
+
+    @param params:  The vector of parameter values.
+    @type params:   numpy rank-1 float array
+    @keyword x:     The x points.
+    @type x:        numpy array
+    @param values:  The measured y values.
+    @type values:   numpy array
+    @return:        The chi2 value.
+    @rtype:         float
+    &quot;&quot;&quot;
+
+    # Calculate.
+    back_calc = func_gauss(params=params, x=x)
+
+    # Return the total chi-squared value.
+    errors = ones(values.shape)
+    chi2 = chi2_rankN(data=values, back_calc_vals=back_calc, errors=errors)
+
+    # Calculate and return the chi-squared value.
+    return chi2
+
+
 def hist_plot(ndarray=None, hist_kwargs=None, show=False):
     &quot;&quot;&quot;Flatten the 2D numpy array, and plot as histogram.

@@ -178,13 +224,10 @@
     #ax.annotate(&quot;Test 1&quot;, xy=(0.5, 0.5), xycoords=&quot;data&quot;, va=&quot;center&quot;, 
ha=&quot;center&quot;, bbox=dict(boxstyle=&quot;round&quot;, fc=&quot;w&quot;))
     ax.annotate(&quot;FWHM=%3.2f std=%3.2f&quot;%(fwhm, fwhm_std), xy=(x0, hm), 
xycoords=&quot;data&quot;, size=8, va=&quot;center&quot;, horizontalalignment=&quot;center&quot;, 
bbox=dict(boxstyle=&quot;round&quot;, facecolor=&quot;w&quot;))

-    # Plot the gaussian function.
-    a = amp
+    # Calculate the gauss values.
+    params = amp, x0, fwhm_std
+    gauss = func_gauss(params=params, x=bincenters)
     sigma = fwhm_std
-    x = bincenters
-
-    # Calculate the gauss values.
-    gauss = a*exp(-(x-x0)**2/(2*sigma**2))

     # Plot the values.
     ax.plot(bincenters, gauss, 'r-', label='gauss')


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Sat Nov 29 09:40:16 2014</div>  
</body>
</html>
