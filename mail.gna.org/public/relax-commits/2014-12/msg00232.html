<!-- MHonArc v2.6.18 -->
<!--X-Subject: r27109 &#45; /trunk/lib/structure/internal/object.py -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Fri, 12 Dec 2014 15:36:02 +0100 -->
<!--X-Message-Id: E1XzRK5&#45;00068f&#45;Sh@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r27109 - /trunk/lib/structure/internal/object.py -- December 12, 2014 - 15:36</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r27109 - /trunk/lib/structure/internal/object.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00232" class="tabs">Index by Date</a> | <a href="threads.html#00232" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00231.html">Date Prev</a>] [<a href="msg00233.html">Date Next</a>] [<a href="msg00231.html">Thread Prev</a>] [<a href="msg00233.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Fri, 12 Dec 2014 14:36:01 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00232.html">E1XzRK5-00068f-Sh@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on December 12, 2014 - 15:36:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Fri Dec 12 15:36:01 2014
New Revision: 27109

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=27109&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=27109&amp;view=rev</a>
Log:
Large improvement for the PDB molecule identification code.

This affects the structure.read_pdb user function.  Now the chain ID code, if 
present in the PDB
file, is being used to determine which ATOM and HETATM records belong to 
which molecule.  All of the
records for each molecule are stored until the end, when they are all 
yielded.  This allows for
discontinuous chain IDs throughout the PDB file, something which occurs often 
with the HETATM
records.


Modified:
    trunk/lib/structure/internal/object.py

Modified: trunk/lib/structure/internal/object.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/structure/internal/object.py?rev=27109&amp;r1=27108&amp;r2=27109&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/lib/structure/internal/object.py?rev=27109&amp;r1=27108&amp;r2=27109&amp;view=diff</a>
==============================================================================
--- trunk/lib/structure/internal/object.py      (original)
+++ trunk/lib/structure/internal/object.py      Fri Dec 12 15:36:01 2014
@@ -659,7 +659,7 @@
             yield records
 
 
-    def _parse_mols(self, records):
+    def _parse_mols_pdb(self, records):
         &quot;&quot;&quot;Generator function for looping over the molecules in the PDB 
records of a model.
 
         @param records:     The list of PDB records for the model, or if no 
models exist the entire PDB file.
@@ -673,8 +673,8 @@
             raise RelaxError(&quot;There are no PDB records for this model.&quot;)
 
         # Init.
-        mol_num = 1
-        mol_records = []
+        mol_count = 1
+        mol_records = [[]]
         end = False
 
         # Loop over the data.
@@ -701,14 +701,8 @@
 
             # End.
             if end:
-                # Yield the info.
-                yield mol_num, mol_records
-
-                # Reset the records.
-                mol_records = []
-
-                # Increment the molecule number.
-                mol_num = mol_num + 1
+                # Increment the molecule counter.
+                mol_count = mol_count + 1
 
                 # Reset the flag.
                 end = False
@@ -716,12 +710,27 @@
                 # Skip the rest of this loop.
                 continue
 
+            # The molecule number.
+            chain_id = records[i][21]
+            if chain_id == ' ':
+                mol_index = mol_count - 1
+            else:
+                mol_index = self._pdb_chain_id_to_mol_index(chain_id)
+
+            # Add a new records list as required.
+            while True:
+                if len(mol_records) &lt;= mol_index:
+                    mol_records.append([])
+                else:
+                    break
+
             # Append the line as a record of the molecule.
-            mol_records.append(records[i])
-
-        # If records is not empty then there is only a single molecule, so 
yield the lot.
-        if len(mol_records):
-            yield mol_num, mol_records
+            mol_records[mol_index].append(records[i])
+
+        # Loop over the molecules and yield the molecule number and records.
+        for i in range(len(mol_records)):
+            if mol_records[i] != []:
+                yield i+1, mol_records[i]
 
 
     def _pdb_chain_id_to_mol_index(self, chain_id=None):
@@ -1989,7 +1998,7 @@
             mol_index = 0
             orig_mol_num = []
             new_mol_name = []
-            for mol_num, mol_records in self._parse_mols(model_records):
+            for mol_num, mol_records in self._parse_mols_pdb(model_records):
                 # Only load the desired model.
                 if read_mol and mol_num not in read_mol:
                     continue



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Dec 12 16:20:01 2014</div>  
</body>
</html>
