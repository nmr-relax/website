<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: AIC from ModeFree data -->
<!--X-From-R13: Eéonfgvra [beva <fronfgvra.zbeva.1Nhyniny.pn> -->
<!--X-Date: Thu, 03 Apr 2008 15:52:23 +0200 -->
<!--X-Message-Id: 47F4E108.3010406@ulaval.ca -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 47F2ABF1.4030700@ulaval.ca -->
<!--X-Reference: 7f080ed10804020046g7c9e038r37ec8181c1b9ccd8@mail.gmail.com -->
<!--X-Reference: 47F3BE35.70904@ulaval.ca -->
<!--X-Reference: 7f080ed10804030624h12ec62e9s263d15550b1d7141@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: AIC from ModeFree data -- April 03, 2008 - 15:52</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: AIC from ModeFree data</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00008" class="tabs">Index by Date</a> | <a href="threads.html#00008" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00007.html">Date Prev</a>] [<a href="msg00009.html">Date Next</a>] [<a href="msg00007.html">Thread Prev</a>] [<a href="msg00011.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 03 Apr 2008 09:52:08 -0400</li>
<li class="menuitem">
<em>Cc</em>: relax-users@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00008.html">47F4E108.3010406@ulaval.ca</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;47F2ABF1.4030700@xxxxxxxxx&gt;		&lt;7f080ed10804020046g7c9e038r37ec8181c1b9ccd8@xxxxxxxxxxxxxx&gt;		&lt;47F3BE35.70904@xxxxxxxxx&gt;	&lt;7f080ed10804030624h12ec62e9s263d15550b1d7141@xxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Thunderbird 2.0.0.12 (X11/20080228)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Sébastien Morin</strong> on April 03, 2008 - 15:52:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#ffffff" style="background-color: #ffffff; color: #000000; "><font color="#000000">



<tt>Hi Ed,<br>
<br>
Thanks for taking a look at this in a new thread !<br>
<br>
<br>
For the script you proposed, as I had noticed yesterday, it won't work
since the results.write() function asks for a sequence... <br>
<br>
========================<br>
relax&gt; results.write(run=name, file='results', force=1)<br>
Opening the file 'aic/results.bz2' for writing.<br>
RelaxError: The sequence data for the run 'aic' does not exist.<br>
========================<br>
<br>
<br>
If I give it a sequence, it then asks for a diffusion tensor...<br>
<br>
</tt><tt>========================</tt><br>
<tt>relax&gt; results.write(run=name, file='results', force=1)<br>
Opening the file 'aic/results.bz2' for writing.<br>
RelaxError: No diffusion tensor data is loaded for the run 'aic'.<br>
</tt><tt>========================<br>
<br>
<br>
Then, what I get is a bigger error message which can be solved by
submitting data sets with frequency labels...<br>
<br>
</tt><tt>========================</tt><br>
<tt>relax&gt; results.write(run=name, file='results', force=1)<br>
Opening the file 'aic/results.bz2' for writing.<br>
Traceback (most recent call last):<br>
&nbsp; File "&lt;console&gt;", line 1, in ?<br>
&nbsp; File
"/home/semor/packages/relax-1.2___FOR__TEM-1__-2.712/prompt/results.py",
line 201, in write<br>
&nbsp;&nbsp;&nbsp; self.__relax__.generic.results.write(run=run, file=file,
directory=dir, force=force, format=format, compress_type=compress_type)<br>
&nbsp; File
"/home/semor/packages/relax-1.2___FOR__TEM-1__-2.712/generic_fns/results.py",
line 166, in write<br>
&nbsp;&nbsp;&nbsp; self.write_function(results_file, run)<br>
&nbsp; File
"/home/semor/packages/relax-1.2___FOR__TEM-1__-2.712/specific_fns/model_free.py",
line 4664, in write_columnar_results<br>
&nbsp;&nbsp;&nbsp; self.write_columnar_line(file=file, num='Num', name='Name',
select='Selected', data_set='Data_set', nucleus='Nucleus',
model='Model', equation='Equation', params='Params',
param_set='Param_set', s2='S2', s2f='S2f', s2s='S2s',
local_tm='Local_tm_(' + self.return_units('local_tm') + ')', te='te_('
+ self.return_units('te') + ')', tf='tf_(' + self.return_units('tf') +
')', ts='ts_(' + self.return_units('ts') + ')', rex='Rex_(' +
replace(self.return_units('rex'), ' ', '_') + ')', r='Bond_length_(' +
self.return_units('r') + ')', csa='CSA_(' + self.return_units('csa') +
')', chi2='Chi-squared', i='Iter', f='f_count', g='g_count',
h='h_count', warn='Warning', diff_type='Diff_type',
diff_params=diff_params, pdb='PDB', pdb_model='PDB_model',
pdb_heteronuc='PDB_heteronuc', pdb_proton='PDB_proton',
xh_vect='XH_vector', ri_labels='Ri_labels', remap_table='Remap_table',
frq_labels='Frq_labels', frq='Frequencies', ri=ri, ri_error=ri_error)<br>
&nbsp; File
"/home/semor/packages/relax-1.2___FOR__TEM-1__-2.712/specific_fns/model_free.py",
line 3732, in return_units<br>
&nbsp;&nbsp;&nbsp; return self.relax.data.frq_labels[self.run][0] + ' MHz'<br>
AttributeError: Data instance has no attribute 'frq_labels'<br>
</tt><tt>========================<br>
<br>
<br>
Thus, if I rewrite the script in a more logical way :<br>
<br>
</tt><tt>========================<br>
runs = ['m1', 'm2', 'm3', 'm4', 'm5']<br>
diff_tensor_Phi = 22.4<br>
diff_tensor_Theta = -3.49<br>
diff_tensor_Dratio = 1.22<br>
diff_tensor_tm = 1.242e-08<br>
<br>
for name in runs:<br>
&nbsp;&nbsp;&nbsp; run.create(name, 'mf')<br>
&nbsp;&nbsp;&nbsp; sequence.read(name, 'sequence')<br>
&nbsp;&nbsp;&nbsp; diffusion_tensor.init(name, (diff_tensor_tm, diff_tensor_Dratio,
diff_tensor_Theta, diff_tensor_Phi), param_types=2,
spheroid_type='prolate', fixed=1)<br>
&nbsp;&nbsp;&nbsp; palmer.extract(run=name)<br>
<br>
name = 'aic'<br>
run.create(name, 'mf')<br>
model_selection(method='AIC', modsel_run=name)<br>
sequence.read(name, 'sequence')<br>
diffusion_tensor.init(name, (diff_tensor_tm, diff_tensor_Dratio,
diff_tensor_Theta, diff_tensor_Phi), param_types=2,
spheroid_type='prolate', fixed=1)<br>
relax_data.read(name, 'R1', '800', 799.812 * 1e6,
'800_R1.dat_plus_sequence')<br>
relax_data.read(name, 'R2', '800', 799.812 * 1e6,
'800_R2.dat_plus_sequence')<br>
relax_data.read(name, 'R1', '600', 599.739 * 1e6,
'600_R1.dat_plus_sequence')<br>
relax_data.read(name, 'R2', '600', 599.739 * 1e6,
'600_R2.dat_plus_sequence')<br>
relax_data.read(name, 'NOE', '600', 599.739 * 1e6,
'600_NOE.dat_plus_sequence')<br>
relax_data.read(name, 'R1', '500', 499.827 * 1e6,
'500_R1.dat_plus_sequence')<br>
relax_data.read(name, 'R2', '500', 499.827 * 1e6,
'500_R2.dat_plus_sequence')<br>
relax_data.read(name, 'NOE', '500', 499.827 * 1e6,
'500_NOE.dat_plus_sequence')<br>
results.write(run=name, file='results', force=1)<br>
</tt><tt>========================<br>
<br>
<br>
Note however that it is not needed to input all data as only submitting
one dataset will avoid getting the error message for </tt><tt>'frq_labels'...</tt><br>
<tt><br>
I think this works in the 'palmer.py' script since at stage 2, the
script loads a saved state from stage 1 where all those information
were input...<br>
<br>
<br>
For the run 'None' being selected, yes, it is for all spins... Running
with the '--debug' flag doesn't change anything...<br>
<br>
<br>
Cheers,<br>
<br>
<br>
S&eacute;b<br>
<br>
<br>
<br>
<br>
</tt><br>
Edward d'Auvergne wrote:
<blockquote
 cite=""
 type="cite">
  <pre wrap="">On Wed, Apr 2, 2008 at 7:11 PM, S&eacute;bastien Morin
<a rel="nofollow" class="moz-txt-link-rfc2396E" href="mailto:sebastien.morin.1@xxxxxxxxx">&lt;sebastien.morin.1@xxxxxxxxx&gt;</a> wrote:
  </pre>
  <blockquote type="cite">
    <pre wrap=""> Hi,

 I tried to use the palmer.extract() function, with no real success...
    </pre>
  </blockquote>
  <pre wrap=""><!---->
I have to admit that my Modelfree star format parser is not of very
high quality.  It woks if you use the palmer.py sample script, but
obviously not in this situation.  Nothing that's not fixable though.
I'll start a new thread about this in the relax-devel mailing list.


  </pre>
  <blockquote type="cite">
    <pre wrap=""> I had several error message during my first tries and manage to get rid of
them with a script like :

 =======================================

 runs = ['m1', 'm2', 'm3', 'm4', 'm5']
 diff_tensor_Phi = 22.4
 diff_tensor_Theta = -3.49
 diff_tensor_Dratio = 1.22
 diff_tensor_tm = 1.242e-08

 for name in runs:
     run.create(name, 'mf')
     sequence.read(name, 'sequence')
     diffusion_tensor.init(name, (diff_tensor_tm, diff_tensor_Dratio,
diff_tensor_Theta, diff_tensor_Phi), param_types=2, spheroid_type='prolate',
fixed=1)
     palmer.extract(run=name)

 name = 'aic'
 run.create(name, 'mf')
 sequence.read(name, 'sequence')
 relax_data.read(name, 'R1', '800', 799.812 * 1e6,
'800_R1.dat_plus_sequence')
 relax_data.read(name, 'R2', '800', 799.812 * 1e6,
'800_R2.dat_plus_sequence')
 relax_data.read(name, 'R1', '600', 599.739 * 1e6,
'600_R1.dat_plus_sequence')
 relax_data.read(name, 'R2', '600', 599.739 * 1e6,
'600_R2.dat_plus_sequence')
 relax_data.read(name, 'NOE', '600', 599.739 * 1e6,
'600_NOE.dat_plus_sequence')
 relax_data.read(name, 'R1', '500', 499.827 * 1e6,
'500_R1.dat_plus_sequence')
 relax_data.read(name, 'R2', '500', 499.827 * 1e6,
'500_R2.dat_plus_sequence')
 relax_data.read(name, 'NOE', '500', 499.827 * 1e6,
'500_NOE.dat_plus_sequence')
 diffusion_tensor.init(name, (diff_tensor_tm, diff_tensor_Dratio,
diff_tensor_Theta, diff_tensor_Phi), param_types=2, spheroid_type='prolate',
fixed=1)
 model_selection(method='AIC', modsel_run=name)
 results.write(run=name, file='results', force=1)

 =======================================
    </pre>
  </blockquote>
  <pre wrap=""><!---->
It is a little strange that you need to read in the sequence and the
relaxation data for the 'aic' run.  If you look at the palmer.py
sample script in the exec_stage_2() function, you'll see that none of
this is done.  The following should also work:


=======================================

runs = ['m1', 'm2', 'm3', 'm4', 'm5']
diff_tensor_Phi = 22.4
diff_tensor_Theta = -3.49
diff_tensor_Dratio = 1.22
diff_tensor_tm = 1.242e-08

for name in runs:
    run.create(name, 'mf')
    sequence.read(name, 'sequence')
    diffusion_tensor.init(name, (diff_tensor_tm, diff_tensor_Dratio,
diff_tensor_Theta, diff_tensor_Phi), param_types=2,
spheroid_type='prolate', fixed=1)
    The rest of the setup user functions ....
    palmer.extract(run=name)

name = 'aic'
run.create(name, 'mf')
model_selection(method='AIC', modsel_run=name)
results.write(run=name, file='results', force=1)

=======================================


  </pre>
  <blockquote type="cite">
    <pre wrap=""> However, there is one problem still present : no model is chosen during AIC
selection... Here is what I get after the command
"model_selection(method='AIC', modsel_run=name)" :

 =======================================

 ...

 Instance 261.

 Run                  Num_params_(k)       Num_data_sets_(n)    Chi2
Criterion

 The model from the run None has been selected.

 ...

 =======================================
    </pre>
  </blockquote>
  <pre wrap=""><!---->
Is this for all spins?  Maybe running relax with the --debug flag will
give more information.


  </pre>
  <blockquote type="cite">
    <pre wrap=""> It seems the mfout (which are all located in their respective folder : m1,
m2 , m3, m4 and m5) are not loaded properly...

 Do you have any clue about this issue ?
    </pre>
  </blockquote>
  <pre wrap=""><!---->
Sorry, I don't have any idea.  This will require investigation of the
relax data storage object to see what data is loaded from the mfout
file, and quite likely a little bit of coding, if you wish to do so.
Please refer to my post to relax-devel which will come soon.


  </pre>
  <blockquote type="cite">
    <pre wrap=""> Also, is there a way of extracting information from a mfout with relax
without inputing any sequence, diffusion tensor, or data..? I thought it
would be possible to use palmer.extract() in a short script like this :

 =======================================

 runs = ['m1', 'm2', 'm3', 'm4', 'm5']

 for name in runs:
     palmer.extract(run=name)

 name = 'aic'
 run.create(name, 'mf')
 model_selection(method='AIC', modsel_run=name)
 results.write(run=name, file='results', force=1)

 =======================================


 Do you see anything I do wrong ?
    </pre>
  </blockquote>
  <pre wrap=""><!---->
There is nothing wrong, the mfout file parser doesn't yet extract this
information.  I'll continue this in my post to relax-devel.

Cheers,

Edward

  </pre>
</blockquote>


</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00011" href="msg00011.html">Re: AIC from ModeFree data</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00001" href="msg00001.html">AIC from ModeFree data</a></strong>
<ul><li><em>From:</em> Sébastien Morin</li></ul></li>
<li><strong><a name="00002" href="msg00002.html">Re: AIC from ModeFree data</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00005" href="msg00005.html">Re: AIC from ModeFree data</a></strong>
<ul><li><em>From:</em> Sébastien Morin</li></ul></li>
<li><strong><a name="00007" href="msg00007.html">Re: AIC from ModeFree data</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Apr 03 18:41:54 2008</div>  
</body>
</html>
