<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Help with settings script for R1rho analysis. -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 22 Oct 2013 20:00:18 +0200 -->
<!--X-Message-Id: CA+CBx2OqSykw&#45;sZasy9Wx8YYscpCTJV5YO6Kus9CR_FY0dEm5Q@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CA+CBx2Otwm3tdPgfzVduw9gDZxtwjq82Y8iAp7q_OJeQ2LKZ8g@mail.gmail.com -->
<!--X-Reference: CAED9pY8QeGe=P4G+=6YD7EitmkKW82HCpTapFsnKfmCiBAZMzg@mail.gmail.com -->
<!--X-Reference: CA+CBx2O=c47Fug5LwhmnFMQLxxnntDr0SHLXR3=SAW_k6bHovg@mail.gmail.com -->
<!--X-Reference: CAED9pY9FZ8ihwpDvHhyxz3ec0QwTeV=FOG9zfn+LPeD6xVZUsw@mail.gmail.com -->
<!--X-Reference: CA+CBx2OEmeEWsvWNL283avhzjb1zBV3=qT&#45;N7q&#45;8Jo8Dn7WgZw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;vYtxFYNaAtwTg&#45;Uu+p=9cfsYeESbSQDYzusN0GmacRA@mail.gmail.com -->
<!--X-Reference: CA+CBx2PPxJgWfK6iXpiLYDNMx2vvqnFMT_JtMoZRg&#45;WLMkdViw@mail.gmail.com -->
<!--X-Reference: CAED9pY9DyZhAMBBOJh=ttah2n3kGqWgpPfb&#45;h8WCZhThn_aLCg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Help with settings script for R1rho analysis. -- October 22, 2013 - 20:00</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Help with settings script for R1rho analysis.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00078" class="tabs">Index by Date</a> | <a href="threads.html#00078" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00077.html">Date Prev</a>] [<a href="msg00079.html">Date Next</a>] [<a href="msg00076.html">Thread Prev</a>] [<a href="msg00082.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 22 Oct 2013 19:59:26 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:from:date:message-id	:subject:to:cc:content-type;	bh=IKP5pnIEuN73/sJF8KdS3BH30Bt4DwpJos1qdYonrX4=;	b=rWzURo7lYfnbe9VOSaxArZSw0pmb0LSXv4K+dJPmaIaTpazlTDK8Emvt/MBy9MU7Nm	VM19u6K1ixAD52o69b/u1lo3fhskVHgHt/AV78zXllXoa1jgAPgeysmxxUe/VAlv533W	+sSpFG6FYV5YsxqGcSAqVNyZqsFicEQLLIHI6e5X/Wb7egR5YPRpX3B5Ee6DXqrOdNu/	lprTFNEbMpiSvfmS0tKmfosvTc9BFgyrhoMC++EeaoUUsRLW3gXtPg9IF/RGzHaOTxv6	pFiWN96SLM0nkxKfSiJe7AYwoS7S0G0nd//g0VLYsmfmgIJi7AQd7WxgxzqZuzF5iPxn	OjCg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00078.html">CA+CBx2OqSykw-sZasy9Wx8YYscpCTJV5YO6Kus9CR_FY0dEm5Q@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2Otwm3tdPgfzVduw9gDZxtwjq82Y8iAp7q_OJeQ2LKZ8g@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY8QeGe=P4G+=6YD7EitmkKW82HCpTapFsnKfmCiBAZMzg@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2O=c47Fug5LwhmnFMQLxxnntDr0SHLXR3=SAW_k6bHovg@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY9FZ8ihwpDvHhyxz3ec0QwTeV=FOG9zfn+LPeD6xVZUsw@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2OEmeEWsvWNL283avhzjb1zBV3=qT-N7q-8Jo8Dn7WgZw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-vYtxFYNaAtwTg-Uu+p=9cfsYeESbSQDYzusN0GmacRA@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2PPxJgWfK6iXpiLYDNMx2vvqnFMT_JtMoZRg-WLMkdViw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY9DyZhAMBBOJh=ttah2n3kGqWgpPfb-h8WCZhThn_aLCg@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on October 22, 2013 - 20:00:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr">Ah ja. :-)<div><br></div><div style>I found the information in:</div><div>specific_analyses/relax_disp/api.py<br></div><div>specific_analyses/relax_disp/disp_data.py<br></div><div><br></div><div style>It is the return_offset_data() function.</div>

<div style><br></div><div style>For reference:</div><div style>----------------</div><div style><br></div><div style><br></div><div style><div># Convert the shift from ppm to rad/s and store it.</div><div>shifts[spin_index, frq_index] = spin.chemical_shift * 2.0 * pi * frq / g1H * return_gyromagnetic_ratio(spin.isotope) * 1e-6</div>

</div><div style><br></div><div style><div># Store the offset in rad/s.</div><div>offsets[spin_index, frq_index, disp_pt_index] = cdp.spin_lock_offset[id] * 2.0 * pi * frq / g1H * return_gyromagnetic_ratio(spin.isotope) * 1e-6</div>

</div><div style><br></div><div style><div># Calculate the tilt angle.</div><div>point = cdp.spin_lock_nu1[id]<br></div><div>omega1 = point * 2.0 * pi</div><div><br></div><div>Delta_omega = shifts[spin_index, frq_index] - offsets[spin_index, frq_index, disp_pt_index]</div>

<div>if Delta_omega == 0.0:</div><div>    theta[spin_index, frq_index, disp_pt_index] = pi / 2.0</div><div>else:</div><div>    theta[spin_index, frq_index, disp_pt_index] = atan(omega1 / Delta_omega)</div><div>------------------</div>

<div><br></div><div style>Which resembles:</div><div><br></div><div><div>$OMEGA=($centerPPM-$chemShift{$peakName})*$frq+$offset{$i};</div><div>$omegaEFF=sqrt($OMEGA**2+$omega1{$i}**2);</div><div>if (($omega1{$i}/$OMEGA) &gt; 0){</div>

<div><span class="" style="white-space:pre">	</span>$theta=180/$PI*abs(atan($omega1{$i}/$OMEGA));</div><div>}else{</div><div><span class="" style="white-space:pre">	</span>$theta=180-180/$PI*abs(atan($omega1{$i}/$OMEGA));</div>

</div><div><br></div></div><div style> </div></div><div class="gmail_extra"><br><br><div class="gmail_quote">2013/10/22 Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx" target="_blank">edward@xxxxxxxxxxxxx</a>&gt;</span><br>

<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">I have to give up for the day, but just a quick hint - look in the<br>
modules of the specific_analyses.relax_disp package!  The disp_data<br>
module is probably your best bet.<br>
<br>
Bye,<br>
<br>
Edward<br>
<div class="HOEnZb"><div class="h5"><br>
<br>
<br>
On 22 October 2013 19:16, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt; Hi Edward.<br>
&gt;<br>
&gt; I prefer to do the calculations straight away in my scripts, from the<br>
&gt; information which is ex-tractable from the procpar files.<br>
&gt; But I guess that is a matter of taste.<br>
&gt;<br>
&gt; But now I think I got it. :-) Thanks!<br>
&gt; I guess that relax calculates &quot;omega_rf_ppm - chemShift{peakName} &quot;, but I<br>
&gt; could not locate this functions call.<br>
&gt; ( I do load the chemical shifts from a SPARKY list, (the seriesTab format is<br>
&gt; not yet supported). )<br>
&gt;<br>
&gt;<br>
&gt; I now do the settings script, by settting variables:<br>
&gt; # In MHz<br>
&gt; yOBS = 81.050<br>
&gt; # In ppm<br>
&gt; yCAR = 118.078<br>
&gt; centerPPM_N15 = yCAR<br>
&gt;<br>
&gt; And then I calculate the offset in ppm for each spectrum.<br>
&gt;<br>
&gt; # Calculating the spin-lock offset in ppm, from offsets values provided in<br>
&gt; Hz.<br>
&gt; #frq_N15_Hz = set_sfrq * 1E6 * gyro15N / gyro1H<br>
&gt; frq_N15_Hz = yOBS * 1E6<br>
&gt; offset_ppm_N15 = float(deltadof2) / frq_N15_Hz * 1E6<br>
&gt; omega_rf_ppm = centerPPM_N15 + offset_ppm_N15<br>
&gt;<br>
&gt; And the range is now 118.078 ppm to 241.45 ppm.<br>
&gt;<br>
&gt; I tried to locate the corresponding calculation of OMEGA in relax, but i was<br>
&gt; not successful.<br>
&gt; I looked in:<br>
&gt;<br>
&gt; lib/dispersion/dpl94.py<br>
&gt; target_functions/relax_disp.py<br>
&gt;<br>
&gt; I wonder where how to locate the calculation of theta?<br>
&gt;<br>
&gt; Best<br>
&gt; Troels<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; 2013/10/22 Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt;<br>
&gt;&gt; Hi,<br>
&gt;&gt;<br>
&gt;&gt; You could look at the relax code for how omega_eff is calculated.<br>
&gt;&gt; However you will never use this - it is never input into relax.  If<br>
&gt;&gt; you have a look at the sample_scripts/relax_disp/R1rho_analysis.py<br>
&gt;&gt; script, you will see that all is needed is an equivalent of the table:<br>
&gt;&gt;<br>
&gt;&gt; # The spectral data - spectrum ID, peak list file name, spin-lock<br>
&gt;&gt; field strength (Hz), the spin-lock offset (ppm), the relaxation time<br>
&gt;&gt; (s), spectrometer frequency (Hz), and experimental error (RMSD of the<br>
&gt;&gt; base plane noise for each spectrum).<br>
&gt;&gt; data = "">
&gt;&gt;     [&#39;ref_500MHz&#39;,       &#39;ref_500MHz.list&#39;,     ,   None, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_1000.0_500MHz&#39;, &#39;nu_1000.0_500MHz.list&#39;, 1000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_1500.0_500MHz&#39;, &#39;nu_1500.0_500MHz.list&#39;, 1500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_2000.0_500MHz&#39;, &#39;nu_2000.0_500MHz.list&#39;, 2000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_2500.0_500MHz&#39;, &#39;nu_2500.0_500MHz.list&#39;, 2500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_3000.0_500MHz&#39;, &#39;nu_3000.0_500MHz.list&#39;, 3000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_3500.0_500MHz&#39;, &#39;nu_3500.0_500MHz.list&#39;, 3500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_4000.0_500MHz&#39;, &#39;nu_4000.0_500MHz.list&#39;, 4000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_4500.0_500MHz&#39;, &#39;nu_4500.0_500MHz.list&#39;, 4500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_5000.0_500MHz&#39;, &#39;nu_5000.0_500MHz.list&#39;, 5000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_5500.0_500MHz&#39;, &#39;nu_5500.0_500MHz.list&#39;, 5500.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_6000.0_500MHz&#39;, &#39;nu_6000.0_500MHz.list&#39;, 6000.0, 110.0, 0.1,<br>
&gt;&gt; 500e6, 200000.0]<br>
&gt;&gt;     [&#39;ref_800MHz&#39;,       &#39;ref_800MHz.list&#39;,     ,   None, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_1000.0_800MHz&#39;, &#39;nu_1000.0_800MHz.list&#39;, 1000.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_1500.0_800MHz&#39;, &#39;nu_1500.0_800MHz.list&#39;, 1500.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_2000.0_800MHz&#39;, &#39;nu_2000.0_800MHz.list&#39;, 2000.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_2500.0_800MHz&#39;, &#39;nu_2500.0_800MHz.list&#39;, 2500.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_3000.0_800MHz&#39;, &#39;nu_3000.0_800MHz.list&#39;, 3000.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_3500.0_800MHz&#39;, &#39;nu_3500.0_800MHz.list&#39;, 3500.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_4000.0_800MHz&#39;, &#39;nu_4000.0_800MHz.list&#39;, 4000.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_4500.0_800MHz&#39;, &#39;nu_4500.0_800MHz.list&#39;, 4500.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_5000.0_800MHz&#39;, &#39;nu_5000.0_800MHz.list&#39;, 5000.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_5500.0_800MHz&#39;, &#39;nu_5500.0_800MHz.list&#39;, 5500.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt;     [&#39;nu_6000.0_800MHz&#39;, &#39;nu_6000.0_800MHz.list&#39;, 6000.0, 110.0, 0.1,<br>
&gt;&gt; 800e6, 200000.0]<br>
&gt;&gt; ]<br>
&gt;&gt;<br>
&gt;&gt; These values can be hardcoded into a script.  There is no need to do<br>
&gt;&gt; this programatically - they will not change.  Though you could<br>
&gt;&gt; programmatically generate such a table in a separate script, if you<br>
&gt;&gt; wish.  You almost have this table anyway with the<br>
&gt;&gt; exp_parameters_sort.txt file.  It is good, for sanity&#39;s sake, to have<br>
&gt;&gt; such a complete summary table in the standard units.  As for<br>
&gt;&gt; omega_eff, it uses the data in this table together with the chemical<br>
&gt;&gt; shifts loaded via the chemical_shift.read user function to<br>
&gt;&gt; automatically determine the values.  It would be best read these<br>
&gt;&gt; shifts from one of your *.ser files.<br>
&gt;&gt;<br>
&gt;&gt; I would recommend to use the<br>
&gt;&gt; sample_scripts/relax_disp/R1rho_analysis.py script as a template for<br>
&gt;&gt; your whole analysis.  For the test suite, I would recommend copying<br>
&gt;&gt; test_suite/system_tests/scripts/relax_disp/r1rho_off_res_tp02.py and<br>
&gt;&gt; making a few minor modifications.  For example using a table as in the<br>
&gt;&gt; sample script.  This r1rho_off_res_tp02.py script does not have a<br>
&gt;&gt; table as it deals with perfect synthetic data.<br>
&gt;&gt;<br>
&gt;&gt; Regards,<br>
&gt;&gt;<br>
&gt;&gt; Edward<br>
&gt;&gt;<br>
&gt;&gt; On 22 October 2013 14:54, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; wrote:<br>
&gt;&gt; &gt; Hi Edward.<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; I am digging through old perl scripts, which is preparing data for our<br>
&gt;&gt; &gt; analysis in IgorPro.<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; So I guess my challenge is now to match this to the procedures of relax,<br>
&gt;&gt; &gt; and<br>
&gt;&gt; &gt; establish the difference.<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; -----------<br>
&gt;&gt; &gt; $expList=&quot;expList.txt&quot;;<br>
&gt;&gt; &gt; $peakFile=&#39;peaks.dat&#39;;<br>
&gt;&gt; &gt; $centerPPM=118.085;<br>
&gt;&gt; &gt; $frq=81.050;<br>
&gt;&gt; &gt; -----------<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; expList.txt contains lines with: &quot;fit_R1_filename&quot;<br>
&gt;&gt; &gt; &quot;spin_lock_offset_HZ&quot;<br>
&gt;&gt; &gt; &quot;spin_lock_field_Hz&quot;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; ----------------------<br>
&gt;&gt; &gt; open IN, &quot;$expList&quot; or die &quot;Cannot open $expList for read&quot;;<br>
&gt;&gt; &gt; while (&lt;IN&gt;){<br>
&gt;&gt; &gt; @process = split (/\s+/, $_);<br>
&gt;&gt; &gt; if ($process[0] ne &quot;#&quot;){<br>
&gt;&gt; &gt; $fileName{$i}=$process[0];<br>
&gt;&gt; &gt; $offset{$i}=$process[1];<br>
&gt;&gt; &gt; $omega1{$i}=$process[2];<br>
&gt;&gt; &gt; $i++;<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; close (IN);<br>
&gt;&gt; &gt; -------------------<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; And then it read the peak file to extract ppm for N15.<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; -------------<br>
&gt;&gt; &gt; open IN , &quot;$peakFile&quot; or die &quot;Cannot open $peakFile for read&quot;;<br>
&gt;&gt; &gt; while (&lt;IN&gt;) {<br>
&gt;&gt; &gt; @process = split (/\s+/, $_);<br>
&gt;&gt; &gt; if ($process[0] eq &quot;&quot;){splice (@process, 0, 1)};<br>
&gt;&gt; &gt; if ($process[0] == 1){ $read = 1};<br>
&gt;&gt; &gt; if ($read == 1){<br>
&gt;&gt; &gt; $chemShift{$process[6]}=$process[4];<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; close (IN);<br>
&gt;&gt; &gt; -----------<br>
&gt;&gt; &gt; The chemical shifts are stored in a dictionary under the residue name<br>
&gt;&gt; &gt; ($process[6]) with the ppm values of N15 ($process[4]).<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Then R1r and R1r_err are read in from external exponential fit files.<br>
&gt;&gt; &gt; ------------<br>
&gt;&gt; &gt; for ($i = 1; $i &lt;= $numFiles; $i++){<br>
&gt;&gt; &gt; open IN, &quot;$fileName{$i}&quot; or die &quot;Cannot open $fileName{$i} for read&quot;;<br>
&gt;&gt; &gt; while (&lt;IN&gt;){<br>
&gt;&gt; &gt; @process = split (/\s+/, $_);<br>
&gt;&gt; &gt; if ($process[0] ne &quot;#&quot;){<br>
&gt;&gt; &gt; $R1r{$process[0]}{$i}=$process[1];<br>
&gt;&gt; &gt; $R1r_err{$process[0]}{$i}=$process[2];<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; close(IN);<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; -------------------<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Then omega is calculated.<br>
&gt;&gt; &gt; ------------<br>
&gt;&gt; &gt; foreach $peakName (keys %chemShift) {<br>
&gt;&gt; &gt; open (OUT, &quot;&gt;../residueFiles/$peakName.dat&quot;);<br>
&gt;&gt; &gt; for ($i=1;$i&lt;=$numFiles;$i++){<br>
&gt;&gt; &gt; $OMEGA=($centerPPM-$chemShift{$peakName})*$frq+$offset{$i};<br>
&gt;&gt; &gt; $omegaEFF=sqrt($OMEGA**2+$omega1{$i}**2);<br>
&gt;&gt; &gt; if (($omega1{$i}/$OMEGA) &gt; 0){<br>
&gt;&gt; &gt; $theta=180/$PI*abs(atan($omega1{$i}/$OMEGA));<br>
&gt;&gt; &gt; }else{<br>
&gt;&gt; &gt; $theta=180-180/$PI*abs(atan($omega1{$i}/$OMEGA));<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; printf OUT &quot;%s %s %s %s %s<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; %s\n&quot;,$OMEGA,$omega1{$i},$omegaEFF,$theta,$R1r{$peakName}{$i},$R1r_err{$peakName}{$i};<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; close (OUT);<br>
&gt;&gt; &gt; };<br>
&gt;&gt; &gt; --------------<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; I guess I would need to find out how relax calculates omegaEFF, the<br>
&gt;&gt; &gt; effective field in the rotating frame ?<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Best<br>
&gt;&gt; &gt; Troels<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; 2013/10/22 Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Hi,<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Ok, I made the assumption that deltadof2 was not the spin-lock offset<br>
&gt;&gt; &gt;&gt; (in ppm) but rather the spin-lock field strength (in Hz).  The ppm<br>
&gt;&gt; &gt;&gt; values as printed out from the r1rho_1_ini.py script are far too low<br>
&gt;&gt; &gt;&gt; for 15N.  They should be in the range of 100-120 ppm!  I.e. around the<br>
&gt;&gt; &gt;&gt; 15N chemical shifts.  They can be much higher and much lower for<br>
&gt;&gt; &gt;&gt; off-resonance data, but having many at an offset of 0.0 ppm seems a<br>
&gt;&gt; &gt;&gt; little strange.<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Regards,<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Edward<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; On 22 October 2013 13:18, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt; Hi Edward.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; Thanks for looking at this.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; The offset for N15 spinlock is given in Hz as parameter deltadof2<br>
&gt;&gt; &gt;&gt; &gt; for our pulse sequence.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; So I guess that this conversions should be appropriate:<br>
&gt;&gt; &gt;&gt; &gt; omega_rf_ppm = float(deltadof2) / (set_sfrq * 1E6) * 1E6<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; where set_sfrq=799.7773991 is the spectrometer frequency.<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; Best<br>
&gt;&gt; &gt;&gt; &gt; Troels<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; 2013/10/22 Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Hi,<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; In the relax prompt, have a look at:<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; relax&gt; help(relax_disp.spin_lock_offset)<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; The unit you need is ppm.  You can find this number directly from<br>
&gt;&gt; &gt;&gt; &gt;&gt; the<br>
&gt;&gt; &gt;&gt; &gt;&gt; Bruker acqus or Varian procpar files.  It is the ppm offset of the<br>
&gt;&gt; &gt;&gt; &gt;&gt; spin-lock pulse which is manually set by the person recording for<br>
&gt;&gt; &gt;&gt; &gt;&gt; each<br>
&gt;&gt; &gt;&gt; &gt;&gt; spectrum.  You may need to go to the original pulse sequence to know<br>
&gt;&gt; &gt;&gt; &gt;&gt; which pulse this is.  It will be a fixed value for each spectrum<br>
&gt;&gt; &gt;&gt; &gt;&gt; collected and you can use that value directly.  The calculations in<br>
&gt;&gt; &gt;&gt; &gt;&gt; your scripts seem far to complicated and it looks like the internal<br>
&gt;&gt; &gt;&gt; &gt;&gt; conversions performed within relax.  You should never need<br>
&gt;&gt; &gt;&gt; &gt;&gt; gyromagnetic ratios, factors of pi, etc.  If you do, you should<br>
&gt;&gt; &gt;&gt; &gt;&gt; probably go back to the original experiments and pull out the<br>
&gt;&gt; &gt;&gt; &gt;&gt; correct<br>
&gt;&gt; &gt;&gt; &gt;&gt; offset number in ppm for each spectrum.  I hope this helps.<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Edward<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; On 22 October 2013 10:46, Troels Emtekær Linnet<br>
&gt;&gt; &gt;&gt; &gt;&gt; &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; Hi Edward.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; I wonder if would have time to look at the settings script in:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; test_suite/shared_data/dispersion/Kjaergaard_et_al_2013<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; It is the scripts:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; r1rho_1_ini.py<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; r1rho_3_spectra_settings.py<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; In r1rho, I am unsure if I do the correct conversion from Hz to<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; ppm<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; for<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; omega_rf.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; Again, if there is hidden radian units?<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; It is when I set:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; relax_disp.spin_lock_offset<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; And I wonder, how to start modifying, so R1 rates can be read per<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; spectra?<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; Best<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; Troels<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; _______________________________________________<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; relax (<a rel="nofollow" href="/" target="_blank">http://www.nmr-relax.com</a>)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; This is the relax-devel mailing list<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="mailto:relax-devel@xxxxxxx">relax-devel@xxxxxxx</a><br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; To unsubscribe from this list, get a password<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; reminder, or change your subscription options,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; visit the list information page at<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="/mail.gna.org/listinfo/relax-devel" target="_blank">https://mail.gna.org/listinfo/relax-devel</a><br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;<br>
&gt;<br>
</div></div></blockquote></div><br></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00082" href="msg00082.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00063" href="msg00063.html">Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00064" href="msg00064.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00065" href="msg00065.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00066" href="msg00066.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00067" href="msg00067.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00068" href="msg00068.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00075" href="msg00075.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00076" href="msg00076.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Oct 23 00:00:08 2013</div>  
</body>
</html>
