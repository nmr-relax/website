<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r6993 &#45; in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Wed, 30 Jul 2008 00:16:23 +0200 -->
<!--X-Message-Id: 7f080ed10807291516j8b72e40kc0397a02a78a7727@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1KNYW4&#45;0003kB&#45;Eg@subversion.gna.org -->
<!--X-Reference: 488E26B1.8010606@ulaval.ca -->
<!--X-Reference: 7f080ed10807290219m18601df6nf2df7e91848a9680@mail.gmail.com -->
<!--X-Reference: 488F147F.4040903@ulaval.ca -->
<!--X-Reference: 7f080ed10807290732i54f026aat7aa5d46dd8bb2271@mail.gmail.com -->
<!--X-Reference: 488F1E7D.7000100@ulaval.ca -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r6993 - in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py -- July 30, 2008 - 00:16</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r6993 - in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00049" class="tabs">Index by Date</a> | <a href="threads.html#00049" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00048.html">Date Prev</a>] [<a href="msg00051.html">Date Next</a>] [<a href="msg00045.html">Thread Prev</a>] [<a href="msg00051.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Sébastien Morin&quot; &lt;sebastien.morin.1@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 30 Jul 2008 00:16:01 +0200</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00049.html">7f080ed10807291516j8b72e40kc0397a02a78a7727@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1KNYW4-0003kB-Eg@xxxxxxxxxxxxxxxxxx&gt; &lt;488E26B1.8010606@xxxxxxxxx&gt;	&lt;7f080ed10807290219m18601df6nf2df7e91848a9680@xxxxxxxxxxxxxx&gt;	&lt;488F147F.4040903@xxxxxxxxx&gt;	&lt;7f080ed10807290732i54f026aat7aa5d46dd8bb2271@xxxxxxxxxxxxxx&gt;	&lt;488F1E7D.7000100@xxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on July 30, 2008 - 00:16:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">That is the idea, to have a print out very similar to yours.  Though I
was thinking of the divisions being more like:

Python modules ........................ [ OK ]
Optional modules ...................... [ Failed ]
Optional external programs ........ [ Failed ]
System/functional tests ............. [ OK ]
Unit tests ................................ [ OK ]
Synopsis ................................. [ OK ]

I like the idea of listing all python modules and external programs
too.  Note that in this mock-up, the synopsis is a pass even though
not all optional modules or external programs are installed.  For
example many of the optional programs may not run on all operating
systems.  So on Windows this would mean that passing the relax test
suite would not be possible.

Regards,

Edward


On Tue, Jul 29, 2008 at 3:43 PM, Sébastien Morin
&lt;sebastien.morin.1@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

This is a good idea. These tests could be separate from other ones and
only informative for non essential dependencies such as ModelFree4.

The output of the test-suite could be something like :



==========
###################################
# Summary of the relax test suite #
###################################

   Required dependencies .............................. [ OK ]
           minfx .............................. ( ok )
           python ............................. ( ok )
           etc.
   Optional dependencies .............................. [ OK ]
           dasha .............................. ( ok )
           modelfree4 ......................... ( ok )
           etc.
   System/functional tests ............................ [ OK ]
   Unit tests ......................................... [ OK ]
   Synopsis ........................................... [ OK ]
==========



instead of the actual :

==========
###################################
# Summary of the relax test suite #
###################################

   System/functional tests ............................ [ OK ]
   Unit tests ......................................... [ OK ]
   Synopsis ........................................... [ OK ]
==========



I think this would be really informative to the user which would see all
required and optional programs at once.

Regards,


Séb




Edward d'Auvergne wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

There could still be a better way of doing this, although I'm not sure
how it could be implemented.  The problem is that all may seem fine to
the user (or to me) but due to the improper set up of the modelfree4
program, the test passes but is silent.  Maybe a way that this could
be done to properly inform the person running the test-suite would be
to add another category of test (on top of the system/functional test
framework and the unit test framework) which would check for both for
python dependencies and for the presence (and maybe proper execution)
of external programs.  I'll have to think about this one for a while.

Regards,

Edward


On Tue, Jul 29, 2008 at 3:00 PM, Sébastien Morin
&lt;sebastien.morin.1@xxxxxxxxx&gt; wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Ed,

I agree with what you propose here. It is important that installation of
ModelFree4 stays a possibility, not an obligation, while, for those with
an installed program, the tools in relax should be tested to see if they
work.

I think your approach in r7017
(<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=7017&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=7017&amp;view=rev</a>) is really perfect
for this purpose and has the advantage of leaving complete flexibility
for the user.

Regards,


Séb




Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

This is a difficult question.  At the moment, I think the simplest
solution would be to use the relax_io.test_binary() function to see if
these binaries are located in the system path and are executable and
if not skip the test (essentially just return without executing the
main part of the test, hence the test counts as a pass).  I'll add
this to your new Modelfree4 system test to see if it works.  Ideally
though, the system tests should report that this test could not be run
as the binary could not be found, but still the system tests should
pass.  Otherwise the failing system test will make users think that
they need to install Modelfree4, which is not possible on all
platforms.

Additionally in this test, a temporary directory should be given to
Modelfree4 to dump it's output into.  This directory would then be
destroyed by the tearDown() method, no matter what happens in the
test.

Regards,

Edward


On Mon, Jul 28, 2008 at 10:06 PM, Sébastien Morin
&lt;sebastien.morin.1@xxxxxxxxx&gt; wrote:


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Ed (and others)

I don't know what you think about this... as some people might not have
ModelFree4 installed and could not be interested in the features related
to it... On the other hand, we most have system tests for interaction
with ModelFree4 stuff...

The same applies for Dasha...

What do you think ?

Regards,


Séb



sebastien.morin.1@xxxxxxxxx wrote:


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: semor
Date: Mon Jul 28 21:36:19 2008
New Revision: 6993

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=6993&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=6993&amp;view=rev</a>
Log:
Started to add system tests for model-free analysis using Modelfree4.


Added:
    1.3/test_suite/system_tests/palmer.py
    1.3/test_suite/system_tests/scripts/palmer.py
Modified:
    1.3/test_suite/system_tests/__init__.py

Modified: 1.3/test_suite/system_tests/__init__.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/1.3/test_suite/system_tests/__init__.py?rev=6993&amp;r1=6992&amp;r2=6993&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/test_suite/system_tests/__init__.py?rev=6993&amp;r1=6992&amp;r2=6993&amp;view=diff</a>
==============================================================================
--- 1.3/test_suite/system_tests/__init__.py (original)
+++ 1.3/test_suite/system_tests/__init__.py Mon Jul 28 21:36:19 2008
@@ -41,6 +41,7 @@
 from model_selection import Modsel
 from n_state_model import N_state_model
 from nmrview import NMRView
+from palmer import Palmer
 from pipe_create import Pipe_create
 from relax_fit import Relax_fit
 from results import Results
@@ -57,6 +58,7 @@
            'model_selection',
            'n_state_model',
            'nmrview',
+           'palmer',
            'pipe_create',
            'relax_fit',
            'results',
@@ -89,6 +91,7 @@
         
suite_array.append(TestLoader().loadTestsFromTestCase(Load_spins))
         suite_array.append(TestLoader().loadTestsFromTestCase(Mf))
         suite_array.append(TestLoader().loadTestsFromTestCase(Modsel))
+        suite_array.append(TestLoader().loadTestsFromTestCase(Palmer))
         
suite_array.append(TestLoader().loadTestsFromTestCase(Relax_fit))
         
suite_array.append(TestLoader().loadTestsFromTestCase(Results))
         
suite_array.append(TestLoader().loadTestsFromTestCase(Sequence))

Added: 1.3/test_suite/system_tests/palmer.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/1.3/test_suite/system_tests/palmer.py?rev=6993&amp;view=auto">http://svn.gna.org/viewcvs/relax/1.3/test_suite/system_tests/palmer.py?rev=6993&amp;view=auto</a>
==============================================================================
--- 1.3/test_suite/system_tests/palmer.py (added)
+++ 1.3/test_suite/system_tests/palmer.py Mon Jul 28 21:36:19 2008
@@ -1,0 +1,39 @@
+###############################################################################
+#                                                                     
        #
+# Copyright (C) 2008 Sebastien Morin                                  
        #
+#                                                                     
        #
+# This file is part of the program relax.                             
        #
+#                                                                     
        #
+# relax is free software; you can redistribute it and/or modify       
        #
+# it under the terms of the GNU General Public License as published 
by        #
+# the Free Software Foundation; either version 2 of the License, or   
        #
+# (at your option) any later version.                                 
        #
+#                                                                     
        #
+# relax is distributed in the hope that it will be useful,            
        #
+# but WITHOUT ANY WARRANTY; without even the implied warranty of      
        #
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the       
        #
+# GNU General Public License for more details.                        
        #
+#                                                                     
        #
+# You should have received a copy of the GNU General Public License   
        #
+# along with relax; if not, write to the Free Software                
        #
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  
02111-1307  USA   #
+#                                                                     
        #
+###############################################################################
+
+# Python module imports.
+import sys
+from unittest import TestCase
+
+
+class Palmer(TestCase):
+    &quot;&quot;&quot;Class for testing various aspects specific to model-free 
analysis using the program
+    'Modelfree4'.
+    &quot;&quot;&quot;
+
+    def test_palmer_stage_1(self):
+        &quot;&quot;&quot;Test a complete model-free analysis using the program 
'Modelfree4'.&quot;&quot;&quot;
+
+        # Execute the script.
+        self.relax.interpreter.run(script_file=sys.path[-1] + 
'/test_suite/system_tests/scripts/palmer.py')
+
+

Added: 1.3/test_suite/system_tests/scripts/palmer.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/1.3/test_suite/system_tests/scripts/palmer.py?rev=6993&amp;view=auto">http://svn.gna.org/viewcvs/relax/1.3/test_suite/system_tests/scripts/palmer.py?rev=6993&amp;view=auto</a>
==============================================================================
--- 1.3/test_suite/system_tests/scripts/palmer.py (added)
+++ 1.3/test_suite/system_tests/scripts/palmer.py Mon Jul 28 21:36:19 
2008
@@ -1,0 +1,136 @@
+# Script for model-free analysis using the program 'Modelfree4'.
+
+# Python module imports.
+import sys
+
+# The RelaxError system.
+from relax_errors import RelaxError
+
+# Set the stage of analysis.
+#
+# The three stages in this script are:
+#   Stage 1:  Initial model-free minimisation.
+#   Stage 2:  Model-free model selection.
+#   Stage 3:  Final optimisation of diffusion tensor parameters 
together with model-free parameters.
+
+
+# Functions.
+
+def exec_stage_1(runs):
+    &quot;&quot;&quot;Stage 1 function.
+
+    Initial model-free minimisation.
+    &quot;&quot;&quot;
+
+    # Loop over the runs.
+    for name in runs:
+        # Create the run.
+        print &quot;\n\n# &quot; + name + &quot; #&quot;
+        pipe.create(name, 'mf')
+
+        # Load the sequence.
+        sequence.read(sys.path[-1] + 
'/test_suite/system_tests/data/jw_mapping/noe.dat')
+
+        # PDB.
+        #structure.read_pdb(name, 'Ap4Aase_new_3.pdb')
+
+        # Load the relaxation data.
+        relax_data.read('R1', '600', 600.0 * 1e6, sys.path[-1] + 
'/test_suite/system_tests/data/jw_mapping/R1.dat')
+        relax_data.read('R2', '600', 600.0 * 1e6, sys.path[-1] + 
'/test_suite/system_tests/data/jw_mapping/R2.dat')
+        relax_data.read('NOE', '600', 600.0 * 1e6, sys.path[-1] + 
'/test_suite/system_tests/data/jw_mapping/noe.dat')
+
+        # Setup other values.
+        diffusion_tensor.init(1e-8)
+        value.set(NUCLEI, 'heteronucleus')
+        value.set(1.02 * 1e-10, 'bond_length')
+        value.set(-172 * 1e-6, 'csa')
+
+        # Select the model-free model.
+        model_free.select_model(model=name)
+
+        # Create the Modelfree4 files.
+        palmer.create(force=True, sims=0)
+
+        # Run Modelfree4.
+        palmer.execute(force=True)
+
+    # Save the program state.
+    state.save('stage1.save', force=True)
+
+
+def exec_stage_2(runs):
+    &quot;&quot;&quot;Stage 2 function.
+
+    Model-free model selection.
+    &quot;&quot;&quot;
+
+    # Load the saved state from stage 1.
+    state.load('stage1.save')
+
+    # Print out.
+    print &quot;\n\nLoading all the Modelfree 4 data.&quot;
+
+    # Extract the Modelfree4 data from the 'mfout' files.
+    for name in runs:
+        palmer.extract()
+
+    # Print out.
+    print &quot;\n\nModel selection.&quot;
+
+    # Create the model selection run.
+    name = 'aic'
+    pipe.create(name, 'mf')
+
+    # Model selection.
+    model_selection(method='AIC', modsel_run=name)
+
+    # Write the results.
+    results.write(file='results', force=True)
+
+    # Save the program state.
+    state.save('stage2.save', force=True)
+
+
+def exec_stage_3():
+    &quot;&quot;&quot;Stage 3 function.
+
+    Final optimisation of diffusion tensor parameters together with 
model-free parameters.
+    &quot;&quot;&quot;
+
+    # Load the saved state from stage 2.
+    state.load('stage2.save')
+
+    # Set the run name.
+    name = 'aic'
+
+    # Let the diffusion tensor parameters be optimised.
+    fix(name, 'diff', 0)
+
+    # Create the Modelfree4 files (change sims as needed, see below).
+    palmer.create(dir='final', force=True, sims=0)
+
+    # Run Modelfree4.
+    palmer.execute(dir='final', force=True)
+
+    # Extract the Modelfree4 data from the 'mfout' file.
+    palmer.extract(dir='final')
+
+    # Save the program state.
+    state.save('stage3.save', force=True)
+
+
+# Main section of the script.
+#############################
+
+# Nuclei type.
+NUCLEI = '15N'
+
+# Set the run name (also the name of a preset model-free model).
+runs = ['m1', 'm2', 'm3']
+
+# Run the stages.
+exec_stage_1(runs)
+exec_stage_2(runs)
+exec_stage_3()
+
+# Either repeat all the above with the optimised diffusion tensor or 
run Monte Carlo simulations on the final results.


_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>





</pre></blockquote><pre style="margin: 0em;">_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>



</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00051" href="msg00051.html">Re: r6993 - in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py</a></strong>
<ul><li><em>From:</em> Sébastien Morin</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00035" href="msg00035.html">Re: r6993 - in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py</a></strong>
<ul><li><em>From:</em> Sébastien Morin</li></ul></li>
<li><strong><a name="00038" href="msg00038.html">Re: r6993 - in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00041" href="msg00041.html">Re: r6993 - in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py</a></strong>
<ul><li><em>From:</em> Sébastien Morin</li></ul></li>
<li><strong><a name="00044" href="msg00044.html">Re: r6993 - in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00045" href="msg00045.html">Re: r6993 - in /1.3/test_suite/system_tests: __init__.py palmer.py	scripts/palmer.py</a></strong>
<ul><li><em>From:</em> Sébastien Morin</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Jul 30 17:44:18 2008</div>  
</body>
</html>
