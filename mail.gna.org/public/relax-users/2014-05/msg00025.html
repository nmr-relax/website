<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: R1rho RD analysis -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Wed, 28 May 2014 11:18:12 +0200 -->
<!--X-Message-Id: CA+CBx2Nwmu_SZyQB3YPFp_icDJNZAN=f60FedmxubCeHrWsQHg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: mailman.0.1400242739.20441.relax&#45;users@gna.org -->
<!--X-Reference: 537A143C.3020901@ibs.fr -->
<!--X-Reference: CAED9pY8GmeRj=HfGGb9x0Gk00bn1vBQYfYsUFDTzRmgyY7B_VA@mail.gmail.com -->
<!--X-Reference: 537E0B05.3060000@ibs.fr -->
<!--X-Reference: CAED9pY&#45;JoCffENebpEy3zPXg=dfcobrULSW&#45;SWEaGrN9nhggVg@mail.gmail.com -->
<!--X-Reference: 5385A2ED.8060605@ibs.fr -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: R1rho RD analysis -- May 28, 2014 - 11:18</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: R1rho RD analysis</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00025" class="tabs">Index by Date</a> | <a href="threads.html#00025" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00024.html">Date Prev</a>] [<a href="msg00026.html">Date Next</a>] [<a href="msg00023.html">Thread Prev</a>] [<a href="msg00027.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: pma &lt;Peixiang.Ma@xxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 28 May 2014 11:17:01 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-users@xxxxxxx&quot; &lt;relax-users@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type; bh=UWpTbPpbV/AX+rDHhDW6mvOmCiF0Nk3zy1CqzV8D6ZQ=; b=EDd1i7Li5IzwXs1RXhz9I3Gq631RNZ+kq/tSgNo9BbkQm1pyE4nOZyyIDnPQD2DiHQ Yypu9S+wFl8ibe3qUM4+1HnnKkhUrz0tBoIoz7V3HYegTAlJ4xDJn1LGwps2XCtHHiXV NX7raflr1p6kKln+Q4ypZSAKqxzZsJr123VVepCGerWF+9uWLt4yA4LWqdecsQpfsZpg CneA41jzn/2OIUOZusnfQGa1UVjA9EIBpesF9kmEC2VhSKzGVnOmHlU1DQVwAmy9FBYX 9E7cnVl2p3awHEEN5FWHw83khDpZhoS/JFNXZVKjbGofAJH/KE7yG6Oisbul7irHcZdC sP1w==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CA+CBx2Nwmu_SZyQB3YPFp_icDJNZAN=f60FedmxubCeHrWsQHg@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;mailman.0.1400242739.20441.relax-users@gna.org&gt; &lt;<a href="msg00011.html">537A143C.3020901@ibs.fr</a>&gt; &lt;CAED9pY8GmeRj=HfGGb9x0Gk00bn1vBQYfYsUFDTzRmgyY7B_VA@mail.gmail.com&gt; &lt;<a href="msg00013.html">537E0B05.3060000@ibs.fr</a>&gt; &lt;CAED9pY-JoCffENebpEy3zPXg=dfcobrULSW-SWEaGrN9nhggVg@mail.gmail.com&gt; &lt;<a href="msg00023.html">5385A2ED.8060605@ibs.fr</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on May 28, 2014 - 11:18:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Peixiang.

It sounds like you would like to get your hands &quot;dirty&quot; with code.

1) Regarding Global fitting / Clustering.
First perform a normal analysis, which makes a result folder for each
model, and a final model.

Then perform global analysis. Cluster residues you find interesting.
Point to the previous results folder. It will find the result files,
and copy over the parameters.
For the shared variables, it will take the values for clustered
residues and do a mean.
This will be you starting point for minimisation. See it as a
replacement for the grid search.

You can tweak this process, by making a script that sets the parameter
values before grid search.
See help(value), or make some &quot;fake&quot; parameter files.

2) Input values
Input in the unit as documentations says. :-)
The conversion is being done for you:

See
lib/nmr.py
specific_analyses/relax_disp/data.py in function return_offset_data.

Best
Troels




2014-05-28 10:48 GMT+02:00 pma &lt;Peixiang.Ma@xxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Thanks, Edward and Troels,


'The trick with the auto-analysis is to use the result of the analytic model
as the starting point for optimisation of the numeric model, so that the
grid search is bypassed.'
That is very useful trick, I solved most of the errors with it.

I did not mean 8 inc is heavy for grid search, but the calculated &quot;Searching
through 32768 grid nodes.&quot; is too heavy! That is only one residue for 5
dimensions parameters grid. You can imagine how much it will be if I
clustered several residues. Actually I indeed tried with cluster several
residues, the program warns too much grid search and stop.

Actually, this problem could also be solved by the individual res fitting
and then load the individual results and run the 'cluster' version scripts.
This could be a common problem for the fresh user like me.

Thanks for you remind, I update to 3.2.0.
However, I met new questions again. I thought there is a mistake in the
sample script. (relax-3.2.1/sample_scripts/relax_disp/R1rho_analysis.py)
The script read the data relax_disp.spin_lock_field(spectrum_id=id,
field=field), I checked the function by help, field is Hz. However, in MP05
and ns_r1rho_2site.The R1rho spin-lock field strengths (in rad.s^-1). I did
not find where the program will multipy 2*pi.

I think the simplest way would be multiply 2*pi in reading the field
(field=field*2*pi). However, I do not know whether it will affect other
calculation or not if change the field like this.

#########################################################
The relax_disp.spin_lock_field user function.

Synopsis

Set the relaxation dispersion spin-lock field strength (nu1).

Defaults

relax_disp.spin_lock_field(spectrum_id=None, field=None)


Keyword Arguments

    spectrum_id:  The spectrum ID string to associate the spin-lock field
strength to.

    field:  The spin-lock field strength, nu1, in Hz.

Description

This sets the spin-lock field strength, nu1, for the specified R1rho
spectrum in Hertz.

Prompt examples

To set a spin-lock field strength of 2.1 kHz for the spectrum
'nu1_2.1kHz_relaxT_0.010', type one
of:

relax&gt; relax_disp.spin_lock_field(2100, 'nu1_2.1kHz_relaxT_0.010')
relax&gt; relax_disp.spin_lock_field(field=2100,
spectrum_id='nu1_2.1kHz_relaxT_0.010')
####################################################################

Best,

Peixiang





On 05/22/2014 05:02 PM, Edward d'Auvergne wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Peixiang,

You should find the answers to most of your questions in the relax
manual.  Please see below:


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Thanks for you reply. I used the script mode in linux.

I tried with 'r1rho_on_res_m61.py', but I think in the script it has a
mistake.
in line27 ds.fixed = True, I think it should be False, because this
experiment has different time period, they do not need the ref. I changed
to
False, the M61 model still give right result.
</pre></blockquote><pre style="margin: 0em;">

Anything starting with 'ds' in the test suite scripts can be ignored.
These are internal data structures used to share scripts between
different tests in the test suite - they are not to be used by normal
users.  You should be very careful with the scripts in
test_suite/system_tests/scripts/, as these can be full of such
developer-only code.  If these are tripping you up and the
sample_scripts are not sufficient, you might prefer to use the
graphical user interface (GUI).  This makes the dispersion analysis
very simple.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">But I still have some other questions.

1. How did you declare replicates in such Variable relaxation period
experiments? I saw in the example r1rho_on_res_m61.py, you read all the
data
into a big Matrix data and did not declare the replicate. But for the
fixed
time period you declare by the spectrum ID. Did you have a solution for
this?
</pre></blockquote><pre style="margin: 0em;">

relax is fully flexible.  You simply use the spectrum.replicated user
function - then relax will take care of the rest.  See the manual
(<a  rel="nofollow" href="http://www.nmr-relax.com/manual/Dispersion_script_mode_loading_data.html">http://www.nmr-relax.com/manual/Dispersion_script_mode_loading_data.html</a>
and
<a  rel="nofollow" href="http://www.nmr-relax.com/manual/Dispersion_GUI_mode_loading_data.html">http://www.nmr-relax.com/manual/Dispersion_GUI_mode_loading_data.html</a>).
  Please note that you really must upgrade to the recently release
relax 3.2.0 as it fixes a severe bug in the replicated spectra error
analysis for the relaxation dispersion analysis in relax:

<a  rel="nofollow" href="http://www.nmr-relax.com/download.html">http://www.nmr-relax.com/download.html</a>,
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/public/relax-announce/2014-05/msg00000.html">https://mail.gna.org/public/relax-announce/2014-05/msg00000.html</a>,
<a  rel="nofollow" href="https://freecode.com/projects/nmr-relax/releases/363882">https://freecode.com/projects/nmr-relax/releases/363882</a>,
<a  rel="nofollow" href="https://gna.org/forum/forum.php?forum_id=2461">https://gna.org/forum/forum.php?forum_id=2461</a>.

I can see that you are not signed up for the relax-announce mailing
list, so you probably missed the announcement.  It is worth signing up
to this list at <a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-announce/">https://mail.gna.org/listinfo/relax-announce/</a>.  This
email list receives around 10 emails per year, so it is a very low
traffic list.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">2.  I want to test NS R1rho 2-site, so I simply add it into the MODELS in
'r1rho_on_res_m61.py'. It seems does not work.
first, they give the warning when it comes to NS R1rho 2-site, (grid_inc
=8
)

------------------------------------------------------------------------------------------------------------------------------
Searching through 32768 grid nodes.
lib/dispersion/ns_r1rho_2site.py:118: RuntimeWarning: divide by zero
encountered in double_scalars
   theta = atan(spin_lock_fields[i]/dA)
lib/dispersion/ns_r1rho_2site.py:132: RuntimeWarning: invalid value
encountered in double_scalars
   back_calc[i]= -inv_relax_time * log(MA)

-----------------------------------------------------------------------------------------------------------------------------
</pre></blockquote><pre style="margin: 0em;">

We are working on removing these warnings at the moment.  It is safe
to ignore them.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I think the grid search is too heavy for the NS model, do you have a
solution to constrain it?
</pre></blockquote><pre style="margin: 0em;">

A grid_inc of 8 will be very much insufficient!  For any NMR theory.
I suggest you use the dispersion auto-analysis I have developed and
talked about in the publication
(<a  rel="nofollow" href="http://dx.doi.org/10.1093/bioinformatics/btu166">http://dx.doi.org/10.1093/bioinformatics/btu166</a>).  The trick with the
auto-analysis is to use the result of the analytic model as the
starting point for optimisation of the numeric model, so that the grid
search is bypassed.  This is described in the paper and extensively in
the relax manual.  In the auto-analysis, for the numeric R1rho model,
Art Palmer's analytic model MP05 (<a  rel="nofollow" href="http://wiki.nmr-relax.com/MP05">http://wiki.nmr-relax.com/MP05</a>) is
used.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Or for example, if I want to limit grid search only for kex and pA, but
not
for others, how can I declare that?
</pre></blockquote><pre style="margin: 0em;">

I'm not sure what you mean.  Do you mean only perform a grid search
over certain parameters and not others?  Such tricks should only be
used if you have extensive knowledge of the relaxation dispersion
phenomenon and you know exactly what the consequences of this will be.
  If so, you will know what the user function
relax_disp.set_grid_r20_from_min_r2eff that Troels Linnet added to
relax can do for you.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">For RuntimeWarning: divide by zero encountered in double_scalars, do you
have suggestions for this?
</pre></blockquote><pre style="margin: 0em;">

Ignore them.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The final results for 'NS R1rho 2-site' did not fit at all, so the data
for
M61 can only be fit with M61 model but not other models?
</pre></blockquote><pre style="margin: 0em;">

The M61 model, according to the relax manual
(<a  rel="nofollow" href="http://www.nmr-relax.com/manual/M61_2_site_fast_exchange_R1_model.html">http://www.nmr-relax.com/manual/M61_2_site_fast_exchange_R1_model.html</a>),
is for on-resonance data.  The 'NS R1rho 2-site' is for off-resonance
data.  That will probably explain what you see.  I hope these
explanations help.  You should look at the relaxation dispersion
chapter of the relax manual though, as some of your questions are
extensively covered in there.

Regards,

Edward

</pre></blockquote><pre style="margin: 0em;">_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-users mailing list
relax-users@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-users">https://mail.gna.org/listinfo/relax-users</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00027" href="msg00027.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> pma</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00011" href="msg00011.html">R1rho RD analysis</a></strong>
<ul><li><em>From:</em> pma</li></ul></li>
<li><strong><a name="00012" href="msg00012.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> pma</li></ul></li>
<li><strong><a name="00014" href="msg00014.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00023" href="msg00023.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> pma</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri May 30 16:00:15 2014</div>  
</body>
</html>
