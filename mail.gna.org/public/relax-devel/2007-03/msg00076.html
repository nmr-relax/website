<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: r3200 &#45; in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py -->
<!--X-From-R13: Quevf [npDnvyq <p.n.znpenvyqNyrrqf.np.hx> -->
<!--X-Date: Fri, 16 Mar 2007 16:25:47 +0100 -->
<!--X-Message-Id: 1174053297.8066.386.camel@mrspell -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1HRtHU&#45;0003nl&#45;Qu@subversion.gna.org -->
<!--X-Reference: 7f080ed10703160007n59fc0579yf0a7fec0c96d3df6@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r3200 - in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py -- March 16, 2007 - 16:25</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r3200 - in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00076" class="tabs">Index by Date</a> | <a href="threads.html#00076" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00075.html">Date Prev</a>] [<a href="msg00077.html">Date Next</a>] [<a href="msg00074.html">Thread Prev</a>] [<a href="msg00079.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 16 Mar 2007 13:54:57 +0000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00076.html">1174053297.8066.386.camel@mrspell</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1HRtHU-0003nl-Qu@subversion.gna.org&gt;	&lt;<a href="msg00074.html">7f080ed10703160007n59fc0579yf0a7fec0c96d3df6@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Chris MacRaild</strong> on March 16, 2007 - 16:25:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">On Fri, 2007-03-16 at 18:07 +1100, Edward d'Auvergne wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Chris,

I've cleaned up the unit tests so that you should be able to check
that these changes are working properly.  Would you be able to fix the
relax module import statements for the alternative relax data storage
object?  This commit has put relax into a very bad shape (not that
much was functioning anyway, but now nothing is).  I'm also not sure
why but the data storage singleton instance method 'add()' (to add a
new data pipe) is not working as it should.
</pre></blockquote><pre style="margin: 0em;">

It seems my attempt to delegate unbound methods from the Data class to a
proxy object was pushing Pythons polymorphism a step too far, hence the
test failures (ie. the problem was in the test, not in the code). My
solution to that (in r3209) is rather cheeky, but acceptable I hope in
the context of a unit-test?

All the imports are now fixed, and relax at least gets to a prompt.
There is even one working system test! Would you like me to do anything
more to get closer to a functional system at this stage, or can further
changes continue with the progressive redesign?

Chris

</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Cheers,

Edward


On 3/16/07, c.a.macraild@xxxxxxxxxxx &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: macraild
Date: Thu Mar 15 17:58:23 2007
New Revision: 3200

URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=3200&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=3200&amp;view=rev</a>
Log:
Alternative implimentation of the data object as a singleton.

As proposed here:
<a  href="http://www.nmr-relax.com/mail.gna.org/public/relax-devel/2007-03/msg00013.html">https://mail.gna.org/public/relax-devel/2007-03/msg00013.html</a>

and agreed here:
<a  href="http://www.nmr-relax.com/mail.gna.org/public/relax-devel/2007-03/msg00058.html#">https://mail.gna.org/public/relax-devel/2007-03/msg00058.html#</a>


Modified:
    1.3/data/__init__.py
    1.3/test_suite/unit_tests/data/test___init__.py

Modified: 1.3/data/__init__.py
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.3/data/__init__.py?rev=3200&amp;r1=3199&amp;r2=3200&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/data/__init__.py?rev=3200&amp;r1=3199&amp;r2=3200&amp;view=diff</a>
==============================================================================
--- 1.3/data/__init__.py (original)
+++ 1.3/data/__init__.py Thu Mar 15 17:58:23 2007
@@ -37,28 +37,8 @@
 class Data(dict):
     &quot;&quot;&quot;The relax data storage object.&quot;&quot;&quot;

-    # Singleton initialisation, the reference to the single instance of 
this class.
-    __instance = None
-
     # The current data pipe.
     current_pipe = None
-
-
-    def __new__(self, *args, **kargs):
-        &quot;&quot;&quot;Method for implementing the singleton design pattern.
-
-        If no other class instance currently exists, create a new 
instance of this class.  Otherwise
-        return the class instance.  See 
<a  href="http://en.wikipedia.org/wiki/Singleton_pattern">http://en.wikipedia.org/wiki/Singleton_pattern</a> for a
-        description of this design pattern.
-        &quot;&quot;&quot;
-
-        # Create a new instance if none exists.
-        if self.__instance is None:
-            self.__instance = dict.__new__(self, *args, **kargs)
-
-        # Return the class instance.
-        return self.__instance
-

     def __repr__(self):
         &quot;&quot;&quot;The string representation of the object.
@@ -145,3 +125,6 @@
         # Change the current data pipe.
         self.current_pipe = pipe_name

+# Rebind the name Data with an instance to prevent accidental creation
+# of multiple instances of the Data class
+Data = Data()

Modified: 1.3/test_suite/unit_tests/data/test___init__.py
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.3/test_suite/unit_tests/data/test___init__.py?rev=3200&amp;r1=3199&amp;r2=3200&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/test_suite/unit_tests/data/test___init__.py?rev=3200&amp;r1=3199&amp;r2=3200&amp;view=diff</a>
==============================================================================
--- 1.3/test_suite/unit_tests/data/test___init__.py (original)
+++ 1.3/test_suite/unit_tests/data/test___init__.py Thu Mar 15 17:58:23 
2007
@@ -27,9 +27,12 @@
 from data import Data


-class NewStore(Data):
-    &quot;&quot;&quot;Subclass the relax data storage object for the isolation and 
creation of a new singleton.&quot;&quot;&quot;
-
+class NewStore(dict):
+    &quot;&quot;&quot;Dict subclass to act as proxy for the Singleton Data object.&quot;&quot;&quot;
+    def __getattr__(self, attr):
+        &quot;&quot;&quot;Delegate to the Data class to get methods for testing&quot;&quot;&quot;
+        return getattr(Data.__class__, attr)
+

 class Empty_container:
     &quot;&quot;&quot;An empty data container.&quot;&quot;&quot;
@@ -53,15 +56,11 @@
         # Add an object to the data store object.
         self.data_store.test = 1

-        # Create a new reference.
-        self.new_ref = NewStore()
-

     def tearDown(self):
         &quot;&quot;&quot;Destroy the subclassed data store.&quot;&quot;&quot;

         # Delete all references (which should decrement the singleton's 
ref counter to 0, hence destroying it).
-        del self.new_ref
         del self.data_store


@@ -104,18 +103,3 @@
         self.assert_(hasattr(self.data_store, 'current_pipe'))


-    def test_singleton(self):
-        &quot;&quot;&quot;Test that the relax data storage object is functioning as a 
singleton.&quot;&quot;&quot;
-
-        # Test that the new reference to NewStore is the singleton 
instance reference.
-        self.assertEqual(self.data_store, self.new_ref)
-
-        # Delete all references (which should decrement the singleton's 
ref counter to 0, hence destroying it).
-        del self.new_ref
-        del self.data_store
-
-        # Create a new singleton.
-        new = NewStore()
-
-        # Test that the object 'test' from the original singleton does 
not exist.
-        self.assert_(not hasattr(new, 'test'))


_______________________________________________
relax (<a  href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>

</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00079" href="msg00079.html">Re: r3200 - in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00074" href="msg00074.html">Re: r3200 - in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Sat Mar 17 03:00:33 2007</div>  
</body>
</html>
