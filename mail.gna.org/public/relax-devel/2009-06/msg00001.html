<!-- MHonArc v2.6.16 -->
<!--X-Subject: Multiple field relaxation dispersion data handling -->
<!--X-From-R13: Eéonfgvra [beva <fronfgvra.zbeva.1Nhyniny.pn> -->
<!--X-Date: Wed, 03 Jun 2009 21:10:56 +0200 -->
<!--X-Message-Id: 4A26CA97.3030905@ulaval.ca -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Multiple field relaxation dispersion data handling -- June 03, 2009 - 21:10</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Multiple field relaxation dispersion data handling</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00001" class="tabs">Index by Date</a> | <a href="threads.html#00001" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00000.html">Date Prev</a>] [<a href="msg00002.html">Date Next</a>] [<a href="msg00000.html">Thread Prev</a>] [<a href="msg00002.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Wed, 03 Jun 2009 15:10:15 -0400</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00001.html">4A26CA97.3030905@ulaval.ca</a>&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Thunderbird 2.0.0.21 (X11/20090501)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Sébastien Morin</strong> on June 03, 2009 - 21:10:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi,

</pre><tt>I am currently trying to do some work on the relaxation dispersion 
</tt><tt>branch which has been on idle mode for somehow a long time...
</tt><pre style="margin: 0em;">

</pre><tt>Executing the system tests for relaxation dispersion, one of the current 
</tt><tt>problems concerns the way multiple field data is handled. It is now 
</tt><tt>having troubles at the very beginning, i.e. data input stage. This could 
</tt><tt>be bypassed and a single magnetic implementation be created, but I would 
</tt><tt>prefer implementing relaxation dispersion directly with multiple field 
</tt><tt>facilities since it is known that multiple field data is a pre-requisite 
</tt><tt>for reliable extraction of dynamics information from relaxation 
</tt><tt>dispersion experiments.
</tt><pre style="margin: 0em;">

Ok.

</pre><tt>So, the way I started to implement it was that peak amplitudes would be 
</tt><tt>first read into relax for all fields and R2eff would be extracted for 
</tt><tt>these respective fields. Hence, the following commands would be issued 
</tt><tt>(as in the system test script: 
</tt><tt>'test_suite/system_tests/scripts/relax_disp_cpmg_fast.py'):
</tt><pre style="margin: 0em;">

======================================
import sys

# Create the data pipe.
pipe.create('rex', 'relax_disp')

# The path to the data files.
</pre><tt>data_path_1 = sys.path[-1] + 
</tt><tt>'/test_suite/shared_data/curve_fitting_disp/Hansen/500_MHz'
</tt><tt>data_path_2 = sys.path[-1] + 
</tt><tt>'/test_suite/shared_data/curve_fitting_disp/Hansen/800_MHz'
</tt><pre style="margin: 0em;">

# Load the sequence.
</pre><tt>sequence.read('fake_sequence.in', dir=sys.path[-1] + 
</tt><tt>'/test_suite/shared_data/curve_fitting_disp/Hansen')
</tt><pre style="margin: 0em;">

# Name the spins so they can be matched to the assignments.
spin.name(name='N')

# Set the relaxation dispersion experiment type.
relax_disp.exp_type('cpmg')

# Set the relaxation dispersion curve type.
relax_disp.select_model('fast')

# Relaxation dispersion magnetic field (in Hz).
frq.set(id='500', frq=500.0 * 1e6)
frq.set(id='800', frq=800.0 * 1e6)

# Spectrum names.
</pre><tt>names = ['reference.in_sparky',  '66.667.in_sparky', '1000.in_sparky', 
</tt><tt>'133.33.in_sparky', '933.33.in_sparky', '200.in_sparky', 
</tt><tt>'866.67.in_sparky', '266.67.in_sparky', '800.in_sparky', 
</tt><tt>'333.33.in_sparky', '733.33.in_sparky', '400.in_sparky', 
</tt><tt>'666.67.in_sparky', '466.67.in_sparky',    '600.in_sparky', 
</tt><tt>'533.33.in_sparky', '133.33.in.bis_sparky', '933.33.in.bis_sparky', 
</tt><tt>'533.33.in.bis_sparky']
</tt><pre style="margin: 0em;">

# Relaxation dispersion CPMG constant time delay T (in s).
relax_disp.cpmg_delayT(id='500', delayT=0.030)
relax_disp.cpmg_delayT(id='800', delayT=0.030)

# Relaxation dispersion CPMG frequencies (in Hz).
</pre><tt>cpmg_frq = [None, 66.667, 1000, 133.33, 933.33, 200, 866.67, 266.67, 
</tt><tt>800, 333.33, 733.33, 400, 666.67, 466.67, 600, 533.33, 133.33, 933.33, 
</tt><tt>533.33]
</tt><pre style="margin: 0em;">

# Loop over the spectra.
for i in xrange(len(names)):
   # Load the peak intensities.
</pre><tt>   spectrum.read_intensities(file=names[i], dir=data_path_1, 
</tt><tt>spectrum_id=names[i], int_method='height')
</tt><tt>   spectrum.read_intensities(file=names[i], dir=data_path_2, 
</tt><tt>spectrum_id=names[i], int_method='height')
</tt><pre style="margin: 0em;">
======================================


</pre><tt>However, the script crashes at this point where the second magnetic 
</tt><tt>field data are read into relax. It crashes because the names of the 
</tt><tt>spectra are the same for both magnetic fields:
</tt><pre style="margin: 0em;">

======================================
</pre><tt> File 
</tt><tt>&quot;/home/semor/pse-4/collaborations/relax/relax-1.3--relax_disp/test_suite/system_tests/scripts/relax_disp_cpmg_fast.py&quot;, 
</tt><tt>line 83, in &lt;module&gt;
</tt><tt>   spectrum.read_intensities(file=names[i], dir=data_path_2, 
</tt><tt>spectrum_id=names[i], int_method='height')
</tt><tt> File 
</tt><tt>&quot;/home/semor/pse-4/collaborations/relax/relax-1.3--relax_disp/prompt/spectrum.py&quot;, 
</tt><tt>line 493, in read_intensities
</tt><tt>   spectrum.read(file=file, dir=dir, spectrum_id=spectrum_id, 
</tt><tt>heteronuc=heteronuc, proton=proton, int_col=int_col, 
</tt><tt>int_method=int_method, mol_name_col=mol_name_col, 
</tt><tt>res_num_col=res_num_col, res_name_col=res_name_col, 
</tt><tt>spin_num_col=spin_num_col, spin_name_col=spin_name_col, sep=sep, 
</tt><tt>ncproc=ncproc)
</tt><tt> File 
</tt><tt>&quot;/home/semor/pse-4/collaborations/relax/relax-1.3--relax_disp/generic_fns/spectrum.py&quot;, 
</tt><tt>line 831, in read
</tt><tt>   raise RelaxError, &quot;The spectrum identification string '%s' already 
</tt><tt>exists.&quot; % spectrum_id
</tt><tt>RelaxError: RelaxError: The spectrum identification string 
</tt><tt>'reference.in_sparky' already exists.
</tt><pre style="margin: 0em;">
======================================


So what should be done to avoid this ?

</pre><tt>Should a magnetic field variable (something like 'frq') be added to the 
</tt><tt>spectrum.read_intensities() function in order for it to treat the 
</tt><tt>different magnetic field data separately ? This might be much 
</tt><tt>unnecessary work...
</tt><pre style="margin: 0em;">

</pre><tt>Should a loop be inserted in order to extract R2eff values from peak 
</tt><tt>intensities at one magnetic field at a time, before storing these 
</tt><tt>informations and, finally, doing the multiple field curve fitting of 
</tt><tt>relaxation dispersion ? I guess this would be the best option...
</tt><pre style="margin: 0em;">

Should the complete approach be changed ?

Any suggestion ?


Séb  :)

--
Sébastien Morin
PhD Student
S. Gagné NMR Laboratory
Université Laval &amp; PROTEO
Québec, Canada



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00002" href="msg00002.html">Re: Multiple field relaxation dispersion data handling</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Jun 30 22:01:29 2009</div>  
</body>
</html>
