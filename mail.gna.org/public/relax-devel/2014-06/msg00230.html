<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r23952 &#45; /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Sun, 15 Jun 2014 15:02:46 +0200 -->
<!--X-Message-Id: CA+CBx2OFho6bQ&#45;vv_ordS12D4j986bZEkTEzMxJTzY7_XFT_3A@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Ww4Jv&#45;0008P5&#45;7q@subversion.gna.org -->
<!--X-Reference: CAED9pY9iWNhomp6v0Kv7&#45;=CYBkr0p=ohZ6LhxTGEC5kOP5EBgg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r23952 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py -- June 15, 2014 - 15:02</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r23952 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00230" class="tabs">Index by Date</a> | <a href="threads.html#00230" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00229.html">Date Prev</a>] [<a href="msg00231.html">Date Next</a>] [<a href="msg00223.html">Thread Prev</a>] [<a href="msg00233.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Sun, 15 Jun 2014 15:01:55 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type; bh=DKtiwV9fWIvpJR0D7t9mba7rswfbDLVeyGFtusmR0Zo=; b=xOJiMpxfNqOAO2qpjEx79fpGBW2YsozZ2xiKjsfoDIvka0b7oFj/oyox+ECiUrQlCP NPqCMDX9A3sVwqbZUeuT+a4LOGyekGn7kYJ9ZsRQ9a7H7dfvl8ofJ5TanjDzN2joGInB SpTgH8RBS+a5J+Xlyb73FpFU6M4pgyOsN648CQ9L/2Uby7yw5UsZzoq/q+GRyxi+GaOr UJRrzoyVl7orXNdv188nnAd7yZNTiJPZPsP61131r9jlfQnX+lNp+yt55QBP2F0zIAZu bMrS3nw/eWFnoiD9HYdegX/kngnpErA3AXnU457bCSb/l3SupJM0y+BqPV24lXA43Izk WNNw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00230.html">CA+CBx2OFho6bQ-vv_ordS12D4j986bZEkTEzMxJTzY7_XFT_3A@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Ww4Jv-0008P5-7q@subversion.gna.org&gt; &lt;CAED9pY9iWNhomp6v0Kv7-=CYBkr0p=ohZ6LhxTGEC5kOP5EBgg@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on June 15, 2014 - 15:02:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Ed.

I tried the out argument, but it wont work?

I was more thinking of giving dot two matrices that are both C_CONTIGUOUS.

<a  rel="nofollow" href="http://wiki.scipy.org/PerformanceTips">http://wiki.scipy.org/PerformanceTips</a>



2014-06-15 10:33 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

Is this actually faster?  I just wrote a script to test this at
<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/index.php?7807#comment199">https://gna.org/task/index.php?7807#comment199</a>.  The log file with the
results is also attached.  This is also archived at
<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.devel/6240">http://article.gmane.org/gmane.science.nmr.relax.devel/6240</a>.  If you
look at that, I think I can show a way to make the numeric models up
to twice as fast.  And that is simply to use the out argument for the
dot product.  At least it will minimise the time required for the dot
products, and maybe remove this as the bottleneck.

Regards,

Edward



On 15 June 2014 08:53,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Sun Jun 15 08:53:38 2014
New Revision: 23952

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=23952&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=23952&amp;view=rev</a>
Log:
Changed linked matrix/vector inner products into chained dot expressions.

Task #7807 (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/index.php?7807">https://gna.org/task/index.php?7807</a>): Speed-up of
</pre></blockquote><pre style="margin: 0em;">dispersion models for Clustered analysis.
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Modified:
    branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py

Modified: branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py
URL:
</pre></blockquote><pre style="margin: 0em;"><a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py?rev=23952&amp;r1=23951&amp;r2=23952&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py?rev=23952&amp;r1=23951&amp;r2=23952&amp;view=diff</a>
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">==============================================================================
</pre><blockquote class="blockquote"><pre style="margin: 0em;">--- branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py
</pre></blockquote><pre style="margin: 0em;">(original)
</pre><blockquote class="blockquote"><pre style="margin: 0em;">+++ branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py Sun Jun
</pre></blockquote><pre style="margin: 0em;">15 08:53:38 2014
</pre><blockquote class="blockquote"><pre style="margin: 0em;">@@ -56,6 +56,7 @@
 # Python module imports.
 from numpy import dot, fabs, isfinite, log, min, ones, ndarray
 from numpy.ma import fix_invalid, masked_less_equal, masked_where
+import numpy as np

 # relax module imports.
 from lib.dispersion.ns_matrices import rcpmg_3d
@@ -138,9 +139,7 @@

         # Loop over the CPMG elements, propagating the magnetisation.
         for j in range(2*power[i]):
-            Mint = dot(Rexpo, Mint)
-            Mint = dot(r180x, Mint)
-            Mint = dot(Rexpo, Mint)
+            Mint = Rexpo.dot(r180x).dot(Rexpo).dot(Mint)

         # The next lines calculate the R2eff using a two-point
</pre></blockquote><pre style="margin: 0em;">approximation, i.e. assuming that the decay is mono-exponential.
</pre><blockquote class="blockquote"><pre style="margin: 0em;">         Mx = Mint[1] / pA


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>

</pre></blockquote><pre style="margin: 0em;">

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00233" href="msg00233.html">Re: r23952 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00223" href="msg00223.html">Re: r23952 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Sun Jun 15 15:40:13 2014</div>  
</body>
</html>
