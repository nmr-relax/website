<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: R1rho RD analysis -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 30 Jun 2014 12:24:04 +0200 -->
<!--X-Message-Id: CAED9pY_U47gvKoJQ2qdj_S0BusLTkV0PZQDbj7e+swz1suYELA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: mailman.0.1400242739.20441.relax&#45;users@gna.org -->
<!--X-Reference: 537A143C.3020901@ibs.fr -->
<!--X-Reference: CAED9pY8GmeRj=HfGGb9x0Gk00bn1vBQYfYsUFDTzRmgyY7B_VA@mail.gmail.com -->
<!--X-Reference: 5391E4B1.6050707@ibs.fr -->
<!--X-Reference: CAED9pY_67hJ9AnXLun0TxCb39n1WT+Yxwe_U1xfXwEs+=YkNVw@mail.gmail.com -->
<!--X-Reference: CAED9pY_bJwCjpXFgrhTn7KiFNk9Wss5xaOwKcsVqvc6=qcP0nQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2Pat+Mvg+=Ujyuktj5H&#45;XWEcYKU_a&#45;Vfpmi840S9S7tOg@mail.gmail.com -->
<!--X-Reference: CAED9pY_Lz0oXa2JHhub4v38fTgz&#45;_ZQ49ZuyvSBde5D7W1jqXg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: R1rho RD analysis -- June 30, 2014 - 12:24</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: R1rho RD analysis</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00030" class="tabs">Index by Date</a> | <a href="threads.html#00030" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00029.html">Date Prev</a>] [Date Next] [<a href="msg00026.html">Thread Prev</a>] [<a href="msg00003.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 30 Jun 2014 12:23:33 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-users@xxxxxxx&quot; &lt;relax-users@xxxxxxx&gt;, Andrew Baldwin &lt;andrew.baldwin@xxxxxxxxxxxxx&gt;, Gary Thompson &lt;garyt@xxxxxxxxxxxxx&gt;, Nikolai Skrynnikov &lt;nikolai@xxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type; bh=TIKbEr9kWCQzTnoBIKYMoOuCOIy5mK8zvljmhS/MUPU=; b=nfxpzNXCy5D6oI51ovDwBU+liGR/hRY8rhwH/NH72DaNPjf2N182gcW+0uD2phRTPU bW+FbEPb6HC8gKajYp+F65bFCFhT8EXu9wpFQoN3H2JftuUu3AJ4GB58oXqFzpIdRbJs NokdnXUpFEsyUvZnU/0Oujhzu+Nc6oz43HjM4ivTf96Rk/yul0Dr4eJmuF/+QItfDUKW dpXIhPDi4hCocHBERzTuovLfEl4hR8DkW9ZVBIYe/jTTU4Bnao9uzq9Rc3SZ9+fYpCE1 pL1VKcGLUd+qGKxYwlwl4X/8GDi6tARmG47b+sVkCixmvZlpfS2UYmlpJPek6/UNPJUl si0Q==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00030.html">CAED9pY_U47gvKoJQ2qdj_S0BusLTkV0PZQDbj7e+swz1suYELA@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;mailman.0.1400242739.20441.relax-users@gna.org&gt; &lt;537A143C.3020901@ibs.fr&gt; &lt;CAED9pY8GmeRj=HfGGb9x0Gk00bn1vBQYfYsUFDTzRmgyY7B_VA@mail.gmail.com&gt; &lt;<a href="msg00006.html">5391E4B1.6050707@ibs.fr</a>&gt; &lt;CAED9pY_67hJ9AnXLun0TxCb39n1WT+Yxwe_U1xfXwEs+=YkNVw@mail.gmail.com&gt; &lt;CAED9pY_bJwCjpXFgrhTn7KiFNk9Wss5xaOwKcsVqvc6=qcP0nQ@mail.gmail.com&gt; &lt;CA+CBx2Pat+Mvg+=Ujyuktj5H-XWEcYKU_a-Vfpmi840S9S7tOg@mail.gmail.com&gt; &lt;<a href="msg00026.html">CAED9pY_Lz0oXa2JHhub4v38fTgz-_ZQ49ZuyvSBde5D7W1jqXg@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 30, 2014 - 12:24:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

For a permanent reference, here are the timings of all of the
dispersion models in relax, with statistics from 10 repetitions, of
the calculation time for 100 function calls for 100 spins.  I.e.
either 10,000 function calls for single spins or 100 function calls
for the cluster of 100 spins.  These are for Troels' recent linear
algrebra optimisations in the disp_spin_speed relax branch
(<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/?pathrev=24362">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/?pathrev=24362</a>).
The absolute timings are not very interesting however the numbers do
allow for comparisons between models.

This shows, for example, how Nikolai's numeric solution (the &quot;NS CPMG
2-site expanded&quot; model at
<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.2/lib.dispersion.ns_cpmg_2site_expanded-module.html">http://www.nmr-relax.com/api/3.2/lib.dispersion.ns_cpmg_2site_expanded-module.html</a>)
is now only 1.08 or 1.39 times slower than Andy's newly published
analytic model (B14).  It also shows that both of these models are ~10
times faster for single spins or ~100 times faster for clustered spins
than the currently implemented numeric models which use full evolution
matrices.  And how the clustered analysis is now significantly faster
than the non-clustered analysis, though this advantage would be
eliminated when running Gary Thompson's multi-processor framework with
OpenMPI on a large cluster.

After Troels' impressive optimisations it can be seen that there are
almost no optimisation possibilities left.  You can see this in the
code of the target_functions/relax_disp.py file
(<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/target_functions/relax_disp.py?view=log&amp;pathrev=24362">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/target_functions/relax_disp.py?view=log&amp;pathrev=24362</a>)
and the files in lib/dispersion/ implementing each dispersion model
(<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/dispersion/?pathrev=24362">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/dispersion/?pathrev=24362</a>).
Apart from the option of expanding the other &quot;NS CPMG 2-site *&quot; and
&quot;NS R1rho *&quot; models following Nikolai's example of the &quot;NS CPMG 2-site
expanded&quot; model, there is not much more speed to be obtained.  As this
is using BLAS/LAPACK+OpenMP via numpy, rewriting the code in C or
FORTRAN will not significantly increase the speed of the models.  If
you feel your model can be faster, any suggestions for speeding up the
code are welcome.  Note that the math domain error checking and edge
case detection code is essential for providing numerical stability for
the dispersion models, and is present for all models.

Here are the timings:

100 single spins analysis:
<a  rel="nofollow" href="http://wiki.nmr-relax.com/No_Rex">http://wiki.nmr-relax.com/No_Rex</a>                       0.290+/-0.016 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/LM63">http://wiki.nmr-relax.com/LM63</a>                         0.792+/-0.015 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/LM63_3-site">http://wiki.nmr-relax.com/LM63_3-site</a>                  1.042+/-0.018 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/CR72">http://wiki.nmr-relax.com/CR72</a>                         1.588+/-0.038 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/CR72_full">http://wiki.nmr-relax.com/CR72_full</a>                    1.723+/-0.030 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/IT99">http://wiki.nmr-relax.com/IT99</a>                         0.894+/-0.020 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/TSMFK01">http://wiki.nmr-relax.com/TSMFK01</a>                      0.751+/-0.013 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/B14">http://wiki.nmr-relax.com/B14</a>                          3.975+/-0.070 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/B14_full">http://wiki.nmr-relax.com/B14_full</a>                     3.973+/-0.073 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_expanded">http://wiki.nmr-relax.com/NS_CPMG_2-site_expanded</a>      4.234+/-0.089 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_3D">http://wiki.nmr-relax.com/NS_CPMG_2-site_3D</a>           45.374+/-1.355 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_3D_full">http://wiki.nmr-relax.com/NS_CPMG_2-site_3D_full</a>      45.954+/-1.165 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_star">http://wiki.nmr-relax.com/NS_CPMG_2-site_star</a>         36.792+/-0.765 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_star_full">http://wiki.nmr-relax.com/NS_CPMG_2-site_star_full</a>    36.345+/-0.420 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/MMQ_CR72">http://wiki.nmr-relax.com/MMQ_CR72</a>                     4.211+/-0.084 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_MMQ_2-site">http://wiki.nmr-relax.com/NS_MMQ_2-site</a>               83.476+/-2.326 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_MMQ_3-site_linear">http://wiki.nmr-relax.com/NS_MMQ_3-site_linear</a>        91.677+/-1.460 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_MMQ_3-site">http://wiki.nmr-relax.com/NS_MMQ_3-site</a>               93.030+/-0.840 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/M61">http://wiki.nmr-relax.com/M61</a>                          0.907+/-0.057 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/DPL94">http://wiki.nmr-relax.com/DPL94</a>                        1.128+/-0.022 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/TP02">http://wiki.nmr-relax.com/TP02</a>                         1.236+/-0.019 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/TAP03">http://wiki.nmr-relax.com/TAP03</a>                        1.952+/-0.028 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/MP05">http://wiki.nmr-relax.com/MP05</a>                         1.445+/-0.029 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_R1rho_2-site">http://wiki.nmr-relax.com/NS_R1rho_2-site</a>             36.547+/-1.757 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_R1rho_3-site_linear">http://wiki.nmr-relax.com/NS_R1rho_3-site_linear</a>      72.351+/-1.483 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_R1rho_3-site">http://wiki.nmr-relax.com/NS_R1rho_3-site</a>             73.000+/-1.696 seconds

Cluster of 100 spins analysis:
<a  rel="nofollow" href="http://wiki.nmr-relax.com/No_Rex">http://wiki.nmr-relax.com/No_Rex</a>                       0.008+/-0.000 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/LM63">http://wiki.nmr-relax.com/LM63</a>                         0.038+/-0.002 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/LM63_3-site">http://wiki.nmr-relax.com/LM63_3-site</a>                  0.069+/-0.001 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/CR72">http://wiki.nmr-relax.com/CR72</a>                         0.107+/-0.002 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/CR72_full">http://wiki.nmr-relax.com/CR72_full</a>                    0.112+/-0.005 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/IT99">http://wiki.nmr-relax.com/IT99</a>                         0.009+/-0.000 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/TSMFK01">http://wiki.nmr-relax.com/TSMFK01</a>                      0.039+/-0.000 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/B14">http://wiki.nmr-relax.com/B14</a>                          0.509+/-0.006 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/B14_full">http://wiki.nmr-relax.com/B14_full</a>                     0.488+/-0.006 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_expanded">http://wiki.nmr-relax.com/NS_CPMG_2-site_expanded</a>      0.711+/-0.008 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_3D">http://wiki.nmr-relax.com/NS_CPMG_2-site_3D</a>           41.426+/-1.090 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_3D_full">http://wiki.nmr-relax.com/NS_CPMG_2-site_3D_full</a>      41.686+/-0.632 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_star">http://wiki.nmr-relax.com/NS_CPMG_2-site_star</a>         31.209+/-0.635 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_star_full">http://wiki.nmr-relax.com/NS_CPMG_2-site_star_full</a>    30.933+/-0.496 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/MMQ_CR72">http://wiki.nmr-relax.com/MMQ_CR72</a>                     0.863+/-0.007 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_MMQ_2-site">http://wiki.nmr-relax.com/NS_MMQ_2-site</a>               77.124+/-1.951 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_MMQ_3-site_linear">http://wiki.nmr-relax.com/NS_MMQ_3-site_linear</a>        83.364+/-1.075 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_MMQ_3-site">http://wiki.nmr-relax.com/NS_MMQ_3-site</a>               83.700+/-0.595 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/M61">http://wiki.nmr-relax.com/M61</a>                          0.036+/-0.001 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/DPL94">http://wiki.nmr-relax.com/DPL94</a>                        0.138+/-0.002 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/TP02">http://wiki.nmr-relax.com/TP02</a>                         0.172+/-0.002 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/TAP03">http://wiki.nmr-relax.com/TAP03</a>                        0.294+/-0.002 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/MP05">http://wiki.nmr-relax.com/MP05</a>                         0.191+/-0.005 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_R1rho_2-site">http://wiki.nmr-relax.com/NS_R1rho_2-site</a>             33.027+/-0.549 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_R1rho_3-site_linear">http://wiki.nmr-relax.com/NS_R1rho_3-site_linear</a>      64.863+/-1.602 seconds
<a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_R1rho_3-site">http://wiki.nmr-relax.com/NS_R1rho_3-site</a>             66.390+/-2.050 seconds

The full timing file with many more details can be seen at the
permanent link of
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/test_suite/shared_data/dispersion/profiling/disp_profile_single.log?view=log&amp;pathrev=24364">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/test_suite/shared_data/dispersion/profiling/disp_profile_single.log?view=log&amp;pathrev=24364</a>
or 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/*checkout*/relax/branches/disp_spin_speed/test_suite/shared_data/dispersion/profiling/disp_profile_single.log?revision=24364&amp;pathrev=24364">http://svn.gna.org/viewcvs/*checkout*/relax/branches/disp_spin_speed/test_suite/shared_data/dispersion/profiling/disp_profile_single.log?revision=24364&amp;pathrev=24364</a>.

Regards,

Edward


P. S.  ATLAS can also be set up with numpy for even greater speed
(<a  rel="nofollow" href="https://en.wikipedia.org/wiki/Automatically_Tuned_Linear_Algebra_Software">https://en.wikipedia.org/wiki/Automatically_Tuned_Linear_Algebra_Software</a>).

On 27 June 2014 12:01, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

For reference for the relax users reading this, the abbreviations
Troels used for the relaxation dispersion models can be decoded using
the relax wiki page
<a  rel="nofollow" href="http://wiki.nmr-relax.com/Category:Relaxation_dispersion">http://wiki.nmr-relax.com/Category:Relaxation_dispersion</a>.

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Just a little heads-up.

Within a week or two, we should be able to release a new version of relax.

This update has focused on speed, recasting the data to higher
dimensional numpy arrays, and
moving the multiple dot operations out of the for loops.

So we have quite much better speed now. :-)
</pre></blockquote><pre style="margin: 0em;">

Troels, you just gave away the surprise of the relax 3.2.3 or 3.2.4
release!  Note that relax was not particularly slow before these
changes, but that you have taken far greater advantage of the
BLAS/LAPACK libraries behind the numpy functions to make the
dispersion models in relax super fast, especially when spins are
clustered.  It's a pity we don't have the means to compare the
optimisation target function speed between relax and other software to
show how much faster relax now is, as the relax advantage of having a
grid search to find the initial non-biased position for optimisation
(a very important technique for optimisation that a number of other
dispersion software do not provide) will give many relax users the
incorrect impression that relax is slower than the other software.
Though if relax is used on a cluster with OpenMPI, this is a
non-issue.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">But we still have a bottleneck with numerical models, where doing the
matrix exponential via eigenvalue decomposition is slow!
Do any of you any experience with a faster method for doing matrix 
exponential?

These initial results shows that if you are going to use the R1rho
2site model, you can expect:

-R1rho
100 single spins analysis:
DPL94:                      23.525+/-0.409 -&gt;   1.138+/-0.035,  20.676x 
faster.
TP02:                       20.191+/-0.375 -&gt;   1.238+/-0.020,  16.308x 
faster.
TAP03:                      31.993+/-0.235 -&gt;   1.956+/-0.025,  16.353x 
faster.
MP05:                       24.892+/-0.354 -&gt;   1.431+/-0.014,  17.395x 
faster.
NS R1rho 2-site:           245.961+/-2.637 -&gt;  36.308+/-0.458,   6.774x 
faster.

Cluster of 100 spins analysis:
DPL94:                      23.872+/-0.505 -&gt;   0.145+/-0.002, 164.180x 
faster.
TP02:                       20.445+/-0.411 -&gt;   0.172+/-0.004, 118.662x 
faster.
TAP03:                      32.212+/-0.234 -&gt;   0.294+/-0.002, 109.714x 
faster.
MP05:                       25.013+/-0.362 -&gt;   0.188+/-0.003, 132.834x 
faster.
NS R1rho 2-site:           246.024+/-3.724 -&gt;  33.119+/-0.320,   7.428x 
faster.

-CPMG
100 single spins analysis:
CR72:                        2.615+/-0.018 -&gt;   1.614+/-0.024,   1.621x 
faster.
CR72 full:                   2.678+/-0.020 -&gt;   1.839+/-0.165,   1.456x 
faster.
IT99:                        1.837+/-0.030 -&gt;   0.881+/-0.010,   2.086x 
faster.
TSMFK01:                     1.665+/-0.049 -&gt;   0.742+/-0.007,   2.243x 
faster.
B14:                         5.851+/-0.133 -&gt;   3.978+/-0.049,   1.471x 
faster.
B14 full:                    5.789+/-0.102 -&gt;   4.065+/-0.059,   1.424x 
faster.
NS CPMG 2-site expanded:     8.225+/-0.196 -&gt;   4.140+/-0.062,   1.987x 
faster.
NS CPMG 2-site 3D:         240.027+/-3.182 -&gt;  45.056+/-0.584,   5.327x 
faster.
NS CPMG 2-site 3D full:    240.910+/-4.882 -&gt;  45.230+/-0.540,   5.326x 
faster.
NS CPMG 2-site star:       186.480+/-2.299 -&gt;  36.400+/-0.397,   5.123x 
faster.
NS CPMG 2-site star full:  187.111+/-2.791 -&gt;  36.745+/-0.689,   5.092x 
faster.

Cluster of 100 spins analysis:
CR72:                        2.610+/-0.035 -&gt;   0.118+/-0.001,  22.138x 
faster.
CR72 full:                   2.674+/-0.021 -&gt;   0.122+/-0.001,  21.882x 
faster.
IT99:                        0.018+/-0.000 -&gt;   0.009+/-0.000,
2.044x faster. IT99: Cluster of only 1 spin analysis, since v. 3.2.2
had a bug with clustering analysis.:
TSMFK01:                     1.691+/-0.091 -&gt;   0.039+/-0.000,  43.369x 
faster.
B14:                         5.891+/-0.127 -&gt;   0.523+/-0.004,  11.264x 
faster.
B14 full:                    5.818+/-0.127 -&gt;   0.515+/-0.021,  11.295x 
faster.
NS CPMG 2-site expanded:     8.167+/-0.159 -&gt;   0.702+/-0.008,  11.638x 
faster.
NS CPMG 2-site 3D:         238.717+/-3.025 -&gt;  41.380+/-0.950,   5.769x 
faster.
NS CPMG 2-site 3D full:    507.411+/-803.089 -&gt;  41.852+/-1.317,
12.124x faster.
NS CPMG 2-site star:       187.004+/-1.935 -&gt;  30.823+/-0.371,   6.067x 
faster.
NS CPMG 2-site star full:  187.852+/-2.698 -&gt;  30.882+/-0.671,   6.083x 
faster.
</pre></blockquote><pre style="margin: 0em;">


There are a number of ways of computing the matrix exponential.
Avoiding eigenvalue decomposition is the essential key.  The Pade
approximation is probably the best, followed by one of the Taylor
series expansion approximations.  As I mentioned in a different post
to the relax-devel mailing list, this was used earlier in relax via
Scipy.  But I removed this and wrote my own algorithm using eigenvalue
decomposition as the Scipy expm() function used in relax was buggy and
could not correctly handle the complex part of the matrix (for the 'NS
CPMG * star' models, <a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_star">http://wiki.nmr-relax.com/NS_CPMG_2-site_star</a>).

Expokit might also be useful <a  rel="nofollow" href="http://www.maths.uq.edu.au/expokit/">http://www.maths.uq.edu.au/expokit/</a>.  But
if you can come up with a multi-rank version of such an algorithm, as
well as the matrix power algorithm, taking advantage of BLAS/LAPACK
(or writing it in C or FORTRAN and using OpenMP
<a  rel="nofollow" href="https://en.wikipedia.org/wiki/OpenMP">https://en.wikipedia.org/wiki/OpenMP</a> with a Python wrapper interface),
then this will be a huge contribution.  Eliminating this bottleneck
that makes the numeric dispersion models 10 to 500 times slower than
the analytic models, as can be seen in the table of speed ups, would
be impressive.

Note that there is another way to solve this problem which is far
faster, and that is what Nikolai Skrynnikov did with the 'NS CPMG
2-site expanded' model in relax
(<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.2/lib.dispersion.ns_cpmg_2site_expanded-module.html">http://www.nmr-relax.com/api/3.2/lib.dispersion.ns_cpmg_2site_expanded-module.html</a>
and <a  rel="nofollow" href="http://wiki.nmr-relax.com/NS_CPMG_2-site_expanded">http://wiki.nmr-relax.com/NS_CPMG_2-site_expanded</a>).  This is a
numeric model, but it looks rather analytic and it requires no slow
matrix exponential or matrix power operations.  From the speeds in
seconds that you gave, it can be seen that this model is only slightly
slower than Andy's analytic B14 model (<a  rel="nofollow" href="http://wiki.nmr-relax.com/B14">http://wiki.nmr-relax.com/B14</a>).
The reason why this model is now pretty much the same speed as Andy's
model are your linear algebra optimisations.  And using Nikolai's
approach, it is possible to achieve this for all the numeric models in
relax.

The idea is to take each numeric model and brute-force expand it using
Maple (<a  rel="nofollow" href="https://en.wikipedia.org/wiki/Maple_%28software%29">https://en.wikipedia.org/wiki/Maple_%28software%29</a>) or
equivalent.  Other symbolic algebra software such as the free Maxima
(or the GUI wxMaxima) could be used, or Mathematica, though it looks
like Maple is the most powerful for outputting this.  You can see how
this was done in the lib.dispersion.ns_cpmg_2site_expanded module
documentation, as the original Maple script is reproduced there
together with an explanation of the steps involved
(<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.2/lib.dispersion.ns_cpmg_2site_expanded-module.html">http://www.nmr-relax.com/api/3.2/lib.dispersion.ns_cpmg_2site_expanded-module.html</a>).
All numeric models, whereby the evolution matrix is slightly different
to account for different effects, has a completely different rank, or
is complex, can be expanded like this.  Then the incredibly slow
matrix exponential and matrix power operations are avoided and all of
your linear algebra tricks for speeding up the models by taking
advantage of BLAS/LAPACK+OpenMP via numpy can be used.  Using this
approach, you should be able to speed up all numeric models to the
equivalent of Nikolai's 'NS CPMG 2-site expanded' model.  This would
be the ultimate speed up for the numeric models, and would make relax
by far the fastest dispersion software out there.  You could then
include this point as part of your paper, and have all the equations
in a supplement so it can be cited.

Regards,

Edward
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00006" href="msg00006.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> pma</li></ul></li>
<li><strong><a name="00012" href="msg00012.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00016" href="msg00016.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00026" href="msg00026.html">Re: R1rho RD analysis</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jun 30 12:40:16 2014</div>  
</body>
</html>
