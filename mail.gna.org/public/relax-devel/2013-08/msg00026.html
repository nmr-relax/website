<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [sr #3043] Support for NMRPipe seriesTab format *.ser -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNtznvy.pbz> -->
<!--X-Date: Fri, 02 Aug 2013 19:24:00 +0200 -->
<!--X-Message-Id: CA+CBx2PkO75bJVAP4fb8JX9Hx11z5y7F&#45;vUVELHNxfc4W0Z1bg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20130618&#45;111658.sv20529.92371@gna.org -->
<!--X-Reference: 20130621&#45;104836.sv20529.74597@gna.org -->
<!--X-Reference: 20130621&#45;110326.sv20529.53221@gna.org -->
<!--X-Reference: 20130621&#45;125601.sv20529.4232@gna.org -->
<!--X-Reference: 20130621&#45;133538.sv20529.35811@gna.org -->
<!--X-Reference: 20130621&#45;133624.sv20529.28609@gna.org -->
<!--X-Reference: 20130621&#45;134734.sv20529.63622@gna.org -->
<!--X-Reference: 20130621&#45;135732.sv20529.11927@gna.org -->
<!--X-Reference: 20130621&#45;143814.sv20529.47445@gna.org -->
<!--X-Reference: 20130621&#45;144033.sv2782.32592@gna.org -->
<!--X-Reference: 20130621&#45;144059.sv2782.9513@gna.org -->
<!--X-Reference: 20130621&#45;152621.sv20529.10944@gna.org -->
<!--X-Reference: 20130621&#45;152918.sv2782.33904@gna.org -->
<!--X-Reference: 20130621&#45;155028.sv20529.59982@gna.org -->
<!--X-Reference: 20130621&#45;155445.sv20529.38949@gna.org -->
<!--X-Reference: 20130621&#45;160244.sv20529.97199@gna.org -->
<!--X-Reference: 20130621&#45;161055.sv20529.98641@gna.org -->
<!--X-Reference: 20130621&#45;161450.sv20529.54611@gna.org -->
<!--X-Reference: 20130621&#45;173006.sv20529.34821@gna.org -->
<!--X-Reference: 20130621&#45;174335.sv20529.95831@gna.org -->
<!--X-Reference: 20130621&#45;174724.sv20529.63909@gna.org -->
<!--X-Reference: 20130621&#45;175836.sv20529.88391@gna.org -->
<!--X-Reference: 20130621&#45;180416.sv20529.2309@gna.org -->
<!--X-Reference: 20130624&#45;094924.sv20529.63314@gna.org -->
<!--X-Reference: 20130624&#45;104521.sv20529.19556@gna.org -->
<!--X-Reference: 20130624&#45;124624.sv20529.87885@gna.org -->
<!--X-Reference: 20130624&#45;142927.sv20529.87827@gna.org -->
<!--X-Reference: 20130625&#45;170643.sv20529.66724@gna.org -->
<!--X-Reference: 20130626&#45;131656.sv20529.87900@gna.org -->
<!--X-Reference: 20130720&#45;111435.sv20529.57662@gna.org -->
<!--X-Reference: 20130720&#45;163956.sv20529.18980@gna.org -->
<!--X-Reference: 20130802&#45;082933.sv20529.44392@gna.org -->
<!--X-Reference: 20130802&#45;113735.sv20529.87604@gna.org -->
<!--X-Reference: 20130802&#45;115138.sv20529.59841@gna.org -->
<!--X-Reference: 20130802&#45;152917.sv20529.29978@gna.org -->
<!--X-Reference: CAED9pY8Zg6pj7970J=Q=t0Ze2=R_&#45;TypJDg5pv&#45;REAhaerq&#45;&#45;w@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;38Ns90st2D44BHRxnh+yrLP5Ki2Ve1ruHr2p=JHt9Zg@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;Sm5YS7=RaWOjW_WuMYh6QA&#45;jSrFoGAsEjSeu2urkbUg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sr #3043] Support for NMRPipe seriesTab format *.ser -- August 02, 2013 - 19:24</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [sr #3043] Support for NMRPipe seriesTab format *.ser</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00026" class="tabs">Index by Date</a> | <a href="threads.html#00026" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00025.html">Date Prev</a>] [<a href="msg00027.html">Date Next</a>] [<a href="msg00013.html">Thread Prev</a>] [<a href="msg00027.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 2 Aug 2013 19:23:07 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;,	&quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:in-reply-to:references:from:date:message-id:subject:to	:cc:content-type:content-transfer-encoding;	bh=i2p93g8QpReMxDX0iaE3dQfZEMmcIe4dL00rqQuqpJ4=;	b=pELOZVrut8lrSgQrBcXdJus1zYo+M9sSqRE8Hn2t4DZj0qyqFcjgAL/n4qYflrUz4E	Np2H9xtJy2dxkVzQSxxHvOnZzAn7dRiqpLON5fP0TVih99TzkqCIpbi39BjyVNnMYvJn	2VFcR8y/fav3kjoB1NpWTs4VNJdmwS+bjftdFfSC1V5guGh8FtnC/HM3F9Mp1RUoebTU	GzST7KX24Fngfx21ppQvdlvh39cMOKh72uOpRJ6vkELwh42alP2A3lI/SI66VxDkz8sf	yCxKGgsRR1FhtB+rYB87uCmz2qoZcyxfPZ0F94NSj2EBo0WUS38UWcO4QP4O4neexecz	AJzg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00026.html">CA+CBx2PkO75bJVAP4fb8JX9Hx11z5y7F-vUVELHNxfc4W0Z1bg@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;20130618-111658.sv20529.92371@xxxxxxx&gt;	&lt;20130621-104836.sv20529.74597@xxxxxxx&gt;	&lt;20130621-110326.sv20529.53221@xxxxxxx&gt;	&lt;20130621-125601.sv20529.4232@xxxxxxx&gt;	&lt;20130621-133538.sv20529.35811@xxxxxxx&gt;	&lt;20130621-133624.sv20529.28609@xxxxxxx&gt;	&lt;20130621-134734.sv20529.63622@xxxxxxx&gt;	&lt;20130621-135732.sv20529.11927@xxxxxxx&gt;	&lt;20130621-143814.sv20529.47445@xxxxxxx&gt;	&lt;20130621-144033.sv2782.32592@xxxxxxx&gt;	&lt;20130621-144059.sv2782.9513@xxxxxxx&gt;	&lt;20130621-152621.sv20529.10944@xxxxxxx&gt;	&lt;20130621-152918.sv2782.33904@xxxxxxx&gt;	&lt;20130621-155028.sv20529.59982@xxxxxxx&gt;	&lt;20130621-155445.sv20529.38949@xxxxxxx&gt;	&lt;20130621-160244.sv20529.97199@xxxxxxx&gt;	&lt;20130621-161055.sv20529.98641@xxxxxxx&gt;	&lt;20130621-161450.sv20529.54611@xxxxxxx&gt;	&lt;20130621-173006.sv20529.34821@xxxxxxx&gt;	&lt;20130621-174335.sv20529.95831@xxxxxxx&gt;	&lt;20130621-174724.sv20529.63909@xxxxxxx&gt;	&lt;20130621-175836.sv20529.88391@xxxxxxx&gt;	&lt;20130621-180416.sv20529.2309@xxxxxxx&gt;	&lt;20130624-094924.sv20529.63314@xxxxxxx&gt;	&lt;20130624-104521.sv20529.19556@xxxxxxx&gt;	&lt;20130624-124624.sv20529.87885@xxxxxxx&gt;	&lt;20130624-142927.sv20529.87827@xxxxxxx&gt;	&lt;20130625-170643.sv20529.66724@xxxxxxx&gt;	&lt;20130626-131656.sv20529.87900@xxxxxxx&gt;	&lt;20130720-111435.sv20529.57662@xxxxxxx&gt;	&lt;20130720-163956.sv20529.18980@xxxxxxx&gt;	&lt;20130802-082933.sv20529.44392@xxxxxxx&gt;	&lt;20130802-113735.sv20529.87604@xxxxxxx&gt;	&lt;20130802-115138.sv20529.59841@xxxxxxx&gt;	&lt;20130802-152917.sv20529.29978@xxxxxxx&gt;	&lt;CAED9pY8Zg6pj7970J=Q=t0Ze2=R_-TypJDg5pv-REAhaerq--w@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-38Ns90st2D44BHRxnh+yrLP5Ki2Ve1ruHr2p=JHt9Zg@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-Sm5YS7=RaWOjW_WuMYh6QA-jSrFoGAsEjSeu2urkbUg@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on August 02, 2013 - 19:24:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi.

I think you have these checks written in the generic type section.

Should it be deleted from there?

Best
Troels

Troels Emtekær Linnet


2013/8/2 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">And again :)  This time
0005-Added-check-for-number-of-supplied-spectra-ID-s-and-.patch (git
hash 7cc9b7407e77a3f5526336dc54f854b4e82c7a4f).  This check should be
independent of the peak list format.  I suggest that it goes after:

    for i in range(len(intensity_data)):
        # Extract the data.
        H_name, X_name, spin_id, intensity, line = intensity_data[i]

        # Convert the intensity data and spectrum IDs to lists if needed.
        if not isinstance(intensity, list):
            intensity = [intensity]
        if not isinstance(spectrum_id, list):
            spectrum_id = [spectrum_id]

This is at the bottom of the pipe_control.spectrum.read() function.
At this point you can simply check if the intensity and spectrum_id
lists are of the same length.  I thought I had already written this
check, but obviously not.  For keeping the data pipe clean if the user
makes a mistake, I would recommend shifting the code:

    # Add the spectrum id (and ncproc) to the relax data store.
    spectrum_ids = spectrum_id
    if isinstance(spectrum_id, str):
        spectrum_ids = [spectrum_id]
    if not hasattr(cdp, 'spectrum_ids'):
        cdp.spectrum_ids = []
        if ncproc != None:
            cdp.ncproc = {}
    for i in range(len(spectrum_ids)):
        if not spectrum_ids[i] in cdp.spectrum_ids:
            cdp.spectrum_ids.append(spectrum_ids[i])
            if ncproc != None:
                cdp.ncproc[spectrum_ids[i]] = ncproc

This should go after the &quot;for i in range(len(intensity_data)):&quot; loop,
i.e. after this check.  Shifting it to later will prevent the
cdp.spectrum_ids list to be populated after the user calls the user
function incorrectly.

Cheers,

Edward


On 2 August 2013 17:44, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi again,

A small fix is needed for the
0004-Added-system-test-for-reading-of-a-multi-column-form.patch file
(git hash 034ec73171270182afe6c4907179d46eebe1b759).  Spaces are
needed after the commas in the self.assertAlmostEqual() calls.  The
2to3 conversion program (for Python 2 to Python 3 conversion)
highlights this issue.  Also, the first few tests should be against
floats rather than integers, i.e. simply add '.0' to the end of each
number.

Cheers,

Edward



On 2 August 2013 17:39, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

I'm getting through you patches and have applied the first two.  These
are ok.  I have an issue with
0003-The-ID-of-spins-in-seriesTab_multi.ser-was-not-forma.patch though
(git hash f49b4f096773cb2f7ecb70293122e03b0b40e889).  It says that you
are changing the seriesTab_multi.ser file's 'ASS' column format to
that of Sparky.  Why is this so?  Is there an NMRPipe seriesTab format
which is different from Sparky?  If so, we should support that.

Cheers,

Edward


On 2 August 2013 17:29, Troels E. Linnet
&lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Follow-up Comment #53, sr #3043 (project relax):

Multi colums import now supported.

Note, I made it possible to autogenerate spectrum ID's, if
 spectrum_id='auto' for the function:

spectrum.read_intensities(file=&quot;seriesTab_multi.ser&quot;, 
dir=status.install_path
+ sep+'test_suite'+sep+'shared_data'+sep+'peak_lists', 
spectrum_id='auto',
int_method='point sum')

(file #18619)
    _______________________________________________________

Additional Item Attachment:

File name: stab.patch.tar.gz              Size:4 KB


    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/support/?3043">http://gna.org/support/?3043</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>

</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00027" href="msg00027.html">Re: [sr #3043] Support for NMRPipe seriesTab format *.ser</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00001" href="msg00001.html">[sr #3043] Support for NMRPipe seriesTab format *.ser</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00006" href="msg00006.html">[sr #3043] Support for NMRPipe seriesTab format *.ser</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00007" href="msg00007.html">[sr #3043] Support for NMRPipe seriesTab format *.ser</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00009" href="msg00009.html">[sr #3043] Support for NMRPipe seriesTab format *.ser</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00010" href="msg00010.html">Re: [sr #3043] Support for NMRPipe seriesTab format *.ser</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00011" href="msg00011.html">Re: [sr #3043] Support for NMRPipe seriesTab format *.ser</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re: [sr #3043] Support for NMRPipe seriesTab format *.ser</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Aug 02 19:40:07 2013</div>  
</body>
</html>
