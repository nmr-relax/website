<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: Weird performance of grid search and order of spectrum.error_analysis -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 22 Apr 2014 09:57:52 +0200 -->
<!--X-Message-Id: CAED9pY84YDY=jX70vJvoZdv=fxkdctg1T6&#45;ziROVu44QSbM3EQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CA+CBx2MysLJo=9kaY13Tj_Zy4bODLLbO&#45;taK0qa7y6JxJ&#45;WWSg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Weird performance of grid search and order of spectrum.error_analysis -- April 22, 2014 - 09:57</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Weird performance of grid search and order of spectrum.error_analysis</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00010" class="tabs">Index by Date</a> | <a href="threads.html#00010" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00009.html">Date Prev</a>] [<a href="msg00011.html">Date Next</a>] [<a href="msg00009.html">Thread Prev</a>] [<a href="msg00011.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtek√¶r Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 22 Apr 2014 09:57:02 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type; bh=GHzErbMwxeg3NQu1kDR7W1Y6wLApT3XUs7qBpiW/ZPU=; b=AfwlI1l6J4TVuY8eOHVyHgBX8ZqyNSCy0vsNOLdY0JY+q2KPBymTeTkfrNrdPxwLJJ khkZ0X+OohHPCrYhMEXOpQ16YbQijOXtbWk9gWaPuNUyAkCXLjGS6B8TgtX6RmaOD5N6 TJq1E8daBd+o+wklModWkQeGGVE8kk8yi3US+mn82SyT7Tuu9dOmzyRrK0yev8k1HZJ7 JQxowxIBYwY4ld+zNGDpfKBGLe9/OGc0hlpuxe5M5oi9CA7Xfg8bOTn//Gn646vDlf9Y dxyxFWu1cQc9UIxqQGzE4vOl9UN3BwOV6d9d3UpvaFqibKoFTzczs7u/WqlVuo4MnCSV 5wag==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY84YDY=jX70vJvoZdv=fxkdctg1T6-ziROVu44QSbM3EQ@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2MysLJo=9kaY13Tj_Zy4bODLLbO-taK0qa7y6JxJ-WWSg@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on April 22, 2014 - 09:57:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

This second thread at
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/5302">http://thread.gmane.org/gmane.science.nmr.relax.devel/5302</a> will cover
the grid search.

</pre><blockquote class="blockquote"><pre style="margin: 0em;">It seems I am having trouble using the: grid_search(lower=None,
upper=None, inc=GRID_INC, constraints=True, verbosity=1)
and finding that the order of spectrum.error_analysis is important.

I am trying to re-run an analysis of the dataset published in:

Kaare Teilum, Melanie H. Smith, Eike Schulz, Lea C. Christensen, Gleb
Solomentseva, Mikael Oliveberg, and Mikael Akkea 2009
&quot;SOD-WT&quot; CPMG data to the CR72 dispersion model at 25 degrees.
<a  rel="nofollow" href="http://dx.doi.org/10.1073/pnas.0907387106">http://dx.doi.org/10.1073/pnas.0907387106</a>

This is CPMG data with a fixed relaxation time period at 500 and 600MHz.
Global fitted to 64 residues.
kex former fitted to 2200 /s with pA=0.993 (Fig. S2 )

I did my initial analysis with a grid search for 11 increments on each 
residues.
Then did a minimization.

Then defined the 64 residues for global fit, read in the results from
above, and minimized.
The end results was weird.
kex = 6.62 and pA = 0.67, and the calculations was extremely slow.

I guess that the very long computation time is quite much related to a
bad-start from the grid_search.

I then looked into the single fitted residues.
These results showed, that either the pA was close to 0.5 or 0.99.
</pre></blockquote><pre style="margin: 0em;">

A pA value of 0.5 or 0.99 mean different things.  At 0.5, that shows
that optimisation was unable to find the minimum.  There is the
constraint that pA &gt; 0.5 in relax to simplify the optimisation space.
By convention the first state has the highest probability and for most
models (which don't say that pA must be &gt; than pB), having a pA value
less than 0.5 is the same as swapping states A and B.  Anyway, a value
of 0.5 is not good!

The value of &gt;0.99 means that there is no statistically significant
dispersion found.  This could either be true, or that optimisation has
again failed to find the minimum.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">gnuplot&gt; set yrange [0.4:1.1]
gnuplot&gt; set term dumb
Terminal type set to 'dumb'
Options are 'feed  size 79, 24'
gnuplot&gt; plot &quot;compare_128_FT_R2eff_CR72&quot; using 2:6


  1.1 ++-------+-------+--------+--------+-------+--------+-------+-------++
      +        +       +      &quot;compare_128_FT_R2eff_CR72&quot; using 2:6   A    +
      |                                                                    |
    1 ++AAA A A    AAAAAA AAAAAAA A AAAAAA  AA A AA  A A    AAA AAA    AA ++
      |A        A                                A                         |
  0.9 ++       A                                                          ++
      |        A                                                           |
      |                                                                    |
  0.8 ++              A          A   A                                    ++
      |      A                                                             |
      |                                                                    |
  0.7 ++          A             A             A                 A         ++
      | A        A     A   A    A  A                                    A  |
      |    A                                                               |
  0.6 ++                  A                            A           A      ++
      |                                                                    |
  0.5 +A AAAAA AAA A A  AA  AAAAAAAAAA AAA AA AAA AAAAA AAAA AAA  AAAAAA  ++
      |                                                                    |
      +        +       +        +        +       +        +       +        +
  0.4 ++-------+-------+--------+--------+-------+--------+-------+-------++
      0        20      40       60       80     100      120     140      
160


That made me believe, that the grid search is not performing so well.
</pre></blockquote><pre style="margin: 0em;">

That looks rather disappointing!


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I have made a system test to investigate:
relax -s 
Relax_disp.test_kteilum_mhsmith_eschulz_lcchristensen_gsolomentsev_moliveberg_makke_sod1wt_t25_to_cr72
-d

I notice that it become horrible &quot;expensive&quot; to increase the number of
grid search:


GRID Nodes = X^5;  elapsed time = 3.84E-4*X^4.94
3 243 0.0873595167
5 3125 1.0895396658
7 16807 5.7426922356
9 59049 19.8741800961
11 161051 53.5563645469
13 371293 122.239449318
15 759375 247.8689026545
17 1419857 459.9905354953
19 2476099 796.8452957302
21 4084101 1306.4552557758

For 21 grid points, it will take 21 minutes per spin.
</pre></blockquote><pre style="margin: 0em;">

This is to be expected for a grid search - for the CR72 model at 2
fields, you have 5 parameters.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">But the problem is, that I don't see kex and pA moves?
Doing up to 13 GRID_INC, I see that neither kex or pA moves, but only
dw, r2500, r2600.

########################## GRID INC 3 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(3, 1.0, 0.5, 5.0, 20.5, 20.5, None, 10, 'G', ':10@N', 0.089359045028686523)
########################## GRID INC 5 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(5, 1.0, 0.5, 5.0, 20.5, 20.5, None, 10, 'G', ':10@N', 1.060028076171875)
########################## GRID INC 7 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(7, 1.0, 0.5, 3.3333333333333335, 20.5, 20.5, None, 10, 'G', ':10@N',
5.6306891441345215)
########################## GRID INC 9 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(9, 1.0, 0.5, 3.75, 20.5, 20.5, None, 10, 'G', ':10@N', 19.880398035049438)
########################## GRID INC 11 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(11, 1.0, 0.5, 4.0, 20.5, 24.399999999999999, None, 10, 'G', ':10@N',
54.264302015304565)
########################## GRID INC 13 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(13, 1.0, 0.5, 4.166666666666667, 20.5, 23.75, None, 10, 'G', ':10@N',
122.64782810211182)

If I then set kex to 2200 before the Grid search, I see that pA is moving.

########################## GRID INC 3 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(3, 2200.0, 0.5, 0.0, 20.5, 20.5, None, 10, 'G', ':10@N', 
0.043489933013916016)
########################## GRID INC 5 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(5, 2200.0, 0.5, 0.0, 20.5, 20.5, None, 10, 'G', ':10@N', 
0.29647397994995117)
########################## GRID INC 7 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(7, 2200.0, 0.5, 0.0, 20.5, 20.5, None, 10, 'G', ':10@N', 1.045961856842041)
########################## GRID INC 9 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(9, 2200.0, 0.5, 0.0, 20.5, 20.5, None, 10, 'G', ':10@N', 2.841001033782959)
########################## GRID INC 11 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(11, 2200.0, 0.80000000000000004, 1.0, 16.600000000000001,
16.600000000000001, None, 10, 'G', ':10@N', 6.2603960037231445)
########################## GRID INC 13 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(13, 2200.0, 0.75, 0.83333333333333337, 17.25, 20.5, None, 10, 'G',
':10@N', 11.912189960479736)
########################## GRID INC 19 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(19, 2200.0, 0.91666666666666674, 1.1111111111111112,
18.333333333333336, 20.500000000000004, None, 10, 'G', ':10@N',
56.463220119476318)
########################## GRID INC 21 ##########################
GRID, kex, pA, dw, r2500, r2600, mol, resi, resn, spin_id, elapsed
(21, 2200.0, 0.90000000000000002, 1.0, 18.550000000000001, 20.5, None,
10, 'G', ':10@N', 83.805304050445557)

Is this to be expected?
</pre></blockquote><pre style="margin: 0em;">

If you have a look at the grid_search_setup() function in the
specific_analyses.relax_disp.optimisation module, you may notice some
inefficiencies.  I wrote this code very quickly to get the relaxation
dispersion analysis up and running as fast as possible.  The main
problem were the random guesses I made at the time, without much
thought, as to what the lower and upper grid search values should be.
You can see for kex that the lower value is 1 and the upper value is
1e5.  You should play around with these defaults and see how that
changes the grid search performance.  I would probably now use 0 to
1e4 for kex instead, as the higher kex values should be rare and easy
to optimise from the lower values anyway.  It could be that because
most of the kex grid points are at very high values, that most of the
grid search is not doing anything.

Anyway, see what happens when you play with this, and feel free to
change the default values.  Oh, just so you know why I chose 1 to 1e5
for kex - I was originally planning on not using the current uniform
grid search but a custom one where the kex dimension is on the log
scale.  This can be done with minfx (see
<a  rel="nofollow" href="http://home.gna.org/minfx/minfx.grid-module.html#grid_point_array">http://home.gna.org/minfx/minfx.grid-module.html#grid_point_array</a>), as
is used in the frame order analysis and model-free analysis to
parallelise the diffusion tensor grid search.  But this was never
implemented - it was partly implemented but then I deleted it as it
was taking too much time.

Regards,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00008" href="msg00008.html">Weird performance of grid search and order of spectrum.error_analysis</a></strong>
<ul><li><em>From:</em> Troels Emtek√¶r Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Apr 22 10:20:15 2014</div>  
</body>
</html>
