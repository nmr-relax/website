<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: bash script for a FTP dump of the newly create relax wiki -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNtznvy.pbz> -->
<!--X-Date: Wed, 17 Jul 2013 14:34:49 +0200 -->
<!--X-Message-Id: CA+CBx2NWWoQBa6poPP3uNszpcTRjKzBfaVPMzEGO&#45;4VTZ&#45;MNuw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CA+CBx2MXQogUUeFKZFQwYJ=VV=y3_6cQ+mjBafTVx&#45;Eg2_Ktpw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;yeSvP7Nqqof7SbHEsryuUUBr_A0OZ10aGeELnv9ty=Q@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: bash script for a FTP dump of the newly create relax wiki -- July 17, 2013 - 14:34</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: bash script for a FTP dump of the newly create relax wiki</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00048" class="tabs">Index by Date</a> | <a href="threads.html#00048" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00047.html">Date Prev</a>] [<a href="msg00049.html">Date Next</a>] [<a href="msg00047.html">Thread Prev</a>] [<a href="msg00049.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 17 Jul 2013 14:33:59 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:in-reply-to:references:from:date:message-id:subject:to	:cc:content-type:content-transfer-encoding;	bh=nHLi0POb/g6mXf2b5AG51HEXB3RHVA8bFHtaCxkey+A=;	b=t56RIfej/ZFA3hE9LtMhoM7K2Bdn8ju6OnB27RV86UPf4BMYJAiSceBav8U1moKNEx	Armqlds9F+12Qry0VBuU47C2r1RDV4rQ/x303bJjy6s/VBizEXzGYruzAryZ+xvjyKif	hrTqTC2bMBKAj4OLLLS4mNsN6Tdf8pLBGN1CWjrAYd994AuVHPEhAUVkcV5y/Iy/9zWX	CO+H8yWLX7BQQddy5SKGwc9XOU7Z8JoA04mY9exkrc8uGcwjxs8u7lAyhB9jMs+uKMQL	xUIsSmLRRhRx8K97fPG88NYE0efo4nmdf58kDmASlKbFxCN46mOwDWWEfR0vKwS8Euzt	UjHw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00048.html">CA+CBx2NWWoQBa6poPP3uNszpcTRjKzBfaVPMzEGO-4VTZ-MNuw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2MXQogUUeFKZFQwYJ=VV=y3_6cQ+mjBafTVx-Eg2_Ktpw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-yeSvP7Nqqof7SbHEsryuUUBr_A0OZ10aGeELnv9ty=Q@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on July 17, 2013 - 14:34:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Edward.

Yes, same scripts should be run together.

The mysql database will alter for each page modification.
The FTP will only alter on file upload, or if we add extensions.

Note. There is a security issue with the mysql dump.
If you look for the line:

INSERT INTO `user` VALUES

The database will contain the fields:
`user_id`, `user_name`, `user_real_name`, `user_password`,
`user_newpassword`, `user_newpass_time`, `user_email`, `user_touched`,
`user_token`, `user_email_authenticated`, `user_email_token`,
`user_email_token_expires`, `user_registration`, `user_editcount`

Reference:
<a  rel="nofollow" href="http://www.mediawiki.org/wiki/Manual:User_table">http://www.mediawiki.org/wiki/Manual:User_table</a>

And so these fields should be kept secret:
`user_password`
`user_email`
`user_token`

The password is hashed, but could be brute force cracked. How, I dont know, 
but

I suggest complely removing the line in the mysql file, by

sed -i '/^INSERT INTO `user` VALUES/d' mysqlfile.sql


Best
Troels


Troels Emtekær Linnet


2013/7/17 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

For backing up the relax wiki (<a  rel="nofollow" href="http://wiki.nmr-relax.com">http://wiki.nmr-relax.com</a>), should I
run both this script and the MySQL dumping script at
<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.devel/4163">http://article.gmane.org/gmane.science.nmr.relax.devel/4163</a>?  Will the
FTP script get the MySQL database contents?  I could create one script
to run both scripts, and then upload using rsync to the relax download
site.  I have now added this script to the relax sources as
devel_scripts/wiki_ftpdump.sh.

Cheers,

Edward



On 17 July 2013 13:24, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Dear relax developers and users.

I hereby send a bash script for a FTP dump of the newly create relax wiki.
Thereby the wiki can easily be created anywhere else, if created
together with the mysql database.

To prevent abuse of the webpage hosting service, I need to keep the
password secret.

The password is shared with Edward d'Auvergne.

I suggest a setup, where Edward run a cronjob a his infrastructure,
and expose the files to:
<a  rel="nofollow" href="http://download.gna.org/relax/wiki/ftpdump">http://download.gna.org/relax/wiki/ftpdump</a>

The FTP dump should only tricker when new files are added.
That would normally only be when images are uploaded.

Best
Troels Linnet

-----------------------
#!/bin/bash
# -*- coding: UTF-8 -*-
# Script for dumping ftp server automatically using cron.

# exec test
exec_test () {
[ $? -eq 0 ] &amp;&amp; echo &quot;-- Command successfully executed&quot; || echo &quot;--
Command failed; exit 1&quot;
}

# Filenames
dbhost=&quot;web3.gigahost.dk&quot;
# The following two fields are kept secret, to prevent abuse.
# Please contact Troels Linnet at: tlinnet _at_ gmail dot com, for access.
dbuser=&quot;secret&quot;
dbpwd=&quot;secret&quot;

mydate=`date '+%Y%m%d_%H%M'`
mytime=`date '+%T %Y%m%d'`
backupfolder=&quot;${HOME}/backup/ftpdump&quot;
backupfoldermirror=&quot;${backupfolder}/mirror&quot;
backupfoldercurrent=&quot;${backupfolder}/current&quot;
mkdir -p $backupfolder $backupfoldermirror $backupfoldercurrent

# Logging
exec 3&gt;&amp;1 4&gt;&amp;2
trap 'exec 2&gt;&amp;4 1&gt;&amp;3' 0 1 2 3
exec 1&gt;&gt;${backupfolder}/ftpdump.log 2&gt;&amp;1
# Everything below will go to the log file

dump_base () {
echo &quot;###########################&quot;
echo &quot;STARTING on: $mytime&quot;
echo &quot;Mirror syncing...&quot;
cd $backupfoldermirror
lftp -e &quot;open <a  rel="nofollow" href="ftp://${dbuser}:${dbpwd}@${dbhost}">ftp://${dbuser}:${dbpwd}@${dbhost}</a> &amp;&amp; mirror --no-perms
--exclude-glob backup_scripts/ --exclude-glob cache/ --exclude-glob
LocalSettings.php --parallel=10 &amp;&amp; bye&quot;
}

compress_base () {
echo &quot;Compressing current...&quot;
DIFF=`diff -q -r $backupfoldermirror $backupfoldercurrent`
echo -e &quot;Difference between sync and current is:\n$DIFF&quot;
DIFFARR=($DIFF)
LENDIFFARR=${#DIFFARR[@]}
if [ &quot;$LENDIFFARR&quot; -gt &quot;0&quot; ]
then
rm -rf $backupfoldercurrent
cp -p -r $backupfoldermirror $backupfoldercurrent
tar -zcf ${backupfolder}/ftpdump_${mydate}.tar.gz $backupfoldercurrent/
fi
}

dump_base ; exec_test
compress_base ; exec_test

echo &quot;Done, quit!&quot;

_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00050" href="msg00050.html">Re: bash script for a FTP dump of the newly create relax wiki</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00049" href="msg00049.html">Re: bash script for a FTP dump of the newly create relax wiki</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00046" href="msg00046.html">bash script for a FTP dump of the newly create relax wiki</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00047" href="msg00047.html">Re: bash script for a FTP dump of the newly create relax wiki</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Jul 17 15:00:07 2013</div>  
</body>
</html>
