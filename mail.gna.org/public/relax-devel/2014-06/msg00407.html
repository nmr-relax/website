<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r24192 &#45; /branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 23 Jun 2014 11:42:09 +0200 -->
<!--X-Message-Id: CAED9pY84udWWvD0hDgNJUwhoRDpv6WGRdkyNDM=pgo17nzAvoA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1WxtP8&#45;0006J5&#45;Jv@subversion.gna.org -->
<!--X-Reference: CAED9pY_ZKkKKOghfSjCCvX4VV3B2UHzQ7fYv26cepgrNYr&#45;QHA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r24192 - /branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py -- June 23, 2014 - 11:42</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r24192 - /branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00407" class="tabs">Index by Date</a> | <a href="threads.html#00407" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00406.html">Date Prev</a>] [<a href="msg00408.html">Date Next</a>] [<a href="msg00404.html">Thread Prev</a>] [<a href="msg00405.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 23 Jun 2014 11:41:38 +0200</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:content-type; bh=KxB4aQNcf1KCPXAtfUH/b24HE0Aqpx4dGBApRB6ASvA=; b=KXUqFstXrNqwyEiErEKNokvHxXreMOTuFBsx6g3/I78rDqb5cQDZVaAa8SFaNE3DWU 0kIY7LzuRY2+UWsBnppl3b3vL2PSchpb3qm+rSu4n7VpD5npuiG5E3ogWb66GJ5DK7tb cr484HQYM+EDA3PGevKa/zHB42jJ4DHLUlcmjEbh13gg9Uh7j0CzP/cnMaCj6RjdL3gY YNaTj/8BsO1QQa53MZuNeOXcQPzBbkgvKeNasRXzeyswUuNMG87mCiojWqh4+thq2B+R mKDXi4BjPvABR+k3jk5JKV2FQpoBg3AW50aoJk8RdOe5kzECRampWBuY8s9la5yZVVNN QS4A==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY84udWWvD0hDgNJUwhoRDpv6WGRdkyNDM=pgo17nzAvoA@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1WxtP8-0006J5-Jv@subversion.gna.org&gt; &lt;<a href="msg00404.html">CAED9pY_ZKkKKOghfSjCCvX4VV3B2UHzQ7fYv26cepgrNYr-QHA@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 23, 2014 - 11:42:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">These could also be called
matrix_exponential_rank_NE_NS_NM_NO_ND_x_x(), or what ever you wish.

Regards,

Edward


On 23 June 2014 11:09, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

There is a faster way to do this - eliminating the 'if' statements.  I
don't know how much faster though, as it is clearly currently not a
bottleneck, but it might cause the code to be much faster later when
other changes to the numeric models occur.  What would be better is to
duplicate and rename the function into the matrix_exponential_rank6()
and matrix_exponential_rank7() functions.  It is more code, but it
will be faster as it will be less lines per function.  If you do this,
for stability it would be good to first have unit tests for the rank 6
and 7 structures.

Regards,

Edward



On 20 June 2014 09:38,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Fri Jun 20 09:38:33 2014
New Revision: 24192

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=24192&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=24192&amp;view=rev</a>
Log:
Made the function matrix_exponential_rankN also find the exponential if 
the experiments indices are missing.

Task #7807 (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/index.php?7807">https://gna.org/task/index.php?7807</a>): Speed-up of dispersion 
models for Clustered analysis.

Modified:
    branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py

Modified: branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py?rev=24192&amp;r1=24191&amp;r2=24192&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py?rev=24192&amp;r1=24191&amp;r2=24192&amp;view=diff</a>
==============================================================================
--- branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py   
(original)
+++ branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py   
Fri Jun 20 09:38:33 2014
@@ -68,7 +68,13 @@
     @rtype:     numpy float array of rank [NE][NS][NM][NO][ND][X][X]
     &quot;&quot;&quot;

-    NE, NS, NM, NO, ND, Row, Col = A.shape
+    # Set initial to None.
+    NE, NS, NM, NO, ND, Row, Col = None, None, None, None, None, None, 
None
+
+    if len(A.shape) == 7:
+        NE, NS, NM, NO, ND, Row, Col = A.shape
+    elif len(A.shape) == 6:
+        NS, NM, NO, ND, Row, Col = A.shape

     # Is the original matrix real?
     complex_flag = any(iscomplex(A))
@@ -84,10 +90,16 @@

     # Calculate the exponential of all elements in the input array. Shape 
[NE][NS][NM][NO][ND][X]
     # Add one axis, to allow for broadcasting multiplication.
-    W_exp = exp(W).reshape(NE, NS, NM, NO, ND, Row, 1)
+    if NE == None:
+        W_exp = exp(W).reshape(NS, NM, NO, ND, Row, 1)
+    else:
+        W_exp = exp(W).reshape(NE, NS, NM, NO, ND, Row, 1)

     # Make a eye matrix, with Shape [NE][NS][NM][NO][ND][X][X]
-    eye_mat = tile(eye(Row)[newaxis, newaxis, newaxis, newaxis, newaxis, 
...], (NE, NS, NM, NO, ND, 1, 1) )
+    if NE == None:
+        eye_mat = tile(eye(Row)[newaxis, newaxis, newaxis, newaxis, 
newaxis, ...], (NS, NM, NO, ND, 1, 1) )
+    else:
+        eye_mat = tile(eye(Row)[newaxis, newaxis, newaxis, newaxis, 
newaxis, ...], (NE, NS, NM, NO, ND, 1, 1) )

     # Transform it to a diagonal matrix, with elements from vector down 
the diagonal.
     W_exp_diag = multiply(W_exp, eye_mat )


_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00404" href="msg00404.html">Re: r24192 - /branches/disp_spin_speed/lib/linear_algebra/matrix_exponential.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jun 23 12:00:18 2014</div>  
</body>
</html>
