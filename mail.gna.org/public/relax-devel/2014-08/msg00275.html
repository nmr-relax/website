<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r25230 &#45; in /trunk: target_functions/ test_suite/shared_data/curve_fitting/profiling/ -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 25 Aug 2014 16:42:33 +0200 -->
<!--X-Message-Id: CAED9pY&#45;Emc8DgCW+bCMjrM9icAG7w26sbXcOpAThC6My=OB=NQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XLgu1&#45;0005EX&#45;AO@subversion.gna.org -->
<!--X-Reference: CAED9pY9a2rNOzJPSW&#45;VwBZEKiWhFhCHOJ=u61KBrQ+Gg9jTnEQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2N2Gqu&#45;ZHdeBVLF4PYwfb79dq3WJG3y0eTq5Uqm7w4Ntg@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;Xhcgxbn3TyfOWHzJS6s+WACiA9gGar2oUGH77fmafmg@mail.gmail.com -->
<!--X-Reference: CA+CBx2NSXevvxTPFxpojroku59_MWNc2j89zK&#45;GuO&#45;CV8mO6Yg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r25230 - in /trunk: target_functions/ test_suite/shared_data/curve_fitting/profiling/ -- August 25, 2014 - 16:42</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r25230 - in /trunk: target_functions/ test_suite/shared_data/curve_fitting/profiling/</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00275" class="tabs">Index by Date</a> | <a href="threads.html#00275" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00274.html">Date Prev</a>] [<a href="msg00276.html">Date Next</a>] [<a href="msg00268.html">Thread Prev</a>] [<a href="msg00270.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 25 Aug 2014 16:42:03 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=SS9dc424Tuh72N9+8tGX2ijywyGJdJbWxHfNg0GSVto=; b=uyWJyurYnBfPfS6jlsjyb/GbO4ags84cNRNSYKgD+qlFJ4fwlpxlAlhtEjMj9SheXW xbRrOSO2H2XL48AXNOLYb4Kup/yWsUfX6Af1/V0gZpB/zv38BJjCJV84Enmjxon2Znzk XFJ7dNivxwunR1HsNw0XTon8V9N2X8QCDuAxIAgGdGsYTlOf1k/NLGJtOzisc5oqgN6m OhuiRQi7YZeKPYu1fA1FIpmUsi5NBk00tjqHhHSfZ5geOS6NusGECStPjP0RlnmREOKU t8oMrtbVtk5VLGSOPvzZjG0i2+hWpuhRaxd/qvf9H5gaoJMTmjw2ewyULDrcUQxE56ZC 3gnw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY-Emc8DgCW+bCMjrM9icAG7w26sbXcOpAThC6My=OB=NQ@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XLgu1-0005EX-AO@subversion.gna.org&gt; &lt;CAED9pY9a2rNOzJPSW-VwBZEKiWhFhCHOJ=u61KBrQ+Gg9jTnEQ@mail.gmail.com&gt; &lt;<a href="msg00263.html">CA+CBx2N2Gqu-ZHdeBVLF4PYwfb79dq3WJG3y0eTq5Uqm7w4Ntg@mail.gmail.com</a>&gt; &lt;<a href="msg00266.html">CAED9pY-Xhcgxbn3TyfOWHzJS6s+WACiA9gGar2oUGH77fmafmg@mail.gmail.com</a>&gt; &lt;<a href="msg00268.html">CA+CBx2NSXevvxTPFxpojroku59_MWNc2j89zK-GuO-CV8mO6Yg@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on August 25, 2014 - 16:42:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

I've just created the target_functions.relax_disp.jacobian() function
at r25249 (<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/22999">http://article.gmane.org/gmane.science.nmr.relax.scm/22999</a>).
This can be called with the optimised parameter vector as an argument
and then the covariance matrix calculated quite simply as described
in:

<a  rel="nofollow" href="https://www.gnu.org/software/gsl/manual/html_node/Computing-the-covariance-matrix-of-best-fit-parameters.html">https://www.gnu.org/software/gsl/manual/html_node/Computing-the-covariance-matrix-of-best-fit-parameters.html</a>

The equation is:

covar = (J^T J)^{-1}

A function to do this could be added to the relax library.  The input
argument is the Jacobian matrix, and the output is the covariance
matrix.  The QR decomposition in the above link is simply a faster
technique to find the inverse.

Regards,

Edward


P. S.  It shouldn't be too hard to extend the c_chi.c file to include
the chi-squared gradient to then have access to faster optimisation
algorithms.


On 25 August 2014 12:05, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Yes, I am just after the error.

Monte-Carlo simulations kill the &quot;screening of data&quot; of R1rho
analysis, when R2eff error estimation is so slow.

Best
Troels

2014-08-25 11:44 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">If the issue of &quot;fast&quot; is not an issue, then why is an alternative
minimisation required?  Are you just after the covariance matrix?

Regards,

Edward


On 25 August 2014 11:16, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

In this target function, exist the target function whereby
scipy.optimize.leastsq minimises.

minfx minimises by minimisation of chi2.

scipy.optimize.leastsq minimises the return of a function which
calculate the array of difference between
function and measured values.

It will then (I guess) minimise sum squares.

You could probably make a call to the target function &quot;exponential&quot; 
instead.

But I am not so good with C code, and having the code in python makes
it possible for me to bug-fix faster.

The issue of &quot;fast&quot;, does not really come into play here, as a
minimisation takes about 0.02 seconds anyway.

Best
Troels


2014-08-25 10:33 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

This new target_functions.relax_disp_curve_fit module clashes with the
C module.  It is repetitive, the code already exists in the
target_functions.relax_fit module.  Why is the faster C module not
being used?

Regards,

Edward



On 25 August 2014 01:08,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Mon Aug 25 01:08:48 2014
New Revision: 25230

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=25230&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=25230&amp;view=rev</a>
Log:
Moved the target function for minimisation of exponential fit into the 
target functions folder.

task #7822(<a  rel="nofollow" href="https://gna.org/task/index.php?7822">https://gna.org/task/index.php?7822</a>): Implement user 
function to estimate R2eff and associated errors for exponential curve 
fitting.

Added:
    trunk/target_functions/relax_disp_curve_fit.py
      - copied, changed from r25229, 
trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py
Removed:
    trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py
Modified:
    trunk/target_functions/__init__.py
    
trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py
    trunk/test_suite/shared_data/curve_fitting/profiling/verify_error.py

Modified: trunk/target_functions/__init__.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/target_functions/__init__.py?rev=25230&amp;r1=25229&amp;r2=25230&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/target_functions/__init__.py?rev=25230&amp;r1=25229&amp;r2=25230&amp;view=diff</a>
==============================================================================
--- trunk/target_functions/__init__.py  (original)
+++ trunk/target_functions/__init__.py  Mon Aug 25 01:08:48 2014
@@ -32,5 +32,6 @@
     'mf',
     'n_state_model',
     'potential',
-    'relax_disp'
+    'relax_disp',
+    'relax_disp_curve_fit'
 ]

Copied: trunk/target_functions/relax_disp_curve_fit.py (from r25229, 
trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py)
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/target_functions/relax_disp_curve_fit.py?p2=trunk/target_functions/relax_disp_curve_fit.py&amp;p1=trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py&amp;r1=25229&amp;r2=25230&amp;rev=25230&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/target_functions/relax_disp_curve_fit.py?p2=trunk/target_functions/relax_disp_curve_fit.py&amp;p1=trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py&amp;r1=25229&amp;r2=25230&amp;rev=25230&amp;view=diff</a>
==============================================================================
    (empty)

Modified: 
trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py?rev=25230&amp;r1=25229&amp;r2=25230&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py?rev=25230&amp;r1=25229&amp;r2=25230&amp;view=diff</a>
==============================================================================
--- 
trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py
 (original)
+++ 
trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py
 Mon Aug 25 01:08:48 2014
@@ -57,7 +57,7 @@
 # relax module imports.
 from status import Status; status = Status()
 from target_functions.relax_fit import setup, func, dfunc, d2func, 
back_calc_I
-from relax_fit import Exponential
+from target_functions.relax_disp_curve_fit import Exponential


 # Alter setup.

Removed: 
trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py?rev=25229&amp;view=auto">http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py?rev=25229&amp;view=auto</a>
==============================================================================
--- trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py   
(original)
+++ trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py   
(removed)
@@ -1,135 +0,0 @@
-###############################################################################
-#                                                                      
       #
-# Copyright (C) 2013-2014 Edward d'Auvergne                            
       #
-# Copyright (C) 2014 Troels E. Linnet                                  
       #
-#                                                                      
       #
-# This file is part of the program relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>).   
       #
-#                                                                      
       #
-# This program is free software: you can redistribute it and/or modify 
       #
-# it under the terms of the GNU General Public License as published by 
       #
-# the Free Software Foundation, either version 3 of the License, or    
       #
-# (at your option) any later version.                                  
       #
-#                                                                      
       #
-# This program is distributed in the hope that it will be useful,      
       #
-# but WITHOUT ANY WARRANTY; without even the implied warranty of       
       #
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        
       #
-# GNU General Public License for more details.                         
       #
-#                                                                      
       #
-# You should have received a copy of the GNU General Public License    
       #
-# along with this program.  If not, see 
&lt;<a  rel="nofollow" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.       #
-#                                                                      
       #
-###############################################################################
-
-# Module docstring.
-&quot;&quot;&quot;Target functions for relaxation fit.&quot;&quot;&quot;
-
-# Python module imports.
-from copy import deepcopy
-from numpy import exp, multiply, sum
-
-# relax module imports.
-
-
-class Exponential:
-    def __init__(self, num_params=None, num_times=None, values=None, 
sd=None, relax_times=None, scaling_matrix=None):
-        &quot;&quot;&quot;Relaxation dispersion target functions for optimisation.
-        &quot;&quot;&quot;
-
-        # Store variables.
-        self.num_params = num_params
-        self.num_times = num_times
-        self.values = values
-        self.errors = sd
-        self.relax_times = relax_times
-        self.scaling_matrix = scaling_matrix
-
-        # Create the structure for holding the back-calculated R2eff 
values (matching the dimensions of the values structure).
-        self.back_calc = deepcopy(self.values)
-
-        # Define function to minimise.
-        self.func = self.func_exp
-        self.calc = self.calc_exp
-
-
-    def chi2_rankN(self, data, back_calc_vals, errors):
-        &quot;&quot;&quot;Function to calculate the chi-squared value for multiple 
numpy array axis.
-
-        @param data:            The multi dimensional vectors of yi 
values.
-        @type data:             numpy multi dimensional array
-        @param back_calc_vals:  The multi dimensional vectors of 
yi(theta) values.
-        @type back_calc_vals:   numpy multi dimensional array
-        @param errors:          The multi dimensional vectors of 
sigma_i values.
-        @type errors:           numpy multi dimensional array
-        @return:                The chi-squared value.
-        @rtype:                 float
-        &quot;&quot;&quot;
-
-        # Calculate the chi-squared statistic.
-        return sum((1.0 / errors * (data - back_calc_vals))**2)
-
-
-    def calc_exp(self, times=None, r2eff=None, i0=None):
-        &quot;&quot;&quot;Calculate the function values of exponential function.
-
-        @keyword times: The time points.
-        @type times:    float
-        @keyword r2eff: The effective transversal relaxation rate.
-        @type r2eff:    float
-        @keyword i0:    The initial intensity.
-        @type i0:       float
-        @return:        The function values.
-        @rtype:         float
-        &quot;&quot;&quot;
-
-        # Calculate.
-        return i0 * exp( -times * r2eff)
-
-
-    def calc_exp_chi2(self, r2eff=None, i0=None):
-        &quot;&quot;&quot;Calculate the chi-squared value of exponential function.
-
-
-        @keyword r2eff: The effective transversal relaxation rate.
-        @type r2eff:    float
-        @keyword i0:    The initial intensity.
-        @type i0:       float
-        @return:        The chi-squared value.
-        @rtype:         float
-        &quot;&quot;&quot;
-
-        # Calculate.
-        self.back_calc[:] = self.calc_exp(times=self.relax_times, 
r2eff=r2eff, i0=i0)
-
-        # Return the total chi-squared value.
-        return self.chi2_rankN(data=self.values, 
back_calc_vals=self.back_calc, errors=self.errors)
-
-
-    def func_exp(self, params):
-        &quot;&quot;&quot;Target function for exponential fit.
-
-        @param params:  The vector of parameter values.
-        @type params:   numpy rank-1 float array
-        @return:        The chi-squared value.
-        @rtype:         float
-        &quot;&quot;&quot;
-
-        # Unpack the parameter values.
-        r2eff = params[0]
-        i0 = params[1]
-
-        # Calculate and return the chi-squared value.
-        return self.calc_exp_chi2(r2eff=r2eff, i0=i0)
-
-
-    def func_exp_general(self, params, xdata, ydata):
-        &quot;&quot;&quot;Target function for minimisation with scipy.optimize.leastsq
-        &quot;&quot;&quot;
-
-        return self.calc_exp(xdata, *params) - ydata
-
-
-    def func_exp_weighted_general(self, params, xdata, ydata, weights):
-        &quot;&quot;&quot;Target function for minimisation with scipy.optimize.leastsq
-        &quot;&quot;&quot;
-
-        return weights * (self.calc_exp(xdata, *params) - ydata)

Modified: 
trunk/test_suite/shared_data/curve_fitting/profiling/verify_error.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/verify_error.py?rev=25230&amp;r1=25229&amp;r2=25230&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/verify_error.py?rev=25230&amp;r1=25229&amp;r2=25230&amp;view=diff</a>
==============================================================================
--- 
trunk/test_suite/shared_data/curve_fitting/profiling/verify_error.py    
    (original)
+++ 
trunk/test_suite/shared_data/curve_fitting/profiling/verify_error.py    
    Mon Aug 25 01:08:48 2014
@@ -32,7 +32,7 @@
 from status import Status; status = Status()

 # Initial try for Exponential class.
-from relax_fit import Exponential
+from target_functions.relax_disp_curve_fit import Exponential

 # Define data path.
 prev_data_path = status.install_path + 
sep+'test_suite'+sep+'shared_data'+sep+'dispersion'+sep+'Kjaergaard_et_al_2013'
 +sep+ &quot;check_graphs&quot; +sep+ &quot;mc_2000&quot;  +sep+ &quot;R2eff&quot;


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00260" href="msg00260.html">Re: r25230 - in /trunk: target_functions/ test_suite/shared_data/curve_fitting/profiling/</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00263" href="msg00263.html">Re: r25230 - in /trunk: target_functions/ test_suite/shared_data/curve_fitting/profiling/</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00266" href="msg00266.html">Re: r25230 - in /trunk: target_functions/ test_suite/shared_data/curve_fitting/profiling/</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00268" href="msg00268.html">Re: r25230 - in /trunk: target_functions/ test_suite/shared_data/curve_fitting/profiling/</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Aug 25 17:00:13 2014</div>  
</body>
</html>
