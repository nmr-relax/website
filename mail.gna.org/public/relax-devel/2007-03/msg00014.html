<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: The singleton design pattern for the old 'self.relax.data' data	structure. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 08 Mar 2007 04:04:22 +0100 -->
<!--X-Message-Id: 7f080ed10703071903nbadfa52jbf89b8c137e62e09@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7f080ed10703070006s309a1e1do38e621f48d8f6d9e@mail.gmail.com -->
<!--X-Reference: 1173263918.8066.238.camel@mrspell -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: The singleton design pattern for the old 'self.relax.data' data	structure. -- March 08, 2007 - 04:04</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: The singleton design pattern for the old 'self.relax.data' data	structure.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00014" class="tabs">Index by Date</a> | <a href="threads.html#00014" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00013.html">Date Prev</a>] [<a href="msg00015.html">Date Next</a>] [<a href="msg00013.html">Thread Prev</a>] [<a href="msg00027.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Chris MacRaild&quot; &lt;c.a.macraild@xxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 8 Mar 2007 14:03:45 +1100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: a=rsa-sha1; c=relaxed/relaxed; d=gmail.com; s=beta;	h=domainkey-signature:received:received:message-id:date:from:sender:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references:x-google-sender-auth;	b=HXFGf4wDdF41lydOZKTENSxnBKr4OsJ7iI7u+H0x9tSygFII5rF5W+6WSShw3mRXJivOk6IOZ9v3hq813l8wyF7JWoUfzi7wRzMVdFIUf46O4YrSIUn6XQSAV8vQ/MMLotTWZbV7ReHxOnx8dnZZT90OFH3u2rwLzbIJNisLLiM=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00014.html">7f080ed10703071903nbadfa52jbf89b8c137e62e09@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00012.html">7f080ed10703070006s309a1e1do38e621f48d8f6d9e@mail.gmail.com</a>&gt;	&lt;<a href="msg00013.html">1173263918.8066.238.camel@mrspell</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on March 08, 2007 - 04:04:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>On 3/7/07, Chris MacRaild &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">On Wed, 2007-03-07 at 19:06 +1100, Edward d'Auvergne wrote:</pre><br>
<pre style="margin: 0em;">&gt; Hi,
&gt;
&gt; After careful thought about design patterns, I've decided to try to
&gt; use the singleton pattern for the old 'self.relax.data' data
&gt; structure.  See <a  href="http://en.wikipedia.org/wiki/Singleton_pattern">http://en.wikipedia.org/wiki/Singleton_pattern</a> for
&gt; more information about this design pattern.  I'll try to use the
&gt; second simple example under the heading 'Python Borg pattern'.  The
&gt; benefit of this pattern is that each module can use the code:
&gt;
&gt; from data import Data
&gt; relax_data = Data()
&gt;
&gt; As Data will be a singleton if two modules used by relax instantiate
&gt; the Data class then the global 'relax_data' in both modules will be
&gt; the same instance.  Therefore if a method from the
&gt; 'special_fns.model_free' module modifies the data structure, all the
&gt; other relax modules using the singleton will see the changes.  The
&gt; benefit of this pattern is that the data structure is similar in
&gt; concept to a global variable but only modules utilising it will have
&gt; it in one of their namespaces.  Also 'self.relax.data' will not need
&gt; to be passed around inside the program, simplifying the code.  What do
&gt; you think of the idea?</pre><br>
<pre style="margin: 0em;">One issue here, identified on the wikipedia page, is that __init__() is
called for each call of Singleton(). Therefore all of the standard
__init__() stuff - inialising variables and empty containers - will
happen every time the Singleton instance is sought. This is clearly not
what we want. Ofcourse there are many ways around that by cleverly
hiding the initialisation stuff, but its starting to look like a complex
solution to what should be a simple problem.
</pre></blockquote><pre style="margin: 0em;"><br>I am aware of the execution of __init__() but this won't be an issue
in the final construction of the relax data storage object.  The
object will be multilayered.  The first layer, equivalent to the
current top level Data class, will be a dictionary type and it's
__init__() method will be empty.  There may be a few variables
(current_run, etc.) and methods defined inside this object but these
will be in the scope of the class rather than the __init__() method.</pre><br>
<pre style="margin: 0em;">The second layer will be data containers identified by the keys of the
top level dictionary type object.  This layer's __init__() method will
not be called each time.  The current Data.__init__() method will be
shifted to this layer (actually I'll probably rename Data to
RunContainer and then create a new Data object).  I'm still unsure but
I think I'll try to leave all __init__() functions empty and define
initial variables and objects in the scope of the class, eg:</pre><br>
<pre style="margin: 0em;">class RunContainer:
   # The molecule-residue-spin object.
   mol = MoleculeList()</pre><br>
<pre style="margin: 0em;">   # The diffusion tensor object.
   diff = DiffContainer()</pre><br>
<pre style="margin: 0em;">   # Molecular structure.
   structure = StructureContainer()</pre><br>
<pre style="margin: 0em;">   def __init__():
       pass</pre><br>
<pre style="margin: 0em;"><br>The third layer will be data containers for specific data types.  For
example the diffusion tensor data structure, the Scientific PDB data
structures (and future molecular structure data structures), and the
molecule-residue-spin multi-object structure (each of these three
layers will consist of two objects - a list type object whereby each
element is a specific data storage object).</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">Something like:</pre><br>
<pre style="margin: 0em;">class Data:
    ...
Data = Data()</pre><br>
<pre style="margin: 0em;">in the data module, then everywhere else:</pre><br>
<pre style="margin: 0em;">from data import Data as relax_data</pre><br>
<pre style="margin: 0em;"><br>By rebinding the name 'Data' with an instance of the class, we
effectively prevent accidental creation of additional instances, and the
import makes that instance availible wherever we need it.
</pre></blockquote><pre style="margin: 0em;"><br>I do think that the relax data storage object is the absolute ideal
situation for the implementation of the Singleton design pattern.
There is only one instance of this object ever and all parts of relax
should worship it - relax is designed around this object.  It is the
pillar that props up all of the program.  And the relax saved stated
is a copy of this object.</pre><br>
<pre style="margin: 0em;">The Singleton construction is also very powerful for relax scripts.
It allows the script access to the data storage object without needing
to pass the object to the script.  Importantly it also allows the unit
test framework access to the structure without invoking relax itself.
And it is also very easy to implement cleanly - just have a look at
the current 1.3 line code base.  The relax data storage object is now
implemented as a Singleton and almost all of the relax test suite
passes.  The only failure is in one functional test whereby a saved
program state is loaded - this is because the state.load() user
function is not working yet.</pre><br>
<pre style="margin: 0em;">Cheers,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00027" href="msg00027.html">Re: The singleton design pattern for the old 'self.relax.data' data	structure.</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00012" href="msg00012.html">The singleton design pattern for the old 'self.relax.data' data	structure.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re: The singleton design pattern for the old 'self.relax.data' data	structure.</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Mar 08 11:20:29 2007</div>  
</body>
</html>
