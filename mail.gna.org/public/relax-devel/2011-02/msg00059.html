<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 21 Feb 2011 12:38:48 +0100 -->
<!--X-Message-Id: AANLkTikiVg1B3nDcGAu9hBZ57UJ=dVjOfazxaE&#45;Jw5UN@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: AANLkTin7c+5hh7DHW7B4V_xqTf8v3+O292FVFOsYtFBs@mail.gmail.com -->
<!--X-Reference: 4D6227A7.5040309@bruker&#45;biospin.de -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation. -- February 21, 2011 - 12:38</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Addition of PDC support to relax 1.3.10 and an inconsistency in	the error calculation.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00059" class="tabs">Index by Date</a> | <a href="threads.html#00059" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00058.html">Date Prev</a>] [<a href="msg00060.html">Date Next</a>] [<a href="msg00057.html">Thread Prev</a>] [<a href="msg00060.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Dr. Klaus-Peter Neidig&quot; &lt;peter.neidig@xxxxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 21 Feb 2011 12:38:16 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;, &quot;Neidig,	Klaus-Peter&quot; &lt;Klaus-Peter.Neidig@xxxxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:mime-version:sender:in-reply-to:references:date	:x-google-sender-auth:message-id:subject:from:to:cc:content-type;	bh=d5WoPMnHxjGSei2p+Q6DeddulLUK4vcOZ+tcI8leu8k=;	b=CitT9jIyZPrnLF6qrKULxbAZxZsT9lTMwOtQtHXjl4SU13/LwdYi6vSWThtF8NBwE2	23t2Sn7nYNbloTT8+UmOR8MqUe87XDdu9X3vXy9bNe+v0td849a17wVk6TFVhaz5oXyn	068hi1Sj1HhvGR9xYtR3ZYYdLzSJBCU88AsT0=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00059.html">AANLkTikiVg1B3nDcGAu9hBZ57UJ=dVjOfazxaE-Jw5UN@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;AANLkTin7c+5hh7DHW7B4V_xqTf8v3+O292FVFOsYtFBs@xxxxxxxxxxxxxx&gt;	&lt;4D6227A7.5040309@xxxxxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on February 21, 2011 - 12:38:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Dear Peter,

Please see below:


On 21 February 2011 09:51, Dr. Klaus-Peter Neidig
&lt;peter.neidig@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Dear Edward,

I'm running a current of output files today and send them.

The error of a ratio of numbers y = a/b with given aErr, bErr is
yErr = sqrt [ (aErr/a)^2 + (bErr/b)^2], which for a=1 and aErr=0 is
yErr = bErr/b

Does this correspond to yout notation ?
</pre></blockquote><pre style="margin: 0em;">

This is not quite right, for example see the NOE error formula on page
5988 of the Farrow et al, Biochem. (1994), 33, 5984-6003 reference.
The formula should be:

yErr/y = sqrt [ (aErr/a)^2 + (bErr/b)^2].

For a=1 and aErr=0, the formula will then be:

yErr/y = bErr/b.

In the case of the R1:

sigma_R1 / R1 = sigma_T1 / T1,

or:

sigma_R1 = sigma_T1 / T1^2,
sigma_R1 = sigma_T1 * R1^2.

There is a chance that this formula from the Kay paper is incorrect.
I've been trying to find another reference, one that I found a long
time ago, but I can't find it any more.  Do you have a reference for
the yErr = sqrt [ (aErr/a)^2 + (bErr/b)^2] formula?  This does not
explain the differences though, they are even more pronounced using
yErr = sqrt [ (aErr/a)^2 + (bErr/b)^2].


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The fit error determination in the PDC depends on the method the user has 
chosen. Under the
tag Fit parameter Error estimation method: the options are
- from fit using arbitray y uncertainties
- from fit using calculated y uncertainties
- from Monte Carlo simulations
</pre></blockquote><pre style="margin: 0em;">

Which of these does the &quot;SECTION:  used integral errors&quot; belong to?
This section appears to be errors associated with each peak intensity
from &quot;SECTION:  used integrals&quot;.  I simply took these to be individual
peak errors and then performed standard Monte Carlo simulations on
these.  Each peak appears to have a different error, but does &quot;Fit
parameter Error estimation method:  from fit using arbitray y
uncertainties&quot; means one error for all peaks?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The first 2 are offered by the our standard Marquardt implementation.
</pre></blockquote><pre style="margin: 0em;">

The Levenberg-Marquardt optimisation and Monte Carlo simulations are
two unrelated techniques, one is for optimisation, the other for error
propagation.  A very low quality error estimation method comes from
the covariance matrix.  So one can use Levenberg-Marquardt (or any
other optimisation algorithm) and then determine the errors using the
covariance matrix defined at the solution.  I don't understand the
differences in the error estimation methods in the PDC :S


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The first option assumes the same
error for all y values. This then cancales out of the formula, therefore we 
call it arbitrary.
</pre></blockquote><pre style="margin: 0em;">

But this could be used for either the Monte Carlo simulations or the
covariance matrix error estimation methods.  In relax, this is used in
combination with MC simulations.

</pre><blockquote class="blockquote"><pre style="margin: 0em;">The second option uses the y errors as determined before. As we discussed 
earlier the base plane RMS
is one source for these errors the other is from optional repetition 
experiments. If repetition experiments
are available the systematic error can be calculated as:
- worst case per peak scenario
- average variance calculation
</pre></blockquote><pre style="margin: 0em;">

As I showed using theoretical examples in
<a  rel="nofollow" href="https://mail.gna.org/public/relax-devel/2010-11/msg00027.html">https://mail.gna.org/public/relax-devel/2010-11/msg00027.html</a> (data,
python and java scripts are attached to <a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/?7180">https://gna.org/task/?7180</a>),
the 2 worst case per peak methods on average significantly
overestimate the errors, and have huge variances meaning that the real
errors compared to the estimates are multiplied by a normal
distribution of 1.594+/-0.852.  So 95% of the estimates from
duplicated spectra (assuming a normal distribution) will be scaled by
a factor between -0.11 and 3.298!  This type of error estimate would
be fatal for subsequent model-free analysis.

Therefore in relax we will need to catch &quot;Systematic error estimation
of data:  worst case per peak scenario&quot; and re-perform the relaxation
curve-fitting and Monte Carlo simulations.  Or maybe throw an in relax
error and tell the user that they must go back to the PDC and use
&quot;average variance calculation&quot; with &quot;Monte Carlo simlautions&quot;.  In the
example file you sent
(<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/1.3/test_suite/shared_data/pdc_files/testT1.txt?revision=12551&amp;view=markup">http://svn.gna.org/viewcvs/relax/1.3/test_suite/shared_data/pdc_files/testT1.txt?revision=12551&amp;view=markup</a>),
it says &quot;Fit parameter Error estimation method:  from fit using
arbitray y uncertainties&quot;.  Above you said that this corresponds to 1
error for all peaks.  But you described in
<a  rel="nofollow" href="https://mail.gna.org/public/relax-devel/2010-11/msg00021.html">https://mail.gna.org/public/relax-devel/2010-11/msg00021.html</a> that the
current &quot;worst case per peak scenario&quot; method in the PDC uses a
different estimate for each peak.  The file also says &quot;Random error
estimation of data: RMS per spectrum (or trace/plane)&quot;.  So I am quite
confused as to how to interpret the data.  Where do I read the peak
intensity errors from?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The test output files I have sent so far calculated the fit parameter 
errors via from fit using arbitray y uncertainties.
This option was chosen accidentally. The error there is different from the 
other 2 methods. Perhaps it is
a better idea to generate a new set of output files using the option &quot;from 
fit using calculated y uncertainties&quot;.
That usually compares well with MC simulations.
</pre></blockquote><pre style="margin: 0em;">

What is the &quot;from fit using calculated y uncertainties&quot;?  Is this the
covariance matrix technique for error estimation?  For simple single
exponentials, the covariance matrix technique and Monte Carlo
simulations should not be too different, I hope.  How does this
combine with &quot;worst case per peak scenario&quot; and &quot;average variance
calculation&quot;?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">In the PDC I do 1000 MC simulations such that a vary the
y values based on a gaussian random distribution, the mean is the original 
y, the width is the error of y.
</pre></blockquote><pre style="margin: 0em;">

You mean you take the back-calculated y value and randomise this 1000
times with a Gaussian distribution centred at the back-calculated y
with an error set to the peak intensity error?  If you take the
original y, this is not Monte Carlo simulations but Bootstrapping - a
technique which should never be used for error estimation.  Well, you
can use bootstrapping for a direct calculation of values, but never
for optimised values.

I am quite confused.  The way I see the analysis, using the notations
from the statistics and optimisation fields, there are the following
categories:

Peak intensity notation:
  - Height (the physical height of the Lorentizian peak at its mean,
or maximum point)
  - Volume (sum of all points, i.e. the discrete integration of the 
Lorentizian)
  - Height (as above but via fitting peak shape to a function)
  - Volume (as above but via fitting peak shape to a function)

Peak errors:
  - 1 average error for all peaks (from some spectra duplicated,
triplicated, etc.)
  - 1 max error for all peaks (largest ever occurring difference)
  - 1 average error for all peaks in one spectrum (only if all spectra
are duplicated)
  - 1 max error for each peak across all spectra (current &quot;worst case
per peak scenario&quot;?).
  - Each peak has a different error (from the baseplane RMSD)

Optimisation methods:
  - Levenberg-Marquardt
  - Simplex
  - Newton
  - etc.

Error estimation methods:
  - Covariance matrix (bad)
  - Jackknife (also bad)
  - Bootstrapping (never to be used with optimisation)
  - Monte Carlo simulations (considered the gold standard)
  - etc.

I am having trouble classifying the PDC file
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/1.3/test_suite/shared_data/pdc_files/testT1.txt?revision=12551&amp;view=markup">http://svn.gna.org/viewcvs/relax/1.3/test_suite/shared_data/pdc_files/testT1.txt?revision=12551&amp;view=markup</a>
into these categories.  This is very, very confusing :S

Regards,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00060" href="msg00060.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency	in the error calculation.</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00054" href="msg00054.html">Addition of PDC support to relax 1.3.10 and an inconsistency in the	error calculation.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00057" href="msg00057.html">Re: Addition of PDC support to relax 1.3.10 and an inconsistency	in the error calculation.</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Feb 21 15:40:13 2011</div>  
</body>
</html>
