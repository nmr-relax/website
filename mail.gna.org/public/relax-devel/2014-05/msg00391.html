<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor? -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 20 May 2014 14:31:08 +0200 -->
<!--X-Message-Id: CA+CBx2MMboJqj56A8hohcCX1XtTjAVHNAP50O73QxAv8b9c9sA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140520&#45;000356.sv20529.92877@gna.org -->
<!--X-Reference: 20140520&#45;000436.sv20529.46737@gna.org -->
<!--X-Reference: CAED9pY9dgTO=XEMitiXkucSttRHH4dwnV6KEwqz4jTxHRarvcQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2Pt5q2E0tnvhxq2ocY2NqYmiB1jqqb61M5cBZXeywtYPg@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;Wo4sSemWQG2AA5eEr&#45;h01oJz7UcsvKE86P35K107MoQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor? -- May 20, 2014 - 14:31</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00391" class="tabs">Index by Date</a> | <a href="threads.html#00391" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00390.html">Date Prev</a>] [<a href="msg00392.html">Date Next</a>] [<a href="msg00390.html">Thread Prev</a>] [<a href="msg00392.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 20 May 2014 14:29:56 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;, Gary Thompson &lt;garyt@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type:content-transfer-encoding; bh=L0jpAzO7E83cOAQRdG5eeX1BvIVBcatuNLJgAX+ziAw=; b=LGP3S3cnfVVBqaHTI8d08/XDVcudEbfUO8oNz65yeND91Pwe4SIE5hDEBhMIgFkzhF HWdG9uU4SdYbKos+7fg/XSHdN8XLokK14YYMEz/D0sjJ535RUa1glFOZpZ/c1Cbzfvu2 CFRpuKPrwAPH40+xPOxYRSWArATvQAEBrWsMh/uoBWWNjuBAhy+JZfSO26/eQgx2BqFJ lUYv6FYOYnBi46hEmwwsOGdljD8uO7EY7A1/hXcD5YwZvK/jtExu2dd7IsWr1tI1qtsE dFLX2Ph1gOHGKEorOx34spMwAaR32BwsoBFlqMRYZ94BOnUnfqWvNg6mXp+Jm2oY+VmI QzVw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00391.html">CA+CBx2MMboJqj56A8hohcCX1XtTjAVHNAP50O73QxAv8b9c9sA@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00377.html">20140520-000356.sv20529.92877@gna.org</a>&gt; &lt;<a href="msg00378.html">20140520-000436.sv20529.46737@gna.org</a>&gt; &lt;CAED9pY9dgTO=XEMitiXkucSttRHH4dwnV6KEwqz4jTxHRarvcQ@mail.gmail.com&gt; &lt;<a href="msg00386.html">CA+CBx2Pt5q2E0tnvhxq2ocY2NqYmiB1jqqb61M5cBZXeywtYPg@mail.gmail.com</a>&gt; &lt;<a href="msg00390.html">CAED9pY-Wo4sSemWQG2AA5eEr-h01oJz7UcsvKE86P35K107MoQ@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on May 20, 2014 - 14:31:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Ed.

Thanks for fixing the bug!

But I think the worst most pity thing, is that I have waster 1/4-1/2
year of my PhD to fix this bug:

bug #22032: Minimisation explodes when using Grid_INC=None
<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/index.php?22032">https://gna.org/bugs/index.php?22032</a>

My last three weeks analysis have shown that the error catching at
boundary values had a huge impact on the minimisation search. It
simply went to scrap.
This was also the case when running grid search. Touching the math
domain errors, caught simplex to stop.
<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/download.php?file_id=20704">https://gna.org/bugs/download.php?file_id=20704</a>
<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/download.php?file_id=20698">https://gna.org/bugs/download.php?file_id=20698</a>

I have tried so hard to understand why the behaviour of relax is
different from other programs.
I have tested, and inspected code, and tried other programs. relax was
just stubborn.

Realising this issue has been a relieve!

I am happy that the processor.run_queue() bug only is related to the 
test-suite.
It hopefully did not affect production???

I can have night-mares about these bugs, as that can mean that
scientists are wasting their time.
Including mine.

Best
Troels

2014-05-20 13:44 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

I have now fixed this issue:

<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/multi/uni_processor.py?r1=23254&amp;r2=23253&amp;pathrev=23254">http://svn.gna.org/viewcvs/relax/trunk/multi/uni_processor.py?r1=23254&amp;r2=23253&amp;pathrev=23254</a>

As you can see, the change is incredibly simple, and it is exactly
what Gary documented in his FIXME comment.  It's almost a pity Troels
that, after finding the source of this 8 year old bug, you didn't take
the final honours and kill it.  You deserve the credit though as this
has been annoying multiple relax developers via the test suite for all
of those 8 years!  You should be able to find mentions of it
throughout the relax-devel mailing list archives.  No one thought to
look at the command queuing as the source of this.

Cheers,

Edward




On 20 May 2014 11:52, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Ed.

I tried hard for several hours yesterday.

But this multi-processing goes beyond my skills...

If you know a little more about, and can fix it, I would be very happy.

I can try the thing you suggested, but beyond that, I would be lost.

Best
Trpels

2014-05-20 9:43 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

You might have actually have found the source of the problem!  This
has been an issue for a long time, but I never solved it.  It affects
many analysis types and I have always wondered why one failing test
would cause many subsequent tests of the same analysis type to fail.
This has been around longer than the dispersion analysis which was
started in 2009.  I always tried to solve it in the special
self.tearDown() test suite method for cleaning up after tests, but
this somehow never completely solved the issue.  So it could have
something to do with the FIXME comment in the run_queue() method of
the multi.uni_processor module:


    def run_queue(self):
        #FIXME: need a finally here to cleanup exceptions states for 
windows etc

        last_command = len(self.command_queue)-1
        for i, command  in enumerate(self.command_queue):
            completed = (i == last_command)

            command.run(self, completed)

        #self.run_command_queue()
        #TODO: add cheques for empty queues and maps if now warn
        del self.command_queue[:]
        self.memo_map.clear()


There are a few minor FIXMEs and TODOs in Gary Thompson's
multi-processor framework.  But this one might be quite important for
the test suite.  You could try as the FIXME says, add a 'try-finally'
statements so the last two lines are always run.  This may cause other
issues, so be careful.

Note, this must not be committed to your 'disp_speed' branch.  If you
have a fix, make sure it is applied to the trunk.

Cheers,

Edward





On 20 May 2014 02:04, Troels E. Linnet &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Additional Item Attachment, bug #22055 (project relax):

File name: log.txt                        Size:792 KB


    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/bugs/?22055">http://gna.org/bugs/?22055</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00392" href="msg00392.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00377" href="msg00377.html">[bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00378" href="msg00378.html">[bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00379" href="msg00379.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00386" href="msg00386.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00390" href="msg00390.html">Re: [bug #22055] The processor.run_queue() does not clean up in uni_processor?</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue May 20 16:00:19 2014</div>  
</body>
</html>
