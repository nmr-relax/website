<!-- MHonArc v2.6.16 -->
<!--X-Subject: r22168 &#45; in /branches/double_rotor: ./ gui/analyses/	test_suite/gui_tests/	test_suite/shared_data/model_free/bug_21615_incom... -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Mon, 10 Feb 2014 10:48:44 +0100 -->
<!--X-Message-Id: E1WCnTo&#45;0003bF&#45;H7@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r22168 - in /branches/double_rotor: ./ gui/analyses/	test_suite/gui_tests/	test_suite/shared_data/model_free/bug_21615_incom... -- February 10, 2014 - 10:48</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r22168 - in /branches/double_rotor: ./ gui/analyses/	test_suite/gui_tests/	test_suite/shared_data/model_free/bug_21615_incom...</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00060" class="tabs">Index by Date</a> | <a href="threads.html#00060" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00059.html">Date Prev</a>] [<a href="msg00061.html">Date Next</a>] [<a href="msg00059.html">Thread Prev</a>] [<a href="msg00061.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Mon, 10 Feb 2014 09:48:44 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00060.html">E1WCnTo-0003bF-H7@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on February 10, 2014 - 10:48:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Mon Feb 10 10:48:44 2014
New Revision: 22168

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=22168&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=22168&amp;view=rev</a>
Log:
Merged revisions 22165-22166 via svnmerge from 
svn+ssh://bugman@xxxxxxxxxxx/svn/relax/trunk

........
  r22165 | bugman | 2014-02-10 10:37:53 +0100 (Mon, 10 Feb 2014) | 9 lines
  
  Created the Mf.test_bug_21615_incomplete_setup_failure GUI tests.
  
  This is designed to catch bug #21615 (<a  rel="nofollow" href="https://gna.org/bugs/?21615">https://gna.org/bugs/?21615</a>) as 
reported by Ivan Leung
  (ivanhoe dott leung att chem dott ox dot ac dot uk).
  
  Included are the data files Ivan attached to the bug report truncated to 
two residues.  The GUI test
  follows exactly the steps outlined by Ivan.
........
  r22166 | bugman | 2014-02-10 10:43:46 +0100 (Mon, 10 Feb 2014) | 10 lines
  
  Fix for bug #21615, the missing data dialog failure when executing the GUI 
model-free analysis.
  
  This is the bug at <a  rel="nofollow" href="https://gna.org/bugs/?21615">https://gna.org/bugs/?21615</a> as reported by Ivan Leung 
(ivanhoe dott leung att
  chem dott ox dot ac dot uk).
  
  The problem is that the spin container's &quot;isotope&quot; variable is being 
accessed directly after a test
  showing that this variable does not exist.  This is now fixed so that the 
missing data dialog is now
  presented explaining that the spin isotope information is not set.
........

Added:
    
branches/double_rotor/test_suite/shared_data/model_free/bug_21615_incomplete_setup_failure/
      - copied from r22166, 
trunk/test_suite/shared_data/model_free/bug_21615_incomplete_setup_failure/
Modified:
    branches/double_rotor/   (props changed)
    branches/double_rotor/gui/analyses/auto_model_free.py
    branches/double_rotor/test_suite/gui_tests/model_free.py

Propchange: branches/double_rotor/
------------------------------------------------------------------------------
--- svnmerge-integrated (original)
+++ svnmerge-integrated Mon Feb 10 10:48:44 2014
@@ -1,1 +1,1 @@
-/trunk:1-22153,22155-22164
+/trunk:1-22167

Modified: branches/double_rotor/gui/analyses/auto_model_free.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/double_rotor/gui/analyses/auto_model_free.py?rev=22168&amp;r1=22167&amp;r2=22168&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/double_rotor/gui/analyses/auto_model_free.py?rev=22168&amp;r1=22167&amp;r2=22168&amp;view=diff</a>
==============================================================================
--- branches/double_rotor/gui/analyses/auto_model_free.py (original)
+++ branches/double_rotor/gui/analyses/auto_model_free.py Mon Feb 10 10:48:44 
2014
@@ -1,7 +1,7 @@
 
###############################################################################
 #                                                                            
 #
 # Copyright (C) 2009 Michael Bieri                                           
 #
-# Copyright (C) 2010-2013 Edward d'Auvergne                                  
 #
+# Copyright (C) 2010-2014 Edward d'Auvergne                                  
 #
 #                                                                            
 #
 # This file is part of the program relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>).         
 #
 #                                                                            
 #
@@ -413,7 +413,7 @@
                 missing.append(msg % (&quot;nuclear isotope data&quot;, 
&quot;spin.isotope&quot;))
 
             # Test if the CSA value has been set for the heteronuclei.
-            if spin.isotope in ['15N', '13C'] and (not hasattr(spin, 'csa') 
or spin.csa == None):
+            if (hasattr(spin, 'isotope') and spin.isotope in ['15N', '13C']) 
and (not hasattr(spin, 'csa') or spin.csa == None):
                 missing.append(msg % (&quot;CSA data&quot;, &quot;value.set&quot;))
 
         # Interatomic data container variables.

Modified: branches/double_rotor/test_suite/gui_tests/model_free.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/double_rotor/test_suite/gui_tests/model_free.py?rev=22168&amp;r1=22167&amp;r2=22168&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/double_rotor/test_suite/gui_tests/model_free.py?rev=22168&amp;r1=22167&amp;r2=22168&amp;view=diff</a>
==============================================================================
--- branches/double_rotor/test_suite/gui_tests/model_free.py (original)
+++ branches/double_rotor/test_suite/gui_tests/model_free.py Mon Feb 10 
10:48:44 2014
@@ -1,6 +1,6 @@
 
###############################################################################
 #                                                                            
 #
-# Copyright (C) 2006-2013 Edward d'Auvergne                                  
 #
+# Copyright (C) 2006-2014 Edward d'Auvergne                                  
 #
 #                                                                            
 #
 # This file is part of the program relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>).         
 #
 #                                                                            
 #
@@ -185,6 +185,91 @@
 
             # Exceptions in the thread.
             self.check_exceptions()
+
+
+    def test_bug_21615_incomplete_setup_failure(self):
+        &quot;&quot;&quot;Catch U{bug #21615&lt;<a  rel="nofollow" href="https://gna.org/bugs/?21615">https://gna.org/bugs/?21615</a>&gt;}, the failure of 
showing the missing data dialog when executing the analysis with an 
incomplete setup.
+
+        This was reported by Ivan Leung.
+        &quot;&quot;&quot;
+
+        # Simulate the new analysis wizard.
+        self.app.gui.analysis.menu_new(None)
+        page = self.app.gui.analysis.new_wizard.wizard.get_page(0)
+        page.select_mf(None)
+        page.analysis_name.SetValue(str_to_gui(&quot;Model-free incomplete setup 
failure&quot;))
+        self.app.gui.analysis.new_wizard.wizard._go_next(None)
+        page = self.app.gui.analysis.new_wizard.wizard.get_page(1)
+        self.app.gui.analysis.new_wizard.wizard._go_next(None)
+
+        # Get the data.
+        analysis_type, analysis_name, pipe_name, pipe_bundle, uf_exec = 
self.app.gui.analysis.new_wizard.get_data()
+
+        # Set up the analysis.
+        self.app.gui.analysis.new_analysis(analysis_type=analysis_type, 
analysis_name=analysis_name, pipe_name=pipe_name, pipe_bundle=pipe_bundle)
+
+        # Alias the analysis.
+        analysis = self.app.gui.analysis.get_page_from_name(&quot;Model-free 
incomplete setup failure&quot;)
+
+        # Change the results directory.
+        analysis.field_results_dir.SetValue(str_to_gui(ds.tmpdir))
+
+        # The data path.
+        data_path = status.install_path + sep + 'test_suite' + sep + 
'shared_data' + sep + 'model_free' + sep + 
'bug_21615_incomplete_setup_failure' + sep
+
+        # Launch the spin viewer window.
+        self.app.gui.show_tree()
+
+        # Spin loading wizard:  Initialisation.
+        self.app.gui.spin_viewer.load_spins_wizard()
+
+        # Spin loading wizard:  The PDB file.
+        page = self.app.gui.spin_viewer.wizard.get_page(0)
+        page.selection = 'new pdb'
+        self.app.gui.spin_viewer.wizard._go_next()
+        page = 
self.app.gui.spin_viewer.wizard.get_page(self.app.gui.spin_viewer.wizard._current_page)
+        page.uf_args['file'].SetValue(str_to_gui(data_path + 
'Truncated_ForBugReport.pdb'))
+        self.app.gui.spin_viewer.wizard._go_next()
+        interpreter.flush()    # Required because of the asynchronous uf 
call.
+
+        # Spin loading wizard:  The spin loading.
+        page = 
self.app.gui.spin_viewer.wizard.get_page(self.app.gui.spin_viewer.wizard._current_page)
+        page.uf_args['spin_id'].SetValue(str_to_gui('@N'))
+        self.app.gui.spin_viewer.wizard._apply()
+        page.uf_args['spin_id'].SetValue(str_to_gui('@H'))
+        self.app.gui.spin_viewer.wizard._go_next()
+        interpreter.flush()    # Required because of the asynchronous uf 
call.
+
+        # Close the spin viewer window.
+        self.app.gui.spin_viewer.handler_close()
+
+        # Flush the interpreter in preparation for the synchronous user 
functions of the peak list wizard.
+        interpreter.flush()
+
+        # Set the element type.
+        self._execute_uf(uf_name='spin.element', element='N')
+
+        # Load the relaxation data.
+        data = [
+            ['NOE_ForBugReport.txt', 'noe_800', 'NOE', 800000001.0],
+            ['T1_ForBugReport.txt',  'r1_800',  'R1',  800000001.0],
+            ['T2_ForBugReport.txt',  'r2_800',  'R2',  800000001.0]
+        ]
+        for i in range(len(data)):
+            self._execute_uf(uf_name='relax_data.read', 
file=data_path+data[i][0], ri_id=data[i][1], ri_type=data[i][2], 
frq=data[i][3], mol_name_col=1, res_num_col=2, res_name_col=3, 
spin_num_col=4, spin_name_col=5, data_col=6, error_col=7)
+
+        # Execute relax.
+        state = 
analysis.execute(wx.CommandEvent(wx.wxEVT_COMMAND_BUTTON_CLICKED, 
analysis.button_exec_relax.GetId()))
+
+        # Wait for execution to complete.
+        if hasattr(analysis, 'thread'):
+            analysis.thread.join()
+
+        # Flush all wx events.
+        wx.Yield()
+
+        # Exceptions in the thread.
+        self.check_exceptions()
 
 
     def test_mf_auto_analysis(self):



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Feb 10 18:00:02 2014</div>  
</body>
</html>
