<!-- MHonArc v2.6.19+ -->
<!--X-Subject: r28101 &#45; in /trunk/lib/structure: __init__.py pca.py -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Wed, 25 Nov 2015 18:38:01 +0100 -->
<!--X-Message-Id: E1a1e12&#45;0008DR&#45;TJ@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r28101 - in /trunk/lib/structure: __init__.py pca.py -- November 25, 2015 - 18:38</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r28101 - in /trunk/lib/structure: __init__.py pca.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00031" class="tabs">Index by Date</a> | <a href="threads.html#00031" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00030.html">Date Prev</a>] [<a href="msg00032.html">Date Next</a>] [<a href="msg00030.html">Thread Prev</a>] [<a href="msg00032.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Wed, 25 Nov 2015 17:38:00 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00031.html">E1a1e12-0008DR-TJ@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on November 25, 2015 - 18:38:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Wed Nov 25 18:38:00 2015
New Revision: 28101

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=28101&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=28101&amp;view=rev</a>
Log:
Partial implemented of the PCA analysis in the relax library.

This is for the new structure.pca user function.  The lib.structure.pca 
module has been created, and
the pca_analysis() function created to calculate the structure covariance 
matrix, via the
covariance() function, and then calculate the eigenvalues and eigenvectors of 
the covariance matrix,
sorting them and truncating to the desired number of PCA modes.

Added:
    trunk/lib/structure/pca.py
Modified:
    trunk/lib/structure/__init__.py

Modified: trunk/lib/structure/__init__.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/structure/__init__.py?rev=28101&amp;r1=28100&amp;r2=28101&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/lib/structure/__init__.py?rev=28101&amp;r1=28100&amp;r2=28101&amp;view=diff</a>
==============================================================================
--- trunk/lib/structure/__init__.py     (original)
+++ trunk/lib/structure/__init__.py     Wed Nov 25 18:38:00 2015
@@ -1,6 +1,6 @@
 
###############################################################################
 #                                                                            
 #
-# Copyright (C) 2013-2014 Edward d'Auvergne                                  
 #
+# Copyright (C) 2013-2015 Edward d'Auvergne                                  
 #
 #                                                                            
 #
 # This file is part of the program relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>).         
 #
 #                                                                            
 #
@@ -29,6 +29,7 @@
     'files',
     'geometric',
     'mass',
+    'pca',
     'pdb_read',
     'pdb_write',
     'statistics',

Added: trunk/lib/structure/pca.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/structure/pca.py?rev=28101&amp;view=auto">http://svn.gna.org/viewcvs/relax/trunk/lib/structure/pca.py?rev=28101&amp;view=auto</a>
==============================================================================
--- trunk/lib/structure/pca.py  (added)
+++ trunk/lib/structure/pca.py  Wed Nov 25 18:38:00 2015
@@ -0,0 +1,93 @@
+###############################################################################
+#                                                                            
 #
+# Copyright (C) 2015 Edward d'Auvergne                                       
 #
+#                                                                            
 #
+# This file is part of the program relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>).         
 #
+#                                                                            
 #
+# This program is free software: you can redistribute it and/or modify       
 #
+# it under the terms of the GNU General Public License as published by       
 #
+# the Free Software Foundation, either version 3 of the License, or          
 #
+# (at your option) any later version.                                        
 #
+#                                                                            
 #
+# This program is distributed in the hope that it will be useful,            
 #
+# but WITHOUT ANY WARRANTY; without even the implied warranty of             
 #
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              
 #
+# GNU General Public License for more details.                               
 #
+#                                                                            
 #
+# You should have received a copy of the GNU General Public License          
 #
+# along with this program.  If not, see &lt;<a  rel="nofollow" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.      
 #
+#                                                                            
 #
+###############################################################################
+
+# Module docstring.
+&quot;&quot;&quot;Module for performing a principle component analysis (PCA).&quot;&quot;&quot;
+
+# Python module imports.
+from numpy import float64, outer, zeros
+from numpy.linalg import eigh
+
+# relax library module imports.
+from lib.structure.statistics import calc_mean_structure
+
+
+def calc_covariance_matrix(coord=None):
+    &quot;&quot;&quot;Calculate the covariance matrix for the structures.
+
+    @keyword coord:         The list of coordinates of all models to 
superimpose.  The first index is the models, the second is the atomic 
positions, and the third is the xyz coordinates.
+    @type coord:            list of numpy rank-2, Nx3 arrays
+    @return:                The covariance matrix.
+    @rtype:                 numpy rank-2, 3N array
+    &quot;&quot;&quot;
+
+    # Init.
+    M = len(coord)
+    N = len(coord[0])
+    covariance_matrix = zeros((N*3, N*3), float64)
+    mean_struct = zeros((N, 3), float64)
+
+    # Calculate the mean structure.
+    calc_mean_structure(coord, mean_struct)
+
+    # Loop over the models.
+    for i in range(M):
+        # The deviations from the mean.
+        deviations = coord[i] - mean_struct
+
+        # Sum the covariance element.
+        covariance_matrix += outer(deviations, deviations)
+
+    # Normalise.
+    covariance_matrix /= M
+
+    # Return the matrix.
+    return covariance_matrix
+
+
+def pca_analysis(coord=None, num_modes=4):
+    &quot;&quot;&quot;Perform the PCA analysis.
+
+    @keyword coord:         The list of coordinates of all models to 
superimpose.  The first index is the models, the second is the atomic 
positions, and the third is the xyz coordinates.
+    @type coord:            list of numpy rank-2, Nx3 arrays
+    @keyword num_modes:     The number of PCA modes to calculate.
+    @type num_modes:        int
+    &quot;&quot;&quot;
+
+    # Calculate the covariance matrix for the structures.
+    covariance_matrix = calc_covariance_matrix(coord)
+
+    # Perform an eigenvalue decomposition on the covariance matrix.
+    values, vectors = eigh(covariance_matrix)
+
+    # Sort the values and vectors.
+    indices = values.argsort()[::-1]
+    values = values[indices]
+    vectors = vectors[:, indices]
+
+    # Truncation to the desired number of modes.
+    values = values[:num_modes]
+    vectors = vectors[:,:num_modes]
+
+    # Printout.
+    print(&quot;\nThe eigenvalues are:&quot;)
+    for i in range(num_modes):
+        print(&quot;Mode %i:  %10.5f&quot; % (i+1, values[i]))



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Nov 25 18:40:03 2015</div>  
</body>
</html>
