<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Speed up of the TSMFK01 model. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 10 Sep 2013 11:58:15 +0200 -->
<!--X-Message-Id: CAED9pY&#45;pGhOkphtNKRPA77w2cVLyqX4rJv2sN1&#45;tZZ0_jJvNgw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CAED9pY_eua_QcXTMpojTpW8B9WjkSf0WcHCgOrO6Twb&#45;iCi4Ug@mail.gmail.com -->
<!--X-Reference: CA+CBx2PsYaEWQaNjO1XMfOP7vv5gU6TJ2muWp_B8JwVrfHoY7Q@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;QW6aoSY0rF&#45;1qEhZwzi77_V9JBh8nnAGiPoCH&#45;BOuyA@mail.gmail.com -->
<!--X-Reference: CA+CBx2McUfF=D1ZCkt&#45;VbhO+i&#45;yV8bvQNzxv0OpAjmTW09uaKw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Speed up of the TSMFK01 model. -- September 10, 2013 - 11:58</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Speed up of the TSMFK01 model.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00115" class="tabs">Index by Date</a> | <a href="threads.html#00115" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00114.html">Date Prev</a>] [<a href="msg00116.html">Date Next</a>] [<a href="msg00114.html">Thread Prev</a>] [<a href="msg00091.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 10 Sep 2013 11:57:43 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date:message-id:subject	:from:to:cc:content-type:content-transfer-encoding;	bh=NJXAW43zDq0WKX+f2GsWvhZsevzdPQ3jx50WacrCn4Y=;	b=btP0+lw2DiLhWGgSxuAvdcpRNPPeQ6VVjRrNl0Ue7gdCK52BtJbDQx3Rhzw6yBdpCZ	Gz9RD51Mro7iXwTladO8Jkmt5jSAeuGrSmyUR+aw3KXnTxuOHXIjhaW/Xiclv1HDbZi5	to+MAk7//Kle4K5jxGaRSpcS3SK30sFb599b+0KBDDA15XA2sBkHoZq66oCyme0NyUIA	wD3Byj7ruyqfQ9lQxJnpjJsK7dqPfZ0eZq/PvTrpp2m4H0z4oeGZk+aQnXJABGQP0Wlp	hG0dNAFYcQ19dgGcmqAj45+i4nW80hNT4qMbCbUVadUW5oQ8DsOvDLkm1jwFklztj9FI	rELA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00115.html">CAED9pY-pGhOkphtNKRPA77w2cVLyqX4rJv2sN1-tZZ0_jJvNgw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CAED9pY_eua_QcXTMpojTpW8B9WjkSf0WcHCgOrO6Twb-iCi4Ug@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2PsYaEWQaNjO1XMfOP7vv5gU6TJ2muWp_B8JwVrfHoY7Q@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-QW6aoSY0rF-1qEhZwzi77_V9JBh8nnAGiPoCH-BOuyA@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2McUfF=D1ZCkt-VbhO+i-yV8bvQNzxv0OpAjmTW09uaKw@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on September 10, 2013 - 11:58:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

Firstly I recommend you can change pA_value variable name to pA to
match the notation used throughout the dispersion code.  I would also
add a new if statement for the kex to k_AB conversion to keep things
separate and clean - it will make debugging easier for you.  As for
preventing the error, that cannot be done.  This error is good and
correct.  The reason is because the implementation requires a number
of changes to the specific_analyses.relax_disp.api module as well to
be complete and functional - especially in the methods relating to the
Monte Carlo simulations from where the spin.*_sim structures are
created.  You may encounter other errors, and this will simply
indicate that more needs to be done.  Grepping for the 'tex' and 'pB'
auxiliary parameters will help you identify all possible locations
where the support is required (only changes to
specific_analyses.relax_disp are required).

Regards,

Edward



On 10 September 2013 11:44, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I tried to modify parameters.py, so:

-------------
        # The kex to tex conversion and kex to k_AB.
        if param_name == 'kex':
            tex = 1.0 / (2.0 * value)
            set_value(value=tex, key=key, spins=spins,
sim_index=sim_index, param_name='tex', spin_index=spin_index,
frq_index=frq_index)
            # Get pA value.
            pA_value = get_value(key=key, spins=spins,
sim_index=sim_index, param_name='pA', spin_index=spin_index,
frq_index=frq_index)
            k_AB = value * (1 - pA_value)
            set_value(value=k_AB, key=key, spins=spins,
sim_index=sim_index, param_name='k_AB', spin_index=spin_index,
frq_index=frq_index)
------------

But when an analysis of the CR72 model, I get this error:

  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_disp/specific_analyses/relax_disp/api.py&quot;,
line 1179, in minimise
    param_conversion(spins=spins, sim_index=sim_index)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_disp/specific_analyses/relax_disp/parameters.py&quot;,
line 721, in param_conversion
    set_value(value=k_AB, key=key, spins=spins, sim_index=sim_index,
param_name='k_AB', spin_index=spin_index, frq_index=frq_index)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_disp/specific_analyses/relax_disp/parameters.py&quot;,
line 852, in set_value
    sim_obj = getattr(spin, param_name+'_sim')
AttributeError: 'SpinContainer' object has no attribute 'k_AB_sim'

How do I prevent this?

Best
Troels


Troels Emtekær Linnet


2013/9/9 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi.

</pre><blockquote class="blockquote"><pre style="margin: 0em;">There is an explanation for everything, including user errors. :-)
</pre></blockquote><pre style="margin: 0em;">

I'd call this more developer errors ;)  Talking about development, I
will soon ask the other relax developers about you joining the
development team.  This will have to wait a little while as I am on
holidays for about 3 weeks starting from this weekend.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I have analysed the 0.48 M GuaHCl dataset (the folded protein), and so
this is not comparable to the
1M GuaHcl (intermediate between folded/unfolded) dataset, which is
shown in the figures in the paper.

So, I got the original datapoints for figure 3, which shows the
ln(k_a) per GuaHCl.
And now k_a fits perfect for 0.48 M.

And I have today analysed the 1M dataset.

Everything matches until first digit, so I am satisfied.
</pre></blockquote><pre style="margin: 0em;">

This sounds great!  The model is so incredibly simple that finding out
that a data mix up was the source of the problem is quite a relief.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">So, I will soon send a swarm of patches to include this dataset.
</pre></blockquote><pre style="margin: 0em;">

All patched 
(<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/4372/focus=4563">http://thread.gmane.org/gmane.science.nmr.relax.devel/4372/focus=4563</a>).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Thanks for looking!

I will look into the tsmfk01 code to speed it up.
</pre></blockquote><pre style="margin: 0em;">

No problems.  I look forward to seeing your solutions.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">To compare to the numerical methods, you mentioned that one could make
auto conversion of the
parameters?

So could k_AB be calculated for the numerical methods, so:
k_AB = kex*(1-pA)
</pre></blockquote><pre style="margin: 0em;">

Yes, this can be done.  The complication is handling the Monte Carlo
simulations, specifically the parameter error estimate calculation at
the end of all simulations.  You can have a go at this yourself, if
you wish.  The key is to look for where the 'tex' or 'pB' parameters
are handled, as these are not parameters in most of the dispersion
models, and to study this code.  These two parameters will be handled
as you wish k_AB to be.  If k_AB is calculated, then so should k_BA.
Maybe phi_ex should also be added to this list of 'auxiliary'
parameters so that the numeric models can be easily compared to the
fast exchange models.  Are there any other auxiliary parameters you
can think of?  What about the alpha factor which determines if the
exchange is fast, slow or intermediate?

Cheers,

Edward
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00090" href="msg00090.html">Speed up of the TSMFK01 model.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00092" href="msg00092.html">Re: Speed up of the TSMFK01 model.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00096" href="msg00096.html">Re: Speed up of the TSMFK01 model.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00114" href="msg00114.html">Re: Speed up of the TSMFK01 model.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Sep 10 12:40:06 2013</div>  
</body>
</html>
