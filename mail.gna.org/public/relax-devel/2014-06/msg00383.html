<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r24152 &#45; /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 23 Jun 2014 09:05:32 +0200 -->
<!--X-Message-Id: CAED9pY_8r4uA1siuA_xaES5drMQ4U93ruR96cMSSf3w0j09hnQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1WxeTC&#45;0007mH&#45;3V@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r24152 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py -- June 23, 2014 - 09:05</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r24152 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00383" class="tabs">Index by Date</a> | <a href="threads.html#00383" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00382.html">Date Prev</a>] [<a href="msg00384.html">Date Next</a>] [<a href="msg00380.html">Thread Prev</a>] [<a href="msg00384.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 23 Jun 2014 09:05:00 +0200</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:content-type; bh=QH4I/1F6wEBIzsPkdwl4inftDQh6sV3yuD+kgbbA310=; b=Taa/FFdWcGBrZqDeNi6vS7wywezRNFcQmLvry42U6XBCJFNsvrmT7aGs0YPO03p9gI 7k7/pcbODasliFSqvqavpCCULdnzSDLm7dlXzbSx4UjCALmIJyv0WRRSVwg2Sx+JLUAN WjbQkr4DTs2/hQx3Z5133KpA90APFI4kPnh6GHHuMixNgmIc7jihEy/LewRV9KR/SGxf f1x8qUpr/lBX4ZCDoPRuiSPR5AGHSWaTXXLXMeNpzONrvsyG6WcZcVbnhbQkKlGbA8hH XfOUmAZQ7sQetdCaOy3GvJtwjrFgu7wjE6pWCsAjy+zE+jS4jAx6rFMmBC3NMS0pgN+l I5sQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00383.html">CAED9pY_8r4uA1siuA_xaES5drMQ4U93ruR96cMSSf3w0j09hnQ@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1WxeTC-0007mH-3V@subversion.gna.org&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 23, 2014 - 09:05:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

I'm now back and have started to quickly check your commits over the
last 4 days.  For this change, such debugging code does not need to be
added to the repository.  It is better that it stays in your local
checked out copy.

Cheers,

Edward



On 19 June 2014 17:41,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Thu Jun 19 17:41:45 2014
New Revision: 24152

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=24152&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=24152&amp;view=rev</a>
Log:
Implemented test, to see if 3D exchange matrixes are the same.

This can be tested while running systemtest 
test_hansen_cpmg_data_to_ns_cpmg_2site_3D.

Task #7807 (<a  rel="nofollow" href="https://gna.org/task/index.php?7807">https://gna.org/task/index.php?7807</a>): Speed-up of dispersion 
models for Clustered analysis.

Modified:
    branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py

Modified: branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py?rev=24152&amp;r1=24151&amp;r2=24152&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py?rev=24152&amp;r1=24151&amp;r2=24152&amp;view=diff</a>
==============================================================================
--- branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py (original)
+++ branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_3d.py Thu Jun 19 
17:41:45 2014
@@ -60,7 +60,7 @@


 # relax module imports.
-from lib.dispersion.ns_matrices import rcpmg_3d
+from lib.dispersion.ns_matrices import rcpmg_3d, rcpmg_3d_rankN
 from lib.float import isNaN
 from lib.linear_algebra.matrix_exponential import matrix_exponential

@@ -128,6 +128,8 @@
     # Extract the total numbers of experiments, number of spins, number of 
magnetic field strength, number of offsets, maximum number of dispersion 
point.
     NE, NS, NM, NO, ND = back_calc.shape

+    R_mat = rcpmg_3d_rankN(R1A=r10a, R1B=r10b, R2A=r20a, R2B=r20b, pA=pA, 
pB=pB, dw=dw, k_AB=k_AB, k_BA=k_BA, tcp=tcp)
+
     # Loop over the spins
     for si in range(NS):
         # Loop over the spectrometer frequencies.
@@ -154,7 +156,22 @@
                 Mint = M0

                 # This matrix is a propagator that will evolve the 
magnetization with the matrix R for a delay tcp.
-                Rexpo = matrix_exponential(R*tcp_si_mi_di)
+                R_tcp = R*tcp_si_mi_di
+                R_mat_i = R_mat[0, si, mi, 0, di]
+
+                # Test if they are equal.
+                diff = R_tcp - R_mat_i
+                if abs(sum(diff)) &gt; 1.e-14:
+                    import sys
+                    print &quot;oh no&quot;
+                    print R_tcp
+                    print R_mat_i
+                    print diff
+                    print abs(sum(diff))
+                    print si, mi, di
+                    sys.exit()
+
+                Rexpo = matrix_exponential(R_tcp)

                 # The essential evolution matrix.
                 # This is the first round.


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jun 23 09:20:16 2014</div>  
</body>
</html>
