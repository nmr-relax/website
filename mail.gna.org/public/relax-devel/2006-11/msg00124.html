<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [Bug #7544] Incorrect nucleus names in results -->
<!--X-From-R13: "Oyrknaqne Vnafra" <ivbpurzvfgNtznvy.pbz> -->
<!--X-Date: Thu, 09 Nov 2006 16:07:22 +0100 -->
<!--X-Message-Id: 481156b20611090706x50c4183bl2ded5c8c38349915@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 481156b20611081032i1ebb3700g5b4b64ef88366af3@mail.gmail.com -->
<!--X-Reference: 7f080ed10611090128j4b74e1bfl4843b7fd78e0cad4@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [Bug #7544] Incorrect nucleus names in results -- November 09, 2006 - 16:07</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [Bug #7544] Incorrect nucleus names in results</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00124" class="tabs">Index by Date</a> | <a href="threads.html#00124" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00123.html">Date Prev</a>] [<a href="msg00125.html">Date Next</a>] [<a href="msg00116.html">Thread Prev</a>] [<a href="msg00125.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 9 Nov 2006 10:06:38 -0500</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00124.html">481156b20611090706x50c4183bl2ded5c8c38349915@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00106.html">481156b20611081032i1ebb3700g5b4b64ef88366af3@mail.gmail.com</a>&gt;	&lt;<a href="msg00116.html">7f080ed10611090128j4b74e1bfl4843b7fd78e0cad4@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Alexandar Hansen</strong> on November 09, 2006 - 16:07:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<br><br><div><span class="gmail_quote">On 11/9/06, <b class="gmail_sendername">Edward d'Auvergne</b> &lt;<a href="mailto:edward.dauvergne@xxxxxxxxx">edward.dauvergne@xxxxxxxxx</a>&gt; wrote:</span><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
On 11/9/06, Alexandar Hansen &lt;<a href="mailto:viochemist@xxxxxxxxx">viochemist@xxxxxxxxx</a>&gt; wrote:<br>&gt; Hi,<br>&gt;<br>&gt; So, I'm attempting this model_free.py fix, but I don't think it's as<br>&gt; straightforward as you say.&nbsp;&nbsp;My first thought was that the nucleus and pdb
<br>&gt; reads were only occuring once before the data loop and, since there's more<br>&gt; than one nucleus/residue type, that should be included in the loop.<br>&gt; Therefore, I copied this:<br>&gt;<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Nucleus.
<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nucleus =<br>&gt; self.relax.generic.nuclei.find_nucleus()<br>&gt;<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # PDB.<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb = None<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb_model = None<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb_heteronuc = None<br>
&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb_proton = None<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if self.relax.data.pdb.has_key(self.run):<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb = self.relax.data.pdb[self.run].file_name<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb_model = self.relax.data.pdb
[self.run].model<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb_heteronuc = self.relax.data.pdb[self.run].heteronuc<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb_proton = self.relax.data.pdb[self.run].proton<br>&gt;<br>&gt; Into the 'Loop over the sequence' but this didn't work.
<br><br>You are on the right track.&nbsp;&nbsp;However you only need to move the<br>'pdb_heteronuc' and 'pdb_proton' parts into the loop.&nbsp;&nbsp;The 'pdb' file<br>and 'pdb_model' will be the same for all spins.&nbsp;&nbsp;As for the 'nucleus'<br>values, these are not yet associated with specific spins.&nbsp;&nbsp;The
<br>'nuclei()' user function just sets one nucleus type for that run,<br>hence you can't currently analyse both carbon and nitrogen<br>simultaneously.&nbsp;&nbsp;This will be fixed when the redesign of the relax<br>data model occurs.
<br><br><br>&gt;&nbsp;&nbsp;I then manually<br>&gt; read in my pdb and executed some pdb.read and pdb.vector commands to see<br>&gt; what those lines are reading and confirmed that pdb.read() doesn't import<br>&gt; anything about protons or heteronuclei.&nbsp;&nbsp;Those are only assigned with the
<br>&gt; pdb.vectors() lines in full_analysis.py.&nbsp;&nbsp;Now, you had suggested that, for<br>&gt; me to read in multiple nuclei, I should load the pdb like this:<br>&gt;<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Load the PDB file.<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
pdb.read(name,'my_pdb.pdb')<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb.vectors(name, heteronuc='N1', proton='H1', res_name='G')<br>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb.vectors(name, heteronuc='N3', proton='H3', res_name='U')<br>&gt;<br>&gt; While I believe this does read in the different vector types, it ulimately
<br>&gt; assignes heteronuc to 'N3' and proton to 'H3', writing over the first vector<br>&gt; call.&nbsp;&nbsp;Is there another place to pull the nucleus information from for a<br>&gt; given row of input data?<br><br>Since I made those changes to the '
pdb.vectors()' user function to<br>allow different nuclei names, relax is now placing the information<br>into the residue specific data structure 'self.relax.data.res[run]'.<br>If you probe around in there you will find the proton and
<br>heteronucleus names.<br><br><br>&gt; Can I call the nucleus straight from the input<br>&gt; data?&nbsp;&nbsp;How can I be sure that pdb.vectors are matching everything up<br>&gt; correctly in calculating relaxation?&nbsp;&nbsp;Where is the list of 
pdb.vectors<br>&gt; stored?&nbsp;&nbsp;What information is stored with each pdb vector (orientation, bond<br>&gt; length, nuclei, etc.)?&nbsp;&nbsp;Sorry for all of the remedial questions.<br><br><br>As the proton and heteronucleus names are permanently stored in
<br>'self.relax.data.res[run]', there is no need to read the values from<br>the input data.&nbsp;&nbsp;If you probe around in there, you should see the<br>following data structures:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;proton<br>&nbsp;&nbsp;&nbsp;&nbsp;heteronuc<br>&nbsp;&nbsp;&nbsp;&nbsp;xh_vect
</blockquote><div><br>Great!&nbsp; That made things pretty easy.&nbsp; I reverted it back to the&nbsp; repository version and made these changes:<br><br>Removed pdb_heteronuc = ... and pdb_proton = ... lines 4682-4683<br>Added this to the loop (at the new line 4700):
<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # XH dipolar nuclei.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if hasattr(data,'heteronuc'):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb_heteronuc = data.heteronuc<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdb_proton = data.proton<br><br>One thing I didn't understand was 
pdb.has_key(self.run).&nbsp; What is that?&nbsp; I'm guessing a flag of some sort that means &quot;if a pdb was used, set value to X&quot; or something along those lines.&nbsp; Anyways, using the old &quot;if ...has_key&quot;, it would still crash because it would come to residues (like A or C) which hadn't been assigned any heteronuclei.&nbsp; So, I looked a few lines down and saw what seemed to be a self explanatory if statement that would work, ie &quot;if hasattr(data,'heteronuc')&quot;
<br><br>Anyways, the sphere through ellipsoid results now have the correct heteronuclei and protons.<br></div><br><br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
The 'xh_vect' is a unit vector parallel to the XH bond.&nbsp;&nbsp;It's length<br>from the PDB is essentially meaningless as it is dependent on which<br>computer program generated the structure or added the protons later.<br><br>Doh!&nbsp;&nbsp;I've had a look at the 
1.3 line code and have realised that I<br>haven't placed the proton and heteronuc names into<br>'self.relax.data.res[run]'!&nbsp;&nbsp;That will cause complications.&nbsp;&nbsp;This will<br>be done before I even send this message.&nbsp;&nbsp;Ok, it's done (see r2792 at
<br><a href="/mail.gna.org/public/relax-commits/2006-11/msg00090.html">https://mail.gna.org/public/relax-commits/2006-11/msg00090.html</a>).<br><br><br>&gt; As for read_xxxxx, will this be read_columnar_results or one of the other
<br>&gt; read_columnar functions?&nbsp;&nbsp;Thanks for all of the help.<br><br>The main driving function here is 'self.read_columnar_results()'.<br>Fixing up the reading code will be a little more difficult.&nbsp;&nbsp;The best<br>option would probably be to modify the function 'self.
<br>read_columnar_xh_vect()' to set the proton and heteronucleus names the<br>same way as the 'pdb.vectors()' user function does (by calling the<br>function 'self.relax.generic.pdb.vectors()').&nbsp;&nbsp;This could be done by<br>mimicking the code already in that function.
</blockquote><div><br>The diff_model = 'final' also finished without error without me having to touch any of the read functions.&nbsp; I was kindof hoping for another fatal error that could direct me to where you're talking about.&nbsp; The 'final' results look alright, just the PDB_model, PDB_heteronuc and PDB_proton columns are filled with 'None'.
<br><br>I'm starting to understand this python data structure type of programming.&nbsp; Now I think I just need to figure out how much data is actually there and get used to the conventions you've set up in naming and using it.&nbsp; I would _still_ like to fix or restrict certain diffusion parameters like one can do with ModelFree because of my limited data situation, but I'll wait and see how things go.
<br><br><br>Alex<br><br>&nbsp;</div><br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">Thank you for helping to resolve these issues,<br><br>Edward
<br></blockquote></div><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00125" href="msg00125.html">Re: [Bug #7544] Incorrect nucleus names in results</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00106" href="msg00106.html">[Bug #7544] Incorrect nucleus names in results</a></strong>
<ul><li><em>From:</em> Alexandar Hansen</li></ul></li>
<li><strong><a name="00116" href="msg00116.html">Re: [Bug #7544] Incorrect nucleus names in results</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Nov 09 17:00:29 2006</div>  
</body>
</html>
