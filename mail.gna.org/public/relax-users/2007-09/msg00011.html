<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: bug? previous vs. current model test in full_analysis -->
<!--X-From-R13: Rbhtynf Ybwrgva <qbhtynf.xbwrgvaNtznvy.pbz> -->
<!--X-Date: Mon, 17 Sep 2007 19:51:26 +0200 -->
<!--X-Message-Id: 59CF5ABD&#45;2724&#45;4547&#45;B9E7&#45;0F66E545F368@gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: A4C2B7BD&#45;E757&#45;4ED2&#45;B5E3&#45;FA47EB1006E6@gmail.com -->
<!--X-Reference: 7f080ed10709170848h6cdf16c7g422a7a93d2935583@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: bug? previous vs. current model test in full_analysis -- September 17, 2007 - 19:51</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: bug? previous vs. current model test in full_analysis</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00011" class="tabs">Index by Date</a> | <a href="threads.html#00011" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00010.html">Date Prev</a>] [<a href="msg00012.html">Date Next</a>] [<a href="msg00009.html">Thread Prev</a>] [<a href="msg00012.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 17 Sep 2007 13:50:40 -0400</li>
<li class="menuitem">
<em>Cc</em>: relax-users@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00011.html">59CF5ABD-2724-4547-B9E7-0F66E545F368@gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;A4C2B7BD-E757-4ED2-B5E3-FA47EB1006E6@xxxxxxxxx&gt;	&lt;7f080ed10709170848h6cdf16c7g422a7a93d2935583@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Douglas Kojetin</strong> on September 17, 2007 - 19:51:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">

</pre><tt>My tests are still running, but here is what I think might be  
</tt><tt>happening.  I think there is a problem with comparing the string  
</tt><tt>representation of the previous and current runs.
</tt><pre style="margin: 0em;">

</pre><tt>When the previous results are loaded in the 'load_tensor' definition  
</tt><tt>(starting on line 496), information for all residues is read,  
</tt><tt>including residues that have 'None' as a model in the previous  
</tt><tt>results.bz2 (AIC) file.  For my 106 residue protein, this essentially  
</tt><tt>loads 106 models (for the 106 residues), with the model for some  
</tt><tt>residues set to 'None'.  In my example below, the model 'None' would  
</tt><tt>be set for residues  1-3, 11 and 18.
</tt><pre style="margin: 0em;">

</pre><tt>The information from the current run does not appear to contain the  
</tt><tt>'None' model for residues 1-3, 11 and 18, as you say they should not  
</tt><tt>be included in the model free analysis.
</tt><pre style="margin: 0em;">

</pre><tt>Therefore, the literal string test between lines 373-378 fails when  
</tt><tt>the string representation of the previous run (the 'prev_models'  
</tt><tt>variable, created between lines 363-365) is directly compared to the  
</tt><tt>string representation of current run (the 'curr_models' variable,  
</tt><tt>created between lines 368-371) within the convergence definition  
</tt><tt>(lines 373-378).
</tt><pre style="margin: 0em;">

</pre><tt>Perhaps this test (lines 373-378) should not be a literal string test  
</tt><tt>between the prev_models and curr_models variables,  created by  
</tt><tt>concatenating the model information, but rather a direct residue-by- 
</tt><tt>residue comparison of models in dictionary or list form.
</tt><pre style="margin: 0em;">

I am working on this now ...

Any thoughts?

Doug

</pre><tt>p.s.  if the line numbers for the above references do not match up or  
</tt><tt>make sense, please let me know
</tt><pre style="margin: 0em;">




On Sep 17, 2007, at 11:48 AM, Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

The problem is likely to be due to a circular looping around very
similar solutions close to the universal solution, as I have defined
in:

d'Auvergne EJ, Gooley PR. Set theory formulation of the model-free
problem and the diffusion seeded model-free paradigm. Mol Biosyst.
2007 Jul;3(7):483-94.

</pre><tt>If you can't get the paper, have a look at Chapter 5 of my PhD  
</tt><tt>thesis at
</tt><pre style="margin: 0em;">
<a  rel="nofollow" href="http://eprints.infodiv.unimelb.edu.au/archive/00002799/">http://eprints.infodiv.unimelb.edu.au/archive/00002799/</a>.  The problem
is the interlinked mathematical optimisation and statistical model
selection where we are trying to minimise different quantities.  For
mathematical optimisation this is the chi-squared value.  For model
selection this is the quantity known as the descrepancy.  These can
not be optimised together as mathematical optimisation works in a
single fixed-dimension space or universe whereas model selection
operates across multiple spaces with different dimensions.  See the
paper for a more comprehensive description of the issue.

You should be able to see this if you look at the end of iterations.
If you have 160 iterations, look after iteration 20 (or maybe even 30
or further).  Until then, you will not have reached the circular loop.
 After that point you will be able to exactly quatify this circular
loop.  You'll be able to determine its periodicity, which residues are
involved (probably only 1), and whether the diffusion tensor changes
as model selection changes.

I mentioned all of this already in my post at
<a  rel="nofollow" href="/mail.gna.org/public/relax-users/2007-07/msg00001.html">https://mail.gna.org/public/relax-users/2007-07/msg00001.html</a>
</pre><tt>(Message-id:  
</tt><tt>&lt;7f080ed10707090104r60453839of0b9df58022501d2@xxxxxxxxxxxxxx&gt;)
</tt><pre style="margin: 0em;">
in response to your original post
(<a  rel="nofollow" href="/mail.gna.org/public/relax-users/2007-06/msg00004.html">https://mail.gna.org/public/relax-users/2007-06/msg00004.html</a>,
Message-id: &lt;2ED509BE-FA07-4ED0-96F0-E4E612405DC7@xxxxxxxxx&gt;).

I have a few more points about the tests you have done but to work out
what is happening with the printouts, it would be very useful to have
your modified 'full_analysis.py' script attached.



On 9/17/07, Douglas Kojetin &lt;douglas.kojetin@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

I'm unsure if this is a bug in full_analysis.py, in the internal
relax code, or user error.  The optimization of the 'sphere' model
will not converge, now after 160+ rounds.   The chi-squared test has
converged (long, long ago):
</pre></blockquote><pre style="margin: 0em;">

See above.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">
&quot;&quot; from output
         Chi-squared test:
             chi2 (k-1): 100.77647517006251
             chi2 (k):   100.77647517006251
             The chi-squared value has converged.
&quot;&quot;

However, the identical model-free models test does has not converged:

&quot;&quot; from output
         Identical model-free models test:
             The model-free models have not converged.

         Identical parameter test:
             The model-free models haven't converged hence the
parameters haven't converged.
&quot;&quot;

Something that confuses me is that the output files in the round_??/
aic directory suggest that, for example, the round_160 and round_161
AIC model selections are equivalent.  Here are the models for the
first few residues:
</pre></blockquote><pre style="margin: 0em;">

Between these 2 rounds, are you sure that all models for all residues
are identical?  From your data that you posted at
<a  rel="nofollow" href="/mail.gna.org/public/relax-users/2007-06/msg00017.html">https://mail.gna.org/public/relax-users/2007-06/msg00017.html</a>
(Message-id: &lt;B52B2F07-8B2C-4FAE-B270-902C2A1B3619@xxxxxxxxx&gt;), I
would guess that this is not the case and one or two residues actually
do change in their model selections.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">
&quot;&quot;
         1 None None
         2 None None
         3 None None
         4 m2 m2
         5 m2 m2
         6 m2 m2
         7 m2 m2
         8 m2 m2
         9 m4 m4
         10 m1 m1
         11 None None
         12 m2 m2
         13 m2 m2
         14 m1 m1
         15 m2 m2
         16 m3 m3
         17 m3 m3
         18 None None
&quot;&quot;

However, I modified the full_analysis.py protocol to print the
differences in the model selection, within the 'Identical model-free
model test' section of the 'convergence' definition. Here is the
beginning of the output (which only contains differences between the
previous and current rounds):

&quot;&quot;
         residue 1: prev=None curr=m2
         residue 2: prev=None curr=m2
         residue 3: prev=None curr=m2
         residue 6: prev=m2 curr=m4
         residue 7: prev=m2 curr=m1
         residue 9: prev=m4 curr=m2
         residue 11: prev=None curr=m2
         residue 12: prev=m2 curr=m3
         residue 13: prev=m2 curr=m3
         residue 15: prev=m2 curr=m1
         residue 16: prev=m3 curr=m2
         residue 17: prev=m3 curr=m1
         residue 18: prev=None curr=m3
&quot;&quot;
</pre></blockquote><pre style="margin: 0em;">

This output is quite strange.  I would need to see the
full_analysis.py script to do more with this.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">
There should be no data for residues 1-3, 11 and 18 (None), however
the 'Identical model-free model test' seems as if it ignores residues
for which 'None' was selected in the curr_model call in the following
code:

&quot;&quot;
         # Create a string representation of the model-free models of
the previous run.
         prev_models = ''
         for i in xrange(len(self.relax.data.res['previous'])):
             if hasattr(self.relax.data.res['previous'][i], 'model'):
                 #prev_models = prev_models + self.relax.data.res
['previous'][i].model
</pre><tt>                 prev_models = prev_models + ' ' +  
</tt><tt>self.relax.data.res
</tt><pre style="margin: 0em;">
['previous'][i].model

         # Create a string representation of the model-free models of
the current run.
         curr_models = ''
         for i in xrange(len(self.relax.data.res[run])):
             if hasattr(self.relax.data.res[run][i], 'model'):
</pre><tt>                 #curr_models = curr_models + self.relax.data.res 
</tt><tt>[run]
</tt><pre style="margin: 0em;">
[i].model
</pre><tt>                 curr_models = curr_models + ' ' +  
</tt><tt>self.relax.data.res
</tt><pre style="margin: 0em;">
[run][i].model
&quot;&quot;
</pre></blockquote><pre style="margin: 0em;">

As residues 1-3, 11 and 18 are deselected, then they will not have the
attribute 'model' and hence will not be placed in the prev_models or
curr_models string (which are then compared).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">
For what it's worth, I have residues 1,2,3,11 and 18 in the file
'unresolved' which is read by the full_analysis.py protocol.  I
created a separate sequence file (variable = SEQUENCE) that contains
all residues (those with data and those without), instead of using a
data file (noe data, in the default full_analysis.py file).  However,
these residues are not specified in the data (r1, r2 and noe) files,
as I did not have data for them.  Should I add them but place 'None'
in the data and error columns?  Could that be causing the problems?
Or should I create a bug report for this?
</pre></blockquote><pre style="margin: 0em;">

I'm not sure what you mean by the file '(variable = SEQUENCE)'
statement.  I would need to see the full_analysis.py script to
understand this.  I would assume a file called the value in the
variable 'SEQUENCE'.  In which case, this should not be a problem.  As
the data is missing from the files containing the relaxation data,
these residues will not be used in model-free analysis.  They will be
automatically deselected.  There is not need to add empty data for
these spin systems into the relaxation data files.  As I said before
at the top of this message and at
<a  rel="nofollow" href="/mail.gna.org/public/relax-users/2007-07/msg00001.html">https://mail.gna.org/public/relax-users/2007-07/msg00001.html</a>
</pre><tt>(Message-id:  
</tt><tt>&lt;7f080ed10707090104r60453839of0b9df58022501d2@xxxxxxxxxxxxxx&gt;),
</tt><pre style="margin: 0em;">
the problem is almost guaranteed to be a circular loop of equivalent
solutions circling around the universal solution - the solution
defined within the universal set (the union of all global models
(diffusion tensor + all model-free models of all residues)).  If you
have hit this circular problem, then I suggest you stop running relax.
 What I would then do is identify the spin system (or systems) causing
the loop, and what the differences are between all members of the
loop.  This you can do by plotting the data and maybe using the
program diff on uncompressed versions of the results files.  It's
likely that the differences are small and inconsequential.  I hope
this helps.

Regards,

Edward
</pre></blockquote><pre style="margin: 0em;">



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00007" href="msg00007.html">bug? previous vs. current model test in full_analysis</a></strong>
<ul><li><em>From:</em> Douglas Kojetin</li></ul></li>
<li><strong><a name="00008" href="msg00008.html">Re: bug? previous vs. current model test in full_analysis</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Sep 17 21:20:33 2007</div>  
</body>
</html>
