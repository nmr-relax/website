<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r22427 &#45; /trunk/lib/rotating_frame.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 07 Mar 2014 13:33:59 +0100 -->
<!--X-Message-Id: CA+CBx2PTwO=4wpCHcOMUWLSb1cENx2mwscedOKfvNOoh96tduw@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: E1WLsEe&#45;0004o9&#45;Lg@subversion.gna.org -->
<!--X-Reference: CAED9pY8J+P=muK3+J7nOtw6NhV1b34Dqx4H_8jyxA4Hn=7VgNg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r22427 - /trunk/lib/rotating_frame.py -- March 07, 2014 - 13:33</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r22427 - /trunk/lib/rotating_frame.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00042" class="tabs">Index by Date</a> | <a href="threads.html#00042" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00041.html">Date Prev</a>] [<a href="msg00043.html">Date Next</a>] [<a href="msg00041.html">Thread Prev</a>] [<a href="msg00043.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 7 Mar 2014 13:33:08 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:from:date:message-id	:subject:to:cc:content-type;	bh=K/rbZOBwPnmVtT4ERx9VYN31a6lk1wpeNw8eFrw2VQA=;	b=VhgYKyxWdcvQK/54ayoNoO6PkDn3rkwDnEf6TG3+OVqVhYcbSXomFTDhsQKrwmSlAV	eFSyZWhL+IgEy60dCCEGqXEFrycxYS3buJy3f6SKDaQ3WoRuofBnizzusp8vQZ6kHOk0	fSBOF4e0Me5zfw3XMzWpCTP2x6WYmfAw6sozlX9gkr121zD9qvJ95uuboXrqQM/Cbjo3	48clcgA74/hUuiixKOUcy+GXme0IGhWNtZ2FLe8HfMwpi/NFjS56rZwMMVrQ6t+wEqJ4	WtOzJpFLiqIinWfVvS+buiNYrOsJmYgHTyl0aqLCgf4+TwGE5KnP0CienAUh5SPz90fM	louA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00042.html">CA+CBx2PTwO=4wpCHcOMUWLSb1cENx2mwscedOKfvNOoh96tduw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1WLsEe-0004o9-Lg@xxxxxxxxxxxxxxxxxx&gt;	&lt;CAED9pY8J+P=muK3+J7nOtw6NhV1b34Dqx4H_8jyxA4Hn=7VgNg@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on March 07, 2014 - 13:33:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr"><div><div>Hi Edward.<br><br></div>How should I handle the value.write function?<br><br>I was thinking of adding w_eff and Delta_omega as parameters, like these commits:<br>r22409 - /trunk/specific_analyses/relax_disp/api.py<br>

<a rel="nofollow" href="http://www.mail-archive.com/relax-commits@xxxxxxx/msg20031.html">http://www.mail-archive.com/relax-commits@xxxxxxx/msg20031.html</a><br><br>r22411 - /trunk/specific_analyses/relax_disp/api.py<br><a rel="nofollow" href="http://www.mail-archive.com/relax-commits@xxxxxxx/msg20033.html">http://www.mail-archive.com/relax-commits@xxxxxxx/msg20033.html</a><br>

<br></div>If I was about to use the value.write function, how should<br>I initialize a call to the function to calculate theta, Delta_omega?<br><br>Best<br>Troels<br><div><br></div></div><div class="gmail_extra"><br><br>
<div class="gmail_quote">
2014-03-07 12:26 GMT+01:00 Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx" target="_blank">edward@xxxxxxxxxxxxx</a>&gt;</span>:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">

Hi Troels,<br>
<br>
One consideration you need to make for the functions of the relax<br>
library is that these are independent of the relax data store and the<br>
pipe_control package (used to manipulate the data store) and the<br>
specific_analyses package.  I.e. you should be able to use all<br>
functions without the rest of relax, hence it could be distributed<br>
with other GPL v3+ NMR software.  Here you have used a number of<br>
pipe_control.mol_res_spin and specific_analyses.relax_disp.disp_data<br>
functions.  Therefore this indicates that the code would be better<br>
located in the specific_analyses.relax_disp.disp_data module.  A<br>
calc_tilt_angle() function in the relax library would essentially need<br>
to take all its data as arguments (spin-lock field and offset and<br>
chemical shift) and return the tilt angle.<br>
<br>
The other problem is the storing of theta in the spin containers.<br>
This should not be done as the user can change the(spin-lock field,<br>
offset, or chemical shift and hence the tilt angle theta will change.<br>
It is much better to generate theta when needed by the<br>
relax_disp.plot_disp_curves user function, and then not store it (so<br>
it is destroyed automatically by Python).  Such non-permanent<br>
parameters are used extensively throughout relax, especially in the<br>
N-state or ensemble analysis code.<br>
<br>
Regards,<br>
<br>
Edward<br>
<div><div class="h5"><br>
<br>
On 7 March 2014 11:42,  &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt; Author: tlinnet<br>
&gt; Date: Fri Mar  7 11:42:36 2014<br>
&gt; New Revision: 22427<br>
&gt;<br>
&gt; URL: <a rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=22427&amp;view=rev" target="_blank">http://svn.gna.org/viewcvs/relax?rev=22427&amp;view=rev</a><br>
&gt; Log:<br>
&gt; Added lib.rotating_frame module containing functions related to rotating frame NMR calculations.<br>
&gt;<br>
&gt; Regarding sr #3124, (<a rel="nofollow" href="https://gna.org/support/index.php?3124" target="_blank">https://gna.org/support/index.php?3124</a>) - Grace graphs production for R1rho analysis with R2_eff as function of Omega_eff.<br>


&gt;<br>
&gt; Added:<br>
&gt;     trunk/lib/rotating_frame.py<br>
&gt;<br>
&gt; Added: trunk/lib/rotating_frame.py<br>
&gt; URL: <a rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/rotating_frame.py?rev=22427&amp;view=auto" target="_blank">http://svn.gna.org/viewcvs/relax/trunk/lib/rotating_frame.py?rev=22427&amp;view=auto</a><br>
&gt; ==============================================================================<br>
&gt; --- trunk/lib/rotating_frame.py (added)<br>
&gt; +++ trunk/lib/rotating_frame.py Fri Mar  7 11:42:36 2014<br>
&gt; @@ -0,0 +1,77 @@<br>
&gt; +###############################################################################<br>
&gt; +#                                                                             #<br>
&gt; +# Copyright (C) 2014 Troels E. Linnet                                         #<br>
&gt; +#                                                                             #<br>
&gt; +# This file is part of the program relax (<a rel="nofollow" href="http://www.nmr-relax.com" target="_blank">http://www.nmr-relax.com</a>).          #<br>
&gt; +#                                                                             #<br>
&gt; +# This program is free software: you can redistribute it and/or modify        #<br>
&gt; +# it under the terms of the GNU General Public License as published by        #<br>
&gt; +# the Free Software Foundation, either version 3 of the License, or           #<br>
&gt; +# (at your option) any later version.                                         #<br>
&gt; +#                                                                             #<br>
&gt; +# This program is distributed in the hope that it will be useful,             #<br>
&gt; +# but WITHOUT ANY WARRANTY; without even the implied warranty of              #<br>
&gt; +# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the               #<br>
&gt; +# GNU General Public License for more details.                                #<br>
&gt; +#                                                                             #<br>
&gt; +# You should have received a copy of the GNU General Public License           #<br>
&gt; +# along with this program.  If not, see &lt;<a rel="nofollow" href="http://www.gnu.org/licenses/" target="_blank">http://www.gnu.org/licenses/</a>&gt;.       #<br>
&gt; +#                                                                             #<br>
&gt; +###############################################################################<br>
&gt; +<br>
&gt; +# Module docstring.<br>
&gt; +&quot;&quot;&quot;Module containing functions related to rotating frame NMR calculations.&quot;&quot;&quot;<br>
&gt; +<br>
&gt; +# Python module imports.<br>
&gt; +from os import sep<br>
&gt; +<br>
&gt; +# relax module imports.<br>
&gt; +from pipe_control.mol_res_spin import find_index, get_spin_ids, index_molecule, index_residue, return_spin, spin_loop<br>
&gt; +from specific_analyses.relax_disp.disp_data import loop_exp_frq_offset, return_offset_data, return_param_key_from_data, return_spin_lock_nu1<br>
&gt; +<br>
&gt; +def calc_tilt_angle():<br>
&gt; +    # Get the field count<br>
&gt; +    field_count = cdp.spectrometer_frq_count<br>
&gt; +<br>
&gt; +    # Get the spin_lock_field points<br>
&gt; +    spin_lock_nu1 = return_spin_lock_nu1(ref_flag=False)<br>
&gt; +<br>
&gt; +    # Initialize data containers<br>
&gt; +    all_spin_ids = get_spin_ids()<br>
&gt; +<br>
&gt; +    # Containers for only selected spins<br>
&gt; +    cur_spin_ids = []<br>
&gt; +    cur_spins = []<br>
&gt; +    for curspin_id in all_spin_ids:<br>
&gt; +        # Get the spin<br>
&gt; +        curspin = return_spin(curspin_id)<br>
&gt; +<br>
&gt; +        # Check if is selected<br>
&gt; +        if curspin.select == True:<br>
&gt; +            cur_spin_ids.append(curspin_id)<br>
&gt; +            cur_spins.append(curspin)<br>
&gt; +<br>
&gt; +    # The offset and R1 data.<br>
&gt; +    chemical_shifts, offsets, tilt_angles = return_offset_data(spins=cur_spins, spin_ids=cur_spin_ids, field_count=field_count, fields=spin_lock_nu1)<br>
&gt; +<br>
&gt; +    # Loop over the index of spins, then exp_type, frq, offset<br>
&gt; +    print(&quot;Printing the following&quot;)<br>
&gt; +    print(&quot;exp_type curspin_id frq offset{ppm} offsets[ei][si][mi][oi]{rad/s} ei mi oi si di cur_spin.chemical_shift{ppm} chemical_shifts[ei][si][mi]{rad/s} spin_lock_nu1{Hz} tilt_angles[ei][si][mi][oi]{rad}&quot;)<br>


&gt; +    for si in range(len(cur_spin_ids)):<br>
&gt; +        theta_spin_dic = dict()<br>
&gt; +        curspin_id = cur_spin_ids[si]<br>
&gt; +        cur_spin = cur_spins[si]<br>
&gt; +        for exp_type, frq, offset, ei, mi, oi in loop_exp_frq_offset(return_indices=True):<br>
&gt; +            # Loop over the dispersion points.<br>
&gt; +            spin_lock_fields = spin_lock_nu1[ei][mi][oi]<br>
&gt; +            for di in range(len(spin_lock_fields)):<br>
&gt; +                print(&quot;%-8s %-10s %11.1f %8.4f %12.5f %i  %i  %i  %i  %i %7.3f %12.5f %12.5f %12.5f&quot;%(exp_type, curspin_id, frq, offset, offsets[ei][si][mi][oi], ei, mi, oi, si, di, cur_spin.chemical_shift, chemical_shifts[ei][si][mi], spin_lock_fields[di], tilt_angles[ei][si][mi][oi][di]))<br>


&gt; +                dic_key = return_param_key_from_data(exp_type=exp_type, frq=frq, offset=offset, point=spin_lock_fields[di])<br>
&gt; +                theta_spin_dic[&quot;%s&quot;%(dic_key)] = tilt_angles[ei][si][mi][oi][di]<br>
&gt; +        # Store the data<br>
&gt; +        cur_spin.theta = theta_spin_dic<br>
&gt; +<br>
&gt; +    print(&quot;\nThe theta data now resides in&quot;)<br>
&gt; +    for curspin, mol_name, res_num, res_name, spin_id in spin_loop(full_info=True, return_id=True, skip_desel=True):<br>
&gt; +        spin_index = find_index(selection=spin_id, global_index=False)<br>
&gt; +        print(&quot;%s cdp.mol[%i].res[%i].spin[%i].theta&quot;%(spin_id, spin_index[0], spin_index[1], spin_index[2]))<br>
&gt;<br>
&gt;<br>
&gt; _______________________________________________<br>
&gt; relax (<a rel="nofollow" href="http://www.nmr-relax.com" target="_blank">http://www.nmr-relax.com</a>)<br>
&gt;<br>
&gt; This is the relax-commits mailing list<br>
&gt; <a rel="nofollow" href="mailto:relax-commits@xxxxxxx">relax-commits@xxxxxxx</a><br>
&gt;<br>
&gt; To unsubscribe from this list, get a password<br>
&gt; reminder, or change your subscription options,<br>
&gt; visit the list information page at<br>
&gt; <a rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits" target="_blank">https://mail.gna.org/listinfo/relax-commits</a><br>
<br>
_______________________________________________<br>
relax (<a rel="nofollow" href="http://www.nmr-relax.com" target="_blank">http://www.nmr-relax.com</a>)<br>
<br>
</div></div>This is the relax-devel mailing list<br>
<a rel="nofollow" href="mailto:relax-devel@xxxxxxx">relax-devel@xxxxxxx</a><br>
<div class=""><br>
To unsubscribe from this list, get a password<br>
reminder, or change your subscription options,<br>
visit the list information page at<br>
</div><a rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel" target="_blank">https://mail.gna.org/listinfo/relax-devel</a><br>
</blockquote></div><br></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00043" href="msg00043.html">Re: r22427 - /trunk/lib/rotating_frame.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00041" href="msg00041.html">Re: r22427 - /trunk/lib/rotating_frame.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Mar 07 16:00:10 2014</div>  
</body>
</html>
