<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: CST branch -->
<!--X-From-R13: Bniry Ynqrenirx <cniry.xnqrenirxNtznvy.pbz> -->
<!--X-Date: Mon, 29 Nov 2010 23:28:14 +0100 -->
<!--X-Message-Id: AANLkTi=aZJDUcj0+p_0Or_P1v3xwSvk=7=s=+DjHFRcA@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: p2l6052a51004080823g94a64268lf8af8d3e332c2a03@mail.gmail.com -->
<!--X-Reference: j2i7f080ed11004120000r80bba9bch9556be67b0c1707@mail.gmail.com -->
<!--X-Reference: g2v6052a51004131048sb5c01509sfc9a77045ad33310@mail.gmail.com -->
<!--X-Reference: r2g7f080ed11004131113mb209905eh63ff1eb61c171fee@mail.gmail.com -->
<!--X-Reference: l2q6052a51004301221h9ad09886ha016465129beb516@mail.gmail.com -->
<!--X-Reference: g2m7f080ed11005050153y2ad8b4bfjb4eb8191b0efd0cc@mail.gmail.com -->
<!--X-Reference: AANLkTin4nzkkOCxs94vUKCpT00R7ak22gLaL5rK&#45;VjPN@mail.gmail.com -->
<!--X-Reference: AANLkTinF4yNXoJQS&#45;rd81VBi3keRURUNeb&#45;_GdkxqqsG@mail.gmail.com -->
<!--X-Reference: AANLkTinibyBQvsoG1&#45;0vmzOXFmRJxD95VMF3eGxzSMMB@mail.gmail.com -->
<!--X-Reference: AANLkTimFT0&#45;Kbgdz_U5LeOW5Ln22mPBZBC8FL68n6CeF@mail.gmail.com -->
<!--X-Reference: AANLkTikhknBoHTc7B7GCRULkrEnxSx+PpqPP=x6KrDOH@mail.gmail.com -->
<!--X-Reference: AANLkTim0B&#45;E6kMW9Nn47o+u+atxrm38540u1Xhaoe6j0@mail.gmail.com -->
<!--X-Reference: AANLkTi=m5S08Nd1F5VDnMGTOu2s+j2Euz1t&#45;ytw0zOAf@mail.gmail.com -->
<!--X-Reference: AANLkTinxUWLu2N19dc3eaPgh22igv_SGy=6qmVnJN=Qj@mail.gmail.com -->
<!--X-Reference: AANLkTik0K3B7huKE8hJtAkXL_yzJmNa9BFxfczu8Sfx9@mail.gmail.com -->
<!--X-Reference: AANLkTin1JfUtMoVqR4c&#45;5dRHTf58N&#45;FAcv4_bc=LpH2b@mail.gmail.com -->
<!--X-Reference: AANLkTimBsSm504qysJd8&#45;e0O_thUdcwvciKrNhMTdoQW@mail.gmail.com -->
<!--X-Reference: AANLkTikf&#45;g23EPV+R2&#45;7inSpXbT5fqv5vDO8nL+DZrwA@mail.gmail.com -->
<!--X-Reference: AANLkTikNh5FTMmeQPqkSiX8ieG5oUw5UcuG83k8PeAiM@mail.gmail.com -->
<!--X-Reference: AANLkTimADCpNAJG4Pg02_UukH5hFW5eQfr&#45;SymzqXrc=@mail.gmail.com -->
<!--X-Reference: AANLkTi=8_288HiMhVQDwpFUCqMp+aBotECez44s44q7z@mail.gmail.com -->
<!--X-Reference: AANLkTi=vSTA2B&#45;jpTzShJab84W=&#45;z1YBzvhW10wTXg_P@mail.gmail.com -->
<!--X-Reference: AANLkTikXiEtqtDWOycdJdyYSG+KfxAARiXhtDwrQm_v+@mail.gmail.com -->
<!--X-Reference: AANLkTinWS1m+j069Y+sTXrae&#45;J5DamkkNTp&#45;Wx8u7OTX@mail.gmail.com -->
<!--X-Reference: AANLkTinNsF7fA3Va=&#45;63bYBE3EoOeZ21OOO8ZYunU0uR@mail.gmail.com -->
<!--X-Reference: AANLkTinw8sg3staDqr+=mBGqLgB0joQwKzKbFNGY_5sF@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: CST branch -- November 29, 2010 - 23:28</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: CST branch</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00033" class="tabs">Index by Date</a> | <a href="threads.html#00033" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00032.html">Date Prev</a>] [<a href="msg00034.html">Date Next</a>] [<a href="msg00020.html">Thread Prev</a>] [<a href="msg00036.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 29 Nov 2010 23:28:05 +0100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:mime-version:received:received:in-reply-to	:references:date:message-id:subject:from:to:cc:content-type;	bh=jgKhqtZLSPYT12nsna/riFjAiAXl/FUltXb245e4oQQ=;	b=Q9NY7mlMATb3AqIRJ+xO7IwPV14v62m0iNLyVyEoC66mkgtOOj+/GyIDYQ1T8yriJ1	hOhuixKfGd0mHBJOWUXcapyoftDkH2u9z4o+/hUOxK33361NzEwwAYCQcP89TlUv5AIt	Hss+7cLwUKiTU77kFmeBQA8k6yINSiAmqEx84=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00033.html">AANLkTi=aZJDUcj0+p_0Or_P1v3xwSvk=7=s=+DjHFRcA@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;p2l6052a51004080823g94a64268lf8af8d3e332c2a03@xxxxxxxxxxxxxx&gt;	&lt;j2i7f080ed11004120000r80bba9bch9556be67b0c1707@xxxxxxxxxxxxxx&gt;	&lt;g2v6052a51004131048sb5c01509sfc9a77045ad33310@xxxxxxxxxxxxxx&gt;	&lt;r2g7f080ed11004131113mb209905eh63ff1eb61c171fee@xxxxxxxxxxxxxx&gt;	&lt;l2q6052a51004301221h9ad09886ha016465129beb516@xxxxxxxxxxxxxx&gt;	&lt;g2m7f080ed11005050153y2ad8b4bfjb4eb8191b0efd0cc@xxxxxxxxxxxxxx&gt;	&lt;AANLkTin4nzkkOCxs94vUKCpT00R7ak22gLaL5rK-VjPN@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinF4yNXoJQS-rd81VBi3keRURUNeb-_GdkxqqsG@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinibyBQvsoG1-0vmzOXFmRJxD95VMF3eGxzSMMB@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimFT0-Kbgdz_U5LeOW5Ln22mPBZBC8FL68n6CeF@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikhknBoHTc7B7GCRULkrEnxSx+PpqPP=x6KrDOH@xxxxxxxxxxxxxx&gt;	&lt;AANLkTim0B-E6kMW9Nn47o+u+atxrm38540u1Xhaoe6j0@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=m5S08Nd1F5VDnMGTOu2s+j2Euz1t-ytw0zOAf@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinxUWLu2N19dc3eaPgh22igv_SGy=6qmVnJN=Qj@xxxxxxxxxxxxxx&gt;	&lt;AANLkTik0K3B7huKE8hJtAkXL_yzJmNa9BFxfczu8Sfx9@xxxxxxxxxxxxxx&gt;	&lt;AANLkTin1JfUtMoVqR4c-5dRHTf58N-FAcv4_bc=LpH2b@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimBsSm504qysJd8-e0O_thUdcwvciKrNhMTdoQW@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikf-g23EPV+R2-7inSpXbT5fqv5vDO8nL+DZrwA@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikNh5FTMmeQPqkSiX8ieG5oUw5UcuG83k8PeAiM@xxxxxxxxxxxxxx&gt;	&lt;AANLkTimADCpNAJG4Pg02_UukH5hFW5eQfr-SymzqXrc=@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=8_288HiMhVQDwpFUCqMp+aBotECez44s44q7z@xxxxxxxxxxxxxx&gt;	&lt;AANLkTi=vSTA2B-jpTzShJab84W=-z1YBzvhW10wTXg_P@xxxxxxxxxxxxxx&gt;	&lt;AANLkTikXiEtqtDWOycdJdyYSG+KfxAARiXhtDwrQm_v+@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinWS1m+j069Y+sTXrae-J5DamkkNTp-Wx8u7OTX@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinNsF7fA3Va=-63bYBE3EoOeZ21OOO8ZYunU0uR@xxxxxxxxxxxxxx&gt;	&lt;AANLkTinw8sg3staDqr+=mBGqLgB0joQwKzKbFNGY_5sF@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Pavel Kaderavek</strong> on November 29, 2010 - 23:28:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div>This change is related to the task #6397 (<a rel="nofollow" href="https://gna.org/task/?6397" target="_blank">https://gna.org/task/?6397</a>)<br><br>kada _at_ chemi _dot_ muni _dot_ cz<br></div><br><a rel="nofollow" href="https://mail.gna.org/public/relax-devel/2010-11/msg00001.html" target="_blank">https://mail.gna.org/public/relax-devel/2010-11/msg00001.html</a><br>

<a rel="nofollow" href="https://gna.org/task/download.php?file_id=11449">https://gna.org/task/download.php?file_id=11449</a><br>
<br>

This
patch
includes change in  func_mf, func_local_tm, func_diff, func_all,
dfunc_mf, dfunc_local_tm, dfunc_diff, dfunc_all, d2func_mf,
d2func_local_tm, d2func_diff, d2func_all functions of class Mf in a
file
maths_fns/mf.py. Functions were modified in order to handle data for
more
interactions.<br><br><div class="gmail_quote">On 27 November 2010 09:25, Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
Hi,<br>
<br>
First make a backup copy just in case, then simply perform an &#39;svn up&#39;<br>
and then &#39;svn diff&#39;.  This should work without clashes.  If there is a<br>
clash, this is a normal part of software development.  This really<br>
shouldn&#39;t be necessary.  But if you need to resolve a clash, you need<br>
to edit the file and find the &#39;&lt;&lt;&lt;&lt;&lt;&#39;, &#39;=====&#39;, and &#39;&gt;&gt;&gt;&gt;&gt;&#39; marks.<br>
This separates code from the old file and the new file for you to<br>
manually edit and merge.  If it&#39;s too confusing, just ask again.<br>
<br>
Cheers,<br>
<font color="#888888"><br>
Edward<br>
</font><div><div></div><div class="h5"><br>
<br>
On 25 November 2010 19:25, Pavel Kaderavek &lt;<a rel="nofollow" href="mailto:pavel.kaderavek@xxxxxxxxx">pavel.kaderavek@xxxxxxxxx</a>&gt; wrote:<br>
&gt; Hi,<br>
&gt;<br>
&gt; We prepared another set of changes according to discussion in:<br>
&gt; <a rel="nofollow" href="https://mail.gna.org/public/relax-devel/2010-11/msg00001.html" target="_blank">https://mail.gna.org/public/relax-devel/2010-11/msg00001.html</a><br>
&gt; and previous.<br>
&gt;<br>
&gt; Normally, we use command &quot;svn diff&quot; to create a patch by comparing new code<br>
&gt; and code of our branch in the repository. As the current changes are applied<br>
&gt; on the already patched version of the code (not present in the current<br>
&gt; repository revision of our branch obtained by &quot;svn up&quot;), we would like to<br>
&gt; ask you how the patch should be created.<br>
&gt;<br>
&gt; Regards,<br>
&gt; Pavel<br>
&gt;<br>
&gt;<br>
&gt; On 15 November 2010 19:21, Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt;&gt;<br>
&gt;&gt; Hi,<br>
&gt;&gt;<br>
&gt;&gt; I&#39;m now back from a few weeks holidays.  This is correct, a double<br>
&gt;&gt; looping will be required.  I think this will still be efficient as the<br>
&gt;&gt; &quot;for k in xrange(self.num_interactions[0])&quot; loops are not very<br>
&gt;&gt; expensive.  The alternative is to bring the &quot;for j in<br>
&gt;&gt; xrange(data.total_num_params):&quot; loop, but this would duplicate<br>
&gt;&gt; calculations and hence be even more expensive.  This will also be<br>
&gt;&gt; required in the d2func_* methods as well.<br>
&gt;&gt;<br>
&gt;&gt; On a different note, as the code is becoming more complex, I would<br>
&gt;&gt; recommend for a future patch that &quot;data = "" so that we<br>
&gt;&gt; always use &quot;self.data[0][k].dri_prime[j]&quot; for each element rather than<br>
&gt;&gt; &quot;data..dri_prime[j]&quot;.  This will help with debugging in the future as<br>
&gt;&gt; we could end up mixing the self.data elements.<br>
&gt;&gt;<br>
&gt;&gt; Also for the Rex interaction, there are plans for the future to allow<br>
&gt;&gt; for it to be non-quadratic for situations closer to slow exchange or<br>
&gt;&gt; intermediate.  For slow exchange the interaction is then linear with<br>
&gt;&gt; field strength, and the value ranges from linear (alpha=1) to<br>
&gt;&gt; quadratic (alpha=2).  So the alpha value between 1 and 2 might become<br>
&gt;&gt; an optimisable parameter and hence this interaction type will become<br>
&gt;&gt; more complex and require its own code paths.  So if this branch<br>
&gt;&gt; separates out the Rex interaction, this would be of benefit to the<br>
&gt;&gt; rest of relax.  Though the separation might be essential for the<br>
&gt;&gt; powerful code restructuring currently anyway.<br>
&gt;&gt;<br>
&gt;&gt; Cheers,<br>
&gt;&gt;<br>
&gt;&gt; Edward<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt; On 27 October 2010 20:45, Pavel Kaderavek &lt;<a rel="nofollow" href="mailto:pavel.kaderavek@xxxxxxxxx">pavel.kaderavek@xxxxxxxxx</a>&gt;<br>
&gt;&gt; wrote:<br>
&gt;&gt; &gt; Hi,<br>
&gt;&gt; &gt; sorry for a late response. Your suggestions seem reasonable. I would add<br>
&gt;&gt; &gt; just a two comments.<br>
&gt;&gt; &gt; 1) We should keep as before not only ri_prime but probably also chi2,<br>
&gt;&gt; &gt; dchi2<br>
&gt;&gt; &gt; and d2chi2 as well.<br>
&gt;&gt; &gt; .<br>
&gt;&gt; &gt; 2)The consideration of Rex as an additional interaction is a one of the<br>
&gt;&gt; &gt; suitable approaches and it fits the general idea. We have to consider<br>
&gt;&gt; &gt; that<br>
&gt;&gt; &gt; it requires to add new interaction into the list of the interactions (<br>
&gt;&gt; &gt; __init__ function in class Mf, file maths_fns/mf.py).<br>
&gt;&gt; &gt; It might be done just within the __init__ function (class Mf, file<br>
&gt;&gt; &gt; maths_fns/mf.py). It will be based on the presence of Rex term within<br>
&gt;&gt; &gt; the<br>
&gt;&gt; &gt; loaded variable param_types. The other possibility is to do it before<br>
&gt;&gt; &gt; calling this __init__ function (number of interactions is one of its<br>
&gt;&gt; &gt; arguments).<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Then I address to discussion one additional problem related to the patch<br>
&gt;&gt; &gt; in<br>
&gt;&gt; &gt; the preparation. Within the  functions related to the derivations:<br>
&gt;&gt; &gt; dfunc_mf,<br>
&gt;&gt; &gt; dfunc_local_tm, dfunc_all, dfunc_diff (class Mf, maths_fns/mf.py) there<br>
&gt;&gt; &gt; is a<br>
&gt;&gt; &gt; small complication. It will be illustrated using  &quot;dfunc_mf&quot; function as<br>
&gt;&gt; &gt; an<br>
&gt;&gt; &gt; example. The original code is following:<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;         data = "">
&gt;&gt; &gt;<br>
&gt;&gt; &gt;         # Calculate the spectral density gradient components.<br>
&gt;&gt; &gt;         if data.calc_djw_comps:<br>
&gt;&gt; &gt;             data.calc_djw_comps(data, params)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;         # Diffusion tensor correlation times.<br>
&gt;&gt; &gt;         self.diff_data.calc_dti(data, self.diff_data)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;         # Loop over the gradient.<br>
&gt;&gt; &gt;         for j in xrange(data.total_num_params):<br>
&gt;&gt; &gt;             # Calculate the spectral density gradients.<br>
&gt;&gt; &gt;             if data.calc_djw[j]:<br>
&gt;&gt; &gt;                 data.djw = data.calc_djw[j](data, params, j)<br>
&gt;&gt; &gt;             else:<br>
&gt;&gt; &gt;                 data.djw = data.djw * 0.0<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;             # Calculate the relaxation gradient components.<br>
&gt;&gt; &gt;             data.create_dri_comps(data, params)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;             # Calculate the R1, R2, and sigma_noe gradients.<br>
&gt;&gt; &gt;             data.dri_prime[j] = data.create_dri_prime[j](data)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;             # Loop over the relaxation values and modify the NOE<br>
&gt;&gt; &gt; gradients.<br>
&gt;&gt; &gt;             data.dri[j] = data.dri_prime[j]<br>
&gt;&gt; &gt;             for m in xrange(data.num_ri):<br>
&gt;&gt; &gt;                 if data.create_dri[m]:<br>
&gt;&gt; &gt;                     data.create_dri[m](data, m, data.remap_table[m],<br>
&gt;&gt; &gt; data.get_dr1, params, j)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;             # Calculate the chi-squared gradient.<br>
&gt;&gt; &gt;             data.dchi2[j] = dchi2_element(data.relax_data, data.ri,<br>
&gt;&gt; &gt; data.dri[j], data.errors)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; If  the loop over interactions is incorporated, it is necessary to do it<br>
&gt;&gt; &gt; before &quot;data.calc_djw_comps&quot; is calculated. However then we get into the<br>
&gt;&gt; &gt; conflict with calculation of &quot;modification of NOE gradients&quot; and also<br>
&gt;&gt; &gt; calculation of &quot;dchi2&quot;. These quantities can be calculated only when<br>
&gt;&gt; &gt; contributions from all interactions has been already evaluated (it is<br>
&gt;&gt; &gt; similar to already discussed ri_prime). In this case it is complicated<br>
&gt;&gt; &gt; by<br>
&gt;&gt; &gt; the presence of loop over fitted parameters. The possible solution would<br>
&gt;&gt; &gt; be<br>
&gt;&gt; &gt; to make the loop over the interactions the inner one. However this seems<br>
&gt;&gt; &gt; to<br>
&gt;&gt; &gt; require repeating the loop over interactions twice within the code:<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;         data = "">
&gt;&gt; &gt;<br>
&gt;&gt; &gt;         # Loop over the interactions<br>
&gt;&gt; &gt;         for k in xrange(self.num_interactions[0]):<br>
&gt;&gt; &gt;             # Calculate the spectral density gradient components.<br>
&gt;&gt; &gt;             if data[k].calc_djw_comps:<br>
&gt;&gt; &gt;                 data[k].calc_djw_comps(data[k], params)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;             # Diffusion tensor correlation times.<br>
&gt;&gt; &gt;             self.diff_data.calc_dti(data[k], self.diff_data)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;         # Loop over the gradient.<br>
&gt;&gt; &gt;         for j in xrange(data.total_num_params):<br>
&gt;&gt; &gt;             # Loop over the interactions<br>
&gt;&gt; &gt;             for k in xrange(self.num_interactions[0])<br>
&gt;&gt; &gt;                 # Calculate the spectral density gradients.<br>
&gt;&gt; &gt;                 if data[k].calc_djw[j]:<br>
&gt;&gt; &gt;                     data[k].djw = data[k].calc_djw[j](data[k], params,<br>
&gt;&gt; &gt; j)<br>
&gt;&gt; &gt;                 else:<br>
&gt;&gt; &gt;                     data[k].djw = data[k].djw * 0.0<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;                     # Calculate the relaxation gradient components.<br>
&gt;&gt; &gt;                     data[k].create_dri_comps(data[k], params)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;                 # Calculate the R1, R2, and sigma_noe gradients.<br>
&gt;&gt; &gt;                 data[k].dri_prime[j] =<br>
&gt;&gt; &gt; data[k].create_dri_prime[j](data[k])                              #<br>
&gt;&gt; &gt; later<br>
&gt;&gt; &gt; data[k].dri_prime[j] will be replaced by data.dri_prime[j]<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;                                                    # but you suggest not<br>
&gt;&gt; &gt; to<br>
&gt;&gt; &gt; include both changes into the following patch together<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;             # Loop over the relaxation values and modify the NOE<br>
&gt;&gt; &gt; gradients.<br>
&gt;&gt; &gt;             data.dri[j] = data.dri_prime[j]<br>
&gt;&gt; &gt;             for m in xrange(data.num_ri):<br>
&gt;&gt; &gt;                 if data.create_dri[m]:<br>
&gt;&gt; &gt;                     data.create_dri[m](data, m, data.remap_table[m],<br>
&gt;&gt; &gt; data.get_dr1, params, j)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;                 # Calculate the chi-squared gradient.<br>
&gt;&gt; &gt;                 data.dchi2[j] = dchi2_element(data.relax_data, data.ri,<br>
&gt;&gt; &gt; data.dri[j], data.errors)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Additionally I would notify that variable &quot;total_num_params&quot; needs to be<br>
&gt;&gt; &gt; kept at the position self.data[0] (similar to your suggestion in your<br>
&gt;&gt; &gt; last<br>
&gt;&gt; &gt; mail, concerning ri_prime)<br>
&gt;&gt; &gt; What do you think about this?<br>
&gt;&gt; &gt; Regards<br>
&gt;&gt; &gt; Pavel<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; On 22 October 2010 19:46, Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt; wrote:<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Hi,<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; This is a good idea.  First I would suggest putting this into 2<br>
&gt;&gt; &gt;&gt; patches, as this is easier to check and apply.  Don&#39;t worry about<br>
&gt;&gt; &gt;&gt; breaking the code at this point - it is in your own special branch so<br>
&gt;&gt; &gt;&gt; as long as it works in the end, you can smash it into a million pieces<br>
&gt;&gt; &gt;&gt; and put it back together again if you like.  Commits to the repository<br>
&gt;&gt; &gt;&gt; are better when they are many small ones, as they can be more easily<br>
&gt;&gt; &gt;&gt; managed.  For example if something is found to be designed not<br>
&gt;&gt; &gt;&gt; ideally, or there is a fatal bug, that patch/commit can be reverted<br>
&gt;&gt; &gt;&gt; and then new code can be worked on.  And small patches make it much<br>
&gt;&gt; &gt;&gt; easier for the other relax developers to read and catch potential<br>
&gt;&gt; &gt;&gt; hidden bugs or design issues.<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; This is an intriguing problem, as the data flow hits a fork here.<br>
&gt;&gt; &gt;&gt; ri_prime is the correct target for the merging of the data from all<br>
&gt;&gt; &gt;&gt; the interactions, as this needs to occur before the calculation of the<br>
&gt;&gt; &gt;&gt; NOE using sigma_noe and the R1.  The relaxation rates R1, R2, and<br>
&gt;&gt; &gt;&gt; sigma_noe add.  However the NOE does not.  I just thought I&#39;d explain<br>
&gt;&gt; &gt;&gt; the logic for others to follow ;)<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; I would suggest we store ri_prime somewhere else.  What I can do is to<br>
&gt;&gt; &gt;&gt; apply a patch for the first change to accommodate for the multiple<br>
&gt;&gt; &gt;&gt; relaxation interactions.  Then I could make a change myself, creating<br>
&gt;&gt; &gt;&gt; a special Python object for &#39;data[i]&#39;.  We can store the ri_prime data<br>
&gt;&gt; &gt;&gt; this special object.  Essentially, it will be like the current code<br>
&gt;&gt; &gt;&gt; base.  We could have specific interaction data in say:<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; self.data[10][0].jw  (or self.data[0].jw if data = "">
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; This is new.  But as before we could have:<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; self.data[10].ri_prime (or data.ri_prime if data = "">
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; So the forking can all be managed within the self.data[i] data<br>
&gt;&gt; &gt;&gt; structures.  What do you think?  Also, we will have to work out how to<br>
&gt;&gt; &gt;&gt; modify or replace func_ri_prime and func_ri_prime_rex in the<br>
&gt;&gt; &gt;&gt; maths_fns.ri_prime module.  This is where the merging of data streams<br>
&gt;&gt; &gt;&gt; currently occurs.  Maybe Rex needs to be considered as its own<br>
&gt;&gt; &gt;&gt; interaction, as this is added to produce ri_prime?<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Regards,<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; Edward<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; P. S.  I just talked to Kathleen Hall and she seemed very interested<br>
&gt;&gt; &gt;&gt; in what you are doing here!<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; On 22 October 2010 18:26, Pavel Kaderavek &lt;<a rel="nofollow" href="mailto:pavel.kaderavek@xxxxxxxxx">pavel.kaderavek@xxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt; Hi,<br>
&gt;&gt; &gt;&gt; &gt; I am continuing in the discussion started in my post<br>
&gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="https://mail.gna.org/public/relax-devel/2010-09/msg00020.html" target="_blank">https://mail.gna.org/public/relax-devel/2010-09/msg00020.html</a><br>
&gt;&gt; &gt;&gt; &gt; It covers changes of functions func_mf.py, func_local_tm , func_diff,<br>
&gt;&gt; &gt;&gt; &gt; func_all and their equivalents for a first and second derivatives<br>
&gt;&gt; &gt;&gt; &gt; (class<br>
&gt;&gt; &gt;&gt; &gt; Mf,<br>
&gt;&gt; &gt;&gt; &gt; file maths_fns/mf.py).<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; I would like to include into next patch also treatment of the fact,<br>
&gt;&gt; &gt;&gt; &gt; that<br>
&gt;&gt; &gt;&gt; &gt; it<br>
&gt;&gt; &gt;&gt; &gt; is necessary to sum together contributions of all interactions. It<br>
&gt;&gt; &gt;&gt; &gt; seems<br>
&gt;&gt; &gt;&gt; &gt; to<br>
&gt;&gt; &gt;&gt; &gt; me that the most suitable way is to do that by the modification just<br>
&gt;&gt; &gt;&gt; &gt; revised<br>
&gt;&gt; &gt;&gt; &gt; functions (func_mf.py, func_local_tm ...)<br>
&gt;&gt; &gt;&gt; &gt; I would suggest to initialize ri_prime before loop over interactions<br>
&gt;&gt; &gt;&gt; &gt; and<br>
&gt;&gt; &gt;&gt; &gt; then step by step add the contributions into the ri_prime:<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;         data = ""                                # the<br>
&gt;&gt; &gt;&gt; &gt; cases<br>
&gt;&gt; &gt;&gt; &gt; when `i` is replaced by `0` were discussed in your last mail<br>
&gt;&gt; &gt;&gt; &gt;         ri_prime=0<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;         for j in xrange(self.num_interactions[i]):<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;               ...<br>
&gt;&gt; &gt;&gt; &gt;               ...<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;               # Calculate the R1, R2, and sigma_noe values.<br>
&gt;&gt; &gt;&gt; &gt;               ri_prime = ri_prime + data[j].create_ri_prime(data[j])<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;          data[0].ri_prime = ri_prime<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; When the loop over interactions is finished the accumulated<br>
&gt;&gt; &gt;&gt; &gt; relaxation<br>
&gt;&gt; &gt;&gt; &gt; rate<br>
&gt;&gt; &gt;&gt; &gt; is copied into the data storage of the first interaction. Then it is<br>
&gt;&gt; &gt;&gt; &gt; possible to call functions, where total ri_prime is needed:<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;         # Calculate the NOE values.<br>
&gt;&gt; &gt;&gt; &gt;         data[0].ri = data[0].ri_prime * 1.0<br>
&gt;&gt; &gt;&gt; &gt;         for m in xrange(data[0].num_ri):<br>
&gt;&gt; &gt;&gt; &gt;             if data[0].create_ri[m]:<br>
&gt;&gt; &gt;&gt; &gt;                 data[0].create_ri[m](data[0], m,<br>
&gt;&gt; &gt;&gt; &gt; data[0].remap_table[m],<br>
&gt;&gt; &gt;&gt; &gt; data[0].get_r1, params)<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;         # Calculate the chi-squared value.<br>
&gt;&gt; &gt;&gt; &gt;         data[0].chi2 = chi2(data[0].relax_data, data[0].ri,<br>
&gt;&gt; &gt;&gt; &gt; data[0].errors)<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt; Pavel<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt; On 19 October 2010 13:49, Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Hi,<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Sorry for the delay, I just came back from a 2 week holiday.  This<br>
&gt;&gt; &gt;&gt; &gt;&gt; is<br>
&gt;&gt; &gt;&gt; &gt;&gt; correct, the func_mf, func_local_tm, etc. methods are working on a<br>
&gt;&gt; &gt;&gt; &gt;&gt; single spin.  This is stored in self.data[0].  The other functions<br>
&gt;&gt; &gt;&gt; &gt;&gt; work on multiple spin data located in self.data[0], self.data[1],<br>
&gt;&gt; &gt;&gt; &gt;&gt; etc.<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; Edward<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; On 14 October 2010 19:38, Pavel Kaderavek<br>
&gt;&gt; &gt;&gt; &gt;&gt; &lt;<a rel="nofollow" href="mailto:pavel.kaderavek@xxxxxxxxx">pavel.kaderavek@xxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; Hi,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; I would like to announce a small clarification of my previous mail<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; about<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; changes in functions func_mf, func_local_tm, func_diff, func_all,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; and<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; their<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; derivatives (class Mf, file maths_fns/mf.py). Loop suggested in my<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; last<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; post:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; <a rel="nofollow" href="https://mail.gna.org/public/relax-devel/2010-09/msg00020.html" target="_blank">https://mail.gna.org/public/relax-devel/2010-09/msg00020.html</a><br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; is valid just for the functions func_diff, func_all, and their<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; equivalents<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; for a first and second derivatives.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; While for the functions  func_mf, func_local_tm, and corresponding<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; derivatives the index of self.num_interactions should be set to<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; `0`<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; instead<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; of index `i`<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;         for j in xrange(self.num_interactions[0]):<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; (The rest of the loop remains the same)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; That comes from the fact that these functions (func_mf,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; func_local_tm,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; ...<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; ) are called for each spin separately. As it is indicated by the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; preceding<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; statement:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;         data = "">
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; Pavel<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; On 29 September 2010 10:53, Edward d&#39;Auvergne<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Hi,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; This is the perfect approach.  It will abstract the calculations<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; so<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; that we will not need to touch many of maths_fns modules.  With<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; this<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; code in place, I would aim at then making the test suite pass<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; again<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; by<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; having the correct data structures pass into maths_fns.mf.  The<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; last<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; step would be to input CSA tensors and the multi-dipole<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; interactions<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; via user functions.  If you make a patch for all of the func_*(),<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; dfunc_*(), and d2func_*() methods, I can check and apply it<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; quickly.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Edward<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; On 28 September 2010 12:07, Pavel Kaderavek<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &lt;<a rel="nofollow" href="mailto:pavel.kaderavek@xxxxxxxxx">pavel.kaderavek@xxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Hi,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; we were thinking about next necessary changes in the CST<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; branch.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Now we need to break through the problem, which implies the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; fact<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; we<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; split<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; the relaxation rate calculation into contributions of<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; individual<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; interactions. Each of them has its own data class to store its<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; parameters<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; (so far called data[i][j], where the [i] was a spin index and<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; [j]<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; was<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; interaction index).<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; It seems to us, that it the best way to deal with it is to edit<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; functions:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; func_mf, func_local_tm , func_diff, func_all and their<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; equivalents<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; for a<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; first and second derivatives (defined in mf.py file).<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Within these functions the calculations of direction cosines,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; diffusion<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; tensor weight calculations, components of the spectral<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; densities<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; and<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; so<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; on<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; are performed. All these must be calculated for each<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; interaction<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; separately,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; because each interaction has its own data storage (which<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; replaced<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; previously<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; used one data class container for the whole IS spin system).<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Instead of:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         # Direction cosine calculations.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         if self.diff_data.calc_di:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             self.diff_data.calc_di(data, self.diff_data)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         # Diffusion tensor weight calculations.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         self.diff_data.calc_ci(data, self.diff_data)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         # Diffusion tensor correlation times.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         self.diff_data.calc_ti(data, self.diff_data)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         # Calculate the components of the spectral densities.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         if data.calc_jw_comps:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             data.calc_jw_comps(data, params)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         # Calculate the R1, R2, and sigma_noe values.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         data.ri_prime = data.create_ri_prime(data)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; we would suggest to introduce a loop over interacations<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;         for j in xrange(self.num_interactions[i]):<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             # Direction cosine calculations.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             if self.diff_data.calc_di:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;                 self.diff_data.calc_di(data[j], self.diff_data)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             # Diffusion tensor weight calculations.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             self.diff_data.calc_ci(data[j], self.diff_data)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             # Diffusion tensor correlation times.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             self.diff_data.calc_ti(data[j], self.diff_data)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             # Calculate the components of the spectral<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; densities.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             if data.calc_jw_comps:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;                 data.calc_jw_comps(data[j], params)<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             # Calculate the R1, R2, and sigma_noe components.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;             data.ri_prime = data.create_ri_prime(data[j])<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; It must be accompanied in the next step by a change the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; ri_prime<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; function so<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; that it just calculate only a product of specific interaction<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; constant<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; and<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; corresponding linear combination of spectral densities. While<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; final<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; sumation over all interactions should be done in a separate<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; step.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Moreover it will be also necessary to distinguish within the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; function<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; setup_equation the type of equation used for contribution of<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; individual<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; interactions according to their type.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Best<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Pavel<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; On 10 September 2010 15:43, Edward d&#39;Auvergne<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Hi Pavel,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; I missed it in the patches, but there were tab characters &#39;\t&#39;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; causing<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; problems.  These are now fixed.  relax requires that a tab is<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; replaced<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; by 4 spaces.  I have also added you to the copyright notices<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; (<a rel="nofollow" href="http://svn.gna.org/viewcvs/relax?view=rev&amp;revision=11543" target="_blank">http://svn.gna.org/viewcvs/relax?view=rev&amp;revision=11543</a>) of<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; files you have modified.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Edward<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; On 10 September 2010 15:36, Edward d&#39;Auvergne<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Hi,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; I&#39;ve carefully checked the patches and committed them with<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; messages you wrote.  Sorry again for the delays.  It should<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; be<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; faster<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; now that I am no longer in the tropical wilderness of far<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; north<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Australia.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; Edward<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; On 6 September 2010 13:23, Edward d&#39;Auvergne<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Hi Pavel,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Sorry for the delayed response.  I was at the ICMRBS<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; conference<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; in<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Australia and then travelled through the tropical north end<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; of<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Australia afterwards.  I came back yesterday out of the<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; remote<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; wilderness and can soon start looking at this patches.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Regards,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; Edward<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; On 31 August 2010 18:00, Pavel Kaderavek<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &lt;<a rel="nofollow" href="mailto:pavel.kaderavek@xxxxxxxxx">pavel.kaderavek@xxxxxxxxx</a>&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; wrote:<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; Hi,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; some time ago, we submitted two patches regarding CST<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; branch.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; We<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; are<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; not<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; sure if we should wait for some additional comment from<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; your<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; side,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; or<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; we can<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; continue with introducing further changes in the code.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; Next step would be a splitting of the relaxation equation<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; so<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; that<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; contribution to the relaxation due to the individual types<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; of<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; interaction<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; (dipole-dipole, CSA) can be calculated separately.<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; Regars,<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt; Pavel, Petr<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;<br>
&gt;<br>
</div></div></blockquote></div><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00036" href="msg00036.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00001" href="msg00001.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00019" href="msg00019.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Pavel Kaderavek</li></ul></li>
<li><strong><a name="00020" href="msg00020.html">Re: CST branch</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Nov 30 18:40:16 2010</div>  
</body>
</html>
