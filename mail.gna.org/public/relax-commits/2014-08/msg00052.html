<!-- MHonArc v2.6.18 -->
<!--X-Subject: r24918 &#45; /branches/R1_fitting/specific_analyses/relax_disp/data.py -->
<!--X-From-R13: gyvaargNaze&#45;erynk.pbz -->
<!--X-Date: Sat, 02 Aug 2014 15:27:41 +0200 -->
<!--X-Message-Id: E1XDZLZ&#45;00061K&#45;E1@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r24918 - /branches/R1_fitting/specific_analyses/relax_disp/data.py -- August 02, 2014 - 15:27</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r24918 - /branches/R1_fitting/specific_analyses/relax_disp/data.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00052" class="tabs">Index by Date</a> | <a href="threads.html#00052" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00051.html">Date Prev</a>] [<a href="msg00053.html">Date Next</a>] [<a href="msg00051.html">Thread Prev</a>] [<a href="msg00053.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Sat, 02 Aug 2014 13:27:41 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00052.html">E1XDZLZ-00061K-E1@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>tlinnet</strong> on August 02, 2014 - 15:27:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: tlinnet
Date: Sat Aug  2 15:27:40 2014
New Revision: 24918

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=24918&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=24918&amp;view=rev</a>
Log:
Modified the warning and error messages beeing raised when calling 
return_r1_data().

Now warnings is raised if no R1 data is available. An error is raised if the 
R1rho model is expected to have R1 data, and it is not available.

That makes systemtest: Relax_disp.test_r1rho_kjaergaard_missing_r1() fail, 
which is the expected behaviour.

sr #3135(<a  rel="nofollow" href="https://gna.org/support/?3135">https://gna.org/support/?3135</a>): Optimisation of the R1 relaxation 
rate for the off-resonance R1rho relaxation dispersion models.
bug #21788(<a  rel="nofollow" href="https://gna.org/bugs/?21788">https://gna.org/bugs/?21788</a>): Only Warning is raised for missing 
loading R1 relaxation rate for the off-resonance R1rho relaxation dispersion 
models.

Modified:
    branches/R1_fitting/specific_analyses/relax_disp/data.py

Modified: branches/R1_fitting/specific_analyses/relax_disp/data.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/R1_fitting/specific_analyses/relax_disp/data.py?rev=24918&amp;r1=24917&amp;r2=24918&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/R1_fitting/specific_analyses/relax_disp/data.py?rev=24918&amp;r1=24917&amp;r2=24918&amp;view=diff</a>
==============================================================================
--- branches/R1_fitting/specific_analyses/relax_disp/data.py    (original)
+++ branches/R1_fitting/specific_analyses/relax_disp/data.py    Sat Aug  2 
15:27:40 2014
@@ -79,7 +79,7 @@
 from pipe_control import value
 import specific_analyses
 from specific_analyses.relax_disp.checks import check_exp_type, 
check_interpolate_offset_cpmg_model, check_mixed_curve_types
-from specific_analyses.relax_disp.variables import EXP_TYPE_CPMG_DQ, 
EXP_TYPE_CPMG_MQ, EXP_TYPE_CPMG_PROTON_MQ, EXP_TYPE_CPMG_PROTON_SQ, 
EXP_TYPE_CPMG_SQ, EXP_TYPE_CPMG_ZQ, EXP_TYPE_DESC_CPMG_DQ, 
EXP_TYPE_DESC_CPMG_MQ, EXP_TYPE_DESC_CPMG_PROTON_MQ, 
EXP_TYPE_DESC_CPMG_PROTON_SQ, EXP_TYPE_DESC_CPMG_SQ, EXP_TYPE_DESC_CPMG_ZQ, 
EXP_TYPE_DESC_R1RHO, EXP_TYPE_LIST, EXP_TYPE_LIST_CPMG, EXP_TYPE_LIST_R1RHO, 
EXP_TYPE_R1RHO, MODEL_B14, MODEL_B14_FULL, MODEL_DPL94, MODEL_LIST_MMQ, 
MODEL_LIST_NUMERIC_CPMG, MODEL_LIST_R1RHO, MODEL_LIST_R1RHO_FULL, MODEL_MP05, 
MODEL_NS_R1RHO_2SITE, MODEL_PARAMS, MODEL_R2EFF, MODEL_TAP03, MODEL_TP02, 
PARAMS_R20
+from specific_analyses.relax_disp.variables import EXP_TYPE_CPMG_DQ, 
EXP_TYPE_CPMG_MQ, EXP_TYPE_CPMG_PROTON_MQ, EXP_TYPE_CPMG_PROTON_SQ, 
EXP_TYPE_CPMG_SQ, EXP_TYPE_CPMG_ZQ, EXP_TYPE_DESC_CPMG_DQ, 
EXP_TYPE_DESC_CPMG_MQ, EXP_TYPE_DESC_CPMG_PROTON_MQ, 
EXP_TYPE_DESC_CPMG_PROTON_SQ, EXP_TYPE_DESC_CPMG_SQ, EXP_TYPE_DESC_CPMG_ZQ, 
EXP_TYPE_DESC_R1RHO, EXP_TYPE_LIST, EXP_TYPE_LIST_CPMG, EXP_TYPE_LIST_R1RHO, 
EXP_TYPE_R1RHO, MODEL_B14, MODEL_B14_FULL, MODEL_DPL94, MODEL_LIST_MMQ, 
MODEL_LIST_NUMERIC_CPMG, MODEL_LIST_R1RHO, MODEL_LIST_R1RHO_FULL, 
MODEL_LIST_R1RHO_W_R1, MODEL_MP05, MODEL_NS_R1RHO_2SITE, MODEL_PARAMS, 
MODEL_R2EFF, MODEL_TAP03, MODEL_TP02, PARAMS_R20
 from stat import S_IRWXU, S_IRGRP, S_IROTH
 from os import chmod, sep
 
@@ -4032,9 +4032,29 @@
 
     # Check for the presence of data.
     if not hasattr(cdp, 'ri_ids'):
+        warn_text = &quot;No R1 relaxation data has been loaded.  Setting it to 
0.0.  This is essential for the proper handling of offsets in off-resonance 
R1rho experiments.&quot;
+        error_text = &quot;No R1 relaxation data has been loaded.  This is 
essential for the proper handling of offsets in off-resonance R1rho 
experiments.&quot;
         if has_r1rho_exp_type():
-            warn(RelaxWarning(&quot;No R1 relaxation data has been loaded.  This 
is essential for the proper handling of offsets in off-resonance R1rho 
experiments.&quot;))
-        return 0.0 * r1
+            # Spin loop.
+            for si in range(spin_num):
+                # Assign spin.
+                spin=spins[si]
+
+                # For all R1rho models using R1, raise an error, if R1 has 
not been loaded.
+                if spin.model in MODEL_LIST_R1RHO_W_R1:
+                    raise RelaxError(error_text)
+
+                # For all models not listed in R1rho models, raise a 
warning, and set 0.0 as value.
+                else:
+                    warn(RelaxWarning(warn_text))
+                    r1[si] = 0.0 * r1[si]
+
+        # For all non-R1rho experiments, return 0.0.
+        else:
+            r1 = 0.0 * r1
+
+        # Return r1
+        return r1
 
     # Loop over the Rx IDs.
     flags = [False]*field_count



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Aug 04 16:40:02 2014</div>  
</body>
</html>
