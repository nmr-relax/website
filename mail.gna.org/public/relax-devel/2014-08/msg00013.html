<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r24865 &#45; /branches/r1rho_plotting/test_suite/system_tests/relax_disp.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 31 Jul 2014 14:56:35 +0200 -->
<!--X-Message-Id: CAED9pY_&#45;A0Oo=zFXrHhHP4QDZbDb6HOn1R6gKNtULkodJJ&#45;jqQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XCbed&#45;0006KP&#45;FM@subversion.gna.org -->
<!--X-Reference: CAED9pY&#45;1AjKATD_w7xU4sMCT&#45;T3yjrVLFSnHoecSapAyba2q=Q@mail.gmail.com -->
<!--X-Reference: CA+CBx2MjZ1Yvci9=3X&#45;nPKCrQtP6_49M=+&#45;N4rH_GgNZWgb_Ng@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r24865 - /branches/r1rho_plotting/test_suite/system_tests/relax_disp.py -- July 31, 2014 - 14:56</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r24865 - /branches/r1rho_plotting/test_suite/system_tests/relax_disp.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00013" class="tabs">Index by Date</a> | <a href="threads.html#00013" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00012.html">Date Prev</a>] [<a href="msg00014.html">Date Next</a>] [<a href="msg00008.html">Thread Prev</a>] [<a href="msg00009.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 31 Jul 2014 14:56:04 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=PG801ZkLWt4nfBB6bkvXryr8uCABEA9GnSUm07uRCkY=; b=SS2+psPqYkRXtFhUv8/HE8c3BVFjG22P7K7/6j7NFibAWkHJyT1fm7u9alwRMFk+O1 BHrZq0evXjhIZfmV0OQq7olZou0igqKotTG5YbQSmbddbHO9goVc1u0aNQPjJHpf7zON Y+y26e9t3biX5HDDs64fmgBLU6Py+0cz1M/pKlfld2GM3sZGY000dF73y+U3e8nHAejG ObFvapcfXuFIOB3Oq9s2Mqf6og7ilfPAsnz0XwuJ5Mkp+Guhku4AALzx6lg/B//zfvEQ rLWhQ8bf6UzWNI0E+crlr/mwQw536mtxc88a93l0XC6mCerlCHLqObnda4bC6nM3Tyqj 4UYQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY_-A0Oo=zFXrHhHP4QDZbDb6HOn1R6gKNtULkodJJ-jqQ@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XCbed-0006KP-FM@subversion.gna.org&gt; &lt;CAED9pY-1AjKATD_w7xU4sMCT-T3yjrVLFSnHoecSapAyba2q=Q@mail.gmail.com&gt; &lt;CA+CBx2MjZ1Yvci9=3X-nPKCrQtP6_49M=+-N4rH_GgNZWgb_Ng@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on July 31, 2014 - 14:56:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">The offset is handled exactly in the same way as for the R1rho data -
the theory is identical
(<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.scm/22521/focus=6564">http://thread.gmane.org/gmane.science.nmr.relax.scm/22521/focus=6564</a>).
However we don't have a model for this yet
(<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.scm/22521/focus=6563">http://thread.gmane.org/gmane.science.nmr.relax.scm/22521/focus=6563</a>).
And the user function for the pi pulse parameters is missing.
Therefore there is not much point setting up such a test yet.

Cheers,

Edward


On 31 July 2014 12:12, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I added the systemtest, but I am about to delete it again.

I am not sure how to handle &quot;offset&quot; data for CPMG experiments.

I am thinking that I will rather test in
specific_analyses/relax_disp/data.py plot_disp_curves()

to see if it is a CPMG model, raise a warning, and pass out of the
function without doing anything.

What do you think?

Best
Troels

2014-07-31 9:43 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

Is the text file checking temporarily commented out in this test?

Cheers,

Edward


On 30 July 2014 23:43,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Wed Jul 30 23:43:22 2014
New Revision: 24865

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=24865&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=24865&amp;view=rev</a>
Log:
Added systemtest Relax_disp.test_kteilum_fmpoulsen_makke_check_graphs() 
to check all possible combinations of dispersion plotting.

sr #3124(<a  rel="nofollow" href="https://gna.org/support/?3124">https://gna.org/support/?3124</a>): Grace graphs production for 
R1rho analysis with R2_eff as function of Omega_eff.
sr #3138(<a  rel="nofollow" href="https://gna.org/support/?3138">https://gna.org/support/?3138</a>): Interpolating theta through 
spin-lock offset [Omega], rather than spin-lock field strength [w1].

Modified:
    branches/r1rho_plotting/test_suite/system_tests/relax_disp.py

Modified: branches/r1rho_plotting/test_suite/system_tests/relax_disp.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/r1rho_plotting/test_suite/system_tests/relax_disp.py?rev=24865&amp;r1=24864&amp;r2=24865&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/r1rho_plotting/test_suite/system_tests/relax_disp.py?rev=24865&amp;r1=24864&amp;r2=24865&amp;view=diff</a>
==============================================================================
--- branches/r1rho_plotting/test_suite/system_tests/relax_disp.py       
(original)
+++ branches/r1rho_plotting/test_suite/system_tests/relax_disp.py       
Wed Jul 30 23:43:22 2014
@@ -4108,6 +4108,114 @@
         self.assertAlmostEqual(spin.chi2/1000, 162.511988511609/1000, 3)


+    def test_kteilum_fmpoulsen_makke_check_graphs(self):
+        &quot;&quot;&quot;Check of all possible dispersion graphs from optimisation of 
Kaare Teilum, Flemming M Poulsen, Mikael Akke 2006 &quot;acyl-CoA binding 
protein&quot; CPMG data to the CR72 dispersion model.
+
+        This uses the data from paper at 
U{<a  rel="nofollow" href="http://dx.doi.org/10.1073/pnas.0509100103}">http://dx.doi.org/10.1073/pnas.0509100103}</a>.  This is CPMG data with a 
fixed relaxation time period.  Experiment in 0.48 M GuHCl (guanidine 
hydrochloride).
+
+        Figure 3 shows the ln( k_a [s^-1]) for different concentrations 
of GuHCl. The precise values are:
+
+          - [GuHCL][M] ln(k_a[s^-1]) k_a[s^-1]
+          - 0.483 0.89623903 2.4503699912708878
+          - 0.545 1.1694838
+          - 0.545 1.1761503
+          - 0.622 1.294
+          - 0.669 1.5176493
+          - 0.722 1.6238791
+          - 0.813 1.9395758
+          - 1.011 2.3558415 10.547000429321157
+        &quot;&quot;&quot;
+
+        # Base data setup.
+        model = 'TSMFK01'
+        expfolder = &quot;acbp_cpmg_disp_048MGuHCl_40C_041223&quot;
+        self.setup_kteilum_fmpoulsen_makke_cpmg_data(model=model, 
expfolder=expfolder)
+
+        # Alias the spins.
+        res61L = cdp.mol[0].res[0].spin[0]
+
+        # The R20 keys.
+        r20_key1 = generate_r20_key(exp_type=EXP_TYPE_CPMG_SQ, 
frq=599.89086220e6)
+
+        # Set the initial parameter values.
+        res61L.r2a = {r20_key1: 8.0}
+        res61L.dw = 6.5
+        res61L.k_AB = 2.5
+
+        # Low precision optimisation.
+        self.interpreter.minimise(min_algor='simplex', line_search=None, 
hessian_mod=None, hessian_type=None, func_tol=1e-05, grad_tol=None, 
max_iter=1000, constraints=True, scaling=True, verbosity=1)
+
+        # Start testing all possible combinations of graphs.
+        y_axis_types = [Y_AXIS_R2_EFF, Y_AXIS_R2_R1RHO]
+        x_axis_types = [X_AXIS_DISP, X_AXIS_THETA, X_AXIS_W_EFF]
+        interpolate_types = [INTERPOLATE_DISP, INTERPOLATE_OFFSET]
+
+        # Write to temp folder.
+        result_dir_name = ds.tmpdir
+        result_folders = [model]
+        spin_id = &quot;:61@N&quot;
+
+        # Loop through all possible combinations of y_axis, x_axis and 
interpolation.
+        data_path = status.install_path + 
sep+'test_suite'+sep+'shared_data'+sep+'dispersion'+sep+'KTeilum_FMPoulsen_MAkke_2006'+sep+expfolder+sep+'check_graphs'
+
+        for result_folder in result_folders:
+            # Initial counter per graph, per model.
+            i = 1
+            for y_axis in y_axis_types:
+                for x_axis in x_axis_types:
+                    for interpolate in interpolate_types:
+                        # Determine file name:
+                        file_name_ini = 
return_grace_file_name_ini(y_axis=y_axis, x_axis=x_axis, 
interpolate=interpolate)
+
+                        # Make the file name.
+                        file_name = &quot;%s%s.agr&quot; % (file_name_ini, 
spin_id.replace('#', '_').replace(':', '_').replace('@', '_'))
+
+                        # Set result folder.
+                        dir_folder = &quot;%i&quot;%(i)
+
+                        # Write the curves.
+                        dir = 
result_dir_name+sep+result_folder+sep+dir_folder
+                        print(&quot;Plotting combination of %s, %s, 
%s&quot;%(y_axis, x_axis, interpolate))
+                        
self.interpreter.relax_disp.plot_disp_curves(dir=dir, y_axis=y_axis, 
x_axis=x_axis, interpolate=interpolate, force=True)
+
+                        # Get the file path.
+                        file_path = get_file_path(file_name, dir)
+
+                        # Test the plot file exists.
+                        print(&quot;Testing file access to graph: 
%s&quot;%file_path)
+                        self.assert_(access(file_path, F_OK))
+
+                        # Now open, and compare content, line by line.
+                        file_prod = open(file_path)
+                        lines_prod = file_prod.readlines()
+                        file_prod.close()
+
+                        # Define file to compare against.
+                        #dir_comp = 
data_path+sep+result_folder+sep+dir_folder
+                        #file_path_comp = get_file_path(file_name, 
dir_comp)
+                        #file_comp = open(file_path_comp)
+                        #lines_comp = file_comp.readlines()
+                        #file_comp.close()
+
+                        ## Assert number of lines is equal.
+                        #self.assertEqual(len(lines_prod), 
len(lines_comp))
+                        #for j in range(len(lines_prod)):
+                        #    # Make the string test
+                        #    first_char = lines_prod[j][0]
+                        #    if first_char in [&quot;@&quot;, &quot;&amp;&quot;]:
+                        #        self.assertEqual(lines_prod[j], 
lines_comp[j])
+                        #    else:
+                        #        # Split string in x, y, error.
+                        #        # The error would change per run.
+                        #        x_prod, y_prod, y_prod_err = 
lines_prod[j].split()
+                        #        x_comp, y_comp, y_comp_err = 
lines_comp[j].split()
+                        #        self.assertAlmostEqual(float(x_prod), 
float(x_comp))
+                        #        self.assertAlmostEqual(float(y_prod), 
float(y_comp))
+
+                        # Add to counter.
+                        i += 1
+
+
     def test_kteilum_fmpoulsen_makke_cpmg_data_048m_guhcl_to_cr72(self):
         &quot;&quot;&quot;Optimisation of Kaare Teilum, Flemming M Poulsen, Mikael Akke 
2006 &quot;acyl-CoA binding protein&quot; CPMG data to the CR72 dispersion model.



_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00006" href="msg00006.html">Re: r24865 - /branches/r1rho_plotting/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00008" href="msg00008.html">Re: r24865 - /branches/r1rho_plotting/test_suite/system_tests/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Aug 01 00:00:18 2014</div>  
</body>
</html>
