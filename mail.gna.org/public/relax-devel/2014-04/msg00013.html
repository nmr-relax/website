<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: Weird performance of grid search and order of spectrum.error_analysis -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 22 Apr 2014 11:39:39 +0200 -->
<!--X-Message-Id: CAED9pY_8KpfNPfbKqDpaGKZxGDBQnGMUJm5O+=qKN71KoPJNtA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CA+CBx2MysLJo=9kaY13Tj_Zy4bODLLbO&#45;taK0qa7y6JxJ&#45;WWSg@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;7MD=FoqCuXCUgFCe1Z3tMx5&#45;xAhyRxbLUZBBqYs=WsA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Weird performance of grid search and order of spectrum.error_analysis -- April 22, 2014 - 11:39</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Weird performance of grid search and order of spectrum.error_analysis</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00013" class="tabs">Index by Date</a> | <a href="threads.html#00013" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00012.html">Date Prev</a>] [<a href="msg00014.html">Date Next</a>] [<a href="msg00011.html">Thread Prev</a>] [<a href="msg00012.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 22 Apr 2014 11:38:46 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type; bh=C1HXLHcedNVpFbtES/b8nLRakGbHIZBEYNrog4WTlxk=; b=I8vQ/5ROyI7V40YLlL5rzyOsCWTsrcOy+JGoR6WTasl20i0RwYxcyocN6PNGgw3t0o p9Ftu9iHOrmjz2KwrOdObgS0NgeS9HhQKfGIVs12LWsAFDOdOCYw7WB3+HLhjhKdDnXi O9fqJ8ELjv1qc0WAHfO8thJrpKaHycSy87V9LBSqEs1Se7pnq1Qst4vv/hC8LI+oWTrm inu++3GpNchpq2dQ3gDMKpY9X2JfYHJq5SQ6huPyqPh+iBmpa9iEHPwO43O8VRZxwJwu bhtgNYMgyPHvQhAFs83FxR3zcbJu/cXmcBOyruoLWNsBQjnSM3GPtg6TwDktcGKpNZ8k 37sw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY_8KpfNPfbKqDpaGKZxGDBQnGMUJm5O+=qKN71KoPJNtA@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2MysLJo=9kaY13Tj_Zy4bODLLbO-taK0qa7y6JxJ-WWSg@mail.gmail.com&gt; &lt;CAED9pY-7MD=FoqCuXCUgFCe1Z3tMx5-xAhyRxbLUZBBqYs=WsA@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on April 22, 2014 - 11:39:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

Note that solving this bug might change the
Relax_disp.test_hansen_trunc_data system test.  I can see the same
problem occurring there when I run:

$ ./relax -d --gui-tests Relax_disp.test_hansen_trunc_data

and find where the spectrum.error_analysis user function was called.
Therefore maybe a check could be added there as well, as the variance
averaging is then over 2 sets of 3 replicates:

&quot;&quot;&quot;
relax&gt; spectrum.error_analysis(subset=['500_reference.in',
'500_66.667.in', '500_133.33.in', '500_133.33.in.bis', '500_200.in',
'500_266.67.in', '500_333.33.in', '500_400.in', '500_466.67.in',
'500_533.33.in', '500_533.33.in.bis', '500_600.in', '500_666.67.in',
'500_733.33.in', '500_800.in', '500_866.67.in', '500_933.33.in',
'500_933.33.in.bis', '500_1000.in'])
Intensity measure:  Peak heights.
Replicated spectra:  Yes.
All spectra replicated:  No.

Replicated spectra:  ['500_133.33.in', '500_133.33.in.bis']
Standard deviation:  132.165166899

Replicated spectra:  ['500_533.33.in', '500_533.33.in.bis']
Standard deviation:  139.49874291

Replicated spectra:  ['500_933.33.in', '500_933.33.in.bis']
Standard deviation:  103.633969846

Variance averaging over all spectra.
Standard deviation for all spins:  126.05227793927868

relax&gt; spectrum.error_analysis(subset=['800_reference.in',
'800_66.667.in', '800_133.33.in', '800_133.33.in.bis', '800_200.in',
'800_266.67.in', '800_333.33.in', '800_400.in', '800_466.67.in',
'800_533.33.in', '800_533.33.in.bis', '800_600.in', '800_666.67.in',
'800_733.33.in', '800_800.in', '800_866.67.in', '800_933.33.in',
'800_933.33.in.bis', '800_1000.in'])
Intensity measure:  Peak heights.
Replicated spectra:  Yes.
All spectra replicated:  No.

Replicated spectra:  ['800_133.33.in', '800_133.33.in.bis']
Standard deviation:  234.398086258

Replicated spectra:  ['800_533.33.in', '800_533.33.in.bis']
Standard deviation:  300.176560374

Replicated spectra:  ['800_933.33.in', '800_933.33.in.bis']
Standard deviation:  258.534014697

Variance averaging over all spectra.
Standard deviation for all spins:  170.37263779019497
&quot;&quot;&quot;

Here I've deleted the debugging printouts.  For the first set, the
variance averaging is:

</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">sqrt((132.165166899**2 + 139.49874291**2 + 103.633969846**2) / 3)
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">126.0522779391583

For the second set:

</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">sqrt((234.398086258**2 + 300.176560374**2 + 258.534014697**2) / 3)
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">265.7619655473215

I don't think you'll have many problems debugging this one!  The hard
part will be updating the dispersion GUI tutorial in the manual as
those numbers will slightly change.  I'll wait for the bug to be
closed first though before working on that.

Cheers,

Edward




On 22 April 2014 10:13, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

This third thread at
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/5302">http://thread.gmane.org/gmane.science.nmr.relax.devel/5302</a> will cover
the error analysis.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Another thing that worries me, is the order how you perform the error 
analysis:
If I set:
********************************************
relax&gt; spectrum.replicated(spectrum_ids=['Z_A1', 'Z_A15'])
relax&gt; spectrum.replicated(spectrum_ids=['Z_B1', 'Z_B18'])
relax&gt; spectrum.error_analysis(subset=['Z_A0', 'Z_A1', 'Z_A2', 'Z_A3',
'Z_A4', 'Z_A5', 'Z_A6', 'Z_A7', 'Z_A8', 'Z_A9', 'Z_A10', 'Z_A11',
'Z_A12', 'Z_A13', 'Z_A14', 'Z_A15', 'Z_A16'])
Intensity measure:  Peak heights.
Replicated spectra:  Yes.
All spectra replicated:  No.

Replicated spectra:  ['Z_A1', 'Z_A15']
Standard deviation:  1900.52054868

Variance averaging over all spectra.
Standard deviation for all spins:  1900.5205486798784

relax&gt; spectrum.error_analysis(subset=['Z_B0', 'Z_B1', 'Z_B2', 'Z_B3',
'Z_B4', 'Z_B5', 'Z_B6', 'Z_B7', 'Z_B8', 'Z_B9', 'Z_B10', 'Z_B11',
'Z_B12', 'Z_B13', 'Z_B14', 'Z_B15', 'Z_B16', 'Z_B17', 'Z_B18'])
Intensity measure:  Peak heights.
Replicated spectra:  Yes.
All spectra replicated:  No.

Replicated spectra:  ['Z_B1', 'Z_B18']
Standard deviation:  5629.56857527

Variance averaging over all spectra.
Standard deviation for all spins:  2562.7669744222535
*************************
relax&gt; spectrum.replicated(spectrum_ids=['Z_A1', 'Z_A15'])
relax&gt; spectrum.replicated(spectrum_ids=['Z_B1', 'Z_B18'])

relax&gt; spectrum.error_analysis(subset=['Z_B0', 'Z_B1', 'Z_B2', 'Z_B3',
'Z_B4', 'Z_B5', 'Z_B6', 'Z_B7', 'Z_B8', 'Z_B9', 'Z_B10', 'Z_B11',
'Z_B12', 'Z_B13', 'Z_B14', 'Z_B15', 'Z_B16', 'Z_B17', 'Z_B18'])
Intensity measure:  Peak heights.
Replicated spectra:  Yes.
All spectra replicated:  No.

Replicated spectra:  ['Z_B1', 'Z_B18']
Standard deviation:  5629.56857527

Variance averaging over all spectra.
Standard deviation for all spins:  5629.5685752716654

relax&gt; spectrum.error_analysis(subset=['Z_A0', 'Z_A1', 'Z_A2', 'Z_A3',
'Z_A4', 'Z_A5', 'Z_A6', 'Z_A7', 'Z_A8', 'Z_A9', 'Z_A10', 'Z_A11',
'Z_A12', 'Z_A13', 'Z_A14', 'Z_A15', 'Z_A16'])
Intensity measure:  Peak heights.
Replicated spectra:  Yes.
All spectra replicated:  No.

Replicated spectra:  ['Z_A1', 'Z_A15']
Standard deviation:  1900.52054868

Variance averaging over all spectra.
Standard deviation for all spins:  5386.8126508475143
*************************
The difference is:
Standard deviation for all spins:  2562.7669744222535
or
Standard deviation for all spins:  5386.8126508475143
</pre></blockquote><pre style="margin: 0em;">

I knew we should have had better system test coverage of this!  The
problem was probably introduced when I added the subset argument to
the spectrum.error_analysis user function
(<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.scm/17239">http://thread.gmane.org/gmane.science.nmr.relax.scm/17239</a>) for the
relaxation dispersion analysis.

It should be very easy for you to create a system test for this!  Note
that the result of the &quot;variance averaging over all spectra&quot; should be
the same as the single replicate standard deviation (for each subset).
 Then have a go and see if you can find where the bug in relax is ;)
I would also suggest creating a bug report for the problem.  Once you
have this sorted out, I might release relax 3.2.0 and tell everyone
that they should upgrade if they are performing dispersion analyses.

Cheers,

Edward
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00008" href="msg00008.html">Weird performance of grid search and order of spectrum.error_analysis</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00011" href="msg00011.html">Re: Weird performance of grid search and order of spectrum.error_analysis</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Apr 22 12:40:13 2014</div>  
</body>
</html>
