<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: The singleton design pattern for the old 'self.relax.data' data	structure. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 09 Mar 2007 08:21:26 +0100 -->
<!--X-Message-Id: 7f080ed10703082320s8ea00b1x70cce99808dc4cfa@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7f080ed10703070006s309a1e1do38e621f48d8f6d9e@mail.gmail.com -->
<!--X-Reference: 1173263918.8066.238.camel@mrspell -->
<!--X-Reference: 7f080ed10703071903nbadfa52jbf89b8c137e62e09@mail.gmail.com -->
<!--X-Reference: 1173348794.8066.249.camel@mrspell -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: The singleton design pattern for the old 'self.relax.data' data	structure. -- March 09, 2007 - 08:21</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: The singleton design pattern for the old 'self.relax.data' data	structure.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00033" class="tabs">Index by Date</a> | <a href="threads.html#00033" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00032.html">Date Prev</a>] [<a href="msg00034.html">Date Next</a>] [<a href="msg00037.html">Thread Prev</a>] [<a href="msg00020.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Chris MacRaild&quot; &lt;c.a.macraild@xxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 9 Mar 2007 18:20:43 +1100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: a=rsa-sha1; c=relaxed/relaxed; d=gmail.com; s=beta;	h=domainkey-signature:received:received:message-id:date:from:sender:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references:x-google-sender-auth;	b=mcPy0F+FrZnKx7mGuz1qhF0DaDNw65Qj/3cq247RC8SD0oc9EAzg+jbufqt2yimo5QMLpsjIrROB+rVvGkiNKEK3k9u3PaY7F6+G2rsP3qq68gzHbtx5OLKUAphMqin1OpWmikRy3gR6FHGrZfoa6Onj4j+zVDkFVSgqP1/vHe8=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00033.html">7f080ed10703082320s8ea00b1x70cce99808dc4cfa@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00012.html">7f080ed10703070006s309a1e1do38e621f48d8f6d9e@mail.gmail.com</a>&gt;	&lt;<a href="msg00013.html">1173263918.8066.238.camel@mrspell</a>&gt;	&lt;<a href="msg00014.html">7f080ed10703071903nbadfa52jbf89b8c137e62e09@mail.gmail.com</a>&gt;	&lt;<a href="msg00027.html">1173348794.8066.249.camel@mrspell</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on March 09, 2007 - 08:21:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>On 3/8/07, Chris MacRaild &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">On Thu, 2007-03-08 at 14:03 +1100, Edward d'Auvergne wrote:
&gt; On 3/7/07, Chris MacRaild &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:
&gt; &gt; On Wed, 2007-03-07 at 19:06 +1100, Edward d'Auvergne wrote:
&gt; &gt;
&gt; &gt; &gt; Hi,
&gt; &gt; &gt;
&gt; &gt; &gt; After careful thought about design patterns, I've decided to try to
&gt; &gt; &gt; use the singleton pattern for the old 'self.relax.data' data
&gt; &gt; &gt; structure.  See <a  href="http://en.wikipedia.org/wiki/Singleton_pattern">http://en.wikipedia.org/wiki/Singleton_pattern</a> for
&gt; &gt; &gt; more information about this design pattern.  I'll try to use the
&gt; &gt; &gt; second simple example under the heading 'Python Borg pattern'.  The
&gt; &gt; &gt; benefit of this pattern is that each module can use the code:
&gt; &gt; &gt;
&gt; &gt; &gt; from data import Data
&gt; &gt; &gt; relax_data = Data()
&gt; &gt; &gt;
&gt; &gt; &gt; As Data will be a singleton if two modules used by relax instantiate
&gt; &gt; &gt; the Data class then the global 'relax_data' in both modules will be
&gt; &gt; &gt; the same instance.  Therefore if a method from the
&gt; &gt; &gt; 'special_fns.model_free' module modifies the data structure, all the
&gt; &gt; &gt; other relax modules using the singleton will see the changes.  The
&gt; &gt; &gt; benefit of this pattern is that the data structure is similar in
&gt; &gt; &gt; concept to a global variable but only modules utilising it will have
&gt; &gt; &gt; it in one of their namespaces.  Also 'self.relax.data' will not need
&gt; &gt; &gt; to be passed around inside the program, simplifying the code.  What do
&gt; &gt; &gt; you think of the idea?
&gt; &gt;
&gt; &gt; One issue here, identified on the wikipedia page, is that __init__() is
&gt; &gt; called for each call of Singleton(). Therefore all of the standard
&gt; &gt; __init__() stuff - inialising variables and empty containers - will
&gt; &gt; happen every time the Singleton instance is sought. This is clearly not
&gt; &gt; what we want. Ofcourse there are many ways around that by cleverly
&gt; &gt; hiding the initialisation stuff, but its starting to look like a complex
&gt; &gt; solution to what should be a simple problem.
&gt;
&gt; I am aware of the execution of __init__() but this won't be an issue
&gt; in the final construction of the relax data storage object.  The
&gt; object will be multilayered.  The first layer, equivalent to the
&gt; current top level Data class, will be a dictionary type and it's
&gt; __init__() method will be empty.  There may be a few variables
&gt; (current_run, etc.) and methods defined inside this object but these
&gt; will be in the scope of the class rather than the __init__() method.
&gt;
&gt; The second layer will be data containers identified by the keys of the
&gt; top level dictionary type object.  This layer's __init__() method will
&gt; not be called each time.  The current Data.__init__() method will be
&gt; shifted to this layer (actually I'll probably rename Data to
&gt; RunContainer and then create a new Data object).  I'm still unsure but
&gt; I think I'll try to leave all __init__() functions empty and define
&gt; initial variables and objects in the scope of the class, eg:
&gt;
&gt; class RunContainer:
&gt;     # The molecule-residue-spin object.
&gt;     mol = MoleculeList()
&gt;
&gt;     # The diffusion tensor object.
&gt;     diff = DiffContainer()
&gt;
&gt;     # Molecular structure.
&gt;     structure = StructureContainer()
&gt;
&gt;     def __init__():
&gt;         pass
&gt;
&gt;
&gt; The third layer will be data containers for specific data types.  For
&gt; example the diffusion tensor data structure, the Scientific PDB data
&gt; structures (and future molecular structure data structures), and the
&gt; molecule-residue-spin multi-object structure (each of these three
&gt; layers will consist of two objects - a list type object whereby each
&gt; element is a specific data storage object).
&gt;
&gt;
&gt; &gt; Something like:
&gt; &gt;
&gt; &gt; class Data:
&gt; &gt;     ...
&gt; &gt; Data = Data()
&gt; &gt;
&gt; &gt; in the data module, then everywhere else:
&gt; &gt;
&gt; &gt; from data import Data as relax_data
&gt; &gt;
&gt; &gt;
&gt; &gt; By rebinding the name 'Data' with an instance of the class, we
&gt; &gt; effectively prevent accidental creation of additional instances, and the
&gt; &gt; import makes that instance availible wherever we need it.
&gt;
&gt; I do think that the relax data storage object is the absolute ideal
&gt; situation for the implementation of the Singleton design pattern.
&gt; There is only one instance of this object ever and all parts of relax
&gt; should worship it - relax is designed around this object.  It is the
&gt; pillar that props up all of the program.  And the relax saved stated
&gt; is a copy of this object.
&gt;
&gt; The Singleton construction is also very powerful for relax scripts.
&gt; It allows the script access to the data storage object without needing
&gt; to pass the object to the script.  Importantly it also allows the unit
&gt; test framework access to the structure without invoking relax itself.
&gt; And it is also very easy to implement cleanly - just have a look at
&gt; the current 1.3 line code base.  The relax data storage object is now
&gt; implemented as a Singleton and almost all of the relax test suite
&gt; passes.  The only failure is in one functional test whereby a saved
&gt; program state is loaded - this is because the state.load() user
&gt; function is not working yet.</pre><br>
<pre style="margin: 0em;">I agree with all of this, I'm just pointing out that we can get the
desired behaviour out of a very simple idiom, without having to rely on
a more complex implimentation of the design pattern. Admittedly it's not
that complex, but we should always be aiming for the simplest possible.</pre><br>
<pre style="margin: 0em;">Alex Martelli has written some good stuff on these on these topics:
<a  href="http://www.aleax.it/python_mat_en.html">http://www.aleax.it/python_mat_en.html</a> and especially
<a  href="http://www.aleax.it/Python/5ep.html">http://www.aleax.it/Python/5ep.html</a> [not coincidentally, the credit for
the idiom I suggest also goes to Martelli, this time the Python
Cookbook]
</pre></blockquote><pre style="margin: 0em;"><br>I've had a read of <a  href="http://www.aleax.it/Python/5ep.html">http://www.aleax.it/Python/5ep.html</a> and all that is
is Alex bagging the singleton and instead presenting his alternative,
the Python Borg pattern.  Essentially from the perspective of the
user, you really won't use the objects differently.  If there are two
objects A and B, if they are both singletons then A == B returns true.
If they share the same 'state' as in Alex's Borg pattern then A == B
returns false.  However if they both have the variable x then in both
situations A.x == B.x.</pre><br>
<pre style="margin: 0em;">Now because the top level object is a dictionary type, using the Borg
pattern, A would have different keys to B (the keys are the names of
the data pipes, aka runs).  For our object, the Borg pattern cannot be
used.  Here is a simple example, which can be cut and paste into the
python interpreter, demonstrating the problem with the Borg pattern
with dictionary type objects:</pre><br>
<pre style="margin: 0em;">from types import DictType</pre><br>
<pre style="margin: 0em;">class Borg(DictType):
   __shared_state = {}
   def __init__(self):
       self.__dict__ = self.__shared_state</pre><br>
<pre style="margin: 0em;">class Container:
   x = 1</pre><br>
<pre style="margin: 0em;">A = Borg()
B = Borg()
A['y'] = Container
print A
print B
print A['y'].x
print B['y'].x</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00012" href="msg00012.html">The singleton design pattern for the old 'self.relax.data' data	structure.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re: The singleton design pattern for the old 'self.relax.data' data	structure.</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00014" href="msg00014.html">Re: The singleton design pattern for the old 'self.relax.data' data	structure.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00027" href="msg00027.html">Re: The singleton design pattern for the old 'self.relax.data' data	structure.</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Sat Mar 10 00:40:15 2007</div>  
</body>
</html>
