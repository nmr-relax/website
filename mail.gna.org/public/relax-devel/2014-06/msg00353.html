<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: Finding the eigen values/matrix exponential for higher dimensional data -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNtznvy.pbz> -->
<!--X-Date: Wed, 18 Jun 2014 13:49:56 +0200 -->
<!--X-Message-Id: CA+CBx2P8zFYLe01N4Ps0WtxT1zgXGuo_QgqK2jd=WewOJZabNA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CA+CBx2NwV+mGK+JfDHE8kyz9tRRboH+2Fi2zcDhS8VVotbGa=A@mail.gmail.com -->
<!--X-Reference: CAED9pY_3RqMZ3S3nfnnAGeuBZAHu7E1WGrokJ46mBhtbRZqkBA@mail.gmail.com -->
<!--X-Reference: CAED9pY_rsK710xdbSguw5asqMr=5Jy_OMzW9xghhTf1YSA5J1g@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Finding the eigen values/matrix exponential for higher dimensional data -- June 18, 2014 - 13:49</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Finding the eigen values/matrix exponential for higher dimensional data</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00353" class="tabs">Index by Date</a> | <a href="threads.html#00353" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00352.html">Date Prev</a>] [<a href="msg00354.html">Date Next</a>] [<a href="msg00352.html">Thread Prev</a>] [<a href="msg00354.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 18 Jun 2014 13:49:05 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:in-reply-to:references:from:date:message-id:subject:to :cc:content-type; bh=YaaC0a4Xj+MLXa/M1pT1HKn+kQQ+GC8u4i7tj45jJl0=; b=ixiUc+sAzFqutowQQ2qEcF0Lzm7Ap+GqFcFPPXPnFDFM3E8Z/n+8bhcqnJt2U/+VYO O+y3bXv37oYUS7JF78TchXQYqtrP39oyYDPHBWigHQebKw4Py8kGs+wj0FsVjMdNytrH dhq3se25/kIWdwLH/LbeZZV3yOJ1UC9/AOKPK1QvIG6MbPBSRe3IDk/ngrKUf1aUkxjd bArUDrRGoCGnAjJD/H3ajnEmIAL3DYtA27HLqeuK9w4gihhW5eHVNOkY91Y+vA2i9W69 1eS2wlQmJicdvS1H4we/3LFst1ulwcwBTlfair5MICImQeXlLEpb2fHYr9UcalyvBRx6 ctRQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CA+CBx2P8zFYLe01N4Ps0WtxT1zgXGuo_QgqK2jd=WewOJZabNA@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2NwV+mGK+JfDHE8kyz9tRRboH+2Fi2zcDhS8VVotbGa=A@mail.gmail.com&gt; &lt;<a href="msg00351.html">CAED9pY_3RqMZ3S3nfnnAGeuBZAHu7E1WGrokJ46mBhtbRZqkBA@mail.gmail.com</a>&gt; &lt;CAED9pY_rsK710xdbSguw5asqMr=5Jy_OMzW9xghhTf1YSA5J1g@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on June 18, 2014 - 13:49:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Yup!

Numpy does not have matrix exponential, but scipy does.

But scipy matrix exponential, does not cover multi dimensional data.
And relax should not depend on scipy.

But fortunately, as you have in the modules, matrix exponential can be
computed from eig.

So, the only bottle neck back, is numpy eig, which is in:
lib.linear_algebra.matrix_exponential and
lib.linear_algebra.matrix_power

And that can do multi dimensional data.
So, it should be possible.

Best
Troels



Troels Emtekær Linnet


2014-06-18 13:35 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

You are aware of the lib.linear_algebra.matrix_exponential and
lib.linear_algebra.matrix_power modules right?

Regards,

Edward


On 18 June 2014 13:33, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

If you would like to tackle this one, that would be legendary.  Though
you must decide if it is worth your time.  There are also still a few
things to tidy up for the disp_spin_speed branch to prepare it for
merger.  For your idea, I would suggest considering the following:

1)  Creating a simple timeit script such as in

</pre></blockquote><pre style="margin: 0em;"><a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/test_suite/shared_data/frame_order/timings/">http://svn.gna.org/viewcvs/relax/branches/frame_order_cleanup/test_suite/shared_data/frame_order/timings/</a>
</pre><blockquote class="blockquote"><pre style="margin: 0em;">to show the timing of one function where you loop over NS and NM,
calculating the matrix exponential each time, and one where you do it
all in one operation.  You can get initial matrices by running one of
the system tests in debugging mode and adding a print statement in an
appropriate place, then replicate this matrix over NS and NM.  This
will allow you to debug the multi-matrix exponential calculation.

2)  Before making changes in lib.dispersion, make sure that the system
and unit test coverage is reasonable for each model to be speed up.

3)  Create a profiling script in
test_suite/shared_data/dispersion/profiling so we can measure and see
the improvements.  If the numpy operation is costly, there is a slight
chance that the change will not speed things up.  Point 1) will show
that though.  You've probably seen that the system tests are useless
for seeing your huge speed ups.

If this could be done, I think relax will then be the fastest
dispersion implementation out there.  Unfortunately I don't have the
source code to all software, so I don't know if this would be true.
And relax uses minfx and different optimisation to the competition,
avoiding numerical gradients, so there are many other factors
affecting the speed of relax vs. the rest.

Regards,

Edward



On 18 June 2014 13:00, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">The worst bottleneck for the numerical analysis, is the looping over
</pre></blockquote></blockquote><pre style="margin: 0em;">spins.
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">

For the nmerical models, a propagator that will evolve the
</pre></blockquote></blockquote><pre style="margin: 0em;">magnetization is
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">calculated.

This is the matrix exponential of the matrix R that contains all the
contributions to the evolution, i.e. relaxation, exchange and chemical
shift evolution.
The shape of R, can be (7, 7) or (9,9).

Finding the matrix exponential is done over looping of spins,
and spectrometer frequencies.
NS and NM.

If NS is 100, and NM is 2, maybe R, could get packed to:
(100, 2, 7, 7)

The matrix exponential is:
    # The eigenvalue decomposition.
    W, V = eig(A)

    # Calculate the exact exponential.
    eA = dot(dot(V, diag(exp(W))), inv(V))

But according to:

</pre></blockquote></blockquote><pre style="margin: 0em;"><a  rel="nofollow" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.linalg.eig.html">http://docs.scipy.org/doc/numpy/reference/generated/numpy.linalg.eig.html</a>
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">

This should be possible for an array of matrixes.


#####
Compute the eigenvalues and right eigenvectors of a square array.

Parameters :
a : (..., M, M) array
Matrices for which the eigenvalues and right eigenvectors will be
</pre></blockquote></blockquote><pre style="margin: 0em;">computed
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">Returns :
w : (..., M) array
The eigenvalues, each repeated according to its multiplicity. The
eigenvalues are not necessarily ordered. The resulting array will be
</pre></blockquote></blockquote><pre style="margin: 0em;">always
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">be of complex type. When a is real the resulting eigenvalues will be
</pre></blockquote></blockquote><pre style="margin: 0em;">real
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">(0 imaginary part) or occur in conjugate pairs
v : (..., M, M) array
The normalized (unit “length”) eigenvectors, such that the column
</pre></blockquote></blockquote><pre style="margin: 0em;">v[:,i] is
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">the eigenvector corresponding to the eigenvalue w[i].
Raises :
LinAlgError
If the eigenvalue computation does not converge.

-------
Broadcasting rules apply, see the numpy.linalg documentation for
</pre></blockquote></blockquote><pre style="margin: 0em;">details.
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">

This is implemented using the _geev LAPACK routines which compute the
eigenvalues and eigenvectors of general square arrays.

The number w is an eigenvalue of a if there exists a vector v such that
dot(a,v) = w * v. Thus, the arrays a, w, and v satisfy the equations
dot(a[:,:], v[:,i]) = w[i] * v[:,i] for i \in \{0,...,M-1\}.
------
####

R is:
R = rcpmg_3d(R1A=r10a, R1B=r10b, R2A=R2A_si_mi, R2B=R2B_si_mi, pA=pA,
pB=pB, dw=dw_si_mi, k_AB=k_AB, k_BA=k_BA)

So that would need a new way to expand this, since we have R20 and dw as
specific for spin and frequency.



Troels Emtekær Linnet
_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00354" href="msg00354.html">Re: Finding the eigen values/matrix exponential for higher dimensional data</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00350" href="msg00350.html">Finding the eigen values/matrix exponential for higher dimensional data</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00351" href="msg00351.html">Re: Finding the eigen values/matrix exponential for higher dimensional data</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00352" href="msg00352.html">Re: Finding the eigen values/matrix exponential for higher dimensional data</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Jun 18 14:00:14 2014</div>  
</body>
</html>
