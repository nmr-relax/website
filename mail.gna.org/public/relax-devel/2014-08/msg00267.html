<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r25228 &#45; in /trunk/test_suite/shared_data/curve_fitting/profiling: profiling_relax_fit.py relax_fit.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 25 Aug 2014 11:55:51 +0200 -->
<!--X-Message-Id: CA+CBx2P0Z0V5&#45;ebwPHXu+ezqOVu6zU=0OhmCf2rMyRow6wA_9A@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XLgtx&#45;0005Dc&#45;AH@subversion.gna.org -->
<!--X-Reference: CAED9pY_VWF2t&#45;xQXk9oz_D2wtJ5tpmECOmr84H&#45;KYftVL+LKxw@mail.gmail.com -->
<!--X-Reference: CA+CBx2Nux3PoF&#45;7vQvtcTc5Qs84ingrR+6xRk&#45;ecxVG_+2PdtQ@mail.gmail.com -->
<!--X-Reference: CAED9pY99x3X+yVvbuw1iDcoEPKL5LqJV9F5kOE9v2EDS3Yhf1g@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r25228 - in /trunk/test_suite/shared_data/curve_fitting/profiling: profiling_relax_fit.py relax_fit.py -- August 25, 2014 - 11:55</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r25228 - in /trunk/test_suite/shared_data/curve_fitting/profiling: profiling_relax_fit.py relax_fit.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00267" class="tabs">Index by Date</a> | <a href="threads.html#00267" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00266.html">Date Prev</a>] [<a href="msg00268.html">Date Next</a>] [<a href="msg00265.html">Thread Prev</a>] [<a href="msg00269.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 25 Aug 2014 11:55:00 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type:content-transfer-encoding; bh=9xX1Aepp2wNc2+brqMSqaUC1oyLcvLE92sWFjRAj8wo=; b=TxDjVEL3UIGlMpHCgdD4auN7Ryd+/7m3L2KCWc4sH+QVXWggOFwngCu9FL8IYjnl/x 6vlwlYa8fhW6ooBe13wyFRViZNDwPgJU9eHbEovp7Au78KbLh39u4tQ7NJYvAuGbBc50 NBlyzOy1ulenI68IrtDnvePQG6mUKwOTJnlov+QYOQcT2Hnrbhbc16M2bBgMbALiKWhF euHh0y4KGPYXJ+7x8JxepQKNWwRyFGzcm19g5gUx9mDeNt3FlHi/1UyZQjhTfnmWFf9m DTcCvmCccbDuYAx3jqpn9D13dNcHw7WfUEYeRMwYpmIGou7JnNKtuLXdPn/Eg4NfBoQl SEjQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CA+CBx2P0Z0V5-ebwPHXu+ezqOVu6zU=0OhmCf2rMyRow6wA_9A@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XLgtx-0005Dc-AH@subversion.gna.org&gt; &lt;<a href="msg00258.html">CAED9pY_VWF2t-xQXk9oz_D2wtJ5tpmECOmr84H-KYftVL+LKxw@mail.gmail.com</a>&gt; &lt;<a href="msg00262.html">CA+CBx2Nux3PoF-7vQvtcTc5Qs84ingrR+6xRk-ecxVG_+2PdtQ@mail.gmail.com</a>&gt; &lt;<a href="msg00265.html">CAED9pY99x3X+yVvbuw1iDcoEPKL5LqJV9F5kOE9v2EDS3Yhf1g@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on August 25, 2014 - 11:55:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Edward.

You have already convinced me that there are other options.

What I try to do here, is the give the 'availability' to the user, to
try different methods.

Here one method is: scipy.optimize.leastsq

The user function detailed describes, that this is by scipy.optimize.leastsq.

Anything which comes from that, can be tracked back to this function.

It is the same arguments, that one cannot change the published &quot;model
function&quot; in dispersion, but they stay as they are published.

Best
Troels


2014-08-25 11:43 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

The scipy.optimize.leastsq() function contained a fatal bug back in
2003.  I reported it and it was not fixed the last time I checked,
probably around 2008.  I wrote minfx to replace scipy.optimize due to
the fatal bugs present in all 3 optimisation algorithms available back
in 2003 (Levenberg-Marquardt, Nelder-Mead simplex, and one other).
Using MINPACK means that they have changed the code for the LM
algorithm, but due to the disregard the developers had for fixing
fatal bugs back in the early days, there is not much someone can say
to convince me that the current code is also not problematic.  Showing
that scipy.optimize.leastsq() finds the correct result does not
disprove this.  The fatal failures occur rarely and hence normally you
don't see a problem.  But when the failure occurs, in case you are
carefully checking you will never know.  This is standard for
optimisation bugs, for example the fatal bug in Modelfree4 that I
fixed and was released as version 4.20
(<a  rel="nofollow" href="http://www.palmer.hs.columbia.edu/software/modelfree.html">http://www.palmer.hs.columbia.edu/software/modelfree.html</a>).  This bug
was not seen in 300+ publications from 1991 to 2006 (over 15 years),
despite it affecting all these published results!

Minfx is far more extensive and complete when compared to
scipy.optimize.  And it is tested in the relax test suite.  The only
feature scipy.optimize has that minfx does not is that it calls
scipy.integrate.quadpack for numerical gradient estimates.  But
deriving these yourself is basic.  For example using Quickmath, open
<a  rel="nofollow" href="http://www.quickmath.com/webMathematica3/quickmath/calculus/differentiate/advanced.jsp">http://www.quickmath.com/webMathematica3/quickmath/calculus/differentiate/advanced.jsp</a>.
Set the equation to:

I*exp(-R*t)

Set the variables to I first, then the differentiate button will tell
you the df/dI partial derivative.  Set the variable to R,
differentiate, then the result is the df/dR partial derivative.  The
vector [df/dI, df/dR] is the gradient.  The Hessian is simple, just
set the variables to [I, I], then [I, R], then [R, I], then [R, R].
Put the result into a matrix and you have the Hessian.  I can't
emphasis enough how basic these equations and solution are.

Anyway, the optimisation solution in relax is minfx, not
scipy.optimize.  All algorithms in scipy are available in minfx.  And
the scipy ones have never been faster than the minfx ones.  The
MINPACK LM algorithm might be slightly faster than the minfx LM
algorithm, but this is not the reason for the speed ups you see!

Regards,

Edward

On 25 August 2014 11:06, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

This post continues from:
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/6814">http://thread.gmane.org/gmane.science.nmr.relax.devel/6814</a>

As I wrote in this post, the new user function:
&quot;relax_disp.r2eff_estimate()&quot;

gives freedom to the user to try other algorithms.
Here scipy.optimize.leastsq which should be (or is) a well known
option in the python community for minimisation.

Did you find errors in MINPACK or in scipy ?

Best
Troels


2014-08-25 10:13 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

You should note that the 20x speed up is due to the change in
optimisation algorithm rather than scipy vs. minfx vs. MINPACK.  The
reason I wrote minfx is that I started with scipy optimisation but
found all implemented algorithms contained fatal bugs.  This was not
fixed for years after I reported it, and I don't know if the code had
changed since 2003 when I looked into it.  Anyway a scipy optimisation
solution is incompatible with the minfx optimisation solution in
relax.  If you derive and code the gradients into relax, then you can
use the minfx LM algorithm as a solution.

Regards,

Edward







On 25 August 2014 01:08,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Mon Aug 25 01:08:44 2014
New Revision: 25228

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=25228&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=25228&amp;view=rev</a>
Log:
Further improved the profiling of relax curve fit.

This profiling shows, that Python code is about twice as slow as the C 
code implemented.

But it also shows that optimising with scipy.optimize.leastsq is 20 X 
faster.
It also gives reasonable error values.

Combining a function for a linear fit to guess the initial values, 
together
with scipy optimise, will be an extreme time win for estimating R2eff 
values fast.

A further test would be to use relax Monte-Carlo simulations for say 
1000-2000 iterations,
and compare to the errors extracted from estimated covariance.

Added:
    trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py
Modified:
    
trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py

[This mail would be too long, it was shortened to contain the URLs only.]

Modified: 
trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py?rev=25228&amp;r1=25227&amp;r2=25228&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/profiling_relax_fit.py?rev=25228&amp;r1=25227&amp;r2=25228&amp;view=diff</a>

Added: trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py?rev=25228&amp;view=auto">http://svn.gna.org/viewcvs/relax/trunk/test_suite/shared_data/curve_fitting/profiling/relax_fit.py?rev=25228&amp;view=auto</a>


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00269" href="msg00269.html">Re: r25228 - in /trunk/test_suite/shared_data/curve_fitting/profiling: profiling_relax_fit.py relax_fit.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00258" href="msg00258.html">Re: r25228 - in /trunk/test_suite/shared_data/curve_fitting/profiling: profiling_relax_fit.py relax_fit.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00262" href="msg00262.html">Re: r25228 - in /trunk/test_suite/shared_data/curve_fitting/profiling: profiling_relax_fit.py relax_fit.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00265" href="msg00265.html">Re: r25228 - in /trunk/test_suite/shared_data/curve_fitting/profiling: profiling_relax_fit.py relax_fit.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Aug 25 12:20:16 2014</div>  
</body>
</html>
