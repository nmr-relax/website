<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: Comparison of Monte Carlo simulations vs. covariance matrix. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 01 Sep 2014 15:56:05 +0200 -->
<!--X-Message-Id: CAED9pY_&#45;wor7KAdGaVED_3u=jXrBee8YHajZ0Z2YPRv8VwDKNQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CAED9pY_k8MJ4f6qooeZFPGRXyKyjzE7CcQpSv7Wav38M5Kaa9A@mail.gmail.com -->
<!--X-Reference: CA+CBx2MyL+iLPLCqnc5PUaeHX&#45;a=L64cP0smaqSmhU=E4z3_EQ@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;ZEV&#45;WQ9rdZDypBcEyuaqntMhDQ4mAsQ6Mc+8oMM=eVA@mail.gmail.com -->
<!--X-Reference: CA+CBx2PePmQpGr_7bzW&#45;ck5uNnKp8RejmLuQbrOTo9bn5O0q_A@mail.gmail.com -->
<!--X-Reference: CAED9pY8a8vgvArU_6=KdAa3KO86Bi+0JXYGeeaSgJEGzcuNJrQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2PLBMWZR+HvYzB307&#45;uwk&#45;ueUnuGEC=hxvin+Q7u8wttw@mail.gmail.com -->
<!--X-Reference: CA+CBx2Mjyrt8q4qCfVF5tR72fNpQaOn_T&#45;T3b94dQO=6Cu=6xA@mail.gmail.com -->
<!--X-Reference: CA+CBx2NO2p40XPaJMY9dxPDsAf_ALPSQxvrk4&#45;eiJVa5naLimw@mail.gmail.com -->
<!--X-Reference: CAED9pY8Lz1T7K24T7FkivpT6W70gpjtdhznzM=y+oT2Vmj5MOQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2NnijG8F75eYmDEkqjUeYn4Ymd=WcNmzHbcuR5QHE=K_g@mail.gmail.com -->
<!--X-Reference: CAED9pY9Y7+AXJC8vYwQju3vorydJNn=Kk9MdeQ3rrGfFuJ3WTw@mail.gmail.com -->
<!--X-Reference: CAED9pY_NUsaoOtvDORUa8qbB70i4pQ8XQqCKfBJ3JMuNvGbntg@mail.gmail.com -->
<!--X-Reference: CA+CBx2MjUP5NY65SEQqd=m9ERJiQMwD22V2ET9=_XwYCyig2SA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Comparison of Monte Carlo simulations vs. covariance matrix. -- September 01, 2014 - 15:56</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Comparison of Monte Carlo simulations vs. covariance matrix.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00030" class="tabs">Index by Date</a> | <a href="threads.html#00030" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00029.html">Date Prev</a>] [<a href="msg00031.html">Date Next</a>] [<a href="msg00029.html">Thread Prev</a>] [<a href="msg00031.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 1 Sep 2014 15:55:33 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=FOsx0+LYlq7ad2xiv1LK2zLu5l+U38JRL1e3/m8F+TI=; b=eapeIW6L8cRX9wapmdXGqMnqn5cdup9zxYRZQO3Br4MLoJ6tasyC1UrPt3778tC75Q ++5fBVZmCUdK6QzrK+Pkx6DGwqQhnuKzLswH8FPygW7+3tFwHr3byXpJf75ViC9UXYyI /WHOUf7oN6EvTLsT76nZjlm/7+YNMQIXkxZ0SIVJZUg2U3sD/RTFSkTItupDXxo5tCvN vTGW87VLDGXP9MqoNgeyvv3y4o83WSm+22pUv/uT2rS3BIoOVakvXJYhCOW8EfWnR1dh 1FI6iYeyxuTjdqnaOPWli5AP5OvTmI5vQ0RIRae6WXgqHpzbMur+1nuq/XUpGvr2K4Wr YbOw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY_-wor7KAdGaVED_3u=jXrBee8YHajZ0Z2YPRv8VwDKNQ@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CAED9pY_k8MJ4f6qooeZFPGRXyKyjzE7CcQpSv7Wav38M5Kaa9A@mail.gmail.com&gt; &lt;CA+CBx2MyL+iLPLCqnc5PUaeHX-a=L64cP0smaqSmhU=E4z3_EQ@mail.gmail.com&gt; &lt;CAED9pY-ZEV-WQ9rdZDypBcEyuaqntMhDQ4mAsQ6Mc+8oMM=eVA@mail.gmail.com&gt; &lt;CA+CBx2PePmQpGr_7bzW-ck5uNnKp8RejmLuQbrOTo9bn5O0q_A@mail.gmail.com&gt; &lt;CAED9pY8a8vgvArU_6=KdAa3KO86Bi+0JXYGeeaSgJEGzcuNJrQ@mail.gmail.com&gt; &lt;CA+CBx2PLBMWZR+HvYzB307-uwk-ueUnuGEC=hxvin+Q7u8wttw@mail.gmail.com&gt; &lt;CA+CBx2Mjyrt8q4qCfVF5tR72fNpQaOn_T-T3b94dQO=6Cu=6xA@mail.gmail.com&gt; &lt;CA+CBx2NO2p40XPaJMY9dxPDsAf_ALPSQxvrk4-eiJVa5naLimw@mail.gmail.com&gt; &lt;CAED9pY8Lz1T7K24T7FkivpT6W70gpjtdhznzM=y+oT2Vmj5MOQ@mail.gmail.com&gt; &lt;CA+CBx2NnijG8F75eYmDEkqjUeYn4Ymd=WcNmzHbcuR5QHE=K_g@mail.gmail.com&gt; &lt;CAED9pY9Y7+AXJC8vYwQju3vorydJNn=Kk9MdeQ3rrGfFuJ3WTw@mail.gmail.com&gt; &lt;<a href="msg00028.html">CAED9pY_NUsaoOtvDORUa8qbB70i4pQ8XQqCKfBJ3JMuNvGbntg@mail.gmail.com</a>&gt; &lt;CA+CBx2MjUP5NY65SEQqd=m9ERJiQMwD22V2ET9=_XwYCyig2SA@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on September 01, 2014 - 15:56:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Anyway, there is a lot of rubbish used in the field, especially the
Ishima and Torshia 2005 equation.  In a private email someone
suggested that relax was calculating the errors incorrectly and that
the Ishima and Torshia equation was the correct one (and it resulted
in smaller errors).  That is why I simulated it in
test_suite/shared_data/dispersion/error_testing/simulation.py and
included the figure in the manual, just to prove that the Ishima &amp;
Torchia suggested equation was wrong, despite the lower errors.

Note that the Ishima and Torchia lower error estimate, which is an
bug/error, is used by a number of other dispersion software programs
out there.  I've just forgotten which ones.

I think that this equation is a textbook case of the log of the ratio
of two normal distributions.  Lets see, we have

  R2eff * T_relax = -log(I1/I0).

This is from <a  rel="nofollow" href="/manual/R2eff_model.html">http://www.nmr-relax.com/manual/R2eff_model.html</a>.  Using the rule

  log(X/Y) = log(X) - log(Y),

then

  R2eff * T_relax = log(I0) - log(I1),
  R2eff = T_relax^-1 (log(I0) - log(I1)).

Using the estimate from
<a  rel="nofollow" href="https://en.wikipedia.org/wiki/Propagation_of_uncertainty">https://en.wikipedia.org/wiki/Propagation_of_uncertainty</a> that:

  if f = aln(A),
  then sigma_f^2 = (a * sigma_A / A)^2.

Then

  sigma_R2eff^2 = (T_relax^-1 * sigma_I0 / I0)^2 + (T_relax^-1 *
sigma_I1 / I1)^2.

Rearranging we have:

  sigma_R2eff = T_relax^-1 * sqrt((sigma_I0 / I0)^2 + (sigma_I1 / I1)^2).

This is the equation used by relax (equation 11.4 in the manual,
<a  rel="nofollow" href="/manual/R2eff_model.html">http://www.nmr-relax.com/manual/R2eff_model.html</a>).  That was easier to
derive than I imagined :)

Regards,

Edward

On 1 September 2014 15:16, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

With my scribbles, and notes from my statistics book, I derive almost
the same thing.

My problem is that I end up with also wanting the time for the reference 
point.

And that does not make sense.

It reminds me of the NS R1rho equation problem, with 1/T.

Best
Troels


Troels Emtekær Linnet


2014-09-01 15:08 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Ok, I've found one reference for this formula:

    - Loria, J. P. and Kempf, J. G. (2004)  Measurement of
Intermediate Exchange Phenomena.  Methods in Molecular Biology, 278,
185-231.  (<a  rel="nofollow" href="http://dx.doi.org/10.1385/1-59259-809-9:185">http://dx.doi.org/10.1385/1-59259-809-9:185</a>).

Specifically section 3.2.7.1 &quot;Two-Point Data Sampling&quot;, and equation 22:

    R2(tau_CP^-1) = t^-1 ln[ave(I0) / ave(I(t))] +/- t^-1 Delta_Q,

and equation 23:

    Delta_Q = sqrt(Delta_I0^2 + Delta_I(t)^2).

This is apparently from the book:

    - Shoemaker, D. P., Garland, C. W., and Nibler, J. W. (1989)
Experiments in Physical Chemistry. 5th ed. McGraw-Hill, New York.

Though I don't have access to that to check.

Regards,

Edward



On 1 September 2014 10:55, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

The 2-point exponential error formula is currently equation 11.4 in
the relax manual (<a  rel="nofollow" href="/manual/R2eff_model.html">http://www.nmr-relax.com/manual/R2eff_model.html</a>).
I unfortunately did not write down a reference for it.  But the
equation is in a number of dispersion papers - I just have to find it.
Feel free to search yourself.  I also simulated this error, see figure
11.1 in the relax manual
(<a  rel="nofollow" href="/manual/R2eff_model.html#fig:_dispersion_error_comparison">http://www.nmr-relax.com/manual/R2eff_model.html#fig:_dispersion_error_comparison</a>)

Regards,

Edward

On 30 August 2014 13:49, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I found this old post in gwing gwong doogle Google.
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.scm/17553">http://thread.gmane.org/gmane.science.nmr.relax.scm/17553</a>

And then I see, that for a two point exponential, this i just
converting the values to a linear problem.

For several time points, a good initial guess for estimating r2eff,
and i0, by converting to a linear problem, and solving by linear least
squares.
(This is currently the experimental 'estimate_x0_exp' in the R2eff
estimate module).
Maybe I should try some weighting on this.

---------
# Convert to linear problem.
# Func
# I = i0 exp(-t R)
# Convert to linear
# ln(I) = R (-t) + ln(i0)
# Compare
# f(I) = a x + b

ln_I = log(I)
x = - 1. * times
n = len(times)

# Solve by linear least squares.
a = (sum(x*ln_I) - 1./n * sum(x) * sum(ln_I) ) / ( sum(x**2) - 1./n *
(sum(x))**2 )
b = 1./n * sum(ln_I) - b * 1./n * sum(x)

# Convert back from linear to exp function. Best estimate for parameter.
r2eff_est = a
i0_est = exp(b)
-----------

And then I see in And then I look in lib.dispersion.two_point.py

---------------
&quot;&quot;&quot;Calculate the R2eff/R1rho error for the fixed relaxation time data.

The formula is::

                            __________________________________
                  1        / / sigma_I1 \ 2     / sigma_I0 \ 2
    sigma_R2 = -------    /  | -------- |   +   | -------- |
               relax_T  \/   \ I1(nu1)  /       \    I0    /

where relax_T is the fixed delay time, I0 and sigma_I0 are the
reference peak intensity and error when relax_T is zero, and I1 and
sigma_I1 are the peak intensity and error in the spectrum of interest.
-------------

Right now, I don't know where that comes from.

My reference book:
An introduction to Error Analysis, Second Edition
John R. Taylor
<a  rel="nofollow" href="http://www.uscibooks.com/taylornb.htm">http://www.uscibooks.com/taylornb.htm</a>

&quot;You will not be surprised to learn that when the uncertainties ...
are independent and random, the sum can be replaced by a sum in
quadrature.&quot;

So, just following you analogy, I could get sigma R2 this way.

I will look into it and make some tests scripts.




Troels Emtekær Linnet


2014-08-30 9:54 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

I don't have much time to reply now, but the key is it use simple
synthetic noise-free data.  Try converting the 5 intensities in
test_suite/shared_data/curve_fitting/numeric_topology/ into 5 Sparky
peak lists with a single spin.  Then test the Monte Carlo simulations
and covariance matrix user functions in relax.  These two relax
techniques should then match the numeric results from the super-basic
scripts in that directory!  This would then be converted into two
system tests.

This was my plan, to complete in my spare time.  If you want to go
quickly, then feel free to follow these steps yourself rather than
waiting for me to do it.  I actually suggested this synthetic data
testing earlier to you
(<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/6807/focus=6840">http://thread.gmane.org/gmane.science.nmr.relax.devel/6807/focus=6840</a>).
Synthetic noise-free data is an essential tool for implemented and
debugging any new analysis type, algorithm, protocol, etc.  The key is
that you know the answer you are searching for!  And synthetic data is
simple.  Nothing should ever be implemented and debugged using real
data, as a good looking result might be the consequence of a nasty
bug.

Regards,

Edward






On 30 August 2014 02:49, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hm.

The last idea I have, is the division by number of degree of freedom.

So either 5-2, or 4-2.

That should be verified by a script with many different time points.

But then the errors for intensity gets very different.

Hm.

On 30 Aug 2014 01:45, &quot;Troels Emtekær Linnet&quot; &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

The sentence:

&quot;then the covariance matrix above gives the statistical error on the
best-fit parameters resulting from the Gaussian errors 'sigma_i' on
the underlying data 'y_i'.&quot;

And here I note the wording:
&quot;statistical error&quot;
&quot;Gaussian errors&quot;

Best
Troels


2014-08-29 21:21 GMT+02:00 Troels Emtekær Linnet 
&lt;tlinnet@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I also think it is some math some where.

I have a feeling, that it is the creating of Monte Carlo data with 2
sigma?
and then some log/exp calculation of R2eff.

If the errors are 2 x times over estimated, the chi2 values are 4 as
small, and the
space should be the same?

best
Troels

2014-08-29 17:06 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">I've just added the 2D Grace plots for this to the repository 
(r25444,
<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/23194">http://article.gmane.org/gmane.science.nmr.relax.scm/23194</a>).  They 
are
also attached to the task for easier access
(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/index.php?7822#comment107">https://gna.org/task/index.php?7822#comment107</a>).  From these 
plots I
see that the I0 error appears to be reasonable, but that the R2eff
errors are overestimated by 1.9555.

The plots are very, very different.  It is clear that
chi2_jacobian=True just gives rubbish.  It is also clear that 
there is
a perfect correlation in R2eff when chi2_jacobian=False.  The plot
shows absolutely no scattering, therefore this indicates a crystal
clear mathematical error somewhere.  I wonder where that could be. 
 It
may not be a factor of 2, as the correlation is 1.9555.  So it 
might
be a bug that is more complicated.  In any case, overestimating the
errors by ~2 and performing a dispersion analysis is not possible.
This will significantly change the curvature of the optimisation 
space
and will also have a huge effect on statistical comparisons between
models.

Regards,

Edward



On 29 August 2014 16:56, Troels Emtekær Linnet 
&lt;tlinnet@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">The default is now chi2_jacobian=False.

You will hopefully see, that the errors are double.

Best
Troels

2014-08-29 16:43 GMT+02:00 Edward d'Auvergne 
&lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Terrible ;)  For R2eff, the correlation is 2.748 and the points 
are
spread out all over the place.  For I0, the correlation is 3.5 
and
the
points are also spread out everywhere.  Maybe I should try with 
the
change from:

relax_disp.r2eff_err_estimate(chi2_jacobian=True)

to:

relax_disp.r2eff_err_estimate(chi2_jacobian=False)

How should this be used?

Cheers,

Edward



On 29 August 2014 16:33, Troels Emtekær Linnet
&lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Do you mean terrible or double?

Best
Troels

2014-08-29 16:15 GMT+02:00 Edward d'Auvergne 
&lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

I really cannot follow and judge how the techniques compare.  I
must
be getting old.  So to remedy this, I have created the

test_suite/shared_data/dispersion/Kjaergaard_et_al_2013/exp_error_analysis/
directory (r25437,
<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/23187">http://article.gmane.org/gmane.science.nmr.relax.scm/23187</a>).  
This
contains 3 scripts for comparing R2eff and I0 parameters for 
the 2
parameter exponential curve-fitting:

1)  A simple script to perform Monte Carlo simulation error
analysis.
This is run with 10,000 simulations to act as the gold 
standard.

2)  A simple script to perform covariance matrix error 
analysis.

3)  A simple script to generate 2D Grace plots to visualise the
differences.  Now I can see how good the covariance matrix
technique
is :)

Could you please check and see if I have used the
relax_disp.r2eff_err_estimate user function correctly?  The 
Grace
plots show that the error estimates are currently terrible.

Cheers,

Edward

_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00031" href="msg00031.html">Re: Comparison of Monte Carlo simulations vs. covariance matrix.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00007" href="msg00007.html">Re: Comparison of Monte Carlo simulations vs. covariance matrix.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00028" href="msg00028.html">Re: Comparison of Monte Carlo simulations vs. covariance matrix.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00029" href="msg00029.html">Re: Comparison of Monte Carlo simulations vs. covariance matrix.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Sep 01 16:40:17 2014</div>  
</body>
</html>
