<!-- MHonArc v2.6.10 -->
<!--X-Subject: r2563 &#45; /1.2/sconstruct -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Fri, 15 Sep 2006 06:53:52 +0200 -->
<!--X-Message-Id: E1GO5ha&#45;0001GT&#45;3T@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r2563 - /1.2/sconstruct -- September 15, 2006 - 06:53</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r2563 - /1.2/sconstruct</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00024" class="tabs">Index by Date</a> | <a href="threads.html#00024" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00023.html">Date Prev</a>] [<a href="msg00025.html">Date Next</a>] [<a href="msg00023.html">Thread Prev</a>] [<a href="msg00025.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Fri, 15 Sep 2006 04:53:21 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00024.html">E1GO5ha-0001GT-3T@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on September 15, 2006 - 06:53:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Fri Sep 15 06:53:20 2006
New Revision: 2563

URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=2563&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=2563&amp;view=rev</a>
Log:
A number of modifications to the sconstruct script for MS Windows 
compatibility.

The contents of the function self.setup_c() has been temporarily shifted into 
the self.relax_fit()
function.  Once other parts of relax have been ported to C, then most of 
self.relax_fit() can be
shifted into a new generic C building function.

The file extensions 'obj', 'dll', 'exp', and 'lib' have been added to the 
list to remove when 'scons
clean' is typed.  These are the compilation files generated by Microsoft 
Visual Studio (MSVS),
specifically Microsoft Visual C++ (MSVC) which compiles C code.

The C compilation flags have been made system dependent.  For example the 
include flag in Windows is
'/I' whereas in Unix like systems it is '-I'.

The Python include path has been split into two, 'py_include_minpath' and 
'py_include_fullpath'.

In Windows the Python library path (where python24.lib is located) cannot be 
found so the LIBPATH
variable pointing to the file has been added to the build environment.

In a number of places the Unix path separator '/' has been replaced by the 
system independent Python
object 'path.sep'.


Modified:
    1.2/sconstruct

Modified: 1.2/sconstruct
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.2/sconstruct?rev=2563&amp;r1=2562&amp;r2=2563&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.2/sconstruct?rev=2563&amp;r1=2562&amp;r2=2563&amp;view=diff</a>
==============================================================================
--- 1.2/sconstruct (original)
+++ 1.2/sconstruct Fri Sep 15 06:53:20 2006
@@ -54,9 +54,6 @@
         # Set the help message.
         self.help()
 
-        # Set up the C options.
-        self.setup_c()
-
         # The operating system.
         self.system = platform.uname()[0]
 
@@ -175,7 +172,7 @@
         print &quot;###############################\n\n&quot;
 
         # Extensions of temporary files.
-        temp_extns = ['pyc', 'bak', 'o', 'os']
+        temp_extns = ['pyc', 'bak', 'o', 'os', 'obj', 'dll', 'exp', 'lib']
 
         # Print out.
         print &quot;\nRemoving the files ending in &quot; + `temp_extns` + &quot;.\n&quot;
@@ -338,20 +335,38 @@
                  'exponential.c',
                  'relax_fit.c']
 
+        # Construct the python include path (for Python.h).
+        py_include_minpath = sys.prefix + path.sep + 'include'
+        py_include_fullpath = py_include_minpath + path.sep + 'python' + 
`sys.version_info[0]` + '.' + `sys.version_info[1]`
+
+        # C flags.
+        if self.system == 'Windows':
+            cflags = '/nologo /I\&quot;' + py_include_minpath + '\&quot;'
+        else:
+            cflags = '-I' + py_include_fullpath
+
         # Relaxation curve fitting build environment.
         env = Environment()
 
+        # Python library path.
+        libpath = ''
+        if self.system == 'Windows':
+            libpath = sys.prefix + path.sep + 'libs'
+
+        # Add the python library path to the environment.
+        env.Append(LIBPATH = libpath)
+
         # Catch Mac OS X and send the correct command line options to the 
linker.
         if env['PLATFORM'] == 'darwin':
-            env.Append(LINKFLAGS = ['-bundle', '-bundle_loader', sys.prefix 
+ '/bin/python', '-dynamic'])
+            env.Append(LINKFLAGS = ['-bundle', '-bundle_loader', sys.prefix 
+ path.sep + 'bin' + path.sep + 'python', '-dynamic'])
 
         # Loop over the relaxation curve fitting files.
         nodes = []
         for file in files:
-            nodes.append(env.SharedObject(dir + '/' + file, 
CCFLAGS=self.cflags))
+            nodes.append(env.SharedObject(dir + path.sep + file, 
CCFLAGS=cflags))
 
         # Build the relaxation curve fitting module.
-        self.relax_fit_object = env.SharedLibrary(target=dir + '/relax_fit', 
source=nodes, SHLIBPREFIX='')
+        self.relax_fit_object = env.SharedLibrary(target=dir + path.sep + 
'relax_fit', source=nodes, SHLIBPREFIX='')
 
         # Print out string returning function.
         def print_string(target=None, source=None, env=None):
@@ -417,16 +432,6 @@
         self.TAR_SRC_FILE = 'relax-' + version + '.src.tar.bz2'
 
 
-    def setup_c(self):
-        &quot;&quot;&quot;Function for setting up the C options.&quot;&quot;&quot;
-
-        # Construct the python include path (for Python.h).
-        py_include_path = sys.prefix + '/include/python' + 
`sys.version_info[0]` + '.' + `sys.version_info[1]`
-
-        # C flags.
-        self.cflags = '-I' + py_include_path
-
-
     def tar(self, target=None, source=None, env=None):
         &quot;&quot;&quot;Builder action for creating the tar archive.&quot;&quot;&quot;
 
@@ -469,10 +474,10 @@
                 # Create the file name (without the base directory).
                 name = path.join(root, files[i])
                 name = name[len(base):]
-                print 'relax-' + version + '/' + name
+                print 'relax-' + version + path.sep + name
 
                 # Tar information.
-                tarinfo = archive.gettarinfo(name, 'relax-' + version + '/' 
+ name)
+                tarinfo = archive.gettarinfo(name, 'relax-' + version + 
path.sep + name)
 
                 # Add the file.
                 archive.addfile(tarinfo, file)



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Sep 15 07:00:09 2006</div>  
</body>
</html>
