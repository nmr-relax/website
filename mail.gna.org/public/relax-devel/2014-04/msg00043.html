<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r22835 &#45; /trunk/pipe_control/spectrum.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Wed, 23 Apr 2014 14:00:33 +0200 -->
<!--X-Message-Id: CAED9pY8+Na_re4A+kDNCP2Wvap87QM+2U+2JFDeQ60t0cR7Wmw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Wcsgp&#45;0005RN&#45;6r@subversion.gna.org -->
<!--X-Reference: CAED9pY9V6edOVpOij+ZU9xAmc5AqF5yUFSFAi8uyO2&#45;Otbpa2Q@mail.gmail.com -->
<!--X-Reference: CA+CBx2OPwf2tA=naLFZoRtiR&#45;PhSza&#45;E_5sCjVkaf6_03ew7mw@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;YAJVxMRZnV2XATVcMnPciDU1Ps9jUSc1P2YYfat6m=g@mail.gmail.com -->
<!--X-Reference: CA+CBx2NBYp451pr4mWAnWwnHS+tAw9L08e2eHnMSeNosRLGL&#45;A@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r22835 - /trunk/pipe_control/spectrum.py -- April 23, 2014 - 14:00</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r22835 - /trunk/pipe_control/spectrum.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00043" class="tabs">Index by Date</a> | <a href="threads.html#00043" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00042.html">Date Prev</a>] [<a href="msg00044.html">Date Next</a>] [<a href="msg00041.html">Thread Prev</a>] [<a href="msg00037.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 23 Apr 2014 13:59:43 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=plMPuVE1kNlo81SnjxFWeT8FOcqHvbZx8lDAntC8GMg=; b=Tp0jQ2UrMd3Cdu3rtgq8vW13OSlX+Fa1jEqkvUp62x0hq5wRaFantV+CMcOabcjfWy L1zOc+H6dBYMMQRZng0MI48UEDSiARdWoED/XNbUK68kfOPF89VZk/FfeGEy52l6Z7P3 WZnHiSXphizv+59gV7Ipn5iQnJFBYGYz2M6Kob+Ht8qPgz11/I6JCNy6uT+VNcaIdUO3 CxT00SQgAelnlDG3MhxgQ6dxaW/U1I0BEXeA+2oWYKyYfLyxIwQzC1pXXYs15H8GoQPx Zckz05GX3hx7tifTnYz67u3NB5l++jo2w1yxzWAgEnz8pr7eMnnmNMT0PtCMrQT5B73P 3yDQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00043.html">CAED9pY8+Na_re4A+kDNCP2Wvap87QM+2U+2JFDeQ60t0cR7Wmw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Wcsgp-0005RN-6r@subversion.gna.org&gt; &lt;<a href="msg00036.html">CAED9pY9V6edOVpOij+ZU9xAmc5AqF5yUFSFAi8uyO2-Otbpa2Q@mail.gmail.com</a>&gt; &lt;CA+CBx2OPwf2tA=naLFZoRtiR-PhSza-E_5sCjVkaf6_03ew7mw@mail.gmail.com&gt; &lt;CAED9pY-YAJVxMRZnV2XATVcMnPciDU1Ps9jUSc1P2YYfat6m=g@mail.gmail.com&gt; &lt;<a href="msg00041.html">CA+CBx2NBYp451pr4mWAnWwnHS+tAw9L08e2eHnMSeNosRLGL-A@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on April 23, 2014 - 14:00:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Oh, ok, I can see where this is:

relax&gt; relax_disp.cpmg_frq(spectrum_id='800_1000.in', cpmg_frq=1000.0)
debug&gt; GUI interpreter:  Applying the relax_disp.cpmg_frq user
function for synchronous execution.
The spectrum ID '800_1000.in' CPMG frequency is set to 1000.0 Hz.
debug&gt; Observer: 'gui_uf' notifying the 'spin count - relax_disp (Wed
Apr 23 13:39:46 2014)' method update_spin_count().
debug&gt; Observer: 'gui_uf' notifying the 'clusters - relax_disp (Wed
Apr 23 13:39:46 2014)' method update_clusters().
debug&gt; Observer: 'gui_uf' notifying the 'spectra list: 0' method
build_element().
debug&gt; Observer: 'gui_uf' notifying the 'relax_disp.cpmg_frq' method
update_args().
debug&gt; Observer: 'gui_uf' unregistering 'relax_disp.cpmg_frq'.
debug&gt; Observer: 'gui_uf' unregistering 'relax_disp.cpmg_frq'.
debug&gt; The key 'relax_disp.cpmg_frq' does not exist.
debug&gt; Observer: 'gui_uf' unregistering 'relax_disp.cpmg_frq'.
debug&gt; The key 'relax_disp.cpmg_frq' does not exist.
debug&gt; Observer: 'gui_uf' registering the 'relax_disp.cpmg_frq' method
update_args().
debug&gt; Observer: 'gui_uf' unregistering 'relax_disp.cpmg_frq'.

These are just messages from the status singleton object.  This is
specifically the status.observers.gui_uf observer object for the GUI
user functions (<a  rel="nofollow" href="https://en.wikipedia.org/wiki/Observer_pattern">https://en.wikipedia.org/wiki/Observer_pattern</a>).  You
will see that 'relax_disp.cpmg_frq' is registered in this object
earlier on and it is removed or unregistered here.  The problem is
that is it unregistered 3 times.  This is to avoid bugs, by
unregistering it from multiple code locations, but it results in these
messages when in debug mode.  It is better to have such a situation
than to somehow have it remain registered - that will result in fatal
wxPython segfaults.

If you're interested, this observer design pattern is used to keep
everything up to date.  In the case of the relax_disp.cpmg_frq user
function, this will make sure that the spectrum ID string list is
always up to date.  For example if you leave the user function window
open and then run the spectrum.read_intensities user function (or it
could be run from a script or something else in the background).  The
list of spectrum IDs will have changed.  The spectrum.read_intensities
user function will notify status.observers.gui_uf when complete (as
all GUI user functions do).  As relax_disp.cpmg_frq has the
update_args() method registered with status.observers.gui_uf, that
method will be run and the relax_disp.cpmg_frq user function window
spectrum ID string list will be updated.  The observer object is a
very common method for keeping things up to date and synchronised in a
GUI - well, it is pretty much essential.  It is used everywhere in the
GUI.  For example the pipe editor window to make sure all data pipes
are listed (or removed from the list), that the spin editor window
always shows the correct molecule, residue and spin structure, etc.
If you notice that some GUI element contains the wrong information or
is not updated, then that's the time we need to look at modifying the
observer objects of the status singleton object.

Regards,

Edward


On 23 April 2014 13:15, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">It passes fine.

But I just saw these messages, and thought something is wrong?

Best
troels


2014-04-23 13:09 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

Does this GUI test not pass on your system?  Or have you modified the
test and it now no longer works?

Cheers,

Edward



On 23 April 2014 12:46, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I see some errors:

The key 'relax_disp.cpmg_frq' does not exist.

it is from this block.

        if status.relax_mode != 'gui' and wx.version() != '2.9.4.1 gtk2
(classic)':
            analysis.peak_intensity.action_relax_disp_cpmg_frq(item=4)
            uf_store['relax_disp.cpmg_frq'].wizard._go_next()
            interpreter.flush()
            analysis.peak_intensity.action_relax_disp_exp_type(item=5)
            uf_store['relax_disp.exp_type'].wizard._go_next()
            interpreter.flush()
            analysis.peak_intensity.action_relax_disp_relax_time(item=0)
            uf_store['relax_disp.relax_time'].wizard._go_next()
            interpreter.flush()
            analysis.peak_intensity.action_spectrometer_frq(item=10)
            uf_store['spectrometer.frequency'].wizard._go_next()
            interpreter.flush()


Best
Troels


2014-04-23 11:29 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Awesome!  That's exactly the change I would have made.

I would also suggest to try to increase the system test coverage of
this to make sure it works in all cases, as well as to make sure that
any future code refactorisation or expansion doesn't break this.  The
easiest way is to simply add more checks to an already existing test.
But the only one possible is the Relax_disp.test_hansen_trunc_data GUI
test as I mentioned at
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/5302/focus=5307">http://thread.gmane.org/gmane.science.nmr.relax.devel/5302/focus=5307</a>.
 Would you like to add a couple of self.assertEqual() checks to that
test, just after the peak height error analysis, to make sure that the
code works when variance averaging over different SD values is
preformed?  Such checks would really make the code robust to future
changes.

Cheers,

Edward


On 23 April 2014 10:37,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Wed Apr 23 10:37:58 2014
New Revision: 22835

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=22835&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=22835&amp;view=rev</a>
Log:
Fix for bug. The variances used to calculated std, should only be
taken
from those which are defined in the subset.

Regarding bug #21954, (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/index.php?21954">https://gna.org/bugs/index.php?21954</a>) - Order
of
spectrum.error_analysis is important.

Modified:
    trunk/pipe_control/spectrum.py

Modified: trunk/pipe_control/spectrum.py
URL:

<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/pipe_control/spectrum.py?rev=22835&amp;r1=22834&amp;r2=22835&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/pipe_control/spectrum.py?rev=22835&amp;r1=22834&amp;r2=22835&amp;view=diff</a>


==============================================================================
--- trunk/pipe_control/spectrum.py      (original)
+++ trunk/pipe_control/spectrum.py      Wed Apr 23 10:37:58 2014
@@ -183,6 +183,10 @@

         # Loop over all time points.
         for id in cdp.var_I.keys():
+            # Only use id's defined in subset
+            if id not in subset:
+                continue
+
             # Single spectrum (or extraordinarily accurate NMR
spectra!).
             if cdp.var_I[id] == 0.0:
                 continue


_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx


To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00036" href="msg00036.html">Re: r22835 - /trunk/pipe_control/spectrum.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00039" href="msg00039.html">Re: r22835 - /trunk/pipe_control/spectrum.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00040" href="msg00040.html">Re: r22835 - /trunk/pipe_control/spectrum.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00041" href="msg00041.html">Re: r22835 - /trunk/pipe_control/spectrum.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Apr 23 14:20:14 2014</div>  
</body>
</html>
