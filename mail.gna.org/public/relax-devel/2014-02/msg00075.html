<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [sr #3117] Functionality to inspect interactively after running	script &#45; The equivalence to python &#45;i -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 14 Feb 2014 11:07:07 +0100 -->
<!--X-Message-Id: CAED9pY8O6yo=1ru2FNLr2GL=YzWh0pek0Nr_EAty1yFa=4QR6Q@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140213&#45;114757.sv20529.7323@gna.org -->
<!--X-Reference: 20140213&#45;164825.sv20529.67050@gna.org -->
<!--X-Reference: CAED9pY&#45;pF1cPK+2bGHt4K8JEJPO7h&#45;Hn2mfaa=gez6m90XXaPg@mail.gmail.com -->
<!--X-Reference: CA+CBx2NSSyg3B9bPRkzJfeB=kuOXuOfXT4PdnmGRsfbc0p4L3g@mail.gmail.com -->
<!--X-Reference: CAED9pY89ZP6YAhqM_hsGbFH6rE61WaTk&#45;pL9AsV6eNiUc1Nuug@mail.gmail.com -->
<!--X-Reference: CA+CBx2OgEWzCW57h+RC4oQTd1sKGR=802poMoSbBbRCSQhJ+1A@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sr #3117] Functionality to inspect interactively after running	script - The equivalence to python -i -- February 14, 2014 - 11:07</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [sr #3117] Functionality to inspect interactively after running	script - The equivalence to python -i</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00075" class="tabs">Index by Date</a> | <a href="threads.html#00075" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00074.html">Date Prev</a>] [<a href="msg00076.html">Date Next</a>] [<a href="msg00078.html">Thread Prev</a>] [<a href="msg00084.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 14 Feb 2014 11:06:37 +0100</li>
<li class="menuitem">
<em>Cc</em>: Chris MacRaild &lt;c.macraild@xxxxxxxxxxxxxx&gt;,	&quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date:message-id:subject	:from:to:cc:content-type:content-transfer-encoding;	bh=hMKd4bRcp3m6T5D21Pr9Ltv1rJy21TA/NllNTk17fvc=;	b=L4SnNOvP1kLk+M3YW3NeZxAQmN6Kl5wUcwua+I9z4o0tB7iOAcAprgvSgEsb5VPddW	RO7S1BVKushBln4zgGWWMDmteBbHColkrFCSlBzu5ZDNuTPNs/mpPIvK+8PYm+gNmdz8	PkpFlz+uUlmIp0kNbhZwUZWeFBd/FGrwNMKS0O5HscGo9QjIQ9aIwMGO/u/3zC7xq+vX	8dDZWq9ICNfys5IXDSkRl6QycyPVEi0wsHEPL6mt2o+O6ch5krr062Qq6w7xnart43zG	CC20y2XorCjOv0xAwxzRxYDcYGTqeVjxOxBtq2Sx/3iD7OLppscZGSBTGl4odnFcrQRR	P8mQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00075.html">CAED9pY8O6yo=1ru2FNLr2GL=YzWh0pek0Nr_EAty1yFa=4QR6Q@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;20140213-114757.sv20529.7323@xxxxxxx&gt;	&lt;20140213-164825.sv20529.67050@xxxxxxx&gt;	&lt;CAED9pY-pF1cPK+2bGHt4K8JEJPO7h-Hn2mfaa=gez6m90XXaPg@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2NSSyg3B9bPRkzJfeB=kuOXuOfXT4PdnmGRsfbc0p4L3g@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY89ZP6YAhqM_hsGbFH6rE61WaTk-pL9AsV6eNiUc1Nuug@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2OgEWzCW57h+RC4oQTd1sKGR=802poMoSbBbRCSQhJ+1A@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on February 14, 2014 - 11:07:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

As I mentioned in the last mail
(<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/5000/focus=5012">http://thread.gmane.org/gmane.science.nmr.relax.devel/5000/focus=5012</a>),
you can ignore the status.  So instead of commenting out the line
there, just remove the 'return' part.  As for having access to the
namespace of the script, that is a whole new can of worms!  Firstly as
you have run off the end of the script, the script namespace no longer
exists and Python will perform automatic garbage collection and
destroy the now orphaned 'a' variable.  Instead you want a script
like:

&quot;&quot;&quot;
pipe.create('test', 'mf')
cdp.a = 10
print(&quot;Hello&quot;)
&quot;&quot;&quot;

Once you enter the prompt you will see that cdp.a exists and is set to
10.  You could also place objects into the special 'status' singleton
(<a  rel="nofollow" href="https://en.wikipedia.org/wiki/Singleton_pattern">https://en.wikipedia.org/wiki/Singleton_pattern</a>).  The problem is
that the namespace of the script is temporary.  If you really must
have this, then you need a lot of extra code.  This code would create
an empty data container in the prompt namespace using the name of the
script, it would then loop over the namespace of the script and find
all user defined objects, and then use a copy.deepcopy() call to
duplicated all objects into the new empty data container.  The
implementation would actually be a lot more complicated than this as
you have to catch this before the script terminates - even I have not
idea how this would be done!  I would not recommend this, but it could
be done.

Regards,

Edward


On 14 February 2014 10:54, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Dear Edward.

I am trying with this code:
        if script_file and status.prompt:
            #return run_script(intro=self.__intro_string, local=locals(),
script_file=script_file, show_script=self.__show_script,
raise_relax_error=self.__raise_relax_error)
            run_script(intro=self.__intro_string, local=locals(),
script_file=script_file, show_script=self.__show_script,
raise_relax_error=self.__raise_relax_error)
            prompt(intro=self.__intro_string, local=locals())


If I add the &quot;return&quot; command, relax quits after execution of the code.

Without adding the return code, I will get relax running the code, but the
variable in the script is not available. ?

----------------------------------------------------------------------------------------------------------------
[tlinnet@tomat relax_trunk]$ ./relax -p test.py



                                  relax repository checkout rNone
                                                None

                              Molecular dynamics by NMR data analysis

                             Copyright (C) 2001-2006 Edward d'Auvergne
                         Copyright (C) 2006-2014 the relax development team

This is free software which you are welcome to modify and redistribute under
the conditions of the
GNU General Public License (GPL).  This program, including all modules, is
licensed under the GPL
and comes with absolutely no warranty.  For details type 'GPL' within the
relax prompt.

Assistance in using the relax prompt and scripting interface can be accessed
by typing 'help' within
the prompt.

Processor fabric:  Uni-processor.

script = 'test.py'
----------------------------------------------------------------------------------------------------
a = 10
print &quot;helo&quot;
----------------------------------------------------------------------------------------------------
helo




                                  relax repository checkout rNone
                                                None

                              Molecular dynamics by NMR data analysis

                             Copyright (C) 2001-2006 Edward d'Auvergne
                         Copyright (C) 2006-2014 the relax development team

This is free software which you are welcome to modify and redistribute under
the conditions of the
GNU General Public License (GPL).  This program, including all modules, is
licensed under the GPL
and comes with absolutely no warranty.  For details type 'GPL' within the
relax prompt.

Assistance in using the relax prompt and scripting interface can be accessed
by typing 'help' within
the prompt.

Processor fabric:  Uni-processor.

relax&gt; print a
Traceback (most recent call last):
  File &quot;&lt;console&gt;&quot;, line 1, in &lt;module&gt;
NameError: name 'a' is not defined
relax&gt; print test.a
Traceback (most recent call last):
  File &quot;&lt;console&gt;&quot;, line 1, in &lt;module&gt;
NameError: name 'test' is not defined





2014-02-14 10:46 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

This is rather simple:

- First execute the run_script() function to have the script execute
prior to reaching the prompt.

- Then execute the prompt() function.

Without the prompt() function call, the Python execution will just run
to the end of the relax.py file and terminate.  The prompt() function
call prevents this by jumping into the interpreter mode.  The
interpreter mode is then exited with the special objects 'q', 'quit',
'exit', and 'bye' and [Ctrl-D].  These commands cause the prompt()
function to be exited, allowing the Python execution to run to the end
of the relax.py file and quit.  As an aside, if you look you'll see
that this implementation (the _Exit class/object) is not ideal as it
uses sys.exit(), which really should never be used - this is simply
ancient code which should one day be updated.

So what you need is that when a script is supplied together with the
--prompt argument, then you just run both of these, one after the
other.  That's what the pseudo-code I suggested does
(<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/5000/focus=5008">http://thread.gmane.org/gmane.science.nmr.relax.devel/5000/focus=5008</a>).
 I quickly tested running one function after the other and it works.
You don't need to worry about returning the status from the
run_script() function, as that's not used in relax yet.  But
eventually to allow for proper terminal behaviour, relax will one day
return a status value to the terminal.  The user combinations for
running relax would be:

- No arguments:  Run prompt(),
- Only the -p, --prompt arguments:  Run prompt(),
- Only a script file:  Run run_script(),
- Both the -p, --prompt arguments and a script file:  Run run_script()
then prompt().

I hope this is now clearer.

Regards,

Edward


On 14 February 2014 10:14, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

Thank you for the suggestions, which I will implement.

I wonder about the pseudo code.

My problem is that I don't know how to parse the script to the prompt?
Does the prompt needs to be modified to run the given script?

Best
Troels


2014-02-13 18:03 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

The idea in the patch looks ok.  It's worth discussing on the list the
idea though, rather than relying on reading the patch itself.  The
--pedantic flag activates this feature that Chris MacRaild added to
relax back in 2006.  So I gather that the suggestion is to change the
argument:

-p, --pedantic, escalate all warnings to errors

to:

-e, --escalate, escalate all warnings to errors

I guess this is reasonable.  I suggest committing just that change as
one commit yourself.  The current patch also includes the argument:

-p, --prompt, 'Execute the given script and continue into the prompt
mode to allow for interactive inspection'

This should be in a separate commit.  Also, the first letter of the
help text should be in lowercase to match the rest of the help system.
 There is also a problem with the logic of the if-else statement in
the run() method.  I would suggest the pseudo-code:

if script:
    script_status = run_script()
if not script or (script and status.prompt):
    prompt()

So essentially two commits, the first renaming --pedantic, the second
adding the --prompt argument and logic.  What do you think?

Regards,

Edward




On 13 February 2014 17:48, Troels E. Linnet
&lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Follow-up Comment #1, sr #3117 (project relax):

This follows the discussion at:
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/5000">http://thread.gmane.org/gmane.science.nmr.relax.devel/5000</a>

The next step would be to figure out to run the code and stay in the
interpreter.
Is it necessary to write a new function?

Initial pathc applied.

(file #20034)
    _______________________________________________________

Additional Item Attachment:

File name: first.patch                    Size:5 KB


    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/support/?3117">http://gna.org/support/?3117</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00059" href="msg00059.html">[sr #3117] Functionality to inspect interactively after running	script - The equivalence to python -i</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00065" href="msg00065.html">[sr #3117] Functionality to inspect interactively after running	script - The equivalence to python -i</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00067" href="msg00067.html">Re: [sr #3117] Functionality to inspect interactively after running	script - The equivalence to python -i</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00069" href="msg00069.html">Re: [sr #3117] Functionality to inspect interactively after running	script - The equivalence to python -i</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00071" href="msg00071.html">Re: [sr #3117] Functionality to inspect interactively after running	script - The equivalence to python -i</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00072" href="msg00072.html">Re: [sr #3117] Functionality to inspect interactively after running	script - The equivalence to python -i</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Feb 14 12:20:21 2014</div>  
</body>
</html>
