<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: Implement handles for nmrglue in relax -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 02 Dec 2014 21:46:37 +0100 -->
<!--X-Message-Id: CAED9pY9sec&#45;PrbRsoPcARkUFBDL1oMj+mo8Y=efyuGAwc8E2bA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CA+CBx2N9gB94wrRMMjh8ETw8yZxmtL5c5uhJx58sCdtV_7HYMQ@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;vUGKBSrvK2WJw2=6kUXC&#45;0OnVeWTp+17TEJSijSgwBg@mail.gmail.com -->
<!--X-Reference: CA+CBx2NOfBd_LRo5yLuygzqJY7YfFTXX_NzhbFd_10QSvqr16A@mail.gmail.com -->
<!--X-Reference: CAED9pY_hXBUo1MzqTq7y9_JW8Zrq_JOW38rpMNAp6LPatRn8cw@mail.gmail.com -->
<!--X-Reference: CAED9pY9UnksSbfm4b2bBXWDcoJv&#45;9xGfdepB9RmhGAnEc5eZnA@mail.gmail.com -->
<!--X-Reference: 547CB55B.6070306@gmail.com -->
<!--X-Reference: CAED9pY94J__vvOWNszDXC6smJsx6c7r9U+XmzHzZiBKyBYQWFg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Implement handles for nmrglue in relax -- December 02, 2014 - 21:46</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Implement handles for nmrglue in relax</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00009" class="tabs">Index by Date</a> | <a href="threads.html#00009" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00008.html">Date Prev</a>] [<a href="msg00011.html">Date Next</a>] [<a href="msg00006.html">Thread Prev</a>] [<a href="msg00007.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Jonathan Helmus &lt;jjhelmus@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 2 Dec 2014 21:46:07 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;, Troels Emtek√¶r Linnet &lt;tlinnet@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type; bh=6uCWEz0PQlgV/ItJPgCngueYNvEeFyd4tv+4PYY9Ot0=; b=iQ+4gZi92c4aAos1UxhUJy5v6harIgaXzHPCK8rqd6CoDIIDcon/gYVscAqyJD7cd0 lq+uTbJxsHCywaE+qecI5T9JgkJAPYJ+ckuCaAiiiEPL7o2Qi6UWxN3Vi+V6Gq8ZMIuc 3ZKCBM4v/j3HEeqShmKKV6O6+2WiEdyOsuIg6aSUe7BsoZz4a7Gxc6GUwjUDalCUVOr0 bkl0db3zxh6dNkp9T4Cth+QOJ5j4bQzsoH7b7RKC5c0euiXPY9K4y9LtELZjlRu61+7e PIh70mrvHPnd5bpW+MKgGEkQZNuTNZW43Rb2qCytwkZkkq29PAxl/16c/bRByLq5nhnB NOKg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY9sec-PrbRsoPcARkUFBDL1oMj+mo8Y=efyuGAwc8E2bA@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2N9gB94wrRMMjh8ETw8yZxmtL5c5uhJx58sCdtV_7HYMQ@mail.gmail.com&gt; &lt;CAED9pY-vUGKBSrvK2WJw2=6kUXC-0OnVeWTp+17TEJSijSgwBg@mail.gmail.com&gt; &lt;CA+CBx2NOfBd_LRo5yLuygzqJY7YfFTXX_NzhbFd_10QSvqr16A@mail.gmail.com&gt; &lt;CAED9pY_hXBUo1MzqTq7y9_JW8Zrq_JOW38rpMNAp6LPatRn8cw@mail.gmail.com&gt; &lt;CAED9pY9UnksSbfm4b2bBXWDcoJv-9xGfdepB9RmhGAnEc5eZnA@mail.gmail.com&gt; &lt;<a href="msg00005.html">547CB55B.6070306@gmail.com</a>&gt; &lt;<a href="msg00006.html">CAED9pY94J__vvOWNszDXC6smJsx6c7r9U+XmzHzZiBKyBYQWFg@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on December 02, 2014 - 21:46:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

I have just fixed the numarray storage in the relax data store.  This
was actually a regression, as multidimensional numpy arrays were
previously stored as IEEE 754 byte arrays
(<a  rel="nofollow" href="https://gna.org/bugs/?23017">https://gna.org/bugs/?23017</a>).  I've now fixed it in the trunk, so it
can be ported to your nmrglue branch using the svnmerge.py script.
Then your spectral data storage should be of much higher quality and
not suffer from floating point truncation artefacts.

Regards,

Edward


On 2 December 2014 at 20:20, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Jonathan,

Thank you for your reply to our public mailing list.  It can take a
while to appear (<a  rel="nofollow" href="http://news.gmane.org/gmane.science.nmr.relax.devel">http://news.gmane.org/gmane.science.nmr.relax.devel</a>),
as the mailing list maintainer, Chris MacRaild, is in a very different
time zone 
(<a  rel="nofollow" href="http://www.monash.edu.au/pharm/research/researchers/profile.html?sid=47804&amp;pid=5391">http://www.monash.edu.au/pharm/research/researchers/profile.html?sid=47804&amp;pid=5391</a>).
Those not signed up to the list need to wait for the maintainer to
accept the message.  Anyway, I'm sure Troels will expand on this
relax-nmrglue topic in the nmrglue forums.  For your points, please
see below:


</pre><blockquote class="blockquote"><pre style="margin: 0em;">    A few points regarding nmrglue in this discussion.  The main nmrglue
website is www.nmrglue.com, links to that site are best in any 
documentation
or credits.  The source code and issue tracker are on GitHub at
<a  rel="nofollow" href="https://github.com/jjhelmus/nmrglue">https://github.com/jjhelmus/nmrglue</a>.
</pre></blockquote><pre style="margin: 0em;">

The relax mailing lists (relax-announce, relax-users, relax-devel, and
relax-commits, see <a  rel="nofollow" href="http://www.nmr-relax.com/communication.html">http://www.nmr-relax.com/communication.html</a>) are
archived locally, with Gmane (<a  rel="nofollow" href="http://gmane.org/">http://gmane.org/</a>), The Mail Archive
(<a  rel="nofollow" href="https://www.mail-archive.com/">https://www.mail-archive.com/</a>), and MARC (<a  rel="nofollow" href="http://marc.info/">http://marc.info/</a>).  So the
nmrglue links will be amplified.  This should really help nmrglue pop
up higher in search engine results.  Crosslinking can further improve
the rankings.  Anyway, Troels is giving you plenty of links, see the
recent changes by Troels at
<a  rel="nofollow" href="http://news.gmane.org/gmane.science.nmr.relax.scm">http://news.gmane.org/gmane.science.nmr.relax.scm</a>
(<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/24567">http://article.gmane.org/gmane.science.nmr.relax.scm/24567</a> for
example).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">    The representation of NMR data is in NumPy multi-dimenstional ndarray
objects [1].  These can be serialized to strings using the .tostring() or
.tobytes() methods.  Spectral metadata is stored in a Python dictionary,
there are a number of options for serializing these.  Also both objects can
be pickled.
</pre></blockquote><pre style="margin: 0em;">

Troels, the relax data store XML representation can handle numpy
ndarrays as is.  In relax, try:

relax&gt; from numpy import array
relax&gt; pipe.create('numpy_test', 'mf')
relax&gt; cdp.test = array([[1, 2, 3.], [4, 5, 6]])
relax&gt; state.save('test')

The 'test.bz2' XML file can then be loaded via state.load without
problem and cdp.test will be the correct numpy array.  Note there is a
truncation artefact present, as the XML looks like:

[snip]
    &lt;pipe desc=&quot;The contents of a relax data pipe&quot; name=&quot;numpy_test&quot; 
type=&quot;mf&quot;&gt;
        &lt;global desc=&quot;Global data located in the top level of the data 
pipe&quot;&gt;
            &lt;test type=&quot;dtype('float64')&quot;&gt;
                &lt;value&gt;
                    array([[ 1.,  2.,  3.],
       [ 4.,  5.,  6.]])
                &lt;/value&gt;
            &lt;/test&gt;
        &lt;/global&gt;
[snip]

Ideally I would modify the data store to_xml() methods use the numpy
tobytes() methods and then store proper byte arrays using Gary
Thompson's float.py module to store the byte arrays, such as we
currently do with floats:

relax&gt; pipe.create('numpy_test', 'mf')
relax&gt; cdp.test = 1.23456
relax&gt; state.save('test', force=True)

Which gives:

            &lt;test type=&quot;float&quot;&gt;
                &lt;value&gt;
                    1.23456
                &lt;/value&gt;
                &lt;ieee_754_byte_array&gt;
                    [56, 50, 143, 252, 193, 192, 243, 63]
                &lt;/ieee_754_byte_array&gt;
            &lt;/test&gt;

The &lt;value&gt; is just there for users to read.  On the other hand, the
loading of the state file reads the data from the
&lt;ieee_754_byte_array&gt; XML tag.  Tell me if you have any truncation
artefact problems when saving states with spectral nmrglue data, and
I'll look into this full precision float support.  Due to horrible
compatibility problems, non-truncating pickling (Python or numpy) is
not an option.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">    Python 3 support is available in the development version of nmrglue,
0.5-dev, available on GitHub.  There is an issue with installing the 
package
in a Python 3 environment which I need to work out but then I plan or
releasing version 0.5 which will be the first release to support Python 3.
Expect it out and available on PyPI by the end of the week.
</pre></blockquote><pre style="margin: 0em;">

I've been watching this.  There are still a lot of type() calls that
need to be replaced by isinstance().  And the unfortunate set()
function which rightfully no longer exists.  The following command
picks up a lot of the problems:

$ 2to3 -j 4 -w -f buffer -f idioms -f set_literal -f ws_comma -x
except -x import -x imports -x long -x numliterals -x xrange .

If you need help, have a look at the relax compat.py module
(<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/lib/compat.py?view=log">http://svn.gna.org/viewcvs/relax/trunk/lib/compat.py?view=log</a>,
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/*checkout*/relax/trunk/lib/compat.py?content-type=text%2Fplain">http://svn.gna.org/viewcvs/*checkout*/relax/trunk/lib/compat.py?content-type=text%2Fplain</a>).
This uses a lot of tricks for handling both Python 2 and 3.  For any
Python packages that have been renamed, we simply alias them in
lib.compat and import from lib.compat rather than from the Python
standard site-packages.  If their are any major headaches, just say
and I could play with it in a git fork.  Oh, we have a special
migration document:
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/docs/devel/2to3_checklist?view=log">http://svn.gna.org/viewcvs/relax/trunk/docs/devel/2to3_checklist?view=log</a>,
or 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/*checkout*/relax/trunk/docs/devel/2to3_checklist">http://svn.gna.org/viewcvs/*checkout*/relax/trunk/docs/devel/2to3_checklist</a>
.  These commands are used on the entire code base, but the fatal
changes to lib.compat are always reverted.  Now there is almost no
relax code, apart from lib.compat, that the 2to3 script touches.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">    I have an SVG file of the nmrglue logo from which the small jpg was
created.  I'll need to find where it is stored on my computer at home but
I'll send it along with a higher resolution png/jpg once I locate it.
</pre></blockquote><pre style="margin: 0em;">

Cheers!  It'll be good to use the logo within relax's GUI, and maybe
one day in the manual if someone writes a chapter on this.  Have you
thought of adding it to the nmrglue sources and hence the distribution
archives?  We do that for relax, with all original graphics in
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/graphics/">http://svn.gna.org/viewcvs/relax/trunk/graphics/</a>.  I have seen the
relax graphics used by third parties at conferences on posters.  You
might have the same luck with nmrglue users - simply making the
original SVG icon easily available to PhD students and postdocs will
probably result in it being on more posters.  It could be good for
free advertising ;)


</pre><blockquote class="blockquote"><pre style="margin: 0em;">    Best of luck on getting relax to play nicely with nmrglue.  If there is
anything I can do to help on the nmrglue side feel free to ask.
</pre></blockquote><pre style="margin: 0em;">

Cheers, I'm sure this won't be a problem in Troels' capable hands.

</pre><blockquote class="blockquote"><pre style="margin: 0em;"> nmrglue is
BSD licensed and I would like to keep it that way, if you send any code my
way I'd appreciate if it could be licensed under the same terms.
</pre></blockquote><pre style="margin: 0em;">

No problems.  For the SVG file, could you put your copyright notice at
the top?  For example just after the comment:

&lt;!-- Created with Inkscape (<a  rel="nofollow" href="http://www.inkscape.org/">http://www.inkscape.org/</a>) --&gt;

wrapped in the &quot;&lt;!--&quot; and &quot;--&gt;&quot; elements.  This will be better for
then including with the relax sources.

Cheers,

Edward
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00005" href="msg00005.html">Re: Implement handles for nmrglue in relax</a></strong>
<ul><li><em>From:</em> Jonathan Helmus</li></ul></li>
<li><strong><a name="00006" href="msg00006.html">Re: Implement handles for nmrglue in relax</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Dec 03 17:00:14 2014</div>  
</body>
</html>
