<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r24983 &#45; in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/ -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 18 Aug 2014 17:55:20 +0200 -->
<!--X-Message-Id: CAED9pY9&#45;vLr2K6jCK2MWcDxh2oMX9ZhVa8cQZbKQK8ESxa4t2Q@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XH7qn&#45;0006pJ&#45;83@subversion.gna.org -->
<!--X-Reference: CAED9pY9TdjqtAhG0pWRww&#45;FErv+G3zKDWJZGEWUVAVuuX6ARXg@mail.gmail.com -->
<!--X-Reference: CA+CBx2Nq+q4dkwsmS0mdXYWdB=KR0td_PzPMRHOaeCx9FO6dyQ@mail.gmail.com -->
<!--X-Reference: CAED9pY8HvzRhpfb9zAkGRJ3AG2ciPzKBS4u1tOc9X3uKjEEqUA@mail.gmail.com -->
<!--X-Reference: CA+CBx2NT+Q8=zimCfQBDo6jvSNHCpy1Vc9fxo=YvkDtX8nejog@mail.gmail.com -->
<!--X-Reference: CAED9pY8hajEnAWXqMkfRPLn2=2zpnMMRpbrYDKz1X4hH=eRVOg@mail.gmail.com -->
<!--X-Reference: CAED9pY9CdK95xJoQHrFq70utU4dQ4+uzy5=4Rs1ZeRcWkwZttg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r24983 - in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/ -- August 18, 2014 - 17:55</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r24983 - in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00121" class="tabs">Index by Date</a> | <a href="threads.html#00121" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00120.html">Date Prev</a>] [<a href="msg00122.html">Date Next</a>] [<a href="msg00119.html">Thread Prev</a>] [<a href="msg00123.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtek√¶r Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 18 Aug 2014 17:54:45 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=6mC818jMlwHaEx9EM2qbmXk9w6EyH59AkKWWPwvmxYI=; b=zw1TNAciZ9gcygP1LJIfcmNoajYiAlifuFlkRJoP/AY6yFueT5QWVzNNPo/9AJrxze 439+q25WW5H+kX5B8oPcGlyq5Jh96B0mAV4R5eA14CZUa8QysJFWqOVY9mMipuoDJhwz 8f073aEAbjBA1tFlvoh/S/XLAQbSX8tFrf6NpEZBnLYh39tVkwnCYCQjOYKRkhFaTEEs ETk7VvcmfBT1mmWqMtL1NFwA8kA8NgVRmnqwvI8M4gRRYH+99q2WUz6l146SnnKo1IRA 15hkD/Yzsc+jWeQNZRtUIbQVBp2vpNzCoXeMoMM2BlqYdVaAMR/tk2F2hFCYoyYA/H2U nDvg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00121.html">CAED9pY9-vLr2K6jCK2MWcDxh2oMX9ZhVa8cQZbKQK8ESxa4t2Q@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XH7qn-0006pJ-83@subversion.gna.org&gt; &lt;<a href="msg00101.html">CAED9pY9TdjqtAhG0pWRww-FErv+G3zKDWJZGEWUVAVuuX6ARXg@mail.gmail.com</a>&gt; &lt;CA+CBx2Nq+q4dkwsmS0mdXYWdB=KR0td_PzPMRHOaeCx9FO6dyQ@mail.gmail.com&gt; &lt;<a href="msg00109.html">CAED9pY8HvzRhpfb9zAkGRJ3AG2ciPzKBS4u1tOc9X3uKjEEqUA@mail.gmail.com</a>&gt; &lt;CA+CBx2NT+Q8=zimCfQBDo6jvSNHCpy1Vc9fxo=YvkDtX8nejog@mail.gmail.com&gt; &lt;CAED9pY8hajEnAWXqMkfRPLn2=2zpnMMRpbrYDKz1X4hH=eRVOg@mail.gmail.com&gt; &lt;CAED9pY9CdK95xJoQHrFq70utU4dQ4+uzy5=4Rs1ZeRcWkwZttg@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on August 18, 2014 - 17:55:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

I will continue from your last post in the twin thread
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.scm/22734">http://thread.gmane.org/gmane.science.nmr.relax.scm/22734</a>.  I have
copied and pasted your message below:


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I could write a section on how models are sorted and nested.
And then add some examples.
</pre></blockquote><pre style="margin: 0em;">

A hardcoded table will be far more practical.  The user will know
which model they would like to optimise, and by looking it up in a
table they will be able to directly see which models it will use for
the default nesting, if any are used at all.  Programatically
determining the model nesting is a nasty problem, as the measures for
this should be model accuracy under most conditions and speed - two
things which cannot be reliably programatically determined.  And we
need to have hardcoded logic that certain models should not be nested
at all.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">By having a specialised function for this, the user can actually try
out the outcome of this before starting calculations.

Another way, is to make it possible to order how the models are
analysed in the GUI.
By a +/- button, moving the models up, and down.
Here, the initial sorting could be performed by the function.
</pre></blockquote><pre style="margin: 0em;">

We should not have a separate solution for the GUI and
scripting/prompt UI.  All parts of all UIs are designed so that they
are equal.  You can do everything in all interfaces (well, apart from
Python programming in the GUI).  So that is why a dictionary of model
nesting, defaulting to say MODEL_NESTING, passed into the
auto-analysis is one of the best solutions.  The user could manipulate
this Python structure in a script or the prompt UI.  And in the GUI we
could create a special GUI window for this nesting model structure.
See the spectrum.replicated user function for the best GUI element for
this purpose (this element already exists, so we can recycle it for
easier implementation).  Here the wx.ComboBoxes would list all
dispersion models.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">That takes care of the sorting.
</pre></blockquote><pre style="margin: 0em;">

The sorting should be based on the nesting which should be based on
accuracy and speed and should be based on which models will be
optimised.  This can be programatically handled if a special
MODEL_NESTING structure is created.  However a hardcoded order might
be the easiest way to resolve all dependencies, in case a user asks
for an impossible combination.  I.e. use B14 for CR72, and
simultaneously use CR72 for B14.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Then comes the nesting.
</pre></blockquote><pre style="margin: 0em;">

I would rather say that the sorting is required for the dependency
resolution of the nesting.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Again, for each model the user could select which model to nest from.
Again with the initial suggestion by the function.
</pre></blockquote><pre style="margin: 0em;">

I think the logical pre-determination of model nesting by an
experimental scientist would be better than any programmatic solution
based on metadata.  The old nesting in the auto-analysis was not
flexible enough, but the new solution is also far from ideal and is
rather dangerous.  Designing a third solution whereby we can say what
is best for nesting each model, defaulting to lower and lower quality
models if the higher quality model is not in the list, would be best.
And allowing us to say that IT99, M61, LM63, TSMFK01, TAP03, etc.
should not have a nested model based on the unique part of the
dispersion space they model or the unique conditions they fulfil would
be best.  There is no need to delete the metadata variables as that
could be used elsewhere.

Note that the nesting is unique to the auto-analysis and is not
available for a custom user defined analysis.  But having a
MODEL_NESTING structure could be useful for such a power user.  Also
the nesting we published in
<a  rel="nofollow" href="http://dx.doi.org/10.1093/bioinformatics/btu166">http://dx.doi.org/10.1093/bioinformatics/btu166</a> should be considered
quite important, as users will only just now be reading about that.

Regards,

Edward


On 18 August 2014 17:18, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">For future reference, this issue is being simultaneously discussed in
the thread for r24984 at
<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.scm/22734">http://thread.gmane.org/gmane.science.nmr.relax.scm/22734</a>.  Troels,
could you continue the discussions all in this thread?

Cheers,

Edward

On 18 August 2014 17:10, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Ah, this logic makes more sense :)  We should then use a combination
of model speed and accuracy as the decider for both nesting and order!
 Note that the entire point of the nesting is for speed - by avoiding
the grid search for very slow, i.e. numeric, models.  The year the
model was published is not very useful for this.

In the CPMG data case, B14 is better than CR72 for slow exchange.  But
CR72 is far better than IT99 or TSMFK01 as these are special case
models which do not arise often (which should be identified by the
user before the analysis).  B14 and CR72 are probably not so great for
fast exchange situations due to parameter redundancy making the
optimisation problem hell for these models.  Note that because of
historical reasons, possibly speed and politics as well, that many
users will choose CR72 instead of B14 (it unfortunately takes a long
time for the field to move to better solutions).  For the R1rho
models, MP05 is better than TP02, DPL94, etc.  So maybe we need a hard
coded dictionary of lists such as:

MODEL_NESTING = {
    ...
    MODEL_CR72:  [],
    MODEL_B14:  [MODEL_CR72],
    MODEL_NS_CPMG_2SITE_EXPANDED:  [MODEL_B14, MODEL_CR72],
    MODEL_NS_CPMG_2SITE_3D:  [MODEL_NS_CPMG_2_SITE_EXPANDED,
MODEL_B14, MODEL_CR72],
    ...
    MODEL_NS_R1RHO_2SITE:  [MODEL_MP05, MODEL_TAP03, MODEL_TP02, 
MODEL_DPL94],
    ...
}

So here the B14 model is used for the 'NS CPMG 2-site expanded' model
first, and then drops back to CR72 if B14 does not exist.  We will
have to create a hardcoded list of model nesting in the relax manual
for this - such a table is essential for the user.  Therefore having a
hardcoded dictionary in the variables module is not an issue.  We
could provide a set of functions in the
specific_analyses.relax_disp.model module to change this dictionary,
if you wish to have it programatically changed.  Or, better yet,
MODEL_NESTING would be a special Python dictionary object that has
methods for changing its defaults.

Anyway, it is very hard to pick which model should be used, as the
fast vs. slow exchange problem is a dominating factor for the nesting
for the numeric models and the alpha-value calculation is not
implemented yet (<a  rel="nofollow" href="https://gna.org/task/?7800">https://gna.org/task/?7800</a>).  Nevertheless, hardcoded
good default values based on logic of accuracy and speed would be very
useful and match a hardcoded table in the manual.  But the fast vs.
slow question might make users want to change the model nesting, hence
why I mentioned earlier about accepting a model nesting dictionary as
an argument for the relax_disp auto-analysis.  And if the user knows
that the best analytic model for their data is TSMFK01 (or IT99), then
they would want to use this as the starting point for the numeric
models and would not use B14 or CR72 which in these conditions would
be bad approximations (though they might use the models anyway for
comparison).

Regards,

Edward




On 18 August 2014 16:40, Troels Emtek√¶r Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

The good thing about the code, is that a change for the nesting only
needs very little work.
Only one or two lines needs to be changed. That is all.

It became a realisation for me, that when adding new models to relax,
it should not be necessary to
hard code every possibility into relax in the auto analysis.

There have to be a function helping out with this.

I can write up some examples, which illustrate the problem.

CPMG:
models = ['R2eff', 'No Rex', 'B14', 'NS CPMG 2-site 3D', 'NS CPMG
2-site expanded']

This would for the user seem to be a good list of models to test.
The user have maybe read, that 'B14' is more precise than 'CR72', and
does not wan't &quot;waste&quot; time on CR72.

But nothing would be nested, even though that the solutions should be
expected to be quite similar.
Why not nest from 'B14'? or 'NS CPMG 2-site 3D', if the optimised
parameters are there?

models = ['R2eff', 'No Rex', 'CR72', 'B14', 'NS CPMG 2-site 3D', 'NS
CPMG 2-site expanded']
Here the user &quot;knows&quot;, that it is essential to nest from CR72.
But if 'NS CPMG 2-site expanded' has been analysed (which nested from
CR72), should 'NS CPMG 2-site 3D' then
nest from CR72 or &quot;the more precise&quot; 'NS CPMG 2-site expanded' ?

It quickly arises to a two step problem.

In which order should the models be analysed?
From which model should model nest from.

Best
Troels



2014-08-18 16:21 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,


</pre><blockquote class="blockquote"><pre style="margin: 0em;">You will soon see my commits about sorting the models.
</pre></blockquote><pre style="margin: 0em;">

I'm still catching up on your huge number of changes :)


</pre><blockquote class="blockquote"><pre style="margin: 0em;">And here we would probably have to discuss a little.
</pre></blockquote><pre style="margin: 0em;">

It's best to discuss ideas before implementing them, as it's then far
easier to change to the best course.  It's far more difficult once
code and time has been invested into one solution when a better
solution could have been first implemented.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">There is a huge time potential to nest parameters from earlier models.
</pre></blockquote><pre style="margin: 0em;">

This was a major point in our paper
(<a  rel="nofollow" href="http://dx.doi.org/10.1093/bioinformatics/btu166">http://dx.doi.org/10.1093/bioinformatics/btu166</a>, and mentioned in the
abstract) which I can now see has volume and page numbers :)


</pre><blockquote class="blockquote"><pre style="margin: 0em;">And so by common sense, it would/could be best to nest from numerical
solutions, since they are more precise.
But they are terrible slow.
</pre></blockquote><pre style="margin: 0em;">

This is not a good idea :S  Well, the analytic models are
approximations anyway so there is a bias in the parameter values, and
this destroys any value the higher precision of the numeric models
could give.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Unless they are these special hybrid version.
</pre></blockquote><pre style="margin: 0em;">

Hybrid, I don't understand?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The word &quot;silico&quot;, I took from:
A.J. Baldwin (2014). An exact solution for R2,eff in CPMG experiments
in the case of two site chemical exchange. J. Magn. Reson., 2014.
(10.1016/j.jmr.2014.02.023).

I think it is a very good representation.

&quot;Silico&quot; is &quot;fast&quot;, and precise.
</pre></blockquote><pre style="margin: 0em;">

Hmmm, maybe Nikolai should be asked about this.  I believe he would
have a strong opinion about this categorisation of his model, and I
don't remember him ever using such terminology.  Andy used the text
&quot;derived in silico&quot; in the introduction which is quite different, as
'in silico' just means on a computer.  Most modern analytic models
would also be derived using Mathametica, Maxima, etc. on a computer
and could equally be said to be 'in silico' derived.  I bet Andy also
used symbolic computational software for his paper ;)


</pre><blockquote class="blockquote"><pre style="margin: 0em;">But &quot;impossible&quot; to read and understand from the code.

I think that &quot;silico&quot; is a good way to represent a &quot;subset&quot; of
numerical solutions.

I would rather describe a model as being &quot;silico&quot;, than to add meta
data about &quot;how fast&quot; it is.
</pre></blockquote><pre style="margin: 0em;">

Why is this differential catagorisation needed at all?  I know this
would invalidate a lot of work, but would it not be better to have
hard coded nested model defaults?  I.e. a dictionary structure as you
have already used in the variables module, with one entry per model.

Regards,

Edward
</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00101" href="msg00101.html">Re: r24983 - in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00105" href="msg00105.html">Re: r24983 - in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/</a></strong>
<ul><li><em>From:</em> Troels Emtek√¶r Linnet</li></ul></li>
<li><strong><a name="00109" href="msg00109.html">Re: r24983 - in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00112" href="msg00112.html">Re: r24983 - in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/</a></strong>
<ul><li><em>From:</em> Troels Emtek√¶r Linnet</li></ul></li>
<li><strong><a name="00116" href="msg00116.html">Re: r24983 - in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00119" href="msg00119.html">Re: r24983 - in /branches/R1_fitting: specific_analyses/relax_disp/ test_suite/unit_tests/_specific_analyses/_relax_disp/</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Aug 18 18:20:20 2014</div>  
</body>
</html>
