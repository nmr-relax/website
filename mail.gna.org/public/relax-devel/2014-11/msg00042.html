<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sr #3195] Fitting of saturation recovery experiment -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 27 Nov 2014 10:08:21 +0100 -->
<!--X-Message-Id: CAED9pY_F0ByOgbRKQ9U0kYvXZyVgCXaupm=+7_qgMjh=N+oPYQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20141126&#45;155950.sv21648.57143@gna.org -->
<!--X-Reference: CAED9pY8hu1d93x2M_rVy_cCAB6ktW_OJDrEJ8Ecy4+U8t0ZHWA@mail.gmail.com -->
<!--X-Reference: 7C03ECAFB770DE43A2478DF9AF4819DFF69FE3096A@ITCCRMAIL02.MED.HARVARD.EDU -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sr #3195] Fitting of saturation recovery experiment -- November 27, 2014 - 10:08</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [sr #3195] Fitting of saturation recovery experiment</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00042" class="tabs">Index by Date</a> | <a href="threads.html#00042" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00041.html">Date Prev</a>] [<a href="msg00043.html">Date Next</a>] [<a href="msg00041.html">Thread Prev</a>] [<a href="msg00062.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Boeszoermenyi, Andras&quot; &lt;Andras_Boeszoermenyi@xxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 27 Nov 2014 10:07:51 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=zlOyRfTtRsx2lg0GIyU/f22QVJDfjCokscjXiZ/QzLM=; b=TKVAfo+PAiFgSuci3xrnNvyKat0vXISahZrHrmm0Nm26PTSgZ5GW2ZRiPhMRiClgHy plL+ia/rizEZTp7gO7QDsdFyrrG2GhqWBMYj2KQ5ztfJvQPoB4rcHTYI9DKiK1bevlYs Q6+bZ0MXc0sFVEqvPFatprKAsoBYNpv8shYBohdH1GfvwxFOwPtr9M1RO/aUZ5pMwa3U QrawcK2k0TqtdhcBigoB+fD2ZRpKj3E+/5c7YpohEW5sErKyzDQgvX1rWI0V1eQNx5mB 5aQGdlaPvswv0YDbnbFNfzhPslJxKbnFUIeGuqTYgGnkwzRyyztA5eckUMfl1kbdN6pj H7IA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY_F0ByOgbRKQ9U0kYvXZyVgCXaupm=+7_qgMjh=N+oPYQ@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00030.html">20141126-155950.sv21648.57143@gna.org</a>&gt; &lt;<a href="msg00039.html">CAED9pY8hu1d93x2M_rVy_cCAB6ktW_OJDrEJ8Ecy4+U8t0ZHWA@mail.gmail.com</a>&gt; &lt;<a href="msg00041.html">7C03ECAFB770DE43A2478DF9AF4819DFF69FE3096A@ITCCRMAIL02.MED.HARVARD.EDU</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on November 27, 2014 - 10:08:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Andras,

Please see below:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">I would be very glad to help out with that.
</pre></blockquote><pre style="margin: 0em;">

Great!


</pre><blockquote class="blockquote"><pre style="margin: 0em;">My input data format is sparky peak lists (I export them from ccpnmr, but 
that doesn't make a difference))
</pre></blockquote><pre style="margin: 0em;">

relax should handle this no problem.  There are system tests set up to
check this compatibility:

<a  rel="nofollow" href="https://gna.org/support/?3044">https://gna.org/support/?3044</a>
<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.3/test_suite.system_tests.peak_lists.Peak_lists-class.html#test_ccpn_analysis">http://www.nmr-relax.com/api/3.3/test_suite.system_tests.peak_lists.Peak_lists-class.html#test_ccpn_analysis</a>
<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.3/test_suite.system_tests.peak_lists-pysrc.html#Peak_lists.test_ccpn_analysis">http://www.nmr-relax.com/api/3.3/test_suite.system_tests.peak_lists-pysrc.html#Peak_lists.test_ccpn_analysis</a>


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The other part of the input data is a sequence file. I have problems 
loading a cyana generated structure. Not sure how it would behave with a 
structure outputted from ccpnmr or other programs. The structure is not in 
the pdb yet.
</pre></blockquote><pre style="margin: 0em;">

This should be no problem in relax.  Any column formatted file will be
sufficient.  You can even use the spectrum.read_spins user function to
load the sequence out of a peak list.  Anyway, it is better to discuss
such topics on the relax-users mailing list.  I would recommend
signing up for the relax-users and relax-devel mailing list using the
links:

<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-users/">https://mail.gna.org/listinfo/relax-users/</a>
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel/">https://mail.gna.org/listinfo/relax-devel/</a>

Using these same links, you can very quickly terminate your
subscription later on.  The advantage of subscribing is that your
messages will be instantly accepted.  Otherwise your message will have
to wait for the mailing list maintainer, Chris MacRaild
(<a  rel="nofollow" href="http://www.monash.edu.au/pharm/research/researchers/profile.html?sid=47804&amp;pid=5391">http://www.monash.edu.au/pharm/research/researchers/profile.html?sid=47804&amp;pid=5391</a>).
As he is based in Melbourne, Australia, there will be a time zone
delay between messages sent, and messages accepted.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I have two spin systems in there, but for testing, we can throw out the NHe 
from my tryptophan indole rings.
</pre></blockquote><pre style="margin: 0em;">

For testing it is best to use synthetic data, see below.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">For my test set, I can even calculate rates for inversion recovery and 
saturation recovery in ccpnmr. The reason that I changed to relax is, that 
the ccpnmr fitting routine is not robust enough for other sets.
</pre></blockquote><pre style="margin: 0em;">

Are Monte Carlo simulations used for the error analysis in CCPNMR
(<a  rel="nofollow" href="http://www.ccpn.ac.uk/software/analysis">http://www.ccpn.ac.uk/software/analysis</a>)?  What do you mean that it
is not robust enough?  From the equation you sent, it does not look
like your experiment is either inversion recovery or saturation
recovery.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I'm very happy to send you real peak lists, or do they have to be synthetic 
for some reason? I could make real peak lists without tryptophan NHes if 
that helps. For synthetic peak lists, I have no experience in making those. 
But I think I could figure that out.
</pre></blockquote><pre style="margin: 0em;">

For testing an implementation, real data is to be avoided.  The reason
is because you do not know beforehand what the real answer is.  In
software development, this can often lead to an incorrect
implementation.

A synthetic set is easy.  Take a set of Sparky formatted peak lists
for a single spin.  Then pick Rx and I0 values that are reasonable.
For R1, a value of 2.0 might be a good choice.  You could have a
second spin with a different R1 value if you wish.  For the I0, pick a
huge value in the order of 1e15.  The reason is because the peak
heights in a Sparky peak list are stored as integer values and not
floating point values.  By starting with a large intensity, you
thereby minimise truncation artefacts.  For the R1 and I0 value,
together with the time points used in the experiment, the formula of
interest can be used to then calculate the intensity for each time
point.  These can then replace the values in the Sparky peak lists to
create the synthetic test set.  Do not truncate the numbers by using
the format 9.62E+07, instead include the full integer number into the
text file.

Using this, a system test can then be set up in relax.  It would
consist of a script similar to your wr1043_0N_relax_fit.py script.
Optimisation would be performed, and then the values of R1 and I0
checked to see if the exact values can be found (to a very high degree
of accuracy).  For example as in the
Relax_fit.test_zooming_grid_search system test which can be run as:

$ relax -sd Relax_fit.test_zooming_grid_search system

This assumes you are not using the Mac OS X dmg distribution file.
The test itself is:

<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.3/test_suite.system_tests.relax_fit.Relax_fit-class.html#test_zooming_grid_search">http://www.nmr-relax.com/api/3.3/test_suite.system_tests.relax_fit.Relax_fit-class.html#test_zooming_grid_search</a>
<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.3/test_suite.system_tests.relax_fit-pysrc.html#Relax_fit.test_zooming_grid_search">http://www.nmr-relax.com/api/3.3/test_suite.system_tests.relax_fit-pysrc.html#Relax_fit.test_zooming_grid_search</a>

This uses the script located at
test_suite/system_tests/scripts/relax_fit_zooming_grid.py.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I am attaching one set of relax that I did on this system with inversion 
recovery to the task and if this is what you are looking for, then I can 
also send you R1 values for inversion and saturation recovery fitting of 
this set in ccpnmr.
</pre></blockquote><pre style="margin: 0em;">

For reference, the file is attached to task #7415
(<a  rel="nofollow" href="https://gna.org/task/?7415">https://gna.org/task/?7415</a>) as the file Relax.tar.gz
(<a  rel="nofollow" href="https://gna.org/task/download.php?file_id=22980">https://gna.org/task/download.php?file_id=22980</a>).  The synthetic data
would be far better.  Could such synthetic data be put through CCPNMR?
 Once the synthetic cases are implemented and returning the expected
result, then it could be applied to real data and comparisons between
software made.  However comparing the results of the synthetic data
for different software is a far better method, as it is a real
positive control.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I did have a problem with the experiment that I ran on relax though. It 
does converge and produces beautiful values, but the Rx values are 
negative. Which doesn't make any sense to me. The pattern is exactly as it 
should be, but the values are simply wrong. Do you have an idea what could 
be going on there?
</pre></blockquote><pre style="margin: 0em;">

Do you have a good original reference for your experiment?  I.e. one
with the pulse sequence and also the exponential equation used?  You
said that the formula for your data is:

I(t) =  I0*(1 - exp(−R1*t))        (1)

In the relax implementation, the formula is:

I(t) = I0*exp(-Rx*t)        (2)

These are clearly not the same as (2) heads to zero as t-&gt;inf, whereas
(1) heads to I0 as t-&gt;inf.  To determine exactly what is happening,
the synthetic data would be best.  Are you sure you reported the
correct equation?  Equation (1) is zero when t is zero, which does not
seem to make sense.  Should the saturation recover not start at I0 and
return to zero?  Equation (2) is supposed to be the one used for
saturation recovery.  Maybe your data is actually in the form of:

I(t) = -I0*exp(-Rx*t)        (3)

Cheers,

Edward


P. S.  Note that there is a 6 hour time zone difference, so I may only
be able to answer you in your mornings.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Best regards,
Andras
________________________________________
From: edward.dauvergne@xxxxxxxxx [edward.dauvergne@xxxxxxxxx] On Behalf Of 
Edward d'Auvergne [edward@xxxxxxxxxxxxx]
Sent: Wednesday, November 26, 2014 1:04 PM
To: Andras Boeszoermenyi
Cc: Boeszoermenyi, Andras; relax-devel@xxxxxxx
Subject: Re: [sr #3195] Fitting of saturation recovery experiment

Hi Andras,

I was wondering if you were interested in helping out with the
inversion-recovery task at <a  rel="nofollow" href="https://gna.org/task/index.php?7415">https://gna.org/task/index.php?7415</a> ?  What
is your input data format, i.e. which peak list format are you using?
Would it be possible to create synthetic peak lists containing with a
single spin system whereby you have calculated what the peak
intensities are based on your equation and some I0 and Rx parameter
values?  If this could be done, it could be added to the relax test
suite directories and form the basis of an implementation.  It could
easily then be used to create a system test which checks that the
fitting occurs as expected.  Then implementing this should be easy.

Cheers,

Edward



On 26 November 2014 at 16:59, Andras Boeszoermenyi
&lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">URL:
  &lt;<a  rel="nofollow" href="http://gna.org/support/?3195">http://gna.org/support/?3195</a>&gt;

                 Summary: Fitting of saturation recovery experiment
                 Project: relax
            Submitted by: andras
            Submitted on: Wed 26 Nov 2014 03:59:50 PM UTC
                Category: Feature request
                Priority: 5 - Normal
                Severity: 3 - Normal
                  Status: None
             Assigned to: None
        Originator Email:
             Open/Closed: Open
         Discussion Lock: Any
        Operating System: Mac OS

    _______________________________________________________

Details:

Hi,

would it be possible to add an option to fit saturation recovery 
experiments
to the existing 'exp' and 'inv' options in relax_fit?

The formula should look like this:

I(t) =  I0*(1 - exp(−R1*t))

Best regards,
Andras Boeszoermenyi




    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/support/?3195">http://gna.org/support/?3195</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00062" href="msg00062.html">RE: [sr #3195] Fitting of saturation recovery experiment</a></strong>
<ul><li><em>From:</em> Boeszoermenyi, Andras</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00030" href="msg00030.html">[sr #3195] Fitting of saturation recovery experiment</a></strong>
<ul><li><em>From:</em> Andras Boeszoermenyi</li></ul></li>
<li><strong><a name="00039" href="msg00039.html">Re: [sr #3195] Fitting of saturation recovery experiment</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00041" href="msg00041.html">RE: [sr #3195] Fitting of saturation recovery experiment</a></strong>
<ul><li><em>From:</em> Boeszoermenyi, Andras</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Nov 27 16:40:16 2014</div>  
</body>
</html>
