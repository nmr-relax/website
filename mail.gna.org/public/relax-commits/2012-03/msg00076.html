<!-- MHonArc v2.6.16 -->
<!--X-Subject: r15491 &#45; in /branches/inversion&#45;recovery: ./ generic_fns/ multi/	scons/ specific_fns/model_free/ test_suite/unit_tests/ test... -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Thu, 15 Mar 2012 20:08:30 +0100 -->
<!--X-Message-Id: E1S8G2I&#45;00065u&#45;MC@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r15491 - in /branches/inversion-recovery: ./ generic_fns/ multi/	scons/ specific_fns/model_free/ test_suite/unit_tests/ test... -- March 15, 2012 - 20:08</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r15491 - in /branches/inversion-recovery: ./ generic_fns/ multi/	scons/ specific_fns/model_free/ test_suite/unit_tests/ test...</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00076" class="tabs">Index by Date</a> | <a href="threads.html#00076" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00075.html">Date Prev</a>] [<a href="msg00077.html">Date Next</a>] [<a href="msg00075.html">Thread Prev</a>] [<a href="msg00077.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Thu, 15 Mar 2012 19:08:30 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00076.html">E1S8G2I-00065u-MC@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on March 15, 2012 - 20:08:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Thu Mar 15 20:08:30 2012
New Revision: 15491

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=15491&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=15491&amp;view=rev</a>
Log:
Merged revisions 15471,15473-15474,15479-15483,15487 via svnmerge from 
svn+ssh://bugman@xxxxxxxxxxx/svn/relax/1.3

........
  r15471 | bugman | 2012-03-12 15:26:57 +0100 (Mon, 12 Mar 2012) | 5 lines
  
  Added some code to detect the bit version of MS Windows in the information 
print out.
  
  This should help better determine if 32 or 64-bit Windows is being used.
........
  r15473 | bugman | 2012-03-13 16:56:38 +0100 (Tue, 13 Mar 2012) | 3 lines
  
  Added the ability to skip scripts in the package __all__ list unit test 
checks.
........
  r15474 | bugman | 2012-03-13 16:57:14 +0100 (Tue, 13 Mar 2012) | 3 lines
  
  The multi-processor package 'test_implementation.py' script is now 
blacklisted from the __all__ check.
........
  r15479 | bugman | 2012-03-15 16:48:13 +0100 (Thu, 15 Mar 2012) | 5 lines
  
  The extern and minfx.scipy_subset relax packages are now excluded form the 
API documentation.
  
  This will be updated at <a  rel="nofollow" href="http://www.nmr-relax.com/api/">http://www.nmr-relax.com/api/</a> after the next relax 
release.
........
  r15480 | bugman | 2012-03-15 16:58:15 +0100 (Thu, 15 Mar 2012) | 3 lines
  
  Epydoc docstring fix.
........
  r15481 | bugman | 2012-03-15 17:05:18 +0100 (Thu, 15 Mar 2012) | 3 lines
  
  The setup.py script can now be imported for the epydoc API documentation 
system.
........
  r15482 | bugman | 2012-03-15 17:06:12 +0100 (Thu, 15 Mar 2012) | 5 lines
  
  The multi-processor test implementation scripts are now excluded from the 
API documentation.
  
  The import of the scripts was failing, and they are not part of the relax 
API.
........
  r15483 | bugman | 2012-03-15 17:21:14 +0100 (Thu, 15 Mar 2012) | 3 lines
  
  Formatting of the epydoc exclusion list.
........
  r15487 | bugman | 2012-03-15 20:05:40 +0100 (Thu, 15 Mar 2012) | 13 lines
  
  Fix for bug #19528 (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?19528">https://gna.org/bugs/?19528</a>).
  
  This bug was reported by Hugh Dannatt (h dott dannatt att sheffield dot ac 
dot uk).
  
  The problem was in the multi-processor code for the model-free 
calculations, specifically for the
  Monte Carlo simulations.  Rather than processing the queue of slave 
processor commands for the
  model-free calculation for each spin system at the end of each simulation, 
the processing of the
  queue was happening at the end of all Monte Carlo simulations.  This caused 
memory usage to bloat!
  A full description of the problem can be found at
  <a  rel="nofollow" href="https://mail.gna.org/public/relax-users/2012-03/msg00037.html">https://mail.gna.org/public/relax-users/2012-03/msg00037.html</a> (Message-id:
  &lt;CAED9pY_Z1wGEg3gZo3WCkhvYTBdqs-Feex5Og4vJFovgJkUOyw@xxxxxxxxxxxxxx&gt;).
........

Modified:
    branches/inversion-recovery/   (props changed)
    branches/inversion-recovery/generic_fns/minimise.py
    branches/inversion-recovery/info.py
    branches/inversion-recovery/multi/__init__.py
    branches/inversion-recovery/scons/manuals.py
    branches/inversion-recovery/setup.py
    branches/inversion-recovery/specific_fns/model_free/mf_minimise.py
    branches/inversion-recovery/test_suite/unit_tests/_multi/test___init__.py
    branches/inversion-recovery/test_suite/unit_tests/package_checking.py

Propchange: branches/inversion-recovery/
------------------------------------------------------------------------------
--- svnmerge-integrated (original)
+++ svnmerge-integrated Thu Mar 15 20:08:30 2012
@@ -1,1 +1,1 @@
-/1.3:1-15466
+/1.3:1-15489

Modified: branches/inversion-recovery/generic_fns/minimise.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/generic_fns/minimise.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/generic_fns/minimise.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff</a>
==============================================================================
--- branches/inversion-recovery/generic_fns/minimise.py (original)
+++ branches/inversion-recovery/generic_fns/minimise.py Thu Mar 15 20:08:30 
2012
@@ -29,7 +29,6 @@
 # relax module imports.
 from generic_fns.mol_res_spin import return_spin, spin_loop
 from generic_fns import pipes
-from multi import Processor_box
 from relax_errors import RelaxError
 import specific_fns
 from status import Status; status = Status()
@@ -138,12 +137,6 @@
     # Grid search.
     else:
         grid_search(lower=lower, upper=upper, inc=inc, 
constraints=constraints, verbosity=verbosity)
-
-    # Get the Processor box singleton (it contains the Processor instance).
-    processor_box = Processor_box() 
-
-    # Execute the queued elements.
-    processor_box.processor.run_queue()
 
 
 def minimise(min_algor=None, min_options=None, func_tol=None, grad_tol=None, 
max_iterations=None, constraints=True, scaling=True, verbosity=1, 
sim_index=None):
@@ -214,12 +207,6 @@
     else:
         minimise(min_algor=min_algor, min_options=min_options, 
func_tol=func_tol, grad_tol=grad_tol, max_iterations=max_iterations, 
constraints=constraints, scaling=scaling, verbosity=verbosity)
 
-    # Get the Processor box singleton (it contains the Processor instance).
-    processor_box = Processor_box() 
-
-    # Execute the queued elements.
-    processor_box.processor.run_queue()
-
 
 def reset_min_stats(data_pipe=None, spin=None):
     &quot;&quot;&quot;Function for resetting the minimisation statistics.

Modified: branches/inversion-recovery/info.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/info.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/info.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff</a>
==============================================================================
--- branches/inversion-recovery/info.py (original)
+++ branches/inversion-recovery/info.py Thu Mar 15 20:08:30 2012
@@ -28,7 +28,7 @@
 if hasattr(ctypes, 'windll'):
     import ctypes.wintypes
 import numpy
-from os import popen3
+from os import environ, popen3
 import platform
 from string import split
 import sys
@@ -397,6 +397,8 @@
             text = text + (format % (&quot;Distribution: &quot;, (platform.dist()[0] + 
&quot; &quot; + platform.dist()[1] + &quot; &quot; + platform.dist()[2])))
         if hasattr(platform, 'platform'):
             text = text + (format % (&quot;Full platform string: &quot;, 
(platform.platform())))
+        if hasattr(ctypes, 'windll'):
+            text = text + (format % (&quot;Windows architecture: &quot;, 
(self.win_arch())))
 
         # Python info.
         text = text + (&quot;\nPython information:\n&quot;)
@@ -436,6 +438,25 @@
         return text
 
 
+    def win_arch(self):
+        &quot;&quot;&quot;Determine the MS Windows architecture.
+
+        @return:    The architecture string.
+        @rtype:     str
+        &quot;&quot;&quot;
+
+        # 64-bit versions.
+        if environ.has_key('PROCESSOR_ARCHITEW6432'):
+            arch = environ['PROCESSOR_ARCHITEW6432']
+
+        # Default 32-bit.
+        else:
+            arch = environ['PROCESSOR_ARCHITECTURE']
+
+        # Return the architecture.
+        return arch
+
+
 
 class MemoryStatusEx(ctypes.Structure):
     &quot;&quot;&quot;Special object for obtaining hardware info in MS Windows.&quot;&quot;&quot;

Modified: branches/inversion-recovery/multi/__init__.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/multi/__init__.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/multi/__init__.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff</a>
==============================================================================
--- branches/inversion-recovery/multi/__init__.py (original)
+++ branches/inversion-recovery/multi/__init__.py Thu Mar 15 20:08:30 2012
@@ -157,7 +157,7 @@
     @param processor_name:  Name of the processor module/class to load.
     @type processor_name:   str
     @keyword verbosity:     The verbosity level at initialisation.  This can 
be changed during program execution.  A value of 0 suppresses all output.  A 
value of 1 causes the basic multi-processor information to be printed.  A 
value of 2 will switch on a number of debugging print outs.  Values greater 
than 2 currently do nothing, though this might change in the future.
-    @type keyword:          int
+    @type verbosity:        int
     @return:                A loaded processor object or None to indicate 
failure.
     @rtype:                 multi.processor.Processor instance
     &quot;&quot;&quot;

Modified: branches/inversion-recovery/scons/manuals.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/scons/manuals.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/scons/manuals.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff</a>
==============================================================================
--- branches/inversion-recovery/scons/manuals.py (original)
+++ branches/inversion-recovery/scons/manuals.py Thu Mar 15 20:08:30 2012
@@ -1,6 +1,6 @@
 
###############################################################################
 #                                                                            
 #
-# Copyright (C) 2006-2011 Edward d'Auvergne                                  
 #
+# Copyright (C) 2006-2012 Edward d'Auvergne                                  
 #
 #                                                                            
 #
 # This file is part of the program relax.                                    
 #
 #                                                                            
 #
@@ -93,7 +93,15 @@
 
     # exclude
     #   The list of objects to exclude.
-    exclude = ['graphics', 'sample_scripts', 'scripts']
+    exclude = [
+        'extern',
+        'graphics',
+        'minfx.scipy_subset',
+        'multi.test_implementation',
+        'multi.test_implementation2',
+        'sample_scripts',
+        'scripts'
+    ]
 
     # output
     #   The type of output that should be generated.  Should be one

Modified: branches/inversion-recovery/setup.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/setup.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/setup.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff</a>
==============================================================================
--- branches/inversion-recovery/setup.py (original)
+++ branches/inversion-recovery/setup.py Thu Mar 15 20:08:30 2012
@@ -1,6 +1,6 @@
 
###############################################################################
 #                                                                            
 #
-# Copyright (C) 2011 Edward d'Auvergne                                       
 #
+# Copyright (C) 2011-2012 Edward d'Auvergne                                  
 #
 #                                                                            
 #
 # This file is part of the program relax.                                    
 #
 #                                                                            
 #
@@ -38,7 +38,10 @@
 # Python module import.
 from os import getcwd, listdir, sep
 from re import search
-from setuptools import setup
+try:
+    from setuptools import setup
+except ImportError:
+    setup = None
 import sys
 
 # relax module imports.

Modified: branches/inversion-recovery/specific_fns/model_free/mf_minimise.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/specific_fns/model_free/mf_minimise.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/specific_fns/model_free/mf_minimise.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff</a>
==============================================================================
--- branches/inversion-recovery/specific_fns/model_free/mf_minimise.py 
(original)
+++ branches/inversion-recovery/specific_fns/model_free/mf_minimise.py Thu 
Mar 15 20:08:30 2012
@@ -1589,6 +1589,9 @@
             num_data_sets = 0
             data_store.num_spins = 1
 
+        # Get the Processor box singleton (it contains the Processor 
instance) and alias the Processor.
+        processor_box = Processor_box() 
+        processor = processor_box.processor
 
         # Loop over the minimisation instances.
         #######################################
@@ -1683,10 +1686,6 @@
             if min_algor == 'back_calc':
                 return self.mf.calc_ri()
 
-            # Get the Processor box singleton (it contains the Processor 
instance) and alias the Processor.
-            processor_box = Processor_box() 
-            processor = processor_box.processor
-
             # Parallelised grid search for the diffusion parameter space.
             if match('^[Gg]rid', min_algor) and data_store.model_type == 
'diff':
                 # Print out.
@@ -1707,6 +1706,9 @@
                     memo = MF_memo(model_free=self, 
model_type=data_store.model_type, spin=spin, sim_index=sim_index, 
scaling=scaling, scaling_matrix=data_store.scaling_matrix)
                     processor.add_to_queue(command, memo)
 
+                # Execute the queued elements.
+                processor.run_queue()
+
                 # Exit this method.
                 return
 
@@ -1724,3 +1726,6 @@
             # Set up the model-free memo and add it to the processor queue.
             memo = MF_memo(model_free=self, 
model_type=data_store.model_type, spin=spin, sim_index=sim_index, 
scaling=scaling, scaling_matrix=data_store.scaling_matrix)
             processor.add_to_queue(command, memo)
+
+        # Execute the queued elements.
+        processor.run_queue()

Modified: 
branches/inversion-recovery/test_suite/unit_tests/_multi/test___init__.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/test_suite/unit_tests/_multi/test___init__.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/test_suite/unit_tests/_multi/test___init__.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff</a>
==============================================================================
--- branches/inversion-recovery/test_suite/unit_tests/_multi/test___init__.py 
(original)
+++ branches/inversion-recovery/test_suite/unit_tests/_multi/test___init__.py 
Thu Mar 15 20:08:30 2012
@@ -1,6 +1,6 @@
 
###############################################################################
 #                                                                            
 #
-# Copyright (C) 2009 Edward d'Auvergne                                       
 #
+# Copyright (C) 2009-2012 Edward d'Auvergne                                  
 #
 #                                                                            
 #
 # This file is part of the program relax.                                    
 #
 #                                                                            
 #
@@ -38,3 +38,6 @@
         self.package = multi
         self.package_name = 'multi'
         self.package_path = sys.path[0] + sep + 'multi'
+
+        # Blacklisted scripts.
+        self.blacklist = ['test_implementation.py']

Modified: 
branches/inversion-recovery/test_suite/unit_tests/package_checking.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/test_suite/unit_tests/package_checking.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/inversion-recovery/test_suite/unit_tests/package_checking.py?rev=15491&amp;r1=15490&amp;r2=15491&amp;view=diff</a>
==============================================================================
--- branches/inversion-recovery/test_suite/unit_tests/package_checking.py 
(original)
+++ branches/inversion-recovery/test_suite/unit_tests/package_checking.py Thu 
Mar 15 20:08:30 2012
@@ -1,6 +1,6 @@
 
###############################################################################
 #                                                                            
 #
-# Copyright (C) 2009-2011 Edward d'Auvergne                                  
 #
+# Copyright (C) 2009-2012 Edward d'Auvergne                                  
 #
 #                                                                            
 #
 # This file is part of the program relax.                                    
 #
 #                                                                            
 #
@@ -47,6 +47,10 @@
             if file == '__init__.py':
                 continue
 
+            # Skip blacklisted files.
+            if hasattr(self, 'blacklist') and file in self.blacklist:
+                continue
+
             # Remove the '.py' part.
             module = file[:-3]
 



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Mar 15 20:20:07 2012</div>  
</body>
</html>
