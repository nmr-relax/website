<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: a black box is needed -->
<!--X-From-R13: [vpunry Pvrev <zvpunry.ovrevNtzk.pu> -->
<!--X-Date: Thu, 17 Sep 2009 02:42:28 +0200 -->
<!--X-Message-Id: 4AB185ED.2020401@gmx.ch -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 20090916163824.28010ecc@mail.ccrc.uga.edu -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: a black box is needed -- September 17, 2009 - 02:42</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: a black box is needed</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00006" class="tabs">Index by Date</a> | <a href="threads.html#00006" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00005.html">Date Prev</a>] [Date Next] [<a href="msg00004.html">Thread Prev</a>] [Thread Next]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Boaz Shapira &lt;bshapira@xxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 17 Sep 2009 10:42:21 +1000</li>
<li class="menuitem">
<em>Cc</em>: relax-users@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00006.html">4AB185ED.2020401@gmx.ch</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;20090916163824.28010ecc@xxxxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Thunderbird 2.0.0.23 (X11/20090817)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Michael Bieri</strong> on September 17, 2009 - 02:42:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Hi Boaz

</pre><tt>There are many data present in the result file obtained by relax (final 
</tt><tt>run of full_analysis.py).
</tt><pre style="margin: 0em;">

</pre><tt>To extract the data I am interested, I'm created the following script: 
</tt><tt>final_data_extraction.py (see attachment).
</tt><pre style="margin: 0em;">

</pre><tt>Just navigate to your final run directory, where the file results.bz2 is 
</tt><tt>located, and copy your pdb file and this script into it. Then run the 
</tt><tt>script using the command &quot;relax final_data_extraction.py&quot;.
</tt><pre style="margin: 0em;">

</pre><tt>This will create a table with Residue Numer - Model - S2 - Rex as well 
</tt><tt>as single data files and grace plots. Furtermore, it calculates the 
</tt><tt>diffucion tensor pdb and generates PyMol macros to visualize the S2 and 
</tt><tt>Rex values in PyMol (just run the macros in PyMol terminal by the 
</tt><tt>command &quot;@s2.pml&quot;).
</tt><pre style="margin: 0em;">

The script works with relax 1.3.4 (not tested with 1.3.3).

I hope this script may help you! There is more that can be incorporated.

Cheers
Michael


Michael Bieri, PhD
Department of Biochemistry and Molecular Biology
Bio21 Molecular Science and Biotechnology Institute
The University of Melbourne, 30 Flemington Road
Parkville, Victoria 3010, Australia

Tel.: +61 3 8334 2256

<a  rel="nofollow" href="http://www.biochemistry.unimelb.edu.au">http://www.biochemistry.unimelb.edu.au</a>



Boaz Shapira wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

I just installed relax and tried to figure out how it works (couldn't).
</pre><tt>I have no idea about python and I don't mind to keep it that way 
</tt><tt>unless i have no other choice.
</tt><tt>Still, I tried to play with the examples and couldn't make it work 
</tt><tt>(the relax --text-suite didn't give me error)
</tt><pre style="margin: 0em;">


I tried to run model-free.py from the relax prompt but it gives me error.
&quot; Traceback (most recent call last):
  File &quot;&lt;console&gt;&quot;, line 1, in &lt;module&gt;
NameError: name 'model' is not defined &quot;

Then I copied line by line and it did work.
It save it in a .bz2 format.
Now If I want to read the data what format should I use?
It looks like a source html file.


</pre><tt>In general I collected data on two fields and want to analyze the data 
</tt><tt>with a black box (the full_analysis.py ?)
</tt><pre style="margin: 0em;">
I have the input files in the right format as in the examples
I have the pdb file

Is it possible to simply run a black-box that will give me an output:
</pre><tt>List of the residues with the best model for each, the values for this 
</tt><tt>model (S2, tau ...), the goodness of the fitting, and
</tt><pre style="margin: 0em;">
the overall diffusion tensor?
This black box will also reject &quot;bad&quot; relaxation data.
and all of that will be given in a text file?

It is too much to ask?

Thank you,

Boaz


------------------------------------------------
Boaz Shapira PhD
Complex Carbohydrate Research Center
University of Georgia
315 Riverbend Rd
Athens, GA 30602-4712
706-542-6286
bshapira@xxxxxxxxxxxx
------------------------------------------------------------------------

_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-users mailing list
relax-users@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-users">https://mail.gna.org/listinfo/relax-users</a>
</pre><tt>  
</tt></blockquote><pre style="margin: 0em;">#####################################################################################
#          Script for Final Data Extraction after Model-free Analysis         
      #
#                                Michael Bieri                                
      #
#                                  16.9.2009                                  
      #
#####################################################################################


# Extract Data to Table

#create a table file

# Python module imports.
from string import replace

# relax module imports.
from generic_fns.mol_res_spin import spin_loop
from generic_fns import pipes


pipe.create('Data_extraction','mf')
results.read()

#create file

self.file = open('Model-free_Results.txt', 'w')

self.file.write('Data Extraction by Michael Bieri')
self.file.write(&quot;\n&quot;)
self.file.write(&quot;\n&quot;)
self.file.write(&quot;Residue                Model   S2                      
Rex\n&quot;)
self.file.write(&quot;\n&quot;)


for spin, spin_id in spin_loop(return_id=True):
            # The spin ID string.
            spin_no = spin_id[spin_id.index(':')+1:spin_id.index('&amp;')]
            spin_res = spin_id[spin_id.index('&amp;')+2:spin_id.index('@')]
            self.file.write((spin_res) + &quot; &quot; + (spin_no))
            # The spin is not selected.
            if not spin.select:
                self.file.write(&quot;\n&quot;)
                continue


# The model-free model.
            if hasattr(spin, 'model'):
                spin.model = spin.model[1:2]
                self.file.write(&quot;               &quot; + spin.model)


# S2.
            if  hasattr(spin, 's2'):
                s2 = str(spin.s2)
                s2_err = str(spin.s2_err)
                if spin.s2 == None:
                        self.file.write(&quot;&quot;)
                else:
                        self.file.write(&quot;       &quot; + s2[0:5]+ &quot; +/- &quot; + 
s2_err[0:4])


# Rex.
            if hasattr(spin, 'rex'):
                rex = str(spin.rex)
                rex_err = str(spin.rex_err)
                if spin.rex == None:
                        self.file.write(&quot;&quot;)
                else:
                        self.file.write(&quot;               &quot; + rex[0:5]+ &quot; +/- &quot; 
+ rex_err[0:4])



# Start a new line.
            self.file.write(&quot;\n&quot;)


##################################################################################################

#Create Single Data Files


value.write(param='rex', file='rex.txt', dir='final_results', force=True)
value.write(param='s2', file='s2.txt', dir='final_results', force=True)
value.write(param='s2f', file='s2f.txt', dir='final_results', force=True)
value.write(param='s2s', file='s2s.txt', dir='final_results', force=True)
value.write(param='te', file='te.txt', dir='final_results', force=True)
value.write(param='tf', file='tf.txt', dir='final_results',  force=True)
value.write(param='ts', file='ts.txt', dir='final_results', force=True)
value.write(param='rex', file='rex.txt', dir='final_results', force=True)
value.write(param='r', file='r.txt', dir='final_results', force=True)
value.write(param='rex', file='rex.txt', dir='final_results', force=True)
value.write(param='csa', file='csa.txt', dir='final_results', force=True)
value.write(param='rex', file='rex.txt', dir='final_results', force=True)
value.write(param='local_tm', file='local_tm.txt', dir='final_results', 
force=True)

##################################################################################################

#Create Grace Plots

grace.write(x_data_type='spin', y_data_type='s2', file='s2.agr', force=True)
grace.write(x_data_type='spin', y_data_type='te', file='te.agr', force=True)
grace.write(x_data_type='spin', y_data_type='s2f', file='s2f.agr', force=True)
grace.write(x_data_type='spin', y_data_type='s2s', file='s2s.agr', force=True)
grace.write(x_data_type='spin', y_data_type='ts', file='ts.agr', force=True)
grace.write(x_data_type='spin', y_data_type='tf', file='tf.agr', force=True)
grace.write(x_data_type='spin', y_data_type='csa', file='csa.agr', force=True)
grace.write(x_data_type='te', y_data_type='s2', file='s2-te.agr', force=True)

##################################################################################################

#Create Diffusion Tensor

# Display the diffusion tensor.
diffusion_tensor.display()

# Create the tensor PDB file.
tensor_file = 'tensor.pdb'
structure.create_diff_tensor_pdb(file=tensor_file, force=True)

##################################################################################################

# Create S2 Macro for PyMol 

# Python module imports.
from string import replace

# relax module imports.
from generic_fns.mol_res_spin import spin_loop
from generic_fns import pipes

#create file

self.file = open('s2.pml', 'w')

self.file.write(&quot;bg_color white\n&quot;)
self.file.write(&quot;color gray90\n&quot;)
self.file.write(&quot;hide all\n&quot;)
self.file.write(&quot;show ribbon\n&quot;)

for spin, spin_id in spin_loop(return_id=True):

#select residue
            spin_no = spin_id[spin_id.index(':')+1:spin_id.index('&amp;')]


#ribbon color
            if  hasattr(spin, 's2'):
                s2 = str(spin.s2)
                if spin.s2 == None:
                        self.file.write(&quot;&quot;)
                else:
                        width = ((1-spin.s2) * 2)
                        green = 1 - ((spin.s2)**3) 
                        green = green * green * green #* green * green
                        green = 1 - green
                        self.file.write(&quot;set_color resicolor&quot; + spin_no + &quot;, 
[0,&quot; + str(green) + &quot;,1]\n&quot;)
                        self.file.write(&quot;color resicolor&quot; + spin_no + &quot;, resi 
&quot; + spin_no + &quot;\n&quot;)
                        self.file.write(&quot;set_bond stick_radius, &quot; + 
str(width) + &quot;, resi &quot; + spin_no + &quot;\n&quot;)



self.file.write(&quot;hide all\n&quot;)
self.file.write(&quot;show sticks, name C+N+CA\n&quot;)
self.file.write(&quot;set stick_quality, 10\n&quot;)
self.file.write(&quot;ray\n&quot;)


##################################################################################################

# Create Rex Macro for PyMol 

#create file

self.file = open('rex.pml', 'w')

self.file.write(&quot;bg_color white\n&quot;)
self.file.write(&quot;color gray90\n&quot;)
self.file.write(&quot;hide all\n&quot;)
self.file.write(&quot;show ribbon\n&quot;)

max_rex = 0

#find max Rex
for spin, spin_id in spin_loop(return_id=True):

            if  hasattr(spin, 'rex'):

                  if not spin.rex == None:
                       if spin.rex &gt; max_rex:
                             max_rex = spin.rex 


for spin, spin_id in spin_loop(return_id=True):

#select residue
            spin_no = spin_id[spin_id.index(':')+1:spin_id.index('&amp;')]
#ribbon color
            if  hasattr(spin, 'rex'):
                rex = str(spin.rex)
                if spin.rex == None:
                        self.file.write(&quot;&quot;)
                else:
                        rel_rex = spin.rex / max_rex
                        width = ((rel_rex) * 2)
                        green = ((rel_rex)) 
                        green = green * green * green #* green * green
                        green = 1 - green
                        self.file.write(&quot;set_color resicolor&quot; + spin_no + &quot;, 
[0,&quot; + str(green) + &quot;,1]\n&quot;)
                        self.file.write(&quot;color resicolor&quot; + spin_no + &quot;, resi 
&quot; + spin_no + &quot;\n&quot;)
                        self.file.write(&quot;set_bond stick_radius, &quot; + 
str(width) + &quot;, resi &quot; + spin_no + &quot;\n&quot;)



self.file.write(&quot;hide all\n&quot;)
self.file.write(&quot;show sticks, name C+N+CA\n&quot;)
self.file.write(&quot;set stick_quality, 10\n&quot;)
self.file.write(&quot;ray\n&quot;)



##################################################################################################


print &quot;&quot;
print &quot;&quot;
print &quot; ---------- done ----------------&quot;
print &quot;&quot;
print &quot;&quot;
print &quot;Grace Plots are in Folder /grace/&quot;
print &quot;&quot;
print &quot;Signle Text Files for Relaxation Parameters are in Folder 
/final_results/&quot;
print &quot;&quot;
print &quot;Diffusion Tensor is in current Folder&quot;
print &quot;&quot;
print &quot;PyMol Macros are in current Folder - execute in PyMol with Command:&quot;
print &quot;@rex.pml and @s2.pml&quot;




</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00004" href="msg00004.html">a black box is needed</a></strong>
<ul><li><em>From:</em> Boaz Shapira</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Sep 17 03:00:37 2009</div>  
</body>
</html>
