<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r25434 &#45; /trunk/specific_analyses/relax_disp/estimate_r2eff.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 29 Aug 2014 17:18:52 +0200 -->
<!--X-Message-Id: CAED9pY9PaeKNuhh11J9vGbqTkrhStJ8KhPzXLYHgOciKeOoe6Q@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XNM38&#45;0007Yl&#45;Vo@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r25434 - /trunk/specific_analyses/relax_disp/estimate_r2eff.py -- August 29, 2014 - 17:18</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r25434 - /trunk/specific_analyses/relax_disp/estimate_r2eff.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00385" class="tabs">Index by Date</a> | <a href="threads.html#00385" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00384.html">Date Prev</a>] [<a href="msg00386.html">Date Next</a>] [<a href="msg00384.html">Thread Prev</a>] [<a href="msg00386.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 29 Aug 2014 17:18:21 +0200</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:content-type; bh=pLMkqzLtWKZKSI9UQAwMlaQBc4kVFfWNj1/hQuE5yo4=; b=y5NFHhkRa1Z2QeGm77OCVcV6gil8E6NM8P5e3todMyoFyO3SjIl6uu6Z+Rsc95QM2A aqLaeNu6a8DuC6z2SPzTo0RZG/efz0gZlItQxnQKk2hrj5qEHfPJXOtlsbJ69158RwGm xVjMVfigp8jAF5hbWKWelSi1YtOzBlpEiHRaNvhKIjomPpxFYq8UmCp9jc1IxsH7d229 4xzSBzipnW9MdVuHCmcRuyOcYdml4+zp89zndXBD0WMBPQD/5Q0o0c42mRnnQ0bcelzn +rNGhyYUyuIGbfBE2DTsrOaGQXADk90/CNd6zGYj401W/S7+rQ0OaJGqfifr6Ywcmf+f k3gQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00385.html">CAED9pY9PaeKNuhh11J9vGbqTkrhStJ8KhPzXLYHgOciKeOoe6Q@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XNM38-0007Yl-Vo@subversion.gna.org&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on August 29, 2014 - 17:18:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Troels,

As there is no Jacobian used in this method at all, maybe it's worth
removing all mentions of 'jacobian' in the docstring and variable.
That will lead to less confusion for future developers looking at this
code.

Cheers,

Edward



On 29 August 2014 15:17,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Fri Aug 29 15:17:05 2014
New Revision: 25434

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=25434&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=25434&amp;view=rev</a>
Log:
Replaced the way to calculate the chi2 Jacobian, for exponential fit in 
minfx.

This is only for the test class, but reuses library code.

This should make it much easier in the future to implement chi2 gradient 
functions to minfx, since it
is only necessary to implement the direct gradient of the function, and 
then pass the direct gradient to chi2 library, which turn it into
the chi2 gradient function which minfx use.

task #7822(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/index.php?7822">https://gna.org/task/index.php?7822</a>): Implement user function to 
estimate R2eff and associated errors for exponential curve fitting.

Modified:
    trunk/specific_analyses/relax_disp/estimate_r2eff.py

Modified: trunk/specific_analyses/relax_disp/estimate_r2eff.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/estimate_r2eff.py?rev=25434&amp;r1=25433&amp;r2=25434&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/estimate_r2eff.py?rev=25434&amp;r1=25433&amp;r2=25434&amp;view=diff</a>
==============================================================================
--- trunk/specific_analyses/relax_disp/estimate_r2eff.py        (original)
+++ trunk/specific_analyses/relax_disp/estimate_r2eff.py        Fri Aug 29 
15:17:05 2014
@@ -591,7 +591,7 @@


     def func_exp_chi2_grad(self, params=None, times=None, values=None, 
errors=None):
-        &quot;&quot;&quot;Target function for the gradient (Jacobian matrix) of 
func_exp_chi2() to minfx, for exponential fit .
+        &quot;&quot;&quot;Target function for the gradient (Jacobian matrix) to minfx, 
for exponential fit .

         @param params:  The vector of parameter values.
         @type params:   numpy rank-1 float array
@@ -605,25 +605,6 @@
         @rtype:         numpy array
         &quot;&quot;&quot;

-        # Get the Jacobian.
-        exp_chi2_grad = func_exp_chi2_grad(params=params, times=times, 
values=values, errors=errors)
-
-        # Transpose back, to get rows.
-        exp_chi2_grad_t = transpose(exp_chi2_grad)
-
-        # Extract vectors:
-        d_chi2_d_r2eff = exp_chi2_grad_t[0]
-        d_chi2_d_i0 = exp_chi2_grad_t[1]
-
-        # Take the sum, to send to minfx.
-        sum_d_chi2_d_r2eff = sum( d_chi2_d_r2eff )
-        sum_d_chi2_d_i0 = sum( d_chi2_d_i0 )
-
-        # Define Jacobian as m rows with function derivatives and n 
columns of parameters.
-        sum_jacobian_matrix_exp_chi2 = transpose(array( 
[sum_d_chi2_d_r2eff , sum_d_chi2_d_i0] ) )
-
-        ######### Try with lib function.
-
         # Get the back calc.
         back_calc = self.func_exp(params=params, times=times)

@@ -637,21 +618,13 @@
         n = len(params)

         # Define array to update parameters in.
-        sum_jacobian_matrix_exp_chi2_minfx = zeros([2])
+        jacobian_chi2_minfx = zeros([n])

         # Update value elements.
-        dchi2(dchi2=sum_jacobian_matrix_exp_chi2_minfx, M=n, data=values, 
back_calc_vals=back_calc, back_calc_grad=exp_grad_t, errors=errors)
-
-        # Make test of two methods.
-        test_eq = allclose(sum_jacobian_matrix_exp_chi2, 
sum_jacobian_matrix_exp_chi2_minfx, rtol=1e-15, atol=1e-15)
-
-        if not test_eq:
-            print(&quot;Chi2 gradient are not equal.&quot;)
-            print(asd)
-
+        dchi2(dchi2=jacobian_chi2_minfx, M=n, data=values, 
back_calc_vals=back_calc, back_calc_grad=exp_grad_t, errors=errors)

         # Return Jacobian matrix.
-        return sum_jacobian_matrix_exp_chi2_minfx
+        return jacobian_chi2_minfx


 def estimate_r2eff(method='minfx', min_algor='simplex', c_code=True, 
constraints=False, chi2_jacobian=False, spin_id=None, ftol=1e-15, 
xtol=1e-15, maxfev=10000000, factor=100.0, verbosity=1):


_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Aug 29 17:40:16 2014</div>  
</body>
</html>
