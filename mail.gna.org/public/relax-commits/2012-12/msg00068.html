<!-- MHonArc v2.6.16 -->
<!--X-Subject: r18134 &#45; in /branches/frame_order_testing: ./ generic_fns/	specific_fns/ test_suite/shared_data/align_data/paramagnetic/ tes... -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Thu, 13 Dec 2012 17:59:58 +0100 -->
<!--X-Message-Id: E1TjC8c&#45;0007Wt&#45;RD@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r18134 - in /branches/frame_order_testing: ./ generic_fns/	specific_fns/ test_suite/shared_data/align_data/paramagnetic/ tes... -- December 13, 2012 - 17:59</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r18134 - in /branches/frame_order_testing: ./ generic_fns/	specific_fns/ test_suite/shared_data/align_data/paramagnetic/ tes...</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00068" class="tabs">Index by Date</a> | <a href="threads.html#00068" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00067.html">Date Prev</a>] [<a href="msg00069.html">Date Next</a>] [<a href="msg00067.html">Thread Prev</a>] [<a href="msg00069.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Thu, 13 Dec 2012 16:59:58 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00068.html">E1TjC8c-0007Wt-RD@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on December 13, 2012 - 17:59:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Thu Dec 13 17:59:58 2012
New Revision: 18134

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=18134&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=18134&amp;view=rev</a>
Log:
Merged revisions 18126-18133 via svnmerge from 
svn+ssh://bugman@xxxxxxxxxxx/svn/relax/trunk

........
  r18126 | bugman | 2012-12-12 15:54:59 +0100 (Wed, 12 Dec 2012) | 5 lines
  
  Created some synthetic paramagnetically aligned RDC and PCS data to the 
test suite.
  
  This will be used in later system tests.
........
  r18127 | bugman | 2012-12-12 16:51:29 +0100 (Wed, 12 Dec 2012) | 3 lines
  
  NH bond length fix for the synthetic data committed at r18126.
........
  r18128 | bugman | 2012-12-12 16:59:42 +0100 (Wed, 12 Dec 2012) | 5 lines
  
  Changed the molecule name to remove a space.
  
  This is for the synthetic paramagnetic data in the test suite.
........
  r18129 | bugman | 2012-12-12 17:02:13 +0100 (Wed, 12 Dec 2012) | 3 lines
  
  Removed quotation marks from the molecule name in the PCS files of the 
synthetic alignment test data.
........
  r18130 | bugman | 2012-12-13 15:52:23 +0100 (Thu, 13 Dec 2012) | 6 lines
  
  Bug fix for the N-state model with PCSs and the temperature or spectrometer 
frequency are not set.
  
  Previously the missing value was set to 0 K or 1e-10 Hz, but this was 
causing optimisation to fail.
  Now a RelaxError is produced if the value is missing and optimisation is 
attempted.
........
  r18131 | bugman | 2012-12-13 15:53:40 +0100 (Thu, 13 Dec 2012) | 5 lines
  
  Fixes for the PCS values of the paramagnetic alignment test suite data.
  
  The data generation script output and results file have been added to the 
repository as well.
........
  r18132 | bugman | 2012-12-13 17:29:39 +0100 (Thu, 13 Dec 2012) | 6 lines
  
  Fixes for the calculation of RDC and PCS Q factors for when fixed alignment 
tensors are present.
  
  If a tensor is fixed, then there will be no back-calculated data.  
Therefore instead of returning
  from the function, a continue statement is used to skip just that alignment.
........
  r18133 | bugman | 2012-12-13 17:47:10 +0100 (Thu, 13 Dec 2012) | 7 lines
  
  Created the N_state_model.test_paramag_align_fit system test to check the 
paramagnetic data.
  
  This test check the alignment tensor optimisation of the RDC and PCS data in
  test_suite/shared_data/align_data/paramagnetic/, loading both alignment 
data sets but only
  optimising one tensor.
........

Added:
    
branches/frame_order_testing/test_suite/shared_data/align_data/paramagnetic/
      - copied from r18133, 
trunk/test_suite/shared_data/align_data/paramagnetic/
    
branches/frame_order_testing/test_suite/system_tests/scripts/n_state_model/paramag_align_fit.py
      - copied unchanged from r18133, 
trunk/test_suite/system_tests/scripts/n_state_model/paramag_align_fit.py
Modified:
    branches/frame_order_testing/   (props changed)
    branches/frame_order_testing/generic_fns/pcs.py
    branches/frame_order_testing/generic_fns/rdc.py
    branches/frame_order_testing/specific_fns/n_state_model.py
    branches/frame_order_testing/test_suite/system_tests/n_state_model.py

Propchange: branches/frame_order_testing/
------------------------------------------------------------------------------
--- svnmerge-integrated (original)
+++ svnmerge-integrated Thu Dec 13 17:59:58 2012
@@ -1,1 +1,1 @@
-/trunk:1-18124
+/trunk:1-18133

Modified: branches/frame_order_testing/generic_fns/pcs.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/generic_fns/pcs.py?rev=18134&amp;r1=18133&amp;r2=18134&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/generic_fns/pcs.py?rev=18134&amp;r1=18133&amp;r2=18134&amp;view=diff</a>
==============================================================================
--- branches/frame_order_testing/generic_fns/pcs.py (original)
+++ branches/frame_order_testing/generic_fns/pcs.py Thu Dec 13 17:59:58 2012
@@ -523,11 +523,11 @@
             warn(RelaxWarning(&quot;No spins have been used in the calculation.&quot;))
             return
         if not pcs_data:
-            warn(RelaxWarning(&quot;No PCS data can be found.&quot;))
-            return
+            warn(RelaxWarning(&quot;No PCS data can be found for the alignment ID 
'%s'.&quot; % align_id))
+            continue
         if not pcs_bc_data:
-            warn(RelaxWarning(&quot;No back-calculated PCS data can be found.&quot;))
-            return
+            warn(RelaxWarning(&quot;No back-calculated PCS data can be found for 
the alignment ID '%s'.&quot; % align_id))
+            continue
 
     # The total Q-factor.
     cdp.q_pcs = 0.0

Modified: branches/frame_order_testing/generic_fns/rdc.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/generic_fns/rdc.py?rev=18134&amp;r1=18133&amp;r2=18134&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/generic_fns/rdc.py?rev=18134&amp;r1=18133&amp;r2=18134&amp;view=diff</a>
==============================================================================
--- branches/frame_order_testing/generic_fns/rdc.py (original)
+++ branches/frame_order_testing/generic_fns/rdc.py Thu Dec 13 17:59:58 2012
@@ -465,11 +465,11 @@
             warn(RelaxWarning(&quot;No interatomic data containers have been used 
in the calculation.&quot;))
             return
         if not rdc_data:
-            warn(RelaxWarning(&quot;No RDC data can be found.&quot;))
-            return
+            warn(RelaxWarning(&quot;No RDC data can be found for the alignment ID 
'%s'.&quot; % align_id))
+            continue
         if not rdc_bc_data:
-            warn(RelaxWarning(&quot;No back-calculated RDC data can be found.&quot;))
-            return
+            warn(RelaxWarning(&quot;No back-calculated RDC data can be found for 
the alignment ID '%s'.&quot; % align_id))
+            continue
 
         # Normalisation factor of 2Da^2(4 + 3R)/5.
         if norm2_flag:

Modified: branches/frame_order_testing/specific_fns/n_state_model.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/specific_fns/n_state_model.py?rev=18134&amp;r1=18133&amp;r2=18134&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/specific_fns/n_state_model.py?rev=18134&amp;r1=18133&amp;r2=18134&amp;view=diff</a>
==============================================================================
--- branches/frame_order_testing/specific_fns/n_state_model.py (original)
+++ branches/frame_order_testing/specific_fns/n_state_model.py Thu Dec 13 
17:59:58 2012
@@ -934,14 +934,18 @@
             # Get the temperature for the PCS constant.
             if align_id in cdp.temperature:
                 temp.append(cdp.temperature[align_id])
+
+            # The temperature must be given!
             else:
-                temp.append(0.0)
+                raise RelaxError(&quot;The experimental temperature for the 
alignment ID '%s' has not been set.&quot; % align_id)
 
             # Get the spectrometer frequency in Tesla units for the PCS 
constant.
             if align_id in cdp.frq:
                 frq.append(cdp.frq[align_id] * 2.0 * pi / g1H)
+
+            # The frequency must be given!
             else:
-                frq.append(1e-10)
+                raise RelaxError(&quot;The spectrometer frequency for the 
alignment ID '%s' has not been set.&quot; % align_id)
 
             # Spin loop.
             j = 0

Modified: 
branches/frame_order_testing/test_suite/system_tests/n_state_model.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/test_suite/system_tests/n_state_model.py?rev=18134&amp;r1=18133&amp;r2=18134&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/frame_order_testing/test_suite/system_tests/n_state_model.py?rev=18134&amp;r1=18133&amp;r2=18134&amp;view=diff</a>
==============================================================================
--- branches/frame_order_testing/test_suite/system_tests/n_state_model.py 
(original)
+++ branches/frame_order_testing/test_suite/system_tests/n_state_model.py Thu 
Dec 13 17:59:58 2012
@@ -580,6 +580,25 @@
         self.assertAlmostEqual(cdp.align_tensors[0].Ayz_err, 0.0)
 
 
+    def test_paramag_align_fit(self):
+        &quot;&quot;&quot;Test the use of RDCs and PCSs to find the alignment tensor.&quot;&quot;&quot;
+
+        # Execute the script.
+        self.script_exec(status.install_path + 
sep+'test_suite'+sep+'system_tests'+sep+'scripts'+sep+'n_state_model'+sep+'paramag_align_fit.py')
+
+        # Test the optimised values.
+        self.assertAlmostEqual(cdp.align_tensors[1].Axx,  0.001414718232784)
+        self.assertAlmostEqual(cdp.align_tensors[1].Ayy,  0.001530457843766)
+        self.assertAlmostEqual(cdp.align_tensors[1].Axy,  0.001689957281873)
+        self.assertAlmostEqual(cdp.align_tensors[1].Axz,  0.000838692329704)
+        self.assertAlmostEqual(cdp.align_tensors[1].Ayz, -0.000984302159683)
+        self.assertAlmostEqual(cdp.q_factors_rdc['Er'], 0.0, 7)
+        self.assertAlmostEqual(cdp.q_factors_rdc_norm2['Er'], 0.0, 7)
+        self.assertAlmostEqual(cdp.q_factors_pcs['Er'], 0.0, 7)
+        self.assertAlmostEqual(cdp.q_rdc, 0.0, 7)
+        self.assertAlmostEqual(cdp.q_pcs, 0.0, 7)
+
+
     def test_paramag_centre_fit(self):
         &quot;&quot;&quot;Test the use of RDCs and PCSs to find the alignment tensor.&quot;&quot;&quot;
 



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Dec 13 19:20:01 2012</div>  
</body>
</html>
