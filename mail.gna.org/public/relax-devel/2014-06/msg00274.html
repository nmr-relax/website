<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r24013 &#45; /branches/disp_spin_speed/test_suite/system_tests/relax_disp.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 17 Jun 2014 11:14:57 +0200 -->
<!--X-Message-Id: CAED9pY9_Dez1jjMwv97AKwODtEaeHitoKDKDm1V=ArZw8sDwUg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Wwntd&#45;0006l2&#45;Dz@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r24013 - /branches/disp_spin_speed/test_suite/system_tests/relax_disp.py -- June 17, 2014 - 11:14</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r24013 - /branches/disp_spin_speed/test_suite/system_tests/relax_disp.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00274" class="tabs">Index by Date</a> | <a href="threads.html#00274" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00273.html">Date Prev</a>] [<a href="msg00275.html">Date Next</a>] [<a href="msg00271.html">Thread Prev</a>] [<a href="msg00280.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 17 Jun 2014 11:14:25 +0200</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:content-type; bh=qJN+C4K3vHk60+rdz2LVzk+YYZ7Tx/L3vP3xMqDuHbE=; b=A+XRzfk+V0vnQUo7AuSdhT7h7kis2gRRpvOwCt+1+3tYS/evi0LgMHqkj0ck7iWub/ VYm9HtC0ficL2JRM74yQGPTq7lmJSfNlW0IesCNvDwhTpc3u+c8yv437m/kLAeQJ6ZU6 z1YXv9WT4kBF2+1TIkXtr8b+fIb3xFuDnKo0y4E6anbDYEq4YEi7klaVKbEpEh6BgxKM cFRDU4kY1lUJBlyWE9CqNsSqGZLQw/BFL5iC49OASGCXDJMObuzPhIjec0IuEMCM+N2j 1X689ETKZmMlLETlIAKkbERdgrh5foXtUq3VYIdoGI0u5UKgo2bPq5RHBzkbl5MFBFgy r8eA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY9_Dez1jjMwv97AKwODtEaeHitoKDKDm1V=ArZw8sDwUg@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Wwntd-0006l2-Dz@subversion.gna.org&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 17, 2014 - 11:14:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

Rather than minimisation, just call the calc user function as this is
the proper way to get the chi-squared value at the current parameter
values.  One iteration of simplex minimisation can actually shift the
parameter values.  And if the test is fast, just leave it there.  It
doesn't need to be temporary.

Cheers,

Edward



On 17 June 2014 09:33,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Tue Jun 17 09:33:32 2014
New Revision: 24013

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=24013&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=24013&amp;view=rev</a>
Log:
Temporary added systemtest: test_korzhnev_2005_all_data_disp_speed_bug.

This makes a minimisation with 1 iteration, and so will give the chi2 value 
at the preset
parameter values.

This is chi2 value should give 162.5, but gives 74.7104.

Task #7807 (<a  rel="nofollow" href="https://gna.org/task/index.php?7807">https://gna.org/task/index.php?7807</a>): Speed-up of dispersion 
models for Clustered analysis.

Modified:
    branches/disp_spin_speed/test_suite/system_tests/relax_disp.py

Modified: branches/disp_spin_speed/test_suite/system_tests/relax_disp.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/test_suite/system_tests/relax_disp.py?rev=24013&amp;r1=24012&amp;r2=24013&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/test_suite/system_tests/relax_disp.py?rev=24013&amp;r1=24012&amp;r2=24013&amp;view=diff</a>
==============================================================================
--- branches/disp_spin_speed/test_suite/system_tests/relax_disp.py      
(original)
+++ branches/disp_spin_speed/test_suite/system_tests/relax_disp.py      Tue 
Jun 17 09:33:32 2014
@@ -3558,6 +3558,101 @@
         self.assertAlmostEqual(spin.chi2/1000, 162.511988511609/1000, 3)


+    def test_korzhnev_2005_all_data_disp_speed_bug(self):
+        &quot;&quot;&quot;Optimisation of all the Korzhnev et al., 2005 CPMG data using 
the 'NS MMQ 2-site' model.
+
+        This uses the data from Dmitry Korzhnev's paper at U{DOI: 
10.1021/ja054550e&lt;<a  rel="nofollow" href="http://dx.doi.org/10.1021/ja054550e">http://dx.doi.org/10.1021/ja054550e</a>&gt;}.  This is the 1H 
SQ, 15N SQ, ZQ, DQ, 1H MQ and 15N MQ data for residue Asp 9 of the Fyn SH3 
domain mutant.
+
+        Here all data will be optimised.  The values found by cpmg_fit 
using just this data are:
+
+            - r2 = {'H-S 500':  6.671649051677150, 'H-S 600':  
6.988634195648529, 'H-S 800':  5.527971316790596,
+                    'N-S 500':  8.394988400015988, 'N-S 600':  
8.891359568401835, 'N-S 800': 10.405356669006709,
+                    'NHZ 500':  5.936446687394352, 'NHZ 600':  
6.717058062814535, 'NHZ 800':  6.838733853403030,
+                    'NHD 500':  8.593136215779710, 'NHD 600': 
10.651511259239674, 'NHD 800': 12.567902357560627,
+                    'HNM 500':  7.851325614877817, 'HNM 600':  
8.408803624020202, 'HNM 800': 11.227489645758979,
+                    'NHM 500':  9.189159145380575, 'NHM 600':  
9.856814478405868, 'NHM 800': 11.967910041807118},
+            - pA = 0.943125351763911,
+            - dw = 4.421827493809807,
+            - dwH = -0.272637034755752,
+            - kex = 360.609744568697238,
+            - chi2 = 162.589570340050813.
+        &quot;&quot;&quot;
+
+        # Base data setup.
+        self.setup_korzhnev_2005_data(data_list=['SQ', '1H SQ', 'DQ', 
'ZQ', 'MQ', '1H MQ'])
+
+        # Alias the spin.
+        spin = return_spin(&quot;:9@N&quot;)
+
+        # The R20 keys.
+        r20_key1  = generate_r20_key(exp_type=EXP_TYPE_CPMG_PROTON_SQ, 
frq=500e6)
+        r20_key2  = generate_r20_key(exp_type=EXP_TYPE_CPMG_PROTON_SQ, 
frq=600e6)
+        r20_key3  = generate_r20_key(exp_type=EXP_TYPE_CPMG_PROTON_SQ, 
frq=800e6)
+        r20_key4  = generate_r20_key(exp_type=EXP_TYPE_CPMG_SQ, frq=500e6)
+        r20_key5  = generate_r20_key(exp_type=EXP_TYPE_CPMG_SQ, frq=600e6)
+        r20_key6  = generate_r20_key(exp_type=EXP_TYPE_CPMG_SQ, frq=800e6)
+        r20_key7  = generate_r20_key(exp_type=EXP_TYPE_CPMG_ZQ, frq=500e6)
+        r20_key8  = generate_r20_key(exp_type=EXP_TYPE_CPMG_ZQ, frq=600e6)
+        r20_key9  = generate_r20_key(exp_type=EXP_TYPE_CPMG_ZQ, frq=800e6)
+        r20_key10 = generate_r20_key(exp_type=EXP_TYPE_CPMG_DQ, frq=500e6)
+        r20_key11 = generate_r20_key(exp_type=EXP_TYPE_CPMG_DQ, frq=600e6)
+        r20_key12 = generate_r20_key(exp_type=EXP_TYPE_CPMG_DQ, frq=800e6)
+        r20_key13 = generate_r20_key(exp_type=EXP_TYPE_CPMG_PROTON_MQ, 
frq=500e6)
+        r20_key14 = generate_r20_key(exp_type=EXP_TYPE_CPMG_PROTON_MQ, 
frq=600e6)
+        r20_key15 = generate_r20_key(exp_type=EXP_TYPE_CPMG_PROTON_MQ, 
frq=800e6)
+        r20_key16 = generate_r20_key(exp_type=EXP_TYPE_CPMG_MQ, frq=500e6)
+        r20_key17 = generate_r20_key(exp_type=EXP_TYPE_CPMG_MQ, frq=600e6)
+        r20_key18 = generate_r20_key(exp_type=EXP_TYPE_CPMG_MQ, frq=800e6)
+
+        # Set the initial parameter values.
+        spin.r2 = {
+            r20_key1:   6.67288025927458, r20_key2:   6.98951408255098, 
r20_key3:   5.52959273852704,
+            r20_key4:   8.39471048876782, r20_key5:   8.89290699178799, 
r20_key6:  10.40770687236930,
+            r20_key7:   5.93611174376373, r20_key8:   6.71735669582514, 
r20_key9:   6.83835225518265,
+            r20_key10:  8.59615074668922, r20_key11: 10.65121378892910, 
r20_key12: 12.57108229191090,
+            r20_key13:  7.85956711501608, r20_key14:  8.41891642907918, 
r20_key15: 11.23620892230380,
+            r20_key16:  9.19654863789350, r20_key17:  9.86031627358462, 
r20_key18: 11.97523755925750
+        }
+        spin.pA = 0.943129019477673
+        spin.dw = 4.42209952545181
+        spin.dwH = -0.27258970590969
+        spin.kex = 360.516132791038
+
+        # Low precision optimisation.
+        #self.interpreter.grid_search(lower=None, upper=None, inc=10, 
constraints=True, verbosity=1)
+        self.interpreter.minimise(min_algor='simplex', func_tol=1e-05, 
max_iter=1)
+
+        # Printout.
+        print(&quot;\n\nOptimised parameters:\n&quot;)
+        print(&quot;%-20s %-20s&quot; % (&quot;Parameter&quot;, &quot;Value (:9)&quot;))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (1H SQ - 500 MHz)&quot;, 
spin.r2[r20_key1]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (1H SQ - 600 MHz)&quot;, 
spin.r2[r20_key2]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (1H SQ - 800 MHz)&quot;, 
spin.r2[r20_key3]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (SQ - 500 MHz)&quot;, spin.r2[r20_key4]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (SQ - 600 MHz)&quot;, spin.r2[r20_key5]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (SQ - 800 MHz)&quot;, spin.r2[r20_key6]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (ZQ - 500 MHz)&quot;, spin.r2[r20_key7]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (ZQ - 600 MHz)&quot;, spin.r2[r20_key8]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (ZQ - 800 MHz)&quot;, spin.r2[r20_key9]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (DQ - 500 MHz)&quot;, spin.r2[r20_key10]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (DQ - 600 MHz)&quot;, spin.r2[r20_key11]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (DQ - 800 MHz)&quot;, spin.r2[r20_key12]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (1H MQ - 500 MHz)&quot;, 
spin.r2[r20_key13]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (1H MQ - 600 MHz)&quot;, 
spin.r2[r20_key14]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (1H MQ - 800 MHz)&quot;, 
spin.r2[r20_key15]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (MQ - 500 MHz)&quot;, spin.r2[r20_key16]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (MQ - 600 MHz)&quot;, spin.r2[r20_key17]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;R2 (MQ - 800 MHz)&quot;, spin.r2[r20_key18]))
+        print(&quot;%-20s %20.15g&quot; % (&quot;pA&quot;, spin.pA))
+        print(&quot;%-20s %20.15g&quot; % (&quot;dw&quot;, spin.dw))
+        print(&quot;%-20s %20.15g&quot; % (&quot;dwH&quot;, spin.dwH))
+        print(&quot;%-20s %20.15g&quot; % (&quot;kex&quot;, spin.kex))
+        print(&quot;%-20s %20.15g\n&quot; % (&quot;chi2&quot;, spin.chi2))
+
+        # Checks for residue :9.
+        self.assertAlmostEqual(spin.chi2, 162.511988511609, 3)
+
+
     def test_kteilum_fmpoulsen_makke_cpmg_data_048m_guhcl_to_cr72(self):
         &quot;&quot;&quot;Optimisation of Kaare Teilum, Flemming M Poulsen, Mikael Akke 
2006 &quot;acyl-CoA binding protein&quot; CPMG data to the CR72 dispersion model.



_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Jun 17 13:40:13 2014</div>  
</body>
</html>
