<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: r2863 &#45;	/branches/test_suite/test_suite/unit_tests/unit_test_runner.py -->
<!--X-From-R13: "Unel E. Fubzcfba" <tnelgNozo.yrrqf.np.hx> -->
<!--X-Date: Tue, 21 Nov 2006 16:32:12 +0100 -->
<!--X-Message-Id: 45631BD4.9000605@bmb.leeds.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1GmTzB&#45;000575&#45;4t@subversion.gna.org -->
<!--X-Reference: 7f080ed10611210634k11c24b92r366d6cfd6427028f@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r2863 -	/branches/test_suite/test_suite/unit_tests/unit_test_runner.py -- November 21, 2006 - 16:32</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r2863 -	/branches/test_suite/test_suite/unit_tests/unit_test_runner.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00184" class="tabs">Index by Date</a> | <a href="threads.html#00184" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00183.html">Date Prev</a>] [<a href="msg00185.html">Date Next</a>] [<a href="msg00183.html">Thread Prev</a>] [<a href="msg00185.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 21 Nov 2006 15:31:32 +0000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00184.html">45631BD4.9000605@bmb.leeds.ac.uk</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1GmTzB-000575-4t@subversion.gna.org&gt;	&lt;<a href="msg00183.html">7f080ed10611210634k11c24b92r366d6cfd6427028f@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla Thunderbird 1.0 (X11/20041206)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Gary S. Thompson</strong> on November 21, 2006 - 16:32:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Edward d'Auvergne wrote:</pre><br>
<blockquote class="blockquote"><tt>Are you having a play with the unittest GUI?  
</tt></blockquote><pre style="margin: 0em;"><br></pre><br>
<tt>I was just having a go to see that it worked. The version I was using, 
however, is under the wrong license (I stole it from zope I think) so it 
was just a test of the code/concept  and will most probably disappear again.</tt><br>
<br>
<blockquote class="blockquote"><tt>If so, is it any good?<br>
Pity it's in Tk though, 
</tt></blockquote><tt><br>Why the problem with tk? Tk is nice (mostly)  and is present in all 
python distributions (note the prejudice, I am an old tcl/tk programmer)</tt><br>
<br>
<blockquote class="blockquote"><tt>it might take more work to integrate it into a<br>
Qt GUI (for all of relax).  
</tt></blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">However, you can use the tk version as a template to build a qt version</pre><br>
<blockquote class="blockquote"><tt>Also where you say:
</tt></blockquote><br>
<blockquote class="blockquote"><pre style="margin: 0em;"><br>A concrete example:</pre><br>
<pre style="margin: 0em;">for class &lt;relax-root-directory&gt;/maths-fns/chi2.py ***complete***</pre><br>
<pre style="margin: 0em;">does 'complete' mean that this example is already completed or it is
to be completed?
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<tt>it is to be completed ;-) I had to leave for work... multiple *** round 
comments / code in my files ususally mean something to do ;-)</tt><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;"><br>Edward</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">On 11/21/06, garyt@xxxxxxxxxxxxxxx &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Author: varioustoxins
Date: Tue Nov 21 12:40:20 2006
New Revision: 2863</pre><br>
<pre style="margin: 0em;">URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=2863&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=2863&amp;view=rev</a>
Log:
updates to allow heirachical unit test trees</pre><br>
<pre style="margin: 0em;"><br>Modified:
    branches/test_suite/test_suite/unit_tests/unit_test_runner.py</pre><br>
<tt>Modified: branches/test_suite/test_suite/unit_tests/unit_test_runner.py<br>
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/branches/test_suite/test_suite/unit_tests/unit_test_runner.py?rev=2863&amp;r1=2862&amp;r2=2863&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/test_suite/test_suite/unit_tests/unit_test_runner.py?rev=2863&amp;r1=2862&amp;r2=2863&amp;view=diff</a> </tt><br>
<br>
<tt>============================================================================== </tt><br>
<br>
<tt>--- branches/test_suite/test_suite/unit_tests/unit_test_runner.py 
(original)<br>
+++ branches/test_suite/test_suite/unit_tests/unit_test_runner.py Tue 
Nov 21 12:40:20 2006<br>
@@ -23,11 +23,37 @@<br>
 #                                                                              
#<br>
 ################################################################################ </tt><br>
<br>
<tt><br>-''' unit_test_runner provides utilities for the running of unit 
tests within<br>
-    the relax testing frame work.<br>
+''' unit_test_runner provides utilities for the running of unit 
tests from the<br>
+    command line or within the relax testing frame work.<br>
+<br>
+    Unit tests in the relax frame work are stored in a directory 
structure<br>
+    rooted at &lt;relax-root-directory&gt;/test_suite/unit_tests. The 
directory<br>
+    unit tests contains a directory structure that mirrors the relax 
directory<br>
+    structire and which ideally contains one unit test file/module 
for each<br>
+    file/module in the relax framework. The dfault convettion is 
that the unit<br>
+    test module for a relax module called &lt;relax-module&gt; is called<br>
+    test_&lt;relax-module&gt; (stored in test_&lt;relax-module&gt;.py). The unit 
test module<br>
+    test_&lt;relax-module&gt; should then contain a class called 
Test_&lt;relax-module&gt;<br>
+    which is a child of TestCase and contains methods whose names 
start with<br>
+    'test' and take no arguments other than self.<br>
+<br>
+    A concrete example:<br>
+<br>
+    for class &lt;relax-root-directory&gt;/maths-fns/chi2.py ***complete***<br>
+<br>
+<br>
+<br>
+<br>
+    The framework can discover sets of unit tests from the file 
system and add<br>
+    them to TestSuites either from the command line or 
programmatically from<br>
+    inside another program. It also has the ability to search for a  
root unit<br>
+    test and system directory from a position anywhere inside the 
unit test<br>
+    hierachy.<br>
 '''</tt><br>
<br>
<pre style="margin: 0em;"> import os,re,unittest,string,sys
+#import Tkinter as tk
+#import unittest.unittestgui as unitgui</pre><br>
<pre style="margin: 0em;"> # utility functions
 ###################
@@ -45,6 +71,16 @@
     if startup_path == '':
         startup_path = os.getcwd()
     return startup_path
+
+def import_module(module_path):
+
+    module = __import__(module_path)
+    result = [module]
+    components = module_path.split('.')
+    for component in components[1:]:
+        module = getattr(module, component)
+        result.append(module)
+    return result</pre><br>
<tt><br> def get_module_relative_path(module_path, root_paths=None):<br>
@@ -199,6 +235,8 @@<br>
     def scan_paths(self):<br>
         '''Scan directories and paths for unit test classes and load 
them into TestSuites'''</tt><br>
<br>
<tt>+        self.suite = unittest.TestSuite()<br>
+        suite_dictionary = {'':self.suite}<br>
         for (dir_path, dir_names, file_names) in 
os.walk(self.root_path):<br>
              for file_name in file_names:<br>
                  if self.pattern.match(file_name):<br>
@@ -207,35 +245,29 @@<br>
                      relative_module_path = 
get_module_relative_path(dir_path)</tt><br>
<br>
<tt>                      class_name = string.upper(file_name[0]) + 
file_name[1:]<br>
-                     print relative_module_path, class_name, file_name<br>
                      if relative_module_path != '':<br>
                          module_path = 
'.'.join((relative_module_path, file_name))<br>
                      else:<br>
                          module_path = file_name<br>
-                     module = __import__(module_path)<br>
-                     clazz =  getattr(module, class_name)<br>
-<br>
-                     self.suite = 
unittest.TestLoader().loadTestsFromTestCase(clazz)<br>
-<br>
-<br>
-    def run(self, test_runner=None):<br>
-        '''Run the unit tests found using a TestRunner.<br>
-<br>
-           @type test_runner: an instance ot TestRunner<br>
-           @param test_runner: the TestRunner instance  to be used 
to run the<br>
-                               TestSuite  with. if the fefault value 
of None is<br>
-                               used an instance of 
unittest.TextTestRunner is<br>
-                               used<br>
-        '''<br>
-<br>
-        if not self.paths_scanned:<br>
-            self.scan_paths()<br>
-            self.paths_scanned = True<br>
-<br>
-        if not test_runner:<br>
-            runner = unittest.TextTestRunner()<br>
-<br>
-        runner.run(self.suite)<br>
+<br>
+                     modules = import_module(module_path)<br>
+<br>
+                     path  = ['']<br>
+                     for i,elem in enumerate(module_path.split('.')):<br>
+                         old_path_key  =  '.'.join(path)<br>
+                         path.append(elem)<br>
+                         path_key = '.'.join(path)<br>
+                         if path_key not in suite_dictionary:<br>
+                             test_suite = unittest.TestSuite()<br>
+                             suite_dictionary[path_key]=test_suite<br>
+                             
suite_dictionary[old_path_key].addTest(test_suite)<br>
+<br>
+                     clazz =  getattr(modules[-1], class_name)<br>
+                     
suite_dictionary[path_key].addTest(unittest.TestLoader().loadTestsFromTestCase(clazz)) </tt><br>
<br>
<pre style="margin: 0em;">+
+
+
+</pre><br>
<tt> class Run_unit_tests(object):<br>
     '''Class to run a particular unit test or a directory of unit 
tests.'''<br>
@@ -427,8 +459,12 @@<br>
         return result</tt><br>
<br>
<pre style="margin: 0em;"><br>-    def run(self):
+    def run(self, runner=None):
         '''Run a unit test or set of unit tests.'''
+
+        print 'testing units...'
+        print '----------------'
+        print</pre><br>
<tt>         system_directory = 
self.find_system_directory_path(self.root_path)<br>
         unit_test_directory = 
self.find_unit_test_directory_path(self.root_path)<br>
@@ -437,10 +473,9 @@<br>
             print 'root path:          ', self.root_path<br>
             print 'system directory:   ', system_directory<br>
             print 'unit test directory:', unit_test_directory<br>
-            print 'module paths',modulePath<br>
+            print 'module paths:       ', module_path<br>
             print<br>
         # add UnitTestDirectory to python path<br>
-        print 'sys path',sys.path<br>
         backup_python_path = sys.path[:]<br>
         sys.path.insert(1,unit_test_directory)<br>
         sys.path.insert(1,system_directory)<br>
@@ -449,20 +484,29 @@<br>
         #iterate and load unit tests from module path<br>
         finder = Test_finder(unit_test_directory)<br>
         finder.scan_paths()<br>
-        finder.run()<br>
+        if runner == None:<br>
+            runner = unittest.TextTestRunner()<br>
+        runner.run(finder.suite)<br>
         # add SystemDirectory to python path<br>
         # iterate and load files to be tested</tt><br>
<br>
<pre style="margin: 0em;"> if __name__ == '__main__':
-    print '1',get_module_relative_path('/A/B/C', ('/A/B',))
-    print '2',get_module_relative_path('/A/B/C', ('/A/B/C',))
-    print '3',get_module_relative_path('/A/B/C', ('/A/B/D/W',))
-    print get_common_prefix(('A','B','C'), ('A','B','C'))
-    print get_common_prefix(('A','B','C'), ('A','B','C','D'))
-    print get_common_prefix(('D','E'), ('A','B','C','D'))
-    print get_common_prefix(('A','B','C','F'), ('A','B','C','D'))
-    print get_common_prefix((),('A','B','C','D'))
-    print ('A','B','C') == ('A','B','C')
-    runner = Run_unit_tests()
+#    print '1',get_module_relative_path('/A/B/C', ('/A/B',))
+#    print '2',get_module_relative_path('/A/B/C', ('/A/B/C',))
+#    print '3',get_module_relative_path('/A/B/C', ('/A/B/D/W',))
+#    print get_common_prefix(('A','B','C'), ('A','B','C'))
+#    print get_common_prefix(('A','B','C'), ('A','B','C','D'))
+#    print get_common_prefix(('D','E'), ('A','B','C','D'))
+#    print get_common_prefix(('A','B','C','F'), ('A','B','C','D'))
+#    print get_common_prefix((),('A','B','C','D'))
+#    print ('A','B','C') == ('A','B','C')
+    runner = Run_unit_tests(verbose=True)
     runner.run()
+
+#    root = tk.Tk()
+#    root.title(&quot;Realx unit tests&quot;)
+#    gui = unitgui.TkTestRunner(root)
+#    runner.run()
+
+
 # todo normcase home</pre><br>
<pre style="margin: 0em;"><br>_______________________________________________
relax (<a  href="http://nmr-relax.com">http://nmr-relax.com</a>)</pre><br>
<pre style="margin: 0em;">This is the relax-commits mailing list
relax-commits@xxxxxxx</pre><br>
<pre style="margin: 0em;">To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a></pre><br>
</blockquote><pre style="margin: 0em;"><br>.</pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
-------------------------------------------------------------------
Dr Gary Thompson
Astbury Centre for Structural Molecular Biology,
University of Leeds, Astbury Building,
Leeds, LS2 9JT, West-Yorkshire, UK             Tel. +44-113-3433024
email: garyt@xxxxxxxxxxxxxxx                   Fax  +44-113-2331407
-------------------------------------------------------------------</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00185" href="msg00185.html">Re: r2863 -	/branches/test_suite/test_suite/unit_tests/unit_test_runner.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00183" href="msg00183.html">Re: r2863 -	/branches/test_suite/test_suite/unit_tests/unit_test_runner.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Nov 21 17:00:50 2006</div>  
</body>
</html>
