<!-- MHonArc v2.6.16 -->
<!--X-Subject: Numerical integration of the Bloch&#45;McConnell equations for the	relaxation dispersion analysis in relax. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 11 Jul 2013 11:39:57 +0200 -->
<!--X-Message-Id: CAED9pY&#45;geVxWf=PBv6g&#45;7gDjfKKmHni3LGBjCNMLQ88_Ecy9XQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax. -- July 11, 2013 - 11:39</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00009" class="tabs">Index by Date</a> | <a href="threads.html#00009" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00008.html">Date Prev</a>] [<a href="msg00010.html">Date Next</a>] [<a href="msg00005.html">Thread Prev</a>] [<a href="msg00015.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Paul Schanda &lt;paul.schanda@xxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 11 Jul 2013 11:39:26 +0200</li>
<li class="menuitem">
<em>Cc</em>: Dominique Marion &lt;Dominique.Marion@xxxxxx&gt;,	Sébastien M &lt;sebastien@xxxxxxxxxxxxx&gt;,	mathilde lescanne &lt;mathilde.lescanne@xxxxxx&gt;,	&quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:date:x-google-sender-auth:message-id:subject	:from:to:cc:content-type:content-transfer-encoding;	bh=tgw+LQQbkQZ4DXZH2YadgOs2lyQjhWpLef7xTyvpE8E=;	b=ehl4bhotS1zNk7DqxIXUzLYK0zBgZmXD6gSDNRbrUI5UUluNi1NpMU4JYI7+Tgnw7Y	wwMfNhshfr92UOI1cS8QZsXaB5SRoEgnvgqoAQ6oiNwEb3qCF9Fx+9G73IlSF+XA/JeO	dsTTow34hRUvd1+QnDkePSN37pA9jdPxaVktI7nv2iKIpJLmUfNITATsxWDUwxkf9FtG	NHh9vqnliRk2wJZMtUwtwayLAoDIoTJfivVHQNJob+3/K6+etWog461H73zRXxlLTGQF	xf7tV86DBUzyzK5pjZ1kGg/LIx3mKvMUa7p7PQipBh+RFjtCV+EqB2S8XsLjlv9lsmnW	c0Mw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00009.html">CAED9pY-geVxWf=PBv6g-7gDjfKKmHni3LGBjCNMLQ88_Ecy9XQ@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on July 11, 2013 - 11:39:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Paul,

Thank you for the code contribution!  First of all, I have to
apologise for the length of this email.  I have tried to be as
comprehensive as possible.

I have attached the ZIP file to the relax task #7712
(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/?7712">https://gna.org/task/?7712</a>).  Note that I have added the [relax-devel
att gna dot org] mailing list to the CC list to bring this out into
the public - it will be permanently archived in multiple locations
(see <a  rel="nofollow" href="http://news.gmane.org/gmane.science.nmr.relax.devel">http://news.gmane.org/gmane.science.nmr.relax.devel</a>,
<a  rel="nofollow" href="http://www.mail-archive.com/relax-devel@xxxxxxx/">http://www.mail-archive.com/relax-devel@xxxxxxx/</a>,
<a  rel="nofollow" href="https://mail.gna.org/public/relax-devel/">https://mail.gna.org/public/relax-devel/</a>,
<a  rel="nofollow" href="http://marc.info/?l=relax-devel&amp;r=1&amp;w=2">http://marc.info/?l=relax-devel&amp;r=1&amp;w=2</a>).  This is necessary as relax
is an open source project where, without exception, all development
occurs in public.  It is supported by a number of developers, though
many are now inactive
(<a  rel="nofollow" href="https://gna.org/project/memberlist.php?group=relax">https://gna.org/project/memberlist.php?group=relax</a>).  Anyone is free
to become a relax developer and advance the project for their own
needs/papers (<a  rel="nofollow" href="http://www.nmr-relax.com/manual/relax_development.html">http://www.nmr-relax.com/manual/relax_development.html</a>).

Below I will address each of your points.  But first, and most
importantly, we need to address the copyright issue.  For the code to
be added to relax, each person who has contributed code to the
fitting_main.py file and the original MATLAB scripts needs to
communicate in public, by having a message permanently archived on the
[relax-devel att gna dot org] mailing list, that they agree to have
their code licenced under the Gnu Public Licence version 3 or higher
(GPL3+).  This does not prevent the author placing their code under a
different copyright licence.  But this is only their code, and the
code which was released under the GPL3 licence can never be retracted.
 For details, see <a  rel="nofollow" href="http://gplv3.fsf.org/">http://gplv3.fsf.org/</a>,
<a  rel="nofollow" href="http://www.gnu.org/licenses/gpl-3.0.html">http://www.gnu.org/licenses/gpl-3.0.html</a>, or the docs/COPYING file
that comes with relax.  I will add a copyright statement to each file
produced, and it will look like the start of
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/consistency_tests.py?view=markup">http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/consistency_tests.py?view=markup</a>.
 There will be one line for each author.  This consists of the years
the author wrote code, the full author name, and maybe a contact email
address.  This would also include all authors of the original MATLAB
scripts.

For reference, an archived message thread on this development is:

<a  rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/3790">http://thread.gmane.org/gmane.science.nmr.relax.devel/3790</a>

Also for reference is the history of relaxation dispersion in relax.
Development is happening in a relax branch rather than the main
development line.  Therefore it will not be included in an official
relax release until the branch is completed and merged back.  The
branch was started by Sébastien Morin who contributed much of the
infrastructure back in 2009.  I recently ported it to the newest relax
code base and significantly expanded its capabilities for my own
needs.  Troels Linnet is also working on this branch for his own paper
and needs, and is advancing towards becoming a full relax developer.

Now, to the mail:


On 9 July 2013 08:16, Paul Schanda &lt;paul.schanda@xxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward,

As promised, I am sending you in the attachment the python functions that we
are using for fitting CPMG data, that was written essentially by Mathilde
Lescanne and Dominique Marion, based on my MATLAB scripts.
</pre></blockquote><pre style="margin: 0em;">

Thank you.  As discussed at the IBS in Grenoble two weeks ago, this
could one day also be incorporated into the NESSY project
(<a  rel="nofollow" href="http://home.gna.org/nessy/">http://home.gna.org/nessy/</a>).  However that project is in a frozen
state so it would require a significant commitment by a dedicated
developer for this to happen.

Also, the code is in a state whereby it can be directly copied and
pasted into relax modules.  Only small modifications will be
necessary.  This includes adding docstrings
(<a  rel="nofollow" href="http://www.python.org/dev/peps/pep-0257/">http://www.python.org/dev/peps/pep-0257/</a>) using the Epydoc format
(<a  rel="nofollow" href="http://epydoc.sourceforge.net/">http://epydoc.sourceforge.net/</a>,
<a  rel="nofollow" href="http://epydoc.sourceforge.net/epytext.html">http://epydoc.sourceforge.net/epytext.html</a>) for the relax API
documentation (<a  rel="nofollow" href="http://www.nmr-relax.com/api/">http://www.nmr-relax.com/api/</a>).  I will also add lots
of comments as the relax coding style requires ~15 to 30% of comment
lines, simply to make it easier for non-coders to understand the code
(<a  rel="nofollow" href="http://www.nmr-relax.com/manual/Comments.html">http://www.nmr-relax.com/manual/Comments.html</a>).  I may ask you,
Mathilde, about these comments later.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">In principle, the fit program should directly work as it is, and generate
plots automatically. (using Matplotlib! I would strongly recommend that
relax also uses matplotlib. Creating plots exclusively outside of python is
a pain in the neck, and only useful for writing a paper, which is the step
that one does after having looked at tons of figures...)
</pre></blockquote><pre style="margin: 0em;">

As I mentioned, Troels Linnet is also interested in Matplotlib as he
has used that in his own dispersion scripts.  Matplotlib support would
be quite useful and is welcome.  But it is also limited compared to
the capabilities of Grace.  But the main point with matplotlib support
would be that it be added as an optional dependency.  For the
automated relaxation dispersion analysis in relax, matplotlib plots
can be created when the Python package is present.  We should probably
discuss this in a different thread.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">You will find five different versions of fitting CPMG data. In fact we only
use two of them, namely an explicit numerical Bloch-McConnell treatment that
works for perfect 180deg pulses, and a Maple-derived solution of the
Bloch-McConnell treatment. The latter is numerically exact and in practice
the most useful version. It is being used by some of the Kay-(ex-)postdocs.
</pre></blockquote><pre style="margin: 0em;">

These, I assume, are the functions returned by MakeFunction() when the
a argument is set to 1 and 5 respectively.  Would you have the primary
references for these two with DOI numbers?  This is important for the
relax documentation (both the user manual and in the user function
documentation).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The script allows to fit multiple residues and multiple fields at the same
time. This is all controlled via a Excel spreadsheet, where the user can put
the information. In relax you would do this differently, in a GUI, but the
logic would stay pretty much the same. The script uses a python package for
handling Excel files; you may need to install it.
</pre></blockquote><pre style="margin: 0em;">

For relax, the details in the Excel spreadsheet would either be placed
directly into a script (for the script UI) or manually input via the
GUI.  relax supports all of these options, though in the automated
analysis it is run a little differently.  You directly define spin
clusters.  Then all spin clusters as well as free spins are optimised
to all selected dispersion models simultaneously.  You are however
free to create a non-automated, custom analysis in a script whereby
you can do whatever you wish.  relax is designed with flexibility in
mind and allows you to do anything you wish (and if that doesn't work,
then it should be considered as a bug).


</pre><blockquote class="blockquote"><pre style="margin: 0em;">If you could incorporate this into relax it would be great.
</pre></blockquote><pre style="margin: 0em;">

Once the copyright issues are sorted out and there are responses from
all involved, I could then incorporate this quite quickly into relax.
It will only be a few hours of work - mainly due to the documentation.
 So having as much detail as possible about these numerical models
makes my life much easier.  See the user manual (you need to compile
it yourself) and relax_disp.select_model user function for how this
documentation is currently set up.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I would also
greatly appreciate if you could help us getting relax to run. Our interest
in sending this stuff to you is that we would like to have an environment
where the data handling (input, output) is done properly, but which
basically does the fitting that we would like to do (Bloch-McConnell).
</pre></blockquote><pre style="margin: 0em;">

For the installing the relaxation dispersion branch, Troels has
created a very useful tutorial:

<a  rel="nofollow" href="http://wiki.nmr-relax.com/index.php?title=Installation_linux">http://wiki.nmr-relax.com/index.php?title=Installation_linux</a>

This includes instructions for building the relax user manual (this
requires LaTeX).  Note that this wiki is still in a state of being set
up, so user creation and page editing is not yet fully functional.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">As said, it would be really great to have the program create plots
automatically. I don't want to use xmgrace for generating plots, or at least
not if I just want to get a quick overview of the fits. Could you please
have a look how complicated it would be to include matplotlib-plotting into
relax?
</pre></blockquote><pre style="margin: 0em;">

The complication is only deciding at which level this would be added.
For example the R2eff/R1rho plots are currently created by the
relax_disp.plot_disp_curves user function after a given dispersion
model has been optimised for all spin clusters and free spins (and
Monte Carlo simulations have been performed).  This could simply be
modified by adding an argument for selecting the graph type (set to
either 'grace' or 'matplotlib').  If this is added, then in the
auto-analysis I would enable both.  For this, ideas can be taken from
the fitting_main.py script, from Troels' scripts, and from NESSY's
matplotlib plotting.

On another level, there are the grace.view and grace.write user
functions.  These are used for plotting all of the other parameters.
If there is interest, then this code could be copied and modified to
the matplotlib.view and matplotlib.write user functions.

Troels, what do you think?

Note that, although Grace and OpenDX are the current ways of viewing
2D and 3D plots, the relax design is not exclusive to these softwares
and allows other plotting capabilities to be relatively easily added
by anyone with interest.  Matplotlib, Gnuplot, SigmaPlot, Octave
(which uses Gnuplot), MATLAB, and Mathematica have all been considered
at some point as a plotting output from relax.  Though most
users/developers found Grace sufficient so these were never
implemented due to a lack of interest.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Please let me know if you need any further information.
</pre></blockquote><pre style="margin: 0em;">

We'll see what is needed as things progress.

Cheers,

Edward


</pre><blockquote class="blockquote"><pre style="margin: 0em;">

best -


Paul



--
Paul Schanda, Ph.D.
Biomolecular NMR group
Institut de Biologie Structurale Jean-Pierre Ebel (IBS)
41, rue Jules Horowitz
F-38027 Grenoble
France
+33 438 78 95 55
paul.schanda@xxxxxx
<a  rel="nofollow" href="http://www.ibs.fr/groups/biomolecular-nmr-spectroscopy?lang=en">http://www.ibs.fr/groups/biomolecular-nmr-spectroscopy?lang=en</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00015" href="msg00015.html">Re: Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Jul 17 11:20:10 2013</div>  
</body>
</html>
