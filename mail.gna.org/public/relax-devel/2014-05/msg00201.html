<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [bug #22017] LinAlgError, for all numerical CPMG models. -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Wed, 07 May 2014 19:46:42 +0200 -->
<!--X-Message-Id: CAED9pY&#45;YpDTzTJh5KPNa&#45;ZUnXzRTT9ob2aL+ZruNfV4ZewOrHw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140507&#45;150749.sv20529.5081@gna.org -->
<!--X-Reference: CAED9pY&#45;rMLWguVxKj0F6sqVGbXqhhkB&#45;0YgBAFK_D&#45;ReyGksng@mail.gmail.com -->
<!--X-Reference: CA+CBx2M74Hk&#45;byLia2ka9ZSxHK9mLHWfeARVOAtOHQBUuA2BYQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [bug #22017] LinAlgError, for all numerical CPMG models. -- May 07, 2014 - 19:46</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [bug #22017] LinAlgError, for all numerical CPMG models.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00201" class="tabs">Index by Date</a> | <a href="threads.html#00201" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00200.html">Date Prev</a>] [<a href="msg00202.html">Date Next</a>] [<a href="msg00200.html">Thread Prev</a>] [<a href="msg00264.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 7 May 2014 19:45:52 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;Troels E. Linnet&quot; &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt;, &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=/eZjBwpiH84OIjgY/oVSLvwkEQww1730Kr3TcqjWmlc=; b=SARDMAapefkDNmr6U4ksKx3pRn4oXya5ITMYgAX3vmh0VaxgGOCYUxMKnuXEGlPWMt It6SvjkPT8LmyeCB/vlLG98a+qdozO3ofgTBinQW1u4aKHPRw6O6k0zDO9yAQWWpy9KS TrGqE+wcUmzLj5qrSdYI9TnnLSdbp1dnH54Y6qWpnPDAVbYTOhT7KC6Jl/8dw//kCLCh 5AV2zpy41Ut02hOXpapQo1hfn7I+ryoZiNur3KgkMTh4TWs0GeBlCCpQmsuPkNzCw2T+ CKXh/2gkB0TqxBY01pRYk5mW08t4Pc7B0+F7Cr4uboMwT2T41fpbSOQIFkEKsJAY1n5P PnLQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00201.html">CAED9pY-YpDTzTJh5KPNa-ZUnXzRTT9ob2aL+ZruNfV4ZewOrHw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00194.html">20140507-150749.sv20529.5081@gna.org</a>&gt; &lt;<a href="msg00195.html">CAED9pY-rMLWguVxKj0F6sqVGbXqhhkB-0YgBAFK_D-ReyGksng@mail.gmail.com</a>&gt; &lt;<a href="msg00200.html">CA+CBx2M74Hk-byLia2ka9ZSxHK9mLHWfeARVOAtOHQBUuA2BYQ@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on May 07, 2014 - 19:46:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

This is closer, but you need to chase it back to the source - where
the NaN first appears.  This could be a divide by zero.  Or it could
be a Python list structure with None in it - converting to numpy will
produce NaNs.

Regards,

Edward


On 7 May 2014 18:32, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

Some test print shows this:
In lib/ns_cpmg_2site_3d.py

        print R*tcp[i]
[[ NaN  NaN  NaN  NaN  NaN  NaN  NaN]
 [ NaN  NaN  NaN  NaN  NaN  NaN  NaN]
 [ NaN  NaN  NaN  NaN  NaN  NaN  NaN]
 [ NaN  NaN  NaN  NaN  NaN  NaN  NaN]
 [ NaN  NaN  NaN  NaN  NaN  NaN  NaN]
 [ NaN  NaN  NaN  NaN  NaN  NaN  NaN]
 [ NaN  NaN  NaN  NaN  NaN  NaN  NaN]]

Error message:
 Rexpo = matrix_exponential(R*tcp[i])
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/lib/linear_algebra/matrix_exponential.py&quot;,
line 46, in matrix_exponential
    W, V = eig(A)
  File &quot;/usr/lib64/python2.6/site-packages/numpy/linalg/linalg.py&quot;,
line 999, in eig
    _assertFinite(a)
  File &quot;/usr/lib64/python2.6/site-packages/numpy/linalg/linalg.py&quot;,
line 144, in _assertFinite
    raise LinAlgError, &quot;Array must not contain infs or NaNs&quot;
LinAlgError: Array must not contain infs or NaNs



2014-05-07 17:14 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

This is part of the parameter checking required in the target function
code.  Something is producing a NaN, and this needs to be caught.
You'll see my attempts at catching these conditions by running the
following from the relax base directory:

$ grep &quot;if &quot; lib/dispersion/* -A1

Obviously something is not caught when it should be.  You can use the
--traceback and --numpy-raise relax options to better debug this.
Once you find the position in the code where the NaN (or Inf) arises,
you can then add such an 'if' condition to fix the bug.

Regards,

Edward



On 7 May 2014 17:07, Troels E. Linnet &lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">URL:
  &lt;<a  rel="nofollow" href="http://gna.org/bugs/?22017">http://gna.org/bugs/?22017</a>&gt;

                 Summary: LinAlgError, for all numerical CPMG models.
                 Project: relax
            Submitted by: tlinnet
            Submitted on: Wed 07 May 2014 03:07:49 PM UTC
                Category: relax's source code
Specific analysis category: Relaxation dispersion
                Priority: 7 - High
                Severity: 4 - Important
                  Status: None
             Assigned to: None
         Originator Name:
        Originator Email:
             Open/Closed: Open
                 Release: Repository: trunk
         Discussion Lock: Any
        Operating System: All systems

    _______________________________________________________

Details:

Hi Edward.

The attached script, will make relax trip.

I am reading in fake R2eff points, and then do a back calculation with:

    sfrq_1 = 599.8908617*1E6
    ncycs_1 = [2, 4, 8, 10, 20, 30, 40, 60]
    sfrq_2 = 499.8908617*1E6
    ncycs_2 = [2, 4, 8, 10, 30, 35, 40, 50]

With the following dynamic parameters
['Ala', 1, 'N', {'r2': {r20_key_1:10, r20_key_2:11.5}, 'r2a': 
{r20_key_1:10,
r20_key_2:11.5}, 'r2b': {r20_key_1:10, r20_key_2:11.5}, 'kex': 1000, 'pA':
0.99, 'dw': 2} ]

#################3
relax_disp.r2eff_read_spin(id='CPMG_599.9', spin_id=':1@N',
file='CPMG_599.9_1_N.txt', dir=None, disp_point_col=1, offset_col=None,
data_col=2, error_col=3, sep=None)
Opening the file 'CPMG_599.9_1_N.txt' for reading.
The following R2eff/R1rho data has been loaded into the relax data store:

# R2eff_key                                 Disp_point              R2eff
             R2eff_error
sq_cpmg_599.89086170_0.000_33.333             33.333333333333336
1.000000000000000       0.100000000000000
sq_cpmg_599.89086170_0.000_66.667             66.666666666666671
1.000000000000000       0.100000000000000
sq_cpmg_599.89086170_0.000_133.333           133.333333333333343
1.000000000000000       0.100000000000000
sq_cpmg_599.89086170_0.000_166.667           166.666666666666686
1.000000000000000       0.100000000000000
sq_cpmg_599.89086170_0.000_333.333           333.333333333333371
1.000000000000000       0.100000000000000
sq_cpmg_599.89086170_0.000_500.000           500.000000000000000
1.000000000000000       0.100000000000000
sq_cpmg_599.89086170_0.000_666.667           666.666666666666742
1.000000000000000       0.100000000000000
sq_cpmg_599.89086170_0.000_1000.000         1000.000000000000000
1.000000000000000       0.100000000000000
Traceback (most recent call last):
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/multi/processor.py&quot;,
line 494, in run
    self.callback.init_master(self)
  File 
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/multi/__init__.py&quot;,
line 318, in default_init_master
    self.master.run()
  File &quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/relax.py&quot;, line 
194,
in run
    self.interpreter.run(self.script_file)
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/prompt/interpreter.py&quot;, 
line
275, in run
    return run_script(intro=self.__intro_string, local=locals(),
script_file=script_file, show_script=self.__show_script,
raise_relax_error=self.__raise_relax_error)
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/prompt/interpreter.py&quot;, 
line
569, in run_script
    return console.interact(intro, local, script_file,
show_script=show_script, raise_relax_error=raise_relax_error)
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/prompt/interpreter.py&quot;, 
line
468, in interact_script
    exec_script(script_file, local)
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/prompt/interpreter.py&quot;, 
line
347, in exec_script
    runpy.run_module(module, globals)
  File &quot;/usr/lib64/python2.6/runpy.py&quot;, line 140, in run_module
    fname, loader, pkg_name)
  File &quot;/usr/lib64/python2.6/runpy.py&quot;, line 34, in _run_code
    exec code in run_globals
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/test_suite/system_tests/scripts/relax_disp/cpmg_synthetic.py&quot;,
line 270, in &lt;module&gt;
    r2effs = optimisation.back_calc_r2eff(spin=cur_spin, 
spin_id=cur_spin_id)
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/specific_analyses/relax_disp/optimisation.py&quot;,
line 188, in back_calc_r2eff
    chi2 = model.func(param_vector)
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/target_functions/relax_disp.py&quot;,
line 1419, in func_ns_cpmg_2site_3D
    return self.calc_ns_cpmg_2site_3D_chi2(R20A=R20, R20B=R20, dw=dw, 
pA=pA,
kex=kex)
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/target_functions/relax_disp.py&quot;,
line 542, in calc_ns_cpmg_2site_3D_chi2
    r2eff_ns_cpmg_2site_3D(r180x=self.r180x, M0=self.M0, 
r20a=R20A[r20_index],
r20b=R20B[r20_index], pA=pA, pB=pB, dw=dw_frq, k_AB=k_AB, k_BA=k_BA,
inv_tcpmg=self.inv_relax_times[0][mi], tcp=self.tau_cpmg[0][mi],
back_calc=self.back_calc[0][si][mi][0],
num_points=self.num_disp_points[0][si][mi][0], power=self.power[0][mi])
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/lib/dispersion/ns_cpmg_2site_3d.py&quot;,
line 115, in r2eff_ns_cpmg_2site_3D
    Rexpo = matrix_exponential(R*tcp[i])
  File
&quot;/sbinlab2/tlinnet/software/NMR-relax/relax_trunk/lib/linear_algebra/matrix_exponential.py&quot;,
line 46, in matrix_exponential
    W, V = eig(A)
  File &quot;/usr/lib64/python2.6/site-packages/numpy/linalg/linalg.py&quot;, line 
999,
in eig
    _assertFinite(a)
  File &quot;/usr/lib64/python2.6/site-packages/numpy/linalg/linalg.py&quot;, line 
144,
in _assertFinite
    raise LinAlgError, &quot;Array must not contain infs or NaNs&quot;
LinAlgError: Array must not contain infs or NaNs
#########################






    _______________________________________________________

File Attachments:


-------------------------------------------------------
Date: Wed 07 May 2014 03:07:49 PM UTC  Name: cpmg_synthetic.py  Size: 16kB
By: tlinnet

&lt;<a  rel="nofollow" href="http://gna.org/bugs/download.php?file_id=20667">http://gna.org/bugs/download.php?file_id=20667</a>&gt;

    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/bugs/?22017">http://gna.org/bugs/?22017</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00194" href="msg00194.html">[bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00195" href="msg00195.html">Re: [bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00200" href="msg00200.html">Re: [bug #22017] LinAlgError, for all numerical CPMG models.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu May 08 20:40:10 2014</div>  
</body>
</html>
