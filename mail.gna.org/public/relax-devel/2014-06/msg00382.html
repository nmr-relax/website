<!-- MHonArc v2.6.18 -->
<!--X-Subject: [task #7807] Speed&#45;up of dispersion models for Clustered analysis -->
<!--X-From-R13: "Febryf S. Zvaarg" &#60;@A&#45;DSBZK.W@HOZWR&#45;ORRDSEENtan.bet> -->
<!--X-Date: Thu, 19 Jun 2014 19:18:16 +0200 -->
<!--X-Message-Id: 20140619&#45;171815.sv20529.49415@gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140606&#45;164034.sv20529.18004@gna.org -->
<!--X-Reference: 20140606&#45;203152.sv20529.82733@gna.org -->
<!--X-Reference: 20140607&#45;192042.sv20529.55008@gna.org -->
<!--X-Reference: 20140608&#45;115339.sv20529.22097@gna.org -->
<!--X-Reference: 20140608&#45;175211.sv20529.15019@gna.org -->
<!--X-Reference: 20140608&#45;182605.sv20529.57278@gna.org -->
<!--X-Reference: 20140608&#45;183428.sv20529.91269@gna.org -->
<!--X-Reference: 20140608&#45;184803.sv20529.12856@gna.org -->
<!--X-Reference: 20140608&#45;214642.sv20529.45231@gna.org -->
<!--X-Reference: 20140608&#45;224658.sv20529.82233@gna.org -->
<!--X-Reference: 20140609&#45;230256.sv20529.53904@gna.org -->
<!--X-Reference: 20140610&#45;170645.sv20529.74988@gna.org -->
<!--X-Reference: 20140611&#45;154047.sv2782.24206@gna.org -->
<!--X-Reference: 20140615&#45;083021.sv2782.41765@gna.org -->
<!--X-Reference: 20140615&#45;193016.sv2782.64447@gna.org -->
<!--X-Reference: 20140616&#45;073736.sv2782.63937@gna.org -->
<!--X-Reference: 20140617&#45;183115.sv20529.58952@gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[task #7807] Speed-up of dispersion models for Clustered analysis -- June 19, 2014 - 19:18</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />[task #7807] Speed-up of dispersion models for Clustered analysis</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00382" class="tabs">Index by Date</a> | <a href="threads.html#00382" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00381.html">Date Prev</a>] [<a href="msg00383.html">Date Next</a>] [<a href="msg00324.html">Thread Prev</a>] [<a href="msg00122.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Troels E. Linnet&quot; &lt;tlinnet@xxxxxxxxxxxxx&gt;, Edward d  Auvergne &lt;edward@xxxxxxxxxxxxx&gt;, relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Thu, 19 Jun 2014 19:18:16 +0200</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00382.html">20140619-171815.sv20529.49415@gna.org</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00069.html">20140606-164034.sv20529.18004@gna.org</a>&gt; &lt;<a href="msg00071.html">20140606-203152.sv20529.82733@gna.org</a>&gt; &lt;<a href="msg00072.html">20140607-192042.sv20529.55008@gna.org</a>&gt; &lt;<a href="msg00073.html">20140608-115339.sv20529.22097@gna.org</a>&gt; &lt;<a href="msg00074.html">20140608-175211.sv20529.15019@gna.org</a>&gt; &lt;<a href="msg00075.html">20140608-182605.sv20529.57278@gna.org</a>&gt; &lt;<a href="msg00076.html">20140608-183428.sv20529.91269@gna.org</a>&gt; &lt;<a href="msg00077.html">20140608-184803.sv20529.12856@gna.org</a>&gt; &lt;<a href="msg00078.html">20140608-214642.sv20529.45231@gna.org</a>&gt; &lt;<a href="msg00079.html">20140608-224658.sv20529.82233@gna.org</a>&gt; &lt;<a href="msg00082.html">20140609-230256.sv20529.53904@gna.org</a>&gt; &lt;<a href="msg00131.html">20140610-170645.sv20529.74988@gna.org</a>&gt; &lt;<a href="msg00177.html">20140611-154047.sv2782.24206@gna.org</a>&gt; &lt;<a href="msg00222.html">20140615-083021.sv2782.41765@gna.org</a>&gt; &lt;<a href="msg00245.html">20140615-193016.sv2782.64447@gna.org</a>&gt; &lt;<a href="msg00248.html">20140616-073736.sv2782.63937@gna.org</a>&gt; &lt;<a href="msg00306.html">20140617-183115.sv20529.58952@gna.org</a>&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels E. Linnet</strong> on June 19, 2014 - 19:18:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Follow-up Comment #325, task #7807 (project relax):

Storage of idea: NS CPMG 2site 3d

Skipping of the spin lloop

    # Loop over the spins
    #for si in range(NS):
    #    # Loop over the spectrometer frequencies.
    for mi in range(NM):
        # Extract number of points.
        num_points_si_mi = int(num_points[0, 0, mi, 0])

        # Loop over the time points, back calculating the R2eff values.
        for di in range(num_points_si_mi):
            # Extract the values from the higher dimensional arrays.
            inv_tcpmg_si_mi_di = inv_tcpmg[0, 0, mi, 0, di]
            power_si_mi_di = int(power[0, 0, mi, 0, di])
            #r20a_si_mi_di = r20a[0, 0, mi, 0, di]

            # Initial magnetisation.
            Mint_i = Mint_mat[:, :, mi, Ellipsis]

            # This matrix is a propagator that will evolve the magnetization
with the matrix R for a delay tcp.
            evolution_matrix_i = evolution_matrix_mat[:, :, mi, Ellipsis]

            # Loop over the CPMG elements, propagating the magnetisation.
            for j in range(power_si_mi_di):
                Mint_i = einsum('...ij,...jk', evolution_matrix_i, Mint_i)

            # Store the result.
            Mint_mat[:, :, mi, Ellipsis] =  Mint_i


    print Mint_mat[:, :, :, :, :, 1, 0]
    print asd

    # The next lines calculate the R2eff using a two-point approximation, i.e.
assuming that the decay is mono-exponential.
    #Mx = Mint_i[1][0] / pA
    # Extract data from ei, si, mi, oi, di, the [1][0]
    Mx = Mint_mat[:, :, :, :, :, 1, 0] / pA

    mask_inv = masked_invalid(Mx)
    if any(mask_inv.mask):
        Mx[mask_inv.mask] = r20a[mask_inv.mask]

    back_calc[:] = Mx


    #if Mx &lt;= 0.0 or isNaN(Mx):
    #    back_calc[0, si, mi, 0, di] = r20a_si_mi_di
    #else:
    #    back_calc[0, si, mi, 0, di] = - inv_tcpmg_si_mi_di * log(Mx)

    # Replace data in array.
    # If dw is zero.
    if t_dw_zero:
        back_calc[mask_dw_zero.mask] = r20a[mask_dw_zero.mask]

    # Catch errors, taking a sum over array is the fastest way to check for
    # +/- inf (infinity) and nan (not a number).
    if not isfinite(sum(back_calc)):
        # Replaces nan, inf, etc. with fill value.
        fix_invalid(back_calc, copy=False, fill_value=1e100)

    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/task/?7807">http://gna.org/task/?7807</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00069" href="msg00069.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00071" href="msg00071.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00072" href="msg00072.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00073" href="msg00073.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00074" href="msg00074.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00075" href="msg00075.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00076" href="msg00076.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00077" href="msg00077.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00078" href="msg00078.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00079" href="msg00079.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00082" href="msg00082.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00131" href="msg00131.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00177" href="msg00177.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Edward d Auvergne</li></ul></li>
<li><strong><a name="00222" href="msg00222.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Edward d Auvergne</li></ul></li>
<li><strong><a name="00245" href="msg00245.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Edward d Auvergne</li></ul></li>
<li><strong><a name="00248" href="msg00248.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Edward d Auvergne</li></ul></li>
<li><strong><a name="00306" href="msg00306.html">[task #7807] Speed-up of dispersion models for Clustered analysis</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jun 23 09:20:17 2014</div>  
</body>
</html>
