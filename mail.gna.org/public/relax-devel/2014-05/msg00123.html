<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r22958 &#45; /trunk/specific_analyses/relax_disp/api.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 05 May 2014 17:44:34 +0200 -->
<!--X-Message-Id: CAED9pY8cdPyH1jZxMUVsy0kV&#45;x0sapH&#45;m6ZjjBVkkE6_ZY9=Fw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1WhK9j&#45;0005iA&#45;3p@subversion.gna.org -->
<!--X-Reference: CA+CBx2PtcGZNwSFZreX7JKzu6J+m0vpbyo2g7&#45;d3oowR2c25nA@mail.gmail.com -->
<!--X-Reference: CAED9pY_+=R9pJtg2GrR=9D63_yNEQ6O_mMjwYjvUYG9vVDfgqw@mail.gmail.com -->
<!--X-Reference: CA+CBx2NLRTSVV_vFauaeuf5q1+g8C9cxu2KfgUGEQ3+ceuDf8g@mail.gmail.com -->
<!--X-Reference: CAED9pY_fiH=9bueXyRo_e0wPwEbGnW2qs3vMdMCPTga2pQEpXw@mail.gmail.com -->
<!--X-Reference: CAED9pY9A7pj8GGRzBsNtzestyLNCbG_fhib&#45;GfogBzdYw_0org@mail.gmail.com -->
<!--X-Reference: CA+CBx2OrQhVuGuKpPConf8z1T2H_j9R&#45;MgLisiv&#45;_7sK4w6XFw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r22958 - /trunk/specific_analyses/relax_disp/api.py -- May 05, 2014 - 17:44</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r22958 - /trunk/specific_analyses/relax_disp/api.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00123" class="tabs">Index by Date</a> | <a href="threads.html#00123" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00122.html">Date Prev</a>] [<a href="msg00124.html">Date Next</a>] [<a href="msg00138.html">Thread Prev</a>] [<a href="msg00122.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 5 May 2014 17:43:41 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=3XNYUZAIWkWQBH8xKSD3CW0gKs913hkUPznGUz3/xFQ=; b=k2in2++n2nh90eE3qokgfv1HtSuUqCZuIZRcR3HwmpKXFpys3OKFg02YWhUsAKw2Q5 2HhZFIhIe+1YCn+2xHMD7qAU3Km0bKB285B8aJS2qFFYJmTa/66bI85T+kdhri9DQfZN jDEZTRddlFSBcVbvRsJl6rdul9sCzh1mi22I17iuSf8CZzdztvy4Ytav9Vn2GyASORti 2WorxrjZ7VN6LWCX6NwGluxiJRlxhiSVKQbv5fhx/JYyaaTus/O7q0txKUzcm7lUUqyN f8AALMIHvRyG6UASs/JDhSxyYXFFUl7BeDvBvT2zRJdwZXMl9cvbVGIlEAEeHqUiz3xE 2A0A==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY8cdPyH1jZxMUVsy0kV-x0sapH-m6ZjjBVkkE6_ZY9=Fw@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1WhK9j-0005iA-3p@subversion.gna.org&gt; &lt;<a href="msg00115.html">CA+CBx2PtcGZNwSFZreX7JKzu6J+m0vpbyo2g7-d3oowR2c25nA@mail.gmail.com</a>&gt; &lt;CAED9pY_+=R9pJtg2GrR=9D63_yNEQ6O_mMjwYjvUYG9vVDfgqw@mail.gmail.com&gt; &lt;<a href="msg00117.html">CA+CBx2NLRTSVV_vFauaeuf5q1+g8C9cxu2KfgUGEQ3+ceuDf8g@mail.gmail.com</a>&gt; &lt;CAED9pY_fiH=9bueXyRo_e0wPwEbGnW2qs3vMdMCPTga2pQEpXw@mail.gmail.com&gt; &lt;<a href="msg00119.html">CAED9pY9A7pj8GGRzBsNtzestyLNCbG_fhib-GfogBzdYw_0org@mail.gmail.com</a>&gt; &lt;<a href="msg00120.html">CA+CBx2OrQhVuGuKpPConf8z1T2H_j9R-MgLisiv-_7sK4w6XFw@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on May 05, 2014 - 17:44:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Unfortuanately I cannot for the life of me replicate this error you're
seeing.  Anyway, I see the where problem is likely to be.  The code in
the Map.map_3D_text() method of the pipe_control.opendx module is
incorrect!  It's quite bad actually!  This is because it is incomplete
- I remember not finishing it as it was good enough to produce the
figures for my PhD thesis and papers.  That was almost a decade ago ;)

Maybe we need a model_loop() call in here.  But then we also need to
handle the fact that there might be multiple iterations from
model_loop().  The current code assumes one map for the dx.map uesr
function call.  But this is not the case.

Another, possibly better way would be to enforce the spin_id argument
for the dx.map call.  I.e. the model_loop() is called in map_3D_text()
with the spin_id argument, and then we check that only one iteration
of the loop occurs, raising a RelaxError otherwise.  If this is ok,
then we use the model_info data returned from the first iteration of
the model_loop() to pass into the subsequent model_statistics() call.
This logic should fix the problem (but may reveal a few more minor
deficiencies as well).  In any case, the problem is not in the
model_statistics() API method.

Regards,

Edward







On 5 May 2014 17:36, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

Sorry for being unclear.

It is this comment:
<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?22012#comment3">https://gna.org/bugs/?22012#comment3</a>



dx.map(params=['dw', 'pA', 'kex'], map_type='Iso3D', spin_id=':1@N',
inc=20, lower=None, upper=None, axis_incs=5, file_prefix='map',
dir=None, point=None, point_file='point', remap=None)

Creating the OpenDX .net program file.
Opening the file 'map.net' for writing.

Creating the OpenDX .cfg program configuration file.
Opening the file 'map.cfg' for writing.

Creating the OpenDX .general file.
Opening the file 'map.general' for writing.

Creating the map.
Opening the file 'map' for writing.
Progress: 0.000%
RelaxWarning: invalid value encountered in double_scalars
debug&gt; Execution lock: Release by 'script UI' ('script' mode).
Traceback (most recent call last):
File &quot;/Users/tlinnet/software/relax_trunk/multi/processor.py&quot;, line 494, in 
run
self.callback.init_master(self)
File &quot;/Users/tlinnet/software/relax_trunk/multi/__init__.py&quot;, line
318, in default_init_master
self.master.run()
File &quot;/Users/tlinnet/software/relax_trunk/relax.py&quot;, line 194, in run
self.interpreter.run(self.script_file)
File &quot;/Users/tlinnet/software/relax_trunk/prompt/interpreter.py&quot;, line
275, in run
return run_script(intro=self.__intro_string, local=locals(),
script_file=script_file, show_script=self.__show_script,
raise_relax_error=self.__raise_relax_error)
File &quot;/Users/tlinnet/software/relax_trunk/prompt/interpreter.py&quot;, line
569, in run_script
return console.interact(intro, local, script_file,
show_script=show_script, raise_relax_error=raise_relax_error)
File &quot;/Users/tlinnet/software/relax_trunk/prompt/interpreter.py&quot;, line
468, in interact_script
exec_script(script_file, local)
File &quot;/Users/tlinnet/software/relax_trunk/prompt/interpreter.py&quot;, line
347, in exec_script
runpy.run_module(module, globals)
File 
&quot;/Library/Frameworks/Python.framework/Versions/7.3/lib/python2.7/runpy.py&quot;,
line 180, in run_module
fname, loader, pkg_name)
File 
&quot;/Library/Frameworks/Python.framework/Versions/7.3/lib/python2.7/runpy.py&quot;,
line 72, in _run_code
exec code in run_globals
File 
&quot;/Users/tlinnet/software/relax_trunk/test_suite/system_tests/scripts/relax_disp/cpmg_synthetic.py&quot;,
line 277, in &lt;module&gt;
dx.map(params=['dw', 'pA', 'kex'], map_type='Iso3D', spin_id=&quot;:1@N&quot;,
inc=20, lower=None, upper=None, axis_incs=5, file_prefix='map',
dir=ds.resdir, point=None, point_file='point', remap=None)
File &quot;/Users/tlinnet/software/relax_trunk/prompt/uf_objects.py&quot;, line
221, in _call_
self._backend(*new_args, **uf_kargs)
File &quot;/Users/tlinnet/software/relax_trunk/pipe_control/opendx.py&quot;,
line 88, in map
Map(params, spin_id, inc, lower, upper, axis_incs, file_prefix, dir,
point, point_file, remap)
File &quot;/Users/tlinnet/software/relax_trunk/pipe_control/opendx.py&quot;,
line 184, in _init_
self.create_map()
File &quot;/Users/tlinnet/software/relax_trunk/pipe_control/opendx.py&quot;,
line 197, in create_map
self.map_3D_text(map_file)
File &quot;/Users/tlinnet/software/relax_trunk/pipe_control/opendx.py&quot;,
line 255, in map_3D_text
k, n, chi2 = self.model_statistics(spin_id=self.spin_id)
File 
&quot;/Users/tlinnet/software/relax_trunk/specific_analyses/relax_disp/api.py&quot;,
line 683, in model_statistics
spins = spin_ids_to_containers(spin_ids)
File 
&quot;/Users/tlinnet/software/relax_trunk/specific_analyses/relax_disp/data.py&quot;,
line 3620, in spin_ids_to_containers
for id in spin_ids:
TypeError: 'NoneType' object is not iterable

2014-05-05 17:27 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">The argument checking is reasonable, but the code:

+        #spins = spin_ids_to_containers(spin_ids)
+
+        spins_list = []
+        for spin_id in self.model_loop():
+            spins_list.append(spin_id[0])
+
+        spins = spin_ids_to_containers(spins_list)

breaks the logic.  This cannot be done, as the code calling
model_statistics() must be looping over the models (i.e. the
model_loop()), so you cannot have the model_loop() inside it.  Any API
method which accepts the model_info argument will follow this logic.

Regards,

Edward



On 5 May 2014 17:23, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">The original code was correct.  The full test suite passes when this
change is not included.  Why did you make this change?  What was the
purpose?  I'm a little confused.

Regards,

Edward



On 5 May 2014 17:15, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Ehhhh.

Can you suggest a change?

Best
Troels

2014-05-05 17:05 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

I now have the failure when running:

$ ./relax -s Relax_disp.test_hansen_cpmg_data_auto_analysis

This is because the change is incorrect.  The model_statistics()
method is called once for each individual model - for each iteration
of the model_loop(), which for the dispersion analysis is each spin
cluster (or individual spins).  The logic:

        spins_list = []
        for spin_id in self.model_loop():
            spins_list.append(spin_id[0])

        spins = spin_ids_to_containers(spins_list)

is incorrect as the model_loop() loops over all spin clusters.
Therefore the 'spins' object will now be a list of the first spin
system from all clusters.  Previously it was simply a list of all the
spins for the current spin cluster.  I hope this makes sense.

Regards,

Edward



On 5 May 2014 16:52, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Now ready to be tested with:

relax -s Relax_disp.test_hansen_cpmg_data_auto_analysis -d


---------- Forwarded message ----------
From:  &lt;tlinnet@xxxxxxxxxxxxx&gt;
Date: 2014-05-05 16:46 GMT+02:00
Subject: r22958 - /trunk/specific_analyses/relax_disp/api.py
To: relax-commits@xxxxxxx


Author: tlinnet
Date: Mon May  5 16:46:10 2014
New Revision: 22958

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=22958&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=22958&amp;view=rev</a>
Log:
Inserted commit r22954 to fix the AIC method selection.

The command used was:
svn merge -r22953:r22954 .

.....
    Attempt to fix function model_statistics() in API for relax_disp.

    bug #22012(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?22012">https://gna.org/bugs/?22012</a>): dx.map not implemented
for pipe type relax_disp.

    Modified:
        trunk/specific_analyses/relax_disp/api.py
.....


Modified:
    trunk/specific_analyses/relax_disp/api.py

Modified: trunk/specific_analyses/relax_disp/api.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/api.py?rev=22958&amp;r1=22957&amp;r2=22958&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/api.py?rev=22958&amp;r1=22957&amp;r2=22958&amp;view=diff</a>
==============================================================================
--- trunk/specific_analyses/relax_disp/api.py   (original)
+++ trunk/specific_analyses/relax_disp/api.py   Mon May  5 16:46:10 
2014
@@ -678,9 +678,21 @@
         @rtype:                 tuple of (int, int, float)
         &quot;&quot;&quot;

+        # Bad argument combination.
+        if model_info == None and spin_id == None:
+            raise RelaxError(&quot;Either the model_info or spin_id
argument must be supplied.&quot;)
+        elif model_info != None and spin_id != None:
+            raise RelaxError(&quot;The model_info arg &quot; + repr(model_info)
+ &quot; and spin_id arg &quot; + repr(spin_id) + &quot; clash.  Only one should be
supplied.&quot;)
+
         # Unpack the data.
         spin_ids = model_info
-        spins = spin_ids_to_containers(spin_ids)
+        #spins = spin_ids_to_containers(spin_ids)
+
+        spins_list = []
+        for spin_id in self.model_loop():
+            spins_list.append(spin_id[0])
+
+        spins = spin_ids_to_containers(spins_list)

         # The number of parameters for the cluster.
         k = param_num(spins=spins)


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00115" href="msg00115.html">Fwd: r22958 - /trunk/specific_analyses/relax_disp/api.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00116" href="msg00116.html">Re: r22958 - /trunk/specific_analyses/relax_disp/api.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00117" href="msg00117.html">Re: r22958 - /trunk/specific_analyses/relax_disp/api.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00118" href="msg00118.html">Re: r22958 - /trunk/specific_analyses/relax_disp/api.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00119" href="msg00119.html">Re: r22958 - /trunk/specific_analyses/relax_disp/api.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00120" href="msg00120.html">Re: r22958 - /trunk/specific_analyses/relax_disp/api.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue May 06 00:00:09 2014</div>  
</body>
</html>
