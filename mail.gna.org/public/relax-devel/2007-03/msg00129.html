<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: how to parallelise model_free minimise -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 26 Mar 2007 19:03:39 +0200 -->
<!--X-Message-Id: 7f080ed10703261002i7cc384a6n8bf20be7aaad4e0e@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7f080ed10703191030h79036e06w56912aa1d9130f48@mail.gmail.com -->
<!--X-Reference: 45FF0E84.1060007@bmb.leeds.ac.uk -->
<!--X-Reference: 1174384147.29205.20.camel@pc172&#45;31&#45;2&#45;63.biochem.unimelb.edu.au -->
<!--X-Reference: 45FFEC5C.7060205@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703200727l5fad8e72if4cf9aff74bc21@mail.gmail.com -->
<!--X-Reference: 45FFF714.7070903@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703200813x323ec212l471796641855a7ff@mail.gmail.com -->
<!--X-Reference: 4603EA08.60801@bmb.leeds.ac.uk -->
<!--X-Reference: 7f080ed10703252217x7db43e6bxfe7324ad0379c778@mail.gmail.com -->
<!--X-Reference: 4607F0AB.6000807@bmb.leeds.ac.uk -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: how to parallelise model_free minimise -- March 26, 2007 - 19:03</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: how to parallelise model_free minimise</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00129" class="tabs">Index by Date</a> | <a href="threads.html#00129" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00128.html">Date Prev</a>] [<a href="msg00130.html">Date Next</a>] [<a href="msg00128.html">Thread Prev</a>] [<a href="msg00131.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Gary S. Thompson&quot; &lt;garyt@xxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 27 Mar 2007 03:02:49 +1000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: a=rsa-sha1; c=relaxed/relaxed; d=gmail.com; s=beta;	h=domainkey-signature:received:received:message-id:date:from:sender:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references:x-google-sender-auth;	b=dVSvS1szJ3aRWiXP1xp80UngKyXuVpz1kk8i6soOuZarrM0NrLZ2kandj8mzpWHtguxmiRVI+VTFxDoZvFt2D1rU0YxcgKDbHKmSXh7EjQL1hkApLl67nKdzRTEt5ixV59c2MW876FwJGN6JSr0CrS/3s18szcSN6kVNHtsE8rw=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00129.html">7f080ed10703261002i7cc384a6n8bf20be7aaad4e0e@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00092.html">7f080ed10703191030h79036e06w56912aa1d9130f48@mail.gmail.com</a>&gt;	&lt;<a href="msg00093.html">45FF0E84.1060007@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00097.html">1174384147.29205.20.camel@pc172-31-2-63.biochem.unimelb.edu.au</a>&gt;	&lt;<a href="msg00107.html">45FFEC5C.7060205@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00110.html">7f080ed10703200727l5fad8e72if4cf9aff74bc21@mail.gmail.com</a>&gt;	&lt;<a href="msg00112.html">45FFF714.7070903@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00114.html">7f080ed10703200813x323ec212l471796641855a7ff@mail.gmail.com</a>&gt;	&lt;<a href="msg00124.html">4603EA08.60801@bmb.leeds.ac.uk</a>&gt;	&lt;<a href="msg00126.html">7f080ed10703252217x7db43e6bxfe7324ad0379c778@mail.gmail.com</a>&gt;	&lt;<a href="msg00128.html">4607F0AB.6000807@bmb.leeds.ac.uk</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on March 26, 2007 - 19:03:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>On 3/27/07, Gary S. Thompson &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">Edward d'Auvergne wrote:
&gt; On 3/24/07, Gary S. Thompson &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:
</pre></blockquote><br>
<blockquote class="blockquote"><pre style="margin: 0em;">&gt;&gt; 2. what is going to change between runs or even over runs of the relax
&gt;&gt; program.
&gt;
&gt; For each iteration of the main loop, these arguments and parameters
&gt; will change.
&gt;
Not necessarily? certainly things such as remap_table, ri_labels, etc do
not seem to change between passes through the loop
</pre></blockquote><pre style="margin: 0em;"><br>These actually change if you have a data set missing for a single spin
system because of peak overlap, etc.  Most of the time you don't see
this though.</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">&gt;&gt; As an aside when the redesign of the spin_loops and minimise /model
&gt;&gt; loops cuts in it would be a good idea 9from the paralle point of view)
&gt;&gt; to have the spin loop  running faster than the minimse/model loop
&gt;
Sorry I wasn't quite clear here, its not comuptational speed I am
talking about but the speed of the 'loop counter'
</pre></blockquote><pre style="margin: 0em;"><br>Sorry, I don't quite understand what the speed of a 'loop counter' is.</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">e.g.it would be nice to have</pre><br>
<pre style="margin: 0em;">for residue in  all residues:
    for model in models:
             do_stuff-(tm)</pre><br>
<pre style="margin: 0em;"><br>as opposed to</pre><br>
<pre style="margin: 0em;">for model in models: #currently at the user level
    for residue in  all residues:
             do_stuff-(tm)</pre><br>
<pre style="margin: 0em;">now that might need something of the form</pre><br>
<pre style="margin: 0em;">        # Set the run names (also the names of preset model-free models).
        if local_tm:
            self.runs = ['tm0', 'tm1', 'tm2', 'tm3', 'tm4', 'tm5',
'tm6', 'tm7', 'tm8', 'tm9']
        else:
            self.runs = ['m0', 'm1', 'm2', 'm3', 'm4', 'm5', 'm6', 'm7',
'm8', 'm9']</pre><br>
<pre style="margin: 0em;">run.create_composite('super')
for name in self.runs:</pre><br>
<pre style="margin: 0em;">    run.create(name, 'mf')
    composite_add('super',name)
    minimise('newton', run='super')</pre><br>
<pre style="margin: 0em;"><br>which would minimise all runs in parallel...</pre><br>
<pre style="margin: 0em;">and I understand from chris that we are planning to do</pre><br>
<pre style="margin: 0em;"><br>       # Set the run names (also the names of preset model-free models).
        if local_tm:
            self.runs = ['tm0', 'tm1', 'tm2', 'tm3', 'tm4', 'tm5',
'tm6', 'tm7', 'tm8', 'tm9']
        else:
            self.runs = ['m0', 'm1', 'm2', 'm3', 'm4', 'm5', 'm6', 'm7',
'm8', 'm9']</pre><br>
<pre style="margin: 0em;"><br>     minimise('newton', runs=self.runs)</pre><br>
<pre style="margin: 0em;"><br>which would also work</pre><br>
<pre style="margin: 0em;"><br>now comes the tricky bit</pre><br>
<pre style="margin: 0em;"><br>all the minimisations etc would now become rfnctions to setup
minimsations and say submit them to a queue with a suitable object to
allow the results to be sorted out later.</pre><br>
<pre style="margin: 0em;">then at the end of minimise('newton', runs=self.runs) you would collect
in all the results from all calculations and complete the calculation so
we have something like</pre><br>
<pre style="margin: 0em;">for residue
    for run in runs:
       calculation-instance = setup-calculation(residue,run)
       queue.submit(calculation-instance)
while(queue.not_complete()):
    result.queue.get_result()
    result.record(self.reax.data)</pre><br>
<pre style="margin: 0em;">This will allow the maximum numer of calculations to be conducted in
parallel and will intrisically load balance as well as we can get
</pre></blockquote><pre style="margin: 0em;"><br>There are a number of very important issues with this approach.  The
most important is that the loop over the data pipes corresponding to
the model-free models (the 'runs') is deliberately not part of the
relax codebase.  In Chris' implementation of the 'runs' argument
(which will need to be renamed) the loop will be at the highest level
of the code so that for the generic_fns.minimise code onwards nothing
changes.  This high level loop would probably be a very difficult
target for MPI as the whole relax data storage object will need to be
sent between nodes.  This multi-megabyte transfer per node, per
calculation is not ideal.</pre><br>
<pre style="margin: 0em;">Secondly, and very importantly, relax doesn't loop over residues in
the model-free minimise() function.  relax loops over minimisation
instances.  For the 'mf' and 'local_tm' parameter sets, this is a loop
over the spin systems (i.e. molecules first, residues second, and spin
systems last).  For the 'diff' and 'all' parameters sets the number of
minimisation instances is one and hence the loop runs once and then
that's it.  Looping over these followed by looping over the data pipes
(ex-runs) is insane!  That is essentially first looping over the
finest grained level followed by the coarsest.</pre><br>
<pre style="margin: 0em;">If you target the main loop of the minimise() code, I can guarrantee
you'll get the best usage out of a cluster.  Without specifically
mentioning this main loop, this is the target we have been talking
about throughout this thread.  An added benefit is that the minimise()
code base hardly needs to be changed.</pre><br>
<pre style="margin: 0em;">Regards,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00131" href="msg00131.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> gary thompson</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00092" href="msg00092.html">relax and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00093" href="msg00093.html">Re: relax and Grid computing.</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00097" href="msg00097.html">relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00107" href="msg00107.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00110" href="msg00110.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00112" href="msg00112.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00114" href="msg00114.html">Re: relax, MPI, and Grid computing.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00124" href="msg00124.html">how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
<li><strong><a name="00126" href="msg00126.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00128" href="msg00128.html">Re: how to parallelise model_free minimise</a></strong>
<ul><li><em>From:</em> Gary S. Thompson</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Mar 27 09:22:37 2007</div>  
</body>
</html>
