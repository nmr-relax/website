<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: r2777 &#45; /branches/test_suite/test_suite/unit_tests/test_float.py -->
<!--X-From-R13: "Unel E. Fubzcfba" <tnelgNozo.yrrqf.np.hx> -->
<!--X-Date: Mon, 13 Nov 2006 11:46:22 +0100 -->
<!--X-Message-Id: 45584CD7.4070101@bmb.leeds.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Ghw4p&#45;0003DT&#45;Mo@subversion.gna.org -->
<!--X-Reference: 7f080ed10611102058j8475279x3d78f44e5bb19@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r2777 - /branches/test_suite/test_suite/unit_tests/test_float.py -- November 13, 2006 - 11:46</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r2777 - /branches/test_suite/test_suite/unit_tests/test_float.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00155" class="tabs">Index by Date</a> | <a href="threads.html#00155" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00154.html">Date Prev</a>] [<a href="msg00156.html">Date Next</a>] [<a href="msg00148.html">Thread Prev</a>] [<a href="msg00158.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 13 Nov 2006 10:45:43 +0000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00155.html">45584CD7.4070101@bmb.leeds.ac.uk</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Ghw4p-0003DT-Mo@subversion.gna.org&gt;	&lt;<a href="msg00148.html">7f080ed10611102058j8475279x3d78f44e5bb19@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla Thunderbird 1.0 (X11/20041206)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Gary S. Thompson</strong> on November 13, 2006 - 11:46:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Edward d'Auvergne wrote:</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Gary, in these tests you have been using the 'float()' function for
creating numbers.  Would it be better to create a large number of
IEEE-754 bit patterns (as strings) covering all number types (and
possibly multiple +/- NaNs with different bits in the mantissa) and
then convert these to 64 bit floats taking endianness into account?
This should be more portable than using the 'float()' function and
give us much better control of the floats.</pre><br>
</blockquote><tt>The logic here was that we should use the in-built float function for 
anything other than special values as they will always be more 
rigourously tested than anything we produce ;-)</tt><br>
<br>
<tt>as to testing multiple nan patterns that is a good idea, and I was 
planning to add that at a later date. There is just a single nan 
pattern  in float.py here so that we can create a constant...</tt><br>
<br>
<tt>I tried to keep the float.py module containing just  the constants &amp;  
functions which are used to check the contents of floats and to give 
values for the special floats inf, zero,and nan</tt><br>
<br>
<tt>I have another file which I haven't submitted to svn yet which contains 
utility functions and information about the float capabilites of a 
platform. However, it is extremley ropey in places....</tt><br>
<br>
<tt>It also has functions for printing floats as bit patterns of hex and 
binary ;-)</tt><br>
<br>
<pre style="margin: 0em;">regards
gary</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Cheers,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">On 11/9/06, garyt@xxxxxxxxxxxxxxx &lt;garyt@xxxxxxxxxxxxxxx&gt; wrote:</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Author: varioustoxins
Date: Wed Nov  8 23:39:23 2006
New Revision: 2777</pre><br>
<pre style="margin: 0em;">URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=2777&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=2777&amp;view=rev</a>
Log:
Added tests for isZero &amp; isPositive &amp; id based dicts and subset removal</pre><br>
<pre style="margin: 0em;"><br>Modified:
    branches/test_suite/test_suite/unit_tests/test_float.py</pre><br>
<tt>Modified: branches/test_suite/test_suite/unit_tests/test_float.py<br>
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/branches/test_suite/test_suite/unit_tests/test_float.py?rev=2777&amp;r1=2776&amp;r2=2777&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/test_suite/test_suite/unit_tests/test_float.py?rev=2777&amp;r1=2776&amp;r2=2777&amp;view=diff</a> </tt><br>
<br>
<tt>============================================================================== </tt><br>
<br>
<tt>--- branches/test_suite/test_suite/unit_tests/test_float.py (original)<br>
+++ branches/test_suite/test_suite/unit_tests/test_float.py Wed Nov  
8 23:39:23 2006<br>
@@ -2,24 +2,76 @@</tt><br>
<br>
<pre style="margin: 0em;"> import unittest
 from float  import *
+from copy import copy
+
 FLOAT_EPSILON=float(4.94065645841247e-324) # replace a a later date
+FLOAT_NORMAL = float(1e6)
+ZERO = float(+0.0)
+NEG_ZERO = -ZERO
+NEG_FLOAT_EPSILON = -FLOAT_EPSILON
+NEG_FLOAT_NORMAL =  -FLOAT_NORMAL
+
+def makeDictById(elements):
+    result ={}
+    for element in elements:
+        result[id(element)]=element
+
+    return result
+
+def winnowDictToListById(dict,elements):
+    resultDict = copy(dict)
+
+    for element in elements:
+        del(resultDict[id(element)])
+
+    return resultDict.values()</pre><br>
<pre style="margin: 0em;"> class Test_float(unittest.TestCase):
-    def test_GetFloatClass(self):
+
+    tests = makeDictById([pos_inf, neg_inf, FLOAT_NORMAL,
+                          NEG_FLOAT_NORMAL, FLOAT_EPSILON,
+                          NEG_FLOAT_EPSILON, nan, ZERO, NEG_ZERO])
+
+
+    def test_getFloatClass(self):
+
         tests = ( CLASS_POS_INF, pos_inf,
                   CLASS_NEG_INF, neg_inf,
-                  CLASS_POS_NORMAL, float(1e6),
-                  CLASS_NEG_NORMAL, -float(1e6),
+                  CLASS_POS_NORMAL, FLOAT_NORMAL,
+                  CLASS_NEG_NORMAL, -FLOAT_NORMAL,
                   CLASS_POS_DENORMAL,  FLOAT_EPSILON,
                   CLASS_NEG_DENORMAL,  -FLOAT_EPSILON,
                   CLASS_QUIET_NAN,     nan,
                   # WE DON'T USE SIGNAL NANS CLASS_SIGNAL_NAN,
-                  CLASS_POS_ZERO,    float(0),
-                  CLASS_NEG_ZERO,    -float(0))
+                  CLASS_POS_ZERO,    ZERO,
+                  CLASS_NEG_ZERO,    -ZERO)</pre><br>
<tt>         i=iter(tests)<br>
         for (fpClass, value) in zip(i,i):<br>
             self.assertEqual(fpClass, getFloatClass(value))<br>
+<br>
+    def test_isZero(self):<br>
+        positives = (ZERO,NEG_ZERO)<br>
+        negatives= winnowDictToListById(self.tests,positives)<br>
+<br>
+        self.doTestSets(isZero,positives=positives, 
negatives=negatives)<br>
+<br>
+<br>
+    def test_isPositive(self):<br>
+        negatives = (neg_inf, NEG_FLOAT_NORMAL,NEG_FLOAT_EPSILON, 
NEG_ZERO)<br>
+        positives= winnowDictToListById(self.tests,negatives)<br>
+<br>
+        self.doTestSets(isPositive,positives=positives, 
negatives=negatives)<br>
+<br>
+    #todo add reporting of failed number class...<br>
+    def doTestSets(self,function,positives=[],negatives=[]):<br>
+        for positive in positives:<br>
+            self.assertEqual(function(positive),True)<br>
+<br>
+        for negative in negatives:<br>
+            self.assertEqual(function(negative),False)<br>
+<br>
+</tt><br>
<br>
<pre style="margin: 0em;"><br> if __name__ == '__main__':</pre><br>
<pre style="margin: 0em;"><br>_______________________________________________
relax (<a  href="http://nmr-relax.com">http://nmr-relax.com</a>)</pre><br>
<pre style="margin: 0em;">This is the relax-commits mailing list
relax-commits@xxxxxxx</pre><br>
<pre style="margin: 0em;">To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a></pre><br>
</blockquote><pre style="margin: 0em;"><br>.</pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
-------------------------------------------------------------------
Dr Gary Thompson
Astbury Centre for Structural Molecular Biology,
University of Leeds, Astbury Building,
Leeds, LS2 9JT, West-Yorkshire, UK             Tel. +44-113-3433024
email: garyt@xxxxxxxxxxxxxxx                   Fax  +44-113-2331407
-------------------------------------------------------------------</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00158" href="msg00158.html">Re: r2777 - /branches/test_suite/test_suite/unit_tests/test_float.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00148" href="msg00148.html">Re: r2777 - /branches/test_suite/test_suite/unit_tests/test_float.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Nov 13 15:20:36 2006</div>  
</body>
</html>
