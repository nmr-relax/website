<!-- MHonArc v2.6.18 -->
<!--X-Subject: r26297 &#45; in /branches/space_mapping_refactor: ./ auto_analyses/dauvergne_protocol.py -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Thu, 16 Oct 2014 18:18:20 +0200 -->
<!--X-Message-Id: E1Xenkp&#45;0000Xu&#45;QW@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r26297 - in /branches/space_mapping_refactor: ./ auto_analyses/dauvergne_protocol.py -- October 16, 2014 - 18:18</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r26297 - in /branches/space_mapping_refactor: ./ auto_analyses/dauvergne_protocol.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00193" class="tabs">Index by Date</a> | <a href="threads.html#00193" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00192.html">Date Prev</a>] [<a href="msg00194.html">Date Next</a>] [<a href="msg00192.html">Thread Prev</a>] [<a href="msg00194.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Thu, 16 Oct 2014 16:18:19 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00193.html">E1Xenkp-0000Xu-QW@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on October 16, 2014 - 18:18:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Thu Oct 16 18:18:19 2014
New Revision: 26297

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=26297&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=26297&amp;view=rev</a>
Log:
Merged revisions 26283-26285 via svnmerge from 
svn+ssh://bugman@xxxxxxxxxxx/svn/relax/trunk

........
  r26283 | bugman | 2014-10-15 11:38:09 +0200 (Wed, 15 Oct 2014) | 13 lines
  
  Added more checks to the determine_rnd() of the dauvergne_protocol 
model-free auto-analysis.
  
  This is to try to catch bizarre situations such as bug #22730 
(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?22730">https://gna.org/bugs/?22730</a>),
  model-free auto-analysis - relax stops and quits at the polate step.
  
  The following additional fatal conditions are now checked for:  A file with 
the same name as the
  base model directory already exists;  The base model directory is not 
readable;  The base model
  directory is not writable.  The last two could be caused by file system 
corruptions.  In addition,
  the presence of the base model directory is checked for using 
os.path.isdir() rather than catching
  errors coming out of the os.listdir() function.  These changes should make 
the analysis more robust
  in the presence of 'strangeness'.
........
  r26284 | bugman | 2014-10-15 11:42:25 +0200 (Wed, 15 Oct 2014) | 8 lines
  
  Added an additional check to determine_rnd() of the dauvergne_protocol 
model-free auto-analysis.
  
  This is to try to catch bizarre situations such as bug #22730 
(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?22730">https://gna.org/bugs/?22730</a>),
  model-free auto-analysis - relax stops and quits at the polate step.
  
  The additional check is that if the base model directory is not executable, 
a RelaxError is raised.
........
  r26285 | bugman | 2014-10-15 13:02:27 +0200 (Wed, 15 Oct 2014) | 7 lines
  
  Added printouts to the determine_rnd() function of the dauvergne_protocol 
model-free auto-analysis.
  
  This is for better user feedback in the log files as to what is happening.  
It may help in debugging
  bug #22730 (<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/?22730">https://gna.org/bugs/?22730</a>): Model-free auto-analysis - relax 
stops and quits at the
  polate step.
........

Modified:
    branches/space_mapping_refactor/   (props changed)
    branches/space_mapping_refactor/auto_analyses/dauvergne_protocol.py

Propchange: branches/space_mapping_refactor/
------------------------------------------------------------------------------
--- svnmerge-integrated (original)
+++ svnmerge-integrated Thu Oct 16 18:18:19 2014
@@ -1 +1 @@
-/trunk:1-26279
+/trunk:1-26279,26283-26285

Modified: branches/space_mapping_refactor/auto_analyses/dauvergne_protocol.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/space_mapping_refactor/auto_analyses/dauvergne_protocol.py?rev=26297&amp;r1=26296&amp;r2=26297&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/space_mapping_refactor/auto_analyses/dauvergne_protocol.py?rev=26297&amp;r1=26296&amp;r2=26297&amp;view=diff</a>
==============================================================================
--- branches/space_mapping_refactor/auto_analyses/dauvergne_protocol.py 
(original)
+++ branches/space_mapping_refactor/auto_analyses/dauvergne_protocol.py Thu 
Oct 16 18:18:19 2014
@@ -21,9 +21,11 @@
 
 # Python module imports.
 from math import pi
-from os import F_OK, access, getcwd, listdir, sep
+from os import F_OK, R_OK, W_OK, X_OK, access, getcwd, listdir, sep
+from os.path import isdir
 from re import search
 from time import sleep
+import sys
 
 # relax module imports.
 from lib.float import floatAsByteArray
@@ -494,14 +496,35 @@
     def determine_rnd(self, model=None):
         &quot;&quot;&quot;Function for returning the name of next round of optimisation.&quot;&quot;&quot;
 
-        # Get a list of all files in the directory model.  If no directory 
exists, set the round to 'init' or 0.
-        try:
-            dir_list = listdir(self.results_dir+sep+model)
-        except:
+        # The base model directory.
+        base_dir = self.results_dir+sep+model
+
+        # Printout.
+        sys.stdout.write(&quot;\n\nDetermining the next round of optimisation for 
'%s':  &quot; % base_dir)
+
+        # Catch if a file exists with the name of the directory.
+        if not isdir(base_dir) and access(base_dir, F_OK):
+            raise RelaxError(&quot;The base model directory '%s' is not usable as 
a file with the same name already exists.&quot; % base_dir)
+
+        # If no directory exists, set the round to 'init' or 0.
+        if not isdir(base_dir):
+            sys.stdout.write(&quot; 0.\n\n&quot;)
             return 0
+
+        # Is the directory readable, writable, and executable.
+        if not access(base_dir, R_OK):
+            raise RelaxError(&quot;The base model directory '%s' is not 
readable.&quot; % base_dir)
+        if not access(base_dir, W_OK):
+            raise RelaxError(&quot;The base model directory '%s' is not 
writable.&quot; % base_dir)
+        if not access(base_dir, X_OK):
+            raise RelaxError(&quot;The base model directory '%s' is not 
executable.&quot; % base_dir)
+
+        # Get a list of all files in the directory model.
+        dir_list = listdir(base_dir)
 
         # Set the round to 'init' or 0 if there is no directory called 
'init'.
         if 'init' not in dir_list:
+            sys.stdout.write(&quot; 0.\n\n&quot;)
             return 0
 
         # Create a list of all files which begin with 'round_'.
@@ -521,6 +544,7 @@
 
         # No directories beginning with 'round_' exist, set the round to 1.
         if not len(numbers):
+            sys.stdout.write(&quot; 1.\n\n&quot;)
             return 1
 
         # The highest number.
@@ -532,7 +556,7 @@
             complete_round = i
 
             # The file root.
-            file_root = self.results_dir + sep + model + sep + &quot;round_%i&quot; % 
i + sep + 'opt' + sep + 'results'
+            file_root = base_dir + sep + &quot;round_%i&quot; % i + sep + 'opt' + sep 
+ 'results'
 
             # Stop looping when the opt/results file is found.
             if access(file_root + '.bz2', F_OK):
@@ -544,9 +568,11 @@
 
         # No round, so assume the initial state.
         if complete_round == 0:
+            sys.stdout.write(&quot; 0.\n\n&quot;)
             return 0
 
         # Determine the number for the next round (add 1 to the highest 
completed round).
+        sys.stdout.write(&quot; %i.\n\n&quot; % complete_round + 1)
         return complete_round + 1
 
 



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Oct 16 18:20:03 2014</div>  
</body>
</html>
