<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Help with settings script for R1rho analysis. -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 22 Oct 2013 14:55:00 +0200 -->
<!--X-Message-Id: CA+CBx2OEmeEWsvWNL283avhzjb1zBV3=qT&#45;N7q&#45;8Jo8Dn7WgZw@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CA+CBx2Otwm3tdPgfzVduw9gDZxtwjq82Y8iAp7q_OJeQ2LKZ8g@mail.gmail.com -->
<!--X-Reference: CAED9pY8QeGe=P4G+=6YD7EitmkKW82HCpTapFsnKfmCiBAZMzg@mail.gmail.com -->
<!--X-Reference: CA+CBx2O=c47Fug5LwhmnFMQLxxnntDr0SHLXR3=SAW_k6bHovg@mail.gmail.com -->
<!--X-Reference: CAED9pY9FZ8ihwpDvHhyxz3ec0QwTeV=FOG9zfn+LPeD6xVZUsw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Help with settings script for R1rho analysis. -- October 22, 2013 - 14:55</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Help with settings script for R1rho analysis.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00067" class="tabs">Index by Date</a> | <a href="threads.html#00067" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00066.html">Date Prev</a>] [<a href="msg00068.html">Date Next</a>] [<a href="msg00066.html">Thread Prev</a>] [<a href="msg00068.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 22 Oct 2013 14:54:07 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:from:date:message-id	:subject:to:cc:content-type;	bh=6tOwt/fhk7TruvtMky7l2mXxk2HSW+TldNOHess4830=;	b=van35bAZrwdme58fZS25u7Svfbk9ifgXSub4yYrqt9v6tePt0h04eZQl/+O7IMrzrw	EQBEElhZ8+BCkTAucJB9Ms048iT3HoznBO61lA7vi/zRT/n93GSdhS7xtAc/WcRnsnmA	SOOsprqi/Dq1R4f2qqQ4z1cGYoJ+QXgAwDZ8DlSrpEkjz+4z9NgytdyEUqxruOGVwEEO	8HUi5r2dBOrj9aLVjhkeqAvLDEk7q0h6Yjan3iZq6MnNUT7v3aoHX6F9oz55w2GfNXol	dlB2tpX7UjqX3nszs5cmS/E22cslNPGLqFROowmuho5YBihiPKmDb7/GxlEMD2kR0in/	ok3Q==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00067.html">CA+CBx2OEmeEWsvWNL283avhzjb1zBV3=qT-N7q-8Jo8Dn7WgZw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CA+CBx2Otwm3tdPgfzVduw9gDZxtwjq82Y8iAp7q_OJeQ2LKZ8g@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY8QeGe=P4G+=6YD7EitmkKW82HCpTapFsnKfmCiBAZMzg@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2O=c47Fug5LwhmnFMQLxxnntDr0SHLXR3=SAW_k6bHovg@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY9FZ8ihwpDvHhyxz3ec0QwTeV=FOG9zfn+LPeD6xVZUsw@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on October 22, 2013 - 14:55:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr">Hi Edward.<div><br></div><div>I am digging through old perl scripts, which is preparing data for our analysis in IgorPro.</div><div><br></div><div>So I guess my challenge is now to match this to the procedures of relax, and establish the difference.</div>

<div><br></div><div>-----------</div><div><div>$expList=&quot;expList.txt&quot;;</div><div>$peakFile=&#39;peaks.dat&#39;;</div><div>$centerPPM=118.085;</div><div>$frq=81.050;</div></div><div>-----------</div><div><br></div>

<div>expList.txt contains lines with: &quot;fit_R1_filename&quot;  &quot;spin_lock_offset_HZ&quot;   &quot;spin_lock_field_Hz&quot; <br></div><div><br></div><div>----------------------</div><div><div>open IN, &quot;$expList&quot; or die &quot;Cannot open $expList for read&quot;;</div>

<div>while (&lt;IN&gt;){</div><div><span class="" style="white-space:pre">	</span>@process = split (/\s+/, $_);<span class="" style="white-space:pre">	</span></div><div><span class="" style="white-space:pre">	</span>if ($process[0] ne &quot;#&quot;){</div>

<div><span class="" style="white-space:pre">		</span>$fileName{$i}=$process[0];</div><div><span class="" style="white-space:pre">		</span>$offset{$i}=$process[1];</div><div><span class="" style="white-space:pre">		</span>$omega1{$i}=$process[2];</div>

<div><span class="" style="white-space:pre">		</span>$i++;</div><div><span class="" style="white-space:pre">	</span>};</div><div>};</div><div>close (IN);</div></div><div>-------------------</div><div><br></div><div style>

And then it read the peak file to extract ppm for N15.</div><div style><br></div><div style>-------------</div><div style><div>open IN , &quot;$peakFile&quot; or die &quot;Cannot open $peakFile for read&quot;;</div><div>
<span class="" style="white-space:pre">	</span>while (&lt;IN&gt;) {</div>
<div><span class="" style="white-space:pre">		</span>@process = split (/\s+/, $_);</div><div><span class="" style="white-space:pre">		</span>if ($process[0] eq &quot;&quot;){splice (@process, 0, 1)};</div><div><span class="" style="white-space:pre">		</span>if ($process[0] == 1){ $read = 1};</div>

<div><span class="" style="white-space:pre">		</span>if ($read == 1){</div><div><span class="" style="white-space:pre">			</span>$chemShift{$process[6]}=$process[4];</div><div><span class="" style="white-space:pre">		</span>};</div>

<div><span class="" style="white-space:pre">	</span>};</div><div>close (IN);</div><div>-----------</div><div style>The chemical shifts are stored in a dictionary under the residue name ($process[6]) with the ppm values of N15 ($process[4]).<br>

</div><div style><br></div><div style>Then R1r and R1r_err are read in from external exponential fit files.</div><div style>------------</div></div><div><div>for ($i = 1; $i &lt;= $numFiles; $i++){</div><div><span class="" style="white-space:pre">	</span>open IN, &quot;$fileName{$i}&quot; or die &quot;Cannot open $fileName{$i} for read&quot;;</div>

<div><span class="" style="white-space:pre">		</span>while (&lt;IN&gt;){</div><div><span class="" style="white-space:pre">			</span>@process = split (/\s+/, $_);</div><div><span class="" style="white-space:pre">			</span>if ($process[0] ne &quot;#&quot;){</div>

<div><span class="" style="white-space:pre">				</span>$R1r{$process[0]}{$i}=$process[1];</div><div><span class="" style="white-space:pre">				</span>$R1r_err{$process[0]}{$i}=$process[2];</div><div><span class="" style="white-space:pre">			</span>};</div>

<div><span class="" style="white-space:pre">		</span>};</div><div><span class="" style="white-space:pre">	</span>close(IN);</div><div>};</div></div><div>-------------------</div><div><br></div><div><div><br></div><div style>

Then omega is calculated.</div><div>------------</div><div>foreach $peakName (keys %chemShift) {</div><div><span class="" style="white-space:pre">	</span>open (OUT, &quot;&gt;../residueFiles/$peakName.dat&quot;);</div><div>

<span class="" style="white-space:pre">		</span>for ($i=1;$i&lt;=$numFiles;$i++){</div><div><span class="" style="white-space:pre">			</span>$OMEGA=($centerPPM-$chemShift{$peakName})*$frq+$offset{$i};</div><div><span class="" style="white-space:pre">			</span>$omegaEFF=sqrt($OMEGA**2+$omega1{$i}**2);</div>

<div><span class="" style="white-space:pre">			</span>if (($omega1{$i}/$OMEGA) &gt; 0){</div><div><span class="" style="white-space:pre">				</span>$theta=180/$PI*abs(atan($omega1{$i}/$OMEGA));</div><div><span class="" style="white-space:pre">			</span>}else{</div>

<div><span class="" style="white-space:pre">				</span>$theta=180-180/$PI*abs(atan($omega1{$i}/$OMEGA));</div><div><span class="" style="white-space:pre">			</span>};</div><div><span class="" style="white-space:pre">			</span>printf OUT &quot;%s %s %s %s %s %s\n&quot;,$OMEGA,$omega1{$i},$omegaEFF,$theta,$R1r{$peakName}{$i},$R1r_err{$peakName}{$i};</div>

<div><span class="" style="white-space:pre">		</span>};</div><div><span class="" style="white-space:pre">	</span>close (OUT);</div><div>};</div></div><div>--------------</div><div><br></div><div style>I guess I would need to find out how relax calculates omegaEFF, the effective field in the rotating frame ?</div>

<div style><br></div><div style>Best</div><div style>Troels</div><div><br></div><div><br></div></div><div class="gmail_extra"><br><br><div class="gmail_quote">2013/10/22 Edward d&#39;Auvergne <span dir="ltr">&lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx" target="_blank">edward@xxxxxxxxxxxxx</a>&gt;</span><br>

<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">Hi,<br>
<br>
Ok, I made the assumption that deltadof2 was not the spin-lock offset<br>
(in ppm) but rather the spin-lock field strength (in Hz).  The ppm<br>
values as printed out from the r1rho_1_ini.py script are far too low<br>
for 15N.  They should be in the range of 100-120 ppm!  I.e. around the<br>
15N chemical shifts.  They can be much higher and much lower for<br>
off-resonance data, but having many at an offset of 0.0 ppm seems a<br>
little strange.<br>
<br>
Regards,<br>
<br>
Edward<br>
<div class="HOEnZb"><div class="h5"><br>
On 22 October 2013 13:18, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt; wrote:<br>
&gt; Hi Edward.<br>
&gt;<br>
&gt; Thanks for looking at this.<br>
&gt;<br>
&gt; The offset for N15 spinlock is given in Hz as parameter deltadof2<br>
&gt; for our pulse sequence.<br>
&gt;<br>
&gt; So I guess that this conversions should be appropriate:<br>
&gt; omega_rf_ppm = float(deltadof2) / (set_sfrq * 1E6) * 1E6<br>
&gt;<br>
&gt; where set_sfrq=799.7773991 is the spectrometer frequency.<br>
&gt;<br>
&gt; Best<br>
&gt; Troels<br>
&gt;<br>
&gt;<br>
&gt; 2013/10/22 Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt;<br>
&gt;&gt; Hi,<br>
&gt;&gt;<br>
&gt;&gt; In the relax prompt, have a look at:<br>
&gt;&gt;<br>
&gt;&gt; relax&gt; help(relax_disp.spin_lock_offset)<br>
&gt;&gt;<br>
&gt;&gt; The unit you need is ppm.  You can find this number directly from the<br>
&gt;&gt; Bruker acqus or Varian procpar files.  It is the ppm offset of the<br>
&gt;&gt; spin-lock pulse which is manually set by the person recording for each<br>
&gt;&gt; spectrum.  You may need to go to the original pulse sequence to know<br>
&gt;&gt; which pulse this is.  It will be a fixed value for each spectrum<br>
&gt;&gt; collected and you can use that value directly.  The calculations in<br>
&gt;&gt; your scripts seem far to complicated and it looks like the internal<br>
&gt;&gt; conversions performed within relax.  You should never need<br>
&gt;&gt; gyromagnetic ratios, factors of pi, etc.  If you do, you should<br>
&gt;&gt; probably go back to the original experiments and pull out the correct<br>
&gt;&gt; offset number in ppm for each spectrum.  I hope this helps.<br>
&gt;&gt;<br>
&gt;&gt; Regards,<br>
&gt;&gt;<br>
&gt;&gt; Edward<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt; On 22 October 2013 10:46, Troels Emtekær Linnet &lt;<a rel="nofollow" href="mailto:tlinnet@xxxxxxxxxxxxx">tlinnet@xxxxxxxxxxxxx</a>&gt;<br>
&gt;&gt; wrote:<br>
&gt;&gt; &gt; Hi Edward.<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; I wonder if would have time to look at the settings script in:<br>
&gt;&gt; &gt; test_suite/shared_data/dispersion/Kjaergaard_et_al_2013<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; It is the scripts:<br>
&gt;&gt; &gt; r1rho_1_ini.py<br>
&gt;&gt; &gt; r1rho_3_spectra_settings.py<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; In r1rho, I am unsure if I do the correct conversion from Hz to ppm for<br>
&gt;&gt; &gt; omega_rf.<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Again, if there is hidden radian units?<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; It is when I set:<br>
&gt;&gt; &gt; relax_disp.spin_lock_offset<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; And I wonder, how to start modifying, so R1 rates can be read per<br>
&gt;&gt; &gt; spectra?<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; Best<br>
&gt;&gt; &gt; Troels<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; _______________________________________________<br>
&gt;&gt; &gt; relax (<a rel="nofollow" href="/" target="_blank">http://www.nmr-relax.com</a>)<br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; This is the relax-devel mailing list<br>
&gt;&gt; &gt; <a rel="nofollow" href="mailto:relax-devel@xxxxxxx">relax-devel@xxxxxxx</a><br>
&gt;&gt; &gt;<br>
&gt;&gt; &gt; To unsubscribe from this list, get a password<br>
&gt;&gt; &gt; reminder, or change your subscription options,<br>
&gt;&gt; &gt; visit the list information page at<br>
&gt;&gt; &gt; <a rel="nofollow" href="/mail.gna.org/listinfo/relax-devel" target="_blank">https://mail.gna.org/listinfo/relax-devel</a><br>
&gt;&gt; &gt;<br>
&gt;<br>
&gt;<br>
</div></div></blockquote></div><br></div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00068" href="msg00068.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00063" href="msg00063.html">Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00064" href="msg00064.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00065" href="msg00065.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00066" href="msg00066.html">Re: Help with settings script for R1rho analysis.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Oct 22 15:20:07 2013</div>  
</body>
</html>
