<!-- MHonArc v2.6.10 -->
<!--X-Subject: r2927 &#45; in /1.3: generic_fns/selection.py prompt/select.py -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Fri, 08 Dec 2006 03:22:22 +0100 -->
<!--X-Message-Id: E1GsVN2&#45;00045q&#45;Ht@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r2927 - in /1.3: generic_fns/selection.py prompt/select.py -- December 08, 2006 - 03:22</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r2927 - in /1.3: generic_fns/selection.py prompt/select.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00026" class="tabs">Index by Date</a> | <a href="threads.html#00026" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00025.html">Date Prev</a>] [<a href="msg00027.html">Date Next</a>] [<a href="msg00025.html">Thread Prev</a>] [<a href="msg00027.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Fri, 08 Dec 2006 02:21:52 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00026.html">E1GsVN2-00045q-Ht@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on December 08, 2006 - 03:22:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Fri Dec  8 03:21:49 2006
New Revision: 2927

URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=2927&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=2927&amp;view=rev</a>
Log:
Spin systems can now be selected using boolean operators.

The user functions 'select.res()' and 'select.read()' now accept the boolean 
keyword option which
can be set to 'OR', 'NOR', 'AND', 'NAND', 'XOR', or 'XNOR'.  The default, and 
previous behaviour, is
'OR'.


Modified:
    1.3/generic_fns/selection.py
    1.3/prompt/select.py

Modified: 1.3/generic_fns/selection.py
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.3/generic_fns/selection.py?rev=2927&amp;r1=2926&amp;r2=2927&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/generic_fns/selection.py?rev=2927&amp;r1=2926&amp;r2=2927&amp;view=diff</a>
==============================================================================
--- 1.3/generic_fns/selection.py (original)
+++ 1.3/generic_fns/selection.py Fri Dec  8 03:21:49 2006
@@ -1,6 +1,6 @@
 
###############################################################################
 #                                                                            
 #
-# Copyright (C) 2003, 2004 Edward d'Auvergne                                 
 #
+# Copyright (C) 2003, 2004, 2006 Edward d'Auvergne                           
 #
 #                                                                            
 #
 # This file is part of the program relax.                                    
 #
 #                                                                            
 #
@@ -80,8 +80,24 @@
                 self.relax.data.res[self.run][i].select = 1
 
 
-    def sel_read(self, run=None, file=None, dir=None, change_all=None, 
column=None):
-        &quot;&quot;&quot;Function for selecting the residues contained in a file.&quot;&quot;&quot;
+    def sel_read(self, run=None, file=None, dir=None, boolean='OR', 
change_all=0, column=None):
+        &quot;&quot;&quot;Select the residues contained in the given file.
+
+        @param run:         The run name.
+        @type run:          str
+        @param file:        The name of the file.
+        @type file:         str
+        @param dir:         The directory containing the file.
+        @type dir:          str
+        @param boolean:     The boolean operator used to select the spin 
systems with.  It can be
+            one of 'OR', 'NOR', 'AND', 'NAND', 'XOR', or 'XNOR'.
+        @type boolean:      str
+        @param change_all:  A flag which if set will set the selection to 
solely those of the file.
+        @type change_all:   int
+        @param column:      The whitespace separated column in which the 
residue numbers are
+            located.
+        @type column:       int
+        &quot;&quot;&quot;
 
         # Extract the data from the file.
         file_data = self.relax.IO.extract_data(file, dir)
@@ -114,7 +130,6 @@
         self.runs = self.relax.generic.runs.list_of_runs(run)
 
         # Loop over the runs.
-        no_match = 1
         for self.run in self.runs:
             # Test if the run exists.
             if not self.run in self.relax.data.run_names:
@@ -129,24 +144,50 @@
                 # Remap the data structure 
'self.relax.data.res[self.run][i]'.
                 data = self.relax.data.res[self.run][i]
 
-                # Unselect all residues.
+                # The spin system is in the new selection list.
+                if data.num in select:
+                    new_select = 1
+                else:
+                    new_select = 0
+
+                # Select just the residues in the file.
                 if change_all:
-                    data.select = 0
-
-                # Select the residue if it is in the list select.
-                if data.num in select:
-                    data.select = 1
-
-                # Match flag.
-                no_match = 0
-
-        # No residue matched.
-        if no_match:
-            print &quot;No residues match.&quot;
-
-
-    def sel_res(self, run=None, num=None, name=None, change_all=None):
-        &quot;&quot;&quot;Function for selecting specific residues.&quot;&quot;&quot;
+                    data.select = new_select
+
+                # Boolean selections.
+                if boolean == 'OR':
+                    data.select = data.select or new_select
+                elif boolean == 'NOR':
+                    data.select = not (data.select or new_select)
+                elif boolean == 'AND':
+                    data.select = data.select and new_select
+                elif boolean == 'NAND':
+                    data.select = not (data.select and new_select)
+                elif boolean == 'XOR':
+                    data.select = not (data.select and new_select) and 
(data.select or new_select)
+                elif boolean == 'XNOR':
+                    data.select = (data.select and new_select) or not 
(data.select or new_select)
+                else:
+                    raise RelaxError, &quot;Unknown boolean operator &quot; + `boolean`
+
+
+
+    def sel_res(self, run=None, num=None, name=None, boolean='OR', 
change_all=0):
+        &quot;&quot;&quot;Select specific residues.
+        
+        @param run:         The run name.
+        @type run:          str
+        @param num:         The residue number.
+        @type num:          int or regular expression str
+        @param name:        The residue name.
+        @type name:         regular expression str
+        @param boolean:     The boolean operator used to select the spin 
systems with.  It can be
+            one of 'OR', 'NOR', 'AND', 'NAND', 'XOR', or 'XNOR'.
+        @type boolean:      str
+        @param change_all:  A flag which if set will set the selection to 
solely those residues
+            specified.
+        @type change_all:   int
+        &quot;&quot;&quot;
 
         # Test if the residue number is a valid regular expression.
         if type(num) == str:
@@ -181,28 +222,45 @@
                 # Remap the data structure 
'self.relax.data.res[self.run][i]'.
                 data = self.relax.data.res[self.run][i]
 
-                # Unselect all residues.
+                # Initialise the new selection flag.
+                new_select = 0
+
+                # Set the new selection flag if the residue matches 'num'.
+                if type(num) == int:
+                    if data.num == num:
+                        new_select = 1
+                elif type(num) == str:
+                    if match(num, `data.num`):
+                        new_select = 1
+
+                # Set the new selection flag if the residue matches 'name'.
+                if name != None:
+                    if match(name, data.name):
+                        new_select = 1
+
+                # Select just the specified residues.
                 if change_all:
-                    data.select = 0
-
-                # Skip the residue if there is no match to 'num'.
-                if type(num) == int:
-                    if not data.num == num:
-                        continue
-                elif type(num) == str:
-                    if not match(num, `data.num`):
-                        continue
-
-                # Skip the residue if there is no match to 'name'.
-                if name != None:
-                    if not match(name, data.name):
-                        continue
-
-                # Select the residue.
-                data.select = 1
+                    data.select = new_select
+
+                # Boolean selections.
+                if boolean == 'OR':
+                    data.select = data.select or new_select
+                elif boolean == 'NOR':
+                    data.select = not (data.select or new_select)
+                elif boolean == 'AND':
+                    data.select = data.select and new_select
+                elif boolean == 'NAND':
+                    data.select = not (data.select and new_select)
+                elif boolean == 'XOR':
+                    data.select = not (data.select and new_select) and 
(data.select or new_select)
+                elif boolean == 'XNOR':
+                    data.select = (data.select and new_select) or not 
(data.select or new_select)
+                else:
+                    raise RelaxError, &quot;Unknown boolean operator &quot; + `boolean`
 
                 # Match flag.
-                no_match = 0
+                if new_selection:
+                    no_match = 0
 
         # No residue matched.
         if no_match:

Modified: 1.3/prompt/select.py
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.3/prompt/select.py?rev=2927&amp;r1=2926&amp;r2=2927&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/prompt/select.py?rev=2927&amp;r1=2926&amp;r2=2927&amp;view=diff</a>
==============================================================================
--- 1.3/prompt/select.py (original)
+++ 1.3/prompt/select.py Fri Dec  8 03:21:49 2006
@@ -1,6 +1,6 @@
 
###############################################################################
 #                                                                            
 #
-# Copyright (C) 2003, 2004 Edward d'Auvergne                                 
 #
+# Copyright (C) 2003, 2004, 2006 Edward d'Auvergne                           
 #
 #                                                                            
 #
 # This file is part of the program relax.                                    
 #
 #                                                                            
 #
@@ -26,6 +26,38 @@
 
 
 class Select:
+    boolean_doc = &quot;&quot;&quot;
+        Boolean operators
+        ~~~~~~~~~~~~~~~~~
+
+        The 'boolean' keyword argument can be used to change how spin 
systems are selected.  The
+        allowed values are: 'OR', 'NOR', 'AND', 'NAND', 'XOR', 'XNOR'.  The 
following table details
+        how the selections will occur for the different boolean operators.
+        __________________________________________________________
+        |                    |   |   |   |   |   |   |   |   |   |
+        | Spin system        | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |
+        |____________________|___|___|___|___|___|___|___|___|___|
+        |                    |   |   |   |   |   |   |   |   |   |
+        | Original selection | 0 | 1 | 1 | 1 | 1 | 0 | 1 | 0 | 1 |
+        |                    |   |   |   |   |   |   |   |   |   |
+        | New selection      | 0 | 1 | 1 | 1 | 1 | 1 | 0 | 0 | 0 |
+        |____________________|___|___|___|___|___|___|___|___|___|
+        |                    |   |   |   |   |   |   |   |   |   |
+        | OR                 | 0 | 1 | 1 | 1 | 1 | 1 | 1 | 0 | 1 |
+        |                    |   |   |   |   |   |   |   |   |   |
+        | NOR                | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |
+        |                    |   |   |   |   |   |   |   |   |   |
+        | AND                | 0 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 |
+        |                    |   |   |   |   |   |   |   |   |   |
+        | NAND               | 1 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 |
+        |                    |   |   |   |   |   |   |   |   |   |
+        | XOR                | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 0 | 1 |
+        |                    |   |   |   |   |   |   |   |   |   |
+        | XNOR               | 1 | 1 | 1 | 1 | 1 | 0 | 0 | 1 | 0 |
+        |____________________|___|___|___|___|___|___|___|___|___|
+    &quot;&quot;&quot;
+
+
     def __init__(self, relax):
         # Help.
         self.__relax_help__ = \
@@ -80,7 +112,7 @@
         self.__relax__.generic.selection.sel_all(run=run)
 
 
-    def read(self, run=None, file=None, dir=None, change_all=0, column=0):
+    def read(self, run=None, file=None, dir=None, boolean='OR', 
change_all=0, column=0):
         &quot;&quot;&quot;Function for selecting the residues contained in a file.
 
         Keyword Arguments
@@ -92,6 +124,8 @@
         file:  The name of the file containing the list of residues to 
select.
 
         dir:  The directory where the file is located.
+
+        boolean:  The boolean operator specifying how residues should be 
selected.
 
         change_all:  A flag specifying if all other residues should be 
changed.
 
@@ -129,6 +163,7 @@
             text = text + &quot;run=&quot; + `run`
             text = text + &quot;, file=&quot; + `file`
             text = text + &quot;, dir=&quot; + `dir`
+            text = text + &quot;, boolean=&quot; + `boolean`
             text = text + &quot;, change_all=&quot; + `change_all`
             text = text + &quot;, column=&quot; + `column` + &quot;)&quot;
             print text
@@ -149,6 +184,10 @@
         if dir != None and type(dir) != str:
             raise RelaxNoneStrError, ('directory name', dir)
 
+        # Boolean operator.
+        if type(boolean) != str:
+            raise RelaxStrError, ('boolean operator', boolean)
+
         # Change all flag.
         if type(change_all) != int or (change_all != 0 and change_all != 1):
             raise RelaxBinError, ('change_all', change_all)
@@ -158,10 +197,10 @@
             raise RelaxIntError, ('residue number column', column)
 
         # Execute the functional code.
-        self.__relax__.generic.selection.sel_read(run=run, file=file, 
dir=dir, change_all=change_all, column=column)
-
-
-    def res(self, run=None, num=None, name=None, change_all=0):
+        self.__relax__.generic.selection.sel_read(run=run, file=file, 
dir=dir, boolean=boolean, change_all=change_all, column=column)
+
+
+    def res(self, run=None, num=None, name=None, boolean='OR', change_all=0):
         &quot;&quot;&quot;Function for selecting specific residues.
 
         Keyword Arguments
@@ -173,6 +212,8 @@
         num:  The residue number.
 
         name:  The residue name.
+
+        boolean:  The boolean operator specifying how residues should be 
selected.
 
         change_all:  A flag specifying if all other residues should be 
changed.
 
@@ -215,6 +256,7 @@
             text = text + &quot;run=&quot; + `run`
             text = text + &quot;, num=&quot; + `num`
             text = text + &quot;, name=&quot; + `name`
+            text = text + &quot;, boolean=&quot; + `boolean`
             text = text + &quot;, change_all=&quot; + `change_all` + &quot;)&quot;
             print text
 
@@ -238,12 +280,16 @@
         if num == None and name == None:
             raise RelaxError, &quot;At least one of the number or name arguments 
is required.&quot;
 
+        # Boolean operator.
+        if type(boolean) != str:
+            raise RelaxStrError, ('boolean operator', boolean)
+
         # Change all flag.
         if type(change_all) != int or (change_all != 0 and change_all != 1):
             raise RelaxBinError, ('change_all', change_all)
 
         # Execute the functional code.
-        self.__relax__.generic.selection.sel_res(run=run, num=num, 
name=name, change_all=change_all)
+        self.__relax__.generic.selection.sel_res(run=run, num=num, 
name=name, boolean=boolean, change_all=change_all)
 
 
     def reverse(self, run=None):
@@ -280,3 +326,11 @@
 
         # Execute the functional code.
         self.__relax__.generic.selection.reverse(run=run)
+
+
+
+    # Docstring modification.
+    #########################
+
+    # Read function.
+    read.__doc__ = read.__doc__ + &quot;\n\n&quot; + boolean_doc + &quot;\n&quot;



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Dec 08 08:00:06 2006</div>  
</body>
</html>
