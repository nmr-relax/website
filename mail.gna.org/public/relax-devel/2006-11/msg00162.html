<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re(2): r2801 &#45; /branches/test_suite/float.py -->
<!--X-From-R13: "tnel gubzcfba" <tnelgNozo.yrrqf.np.hx> -->
<!--X-Date: Wed, 15 Nov 2006 12:14:34 +0100 -->
<!--X-Message-Id: f001463a0611150313r32db2d84na26b6acfd658b0a0@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re(2): r2801 - /branches/test_suite/float.py -- November 15, 2006 - 12:14</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re(2): r2801 - /branches/test_suite/float.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00162" class="tabs">Index by Date</a> | <a href="threads.html#00162" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00161.html">Date Prev</a>] [<a href="msg00163.html">Date Next</a>] [<a href="msg00161.html">Thread Prev</a>] [<a href="msg00167.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Wed, 15 Nov 2006 11:13:46 +0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00162.html">f001463a0611150313r32db2d84na26b6acfd658b0a0@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>gary thompson</strong> on November 15, 2006 - 12:14:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">In advance sorry for the slightly strange format but I am replying to this by
gmail at home having cut and pasted the message from the archive
(this is my second attempt it lost all the first set of edits) n.b. I will 
only
send this to the list now as i don't have eds e-mail address at home
</pre><blockquote class="blockquote"><pre style="margin: 0em;"><br>edward.dauvergne@xxxxxxxxx wrote:</pre><br>
<pre style="margin: 0em;"> &gt;Author: bugman
&gt;Date: Sat Nov 11 10:57:35 2006
&gt;New Revision: 2801
&gt;
&gt;URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=2801&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=2801&amp;view=rev</a>
&gt;Log:
&gt;Two functions for converting a string bit pattern to a float and a number of
IEEE-754 constants.
&gt;
&gt;The fucntions 'bitpatternToFloat()' and 'bitpatternToInt()' have been added
to 'float.py'.  The
&gt;first converts a 64 bit IEEE-754 bit pattern in the form of a string into a
64 bit Python float.
&gt;The second converts an arbitrary bit pattern into its integer
representation.  By looping over each
&gt;8 characters of the string (1 byte), 'bitpatternToFloat()' calls
'bitpatternToInt()' to create an
&gt;array of integers.  Then 'packBytesAsPyFloat()' is called to convert the
byte array into the float.
&gt;These two functions convert between big and little endian when necessary.
&gt;
&gt;
Nice functions! However, I would suggest that these should go in utility
functions or  the test suite.... I am trying to keep float.py as the
bare minimum file for testing floating point numbers and floating point
constants</pre><br>
<pre style="margin: 0em;"><br>I agree - these string to float conversions are auxiliary to intended
purpose of the IEEE-754 module.  Unfortunately as you hadn't committed
the utility function code yet - I wasn't able to put the functions
there :).</pre><br>
<tt>This is true but certainly at this stage the product is just too half cut for
</tt></blockquote><pre style="margin: 0em;">anyone else and I wanted to concentrate on the primary problem (i.e. float.py)
and complete that first unit, test it etc before I did some work on
the capabilities
</pre><blockquote class="blockquote"><pre style="margin: 0em;"><br> How would you like to design the ieee754 module?  Have you searched
for documentation describing how to create standard Python modules,
i.e. the format and structure of the modules?  Should the utility
functions be part of the module?  Or should the be their own module?
</pre></blockquote><pre style="margin: 0em;"><br>Something I have to thing about and read python in a nutshell. basically 
if the
utility functions are private they shouldn't be part of the public interface.
Otherwise it is just a question of keeping the utility of the module 
focused...</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">The 'bitpatternToFloat()' function I added is 100% specific to
IEEE-754 though.  Do you think it would be a good idea, for future
Python inclusion and to improve on 'fpconst', to create a module which
includes as many IEEE-754 related functions as possible?</pre><br>
<br>
</blockquote><pre style="margin: 0em;">I would try to keep the number of functions to the minimum and maintain 
fpconst
compatabilty. all other functions can go in separate modules if needed.
</pre><blockquote class="blockquote"><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;"><br>A couple of other matters as well</pre><br>
<pre style="margin: 0em;"> 1. the constants are not much use at the end of the file as if anything
else in the file wants to refer to them they won't be able to</pre><br>
<pre style="margin: 0em;"><br>I didn't expect anything in 'float.py' to use them.  I just expanded
the constants proposed in PEP-754
(<a  href="http://www.python.org/dev/peps/pep-0754/">http://www.python.org/dev/peps/pep-0754/</a>) into a complete list of all
the IEEE-754 special numbers.  That was pretty simple to do.  They can
be imported into the unit tests as an accurate replacement for
FLOAT_EPSILON, etc.  Their main usage would be by the users of the
module.</pre><br>
</blockquote><pre style="margin: 0em;"><br>fair enough still the top is the place to put them (this is also where 
users
would expect to search for constants...)
</pre><blockquote class="blockquote"><pre style="margin: 0em;"><br>2. I was thinking of a test case with random numbers in the exponent of
the nan and then reporting what the bit pattern that failed was....</pre><br>
<tt><br>You mean mantissa?
</tt></blockquote><pre style="margin: 0em;"><br>sorry mental typo</pre><br>
<tt>The three NaN just give the users of the module a
</tt><blockquote class="blockquote"><pre style="margin: 0em;">few different NaN numbers to play with.  I can't stand the way I've
named them though!</pre><br>
</blockquote><pre style="margin: 0em;"><br>I would suggest that we don't want to have multiple nans. decide on one 
good bit
pattern that is easy to identify and then use it everywhere.
This will make debugging a lost easier. One suggestion is to have a
memorable hex
pattern e.g. 'deadara' or something similar</pre><br>
<pre style="margin: 0em;">as an aside from my (limited) reading of the ieee spec it seems that
the extra patterns
are just there to give the designers of fpus some flexibility</pre><br>
<pre style="margin: 0em;">now when we come round to unit testing thats a different matter here we want
lots of nans and if the names are ugly who cares as long as they don't change!
</pre><blockquote class="blockquote"><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">3. I was also thinking of having test caseswith minimum and maximum bit
patterns e.g. max denorm min denorm nan with highest mantissa bit set
nan with smallest mantissa bit set etc</pre><br>
<pre style="margin: 0em;"><br>These can still be pre-defined constants within the ieee754 module for
others to use.  We may as well give the users of the module access to
a complete series of ieee754 special numbers, including the limits.
Essentially I have added all of the 64 bit special values discussed in
the current Wikipedia article <a  href="http://en.wikipedia.org/wiki/IEEE-754">http://en.wikipedia.org/wiki/IEEE-754</a>.</pre><br>
</blockquote><tt>see my comments on nans
</tt><blockquote class="blockquote"><pre style="margin: 0em;"><br> ehen
&gt;By passing big-endian 64 bit patterns to the 'bitpatternToFloat()' function,
the following IEEE-754
&gt;constants are defined:
&gt;    PosZero:
0000000000000000000000000000000000000000000000000000000000000000
&gt;    NegZero:
1000000000000000000000000000000000000000000000000000000000000000
&gt;    PosEpsilonDenorm:   ehen
0000000000000000000000000000000000000000000000000000000000000001
&gt;    NegEpsilonDenorm:
1000000000000000000000000000000000000000000000000000000000000001
&gt;    PosEpsilonNorm:
0000000000010000000000000000000000000000000000000000000000000001
&gt;    NegEpsilonNorm:
1000000000010000000000000000000000000000000000000000000000000001
&gt;    PosMax:
01111111111011111111111111111111111111111111111111ehen11111111111111
&gt;    NegMin:
1111111111101111111111111111111111111111111111111111111111111111
&gt;    PosInf:
01111111111100000000000000000000000000000000000000ehen00000000000000
&gt;    NegInf:
1111111111110000000000000000000000000000000000000000000000000000
&gt;    PosNaN_A:
0111111111110000000000000000000000000000001000000000000000000000
&gt;    NegNaN_A:
1111111111110000000000000000000000000000001000000000000000000000
&gt;    PosNaN_B:
0111111111110000000000000000011111111111111111111110000000000000
&gt;    NegNaN_B:
1111111111110000000000000000011111111111111111111110000000000000
&gt;    PosNaN_C:
01111111111101010101010101010101010101010101010101ehen01010101010101
&gt;    NegNaN_C:
1111111111110101010101010101010101010101010101010101010101010101
&gt;    PosNaN = PosNaN_C
&gt;    NegNaN = NegNaN_C
&gt;
&gt;
&gt;
I have some code that reads and displays these as ehenoctes which makes life
easier...</pre><br>
<pre style="margin: 0em;">  11111111 11110101 01010101 01010101 01010101 01010101 01010101 01010101
I don't know if the spaces help much.  As the mantehenissa is from 0-51,
the exponent from 52-62, and the sign bit is at position 63, wouldn't
the best place for spaces be to separate out the components of the
IEEE-754 float, e.g.:</pre><br>
<pre style="margin: 0em;"> 1 1111111111 10101010101010101010101010101010101010101010101010101</pre><br>
<pre style="margin: 0em;"> ieee754 doesn't seem to be an octet based system.</pre><br>
<br>
</blockquote><pre style="margin: 0em;">this is true ieee754 breaks the mantissa and exponent  at a  nibble boundary</pre><br>
<pre style="margin: 0em;">however it is good to have an easily read structure that is less 
monolithic....
and  the underlying structure of
numbers on computers is octet based, most computer programmers think
in octets/bytes at
the basic level  and when you manipulate the contents of nans you will tend to
split in to octets for bit manipulation. so octets seem a good idea...</pre><br>
<pre style="margin: 0em;"><br>one (ugly) suggestion would be</pre><br>
<pre style="margin: 0em;">0bs1 e111111 1111 m1010 10101010 10101010 10101010 10101010 10101010 101010101</pre><br>
<pre style="margin: 0em;">and then strip all leading 0b's all spaces and all letters. the addition of 0b
would allow you to use hex as well if you wanted (i would add that most system
programmers much prefer hex to bit patterns. if you look at many programs they
don't have binary constants but hex constants, and languages such as
python and c
support hex constants but not binary ones [most programmers find them
too wordy]
</pre><blockquote class="blockquote"><pre style="margin: 0em;"><br>&gt;+def bitpatternToFloat(string, endian='big'):
&gt;+    &quot;&quot;&quot;Convert a 64 bit IEEE-754 ascii bit pattern into a 64 bit Python
float.
&gt;+
&gt;+    @param string:  The ascii bit pattern repesenting the IEEE-754 float.
&gt;+    @type string:   str
&gt;+    @param endian:  The endianness of the bit pattern (can be 'big' or
'little').
&gt;+    @type endian:   str
&gt;+    @return:        The 64 bit float corresponding to the IEEE-754 bit
pattern.
&gt;+    @returntype:    float
&gt;+    @raise:         TypeError if 'string' is not a string, the length of
the 'string' is not 64, or
&gt;+        if 'string' does not consist solely of the characters '0' and '1'.
&gt;+    &quot;&quot;&quot;
&gt;+
&gt;+    # Test that the bit pattern is a string.
&gt;+    if type(string) != str:
&gt;+        raise TypeError, &quot;The string argument '%s' is not a string.&quot; %
string
&gt;
&gt;</pre><br>
<pre style="margin: 0em;"> I think this is to restrictive opther things can act as sequences...
Feel free to remove the test.  I can see how it would be restrictive.</pre><br>
<br>
</blockquote><pre style="margin: 0em;">will do</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;"><br>&gt;+    # Test the length of the bit pattern.
&gt;+    if len(string) != 64:
&gt;+        raise TypeError, &quot;The string '%s' is not 64 characters long.&quot; %
string
&gt;+
&gt;+    # Test that the string consists solely of zeros and ones.
&gt;+    for char in string:
&gt;+        if char not in ['0', '1']:
&gt;+            raise TypeError, &quot;The string '%s' should be composed solely of 
the
characters '0' and '1'.&quot; % string
&gt;+
&gt;+    # Reverse the byte order as neccessary.
&gt;+    if endian == 'big' and sys.byteorder == 'little':
&gt;+        string = string[::-1]
&gt;+    elif endian == 'little' and sys.byteorder == 'big':
&gt;+        string = string[::-1]
&gt;+
&gt;
&gt;</pre><br>
<pre style="margin: 0em;"> this could be better written as</pre><br>
<pre style="margin: 0em;"> # Reverse the byte order as neccessary.
if endian != sys.byteorder:
    string = string[::-1]</pre><br>
<pre style="margin: 0em;"><br>Good point.  Again feel free to make the modification.</pre><br>
<br>
</blockquote><pre style="margin: 0em;">will do</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;"><br>and then add an assert effectivley of the form endian..tolower()  in
('little','big')</pre><br>
<br>
</blockquote><pre style="margin: 0em;">I think you need to assert that big and little are passed in endian if this is
a public function. The
general way to think about these things is that you should test all data for
validity at public interfaces. Then if you have internal functions you don't
have to test for validity (as you will slow down to repeated
testing). Its a bit like testing messages at a firewall before they
enter the dmz. However,
it is still a wise decision to check argument validity in all functions in
debugging mode e.g. with assert as this will catch errors early</pre><br>
<pre style="margin: 0em;">as to the to lower it just gives a bit more generality if you don'
have to worry
about case</pre><br>
<pre style="margin: 0em;">also you asked about using &gt; and &lt;.  I personally much prefer big and
little they are much more obvious and intuitive &lt;/&gt; are open to interpretation</pre><br>
<blockquote class="blockquote"><pre style="margin: 0em;">Is this necessary?  If the user supplies dud arguments, I'm not sure
what to do.  There should be Python standards for standard Python
modules somewhere which say how to properly handle incorrect user
input.
</pre></blockquote><tt><br>yep exceptions ;-)
</tt><blockquote class="blockquote"><pre style="margin: 0em;"><br> Edward</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<br>
</blockquote><pre style="margin: 0em;"><br>regards
gary</pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00168" href="msg00168.html">Re: Re(2): r2801 - /branches/test_suite/float.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00167" href="msg00167.html">Re: Re(2): r2801 - /branches/test_suite/float.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Nov 28 04:40:50 2006</div>  
</body>
</html>
