<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r25287 &#45; /trunk/specific_analyses/relax_disp/estimate_r2eff.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 26 Aug 2014 15:00:21 +0200 -->
<!--X-Message-Id: CAED9pY9U2t_8r15z=KrSRVnL2fYeWBTV_3fYc=BDPipBKvGL2w@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XMEqp&#45;0002qF&#45;KZ@subversion.gna.org -->
<!--X-Reference: CAED9pY_ZM9PoOOBT7tm9=kRhrp5A07JZh95&#45;1DE=21CAORAsoA@mail.gmail.com -->
<!--X-Reference: CA+CBx2NPnWD&#45;2f6EyED_P7T3XV602t7x=xHkOuPhSYiCFrVK9Q@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;Q&#45;b_1vAWH78S&#45;nKttNJkFpQL5DG41XWa8&#45;prG&#45;VcU9A@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r25287 - /trunk/specific_analyses/relax_disp/estimate_r2eff.py -- August 26, 2014 - 15:00</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r25287 - /trunk/specific_analyses/relax_disp/estimate_r2eff.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00304" class="tabs">Index by Date</a> | <a href="threads.html#00304" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00303.html">Date Prev</a>] [<a href="msg00305.html">Date Next</a>] [<a href="msg00303.html">Thread Prev</a>] [<a href="msg00305.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 26 Aug 2014 14:59:49 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=MTj/SdSjbiYpxF6E4ze1Ik1V6raJP6Tfn5Dxp/lnzjg=; b=jptGDsUaK2M8ZkgkzXKRdAMT+0/LqPYhxoZP13lmwlOChF/sukJM+ZF4PIN0jjUlWe Mi+0SNWxztu2zOFbmE7MGwIIiMNIxXiLj+QOl93+OBLmVi5SwNr6k0w8ZrSHI5w3OKkH gDcJHC8pD4FMPEUeRgSh6presPjVi0lZwZsTFfIm7wAsAFWpCU8IWF8UvDI5zHQBLRTH 5l13bGDmRnSgrevGTqqhPnmRada/6L1YG6TWEDGSfDRp+hQVQmGA6htO/HzD6Z5f6Qm2 cp08HIdYLZ9p7G+ST8oBHaHf4UPJCRCWR+jeJqMWtDeuDi6mLDG/sBhnwF4PKSGAGUV1 ORfA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY9U2t_8r15z=KrSRVnL2fYeWBTV_3fYc=BDPipBKvGL2w@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XMEqp-0002qF-KZ@subversion.gna.org&gt; &lt;CAED9pY_ZM9PoOOBT7tm9=kRhrp5A07JZh95-1DE=21CAORAsoA@mail.gmail.com&gt; &lt;CA+CBx2NPnWD-2f6EyED_P7T3XV602t7x=xHkOuPhSYiCFrVK9Q@mail.gmail.com&gt; &lt;<a href="msg00303.html">CAED9pY-Q-b_1vAWH78S-nKttNJkFpQL5DG41XWa8-prG-VcU9A@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on August 26, 2014 - 15:00:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">If you have a look at the 'sconstruct' script, specifically in the
relax_fit() method, you will also see that you can set the
PYTHON_INCLUDE_DIR environmental variable to where ever the
corresponding Python.h file is.

Regards,

Edward

On 26 August 2014 14:58, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

The problem is shown in the line:

target_functions/relax_fit.c:21:20: error: Python.h: No such file or 
directory

I.e. the Python headers cannot be found by the compiler.  How do you
compile this?  Do you use 'scons'?  Have you compiled the module
before?  Is the Python.h file in the directory
/sbinlab2/software/python-enthought-dis/canopy-1.4.0-full-rh5-64/Canopy_64bit/User/include/python2.7?

Regards,

Edward


On 26 August 2014 14:57, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; 
wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">I get this when I try to compile:

gcc -o target_functions/c_chi2.os -c
-I/sbinlab2/software/python-
enthought-dis/canopy-1.4.0-full-rh5-64/Canopy_64bit/User/include/python2.7
-fPIC target_functions/c_chi2.c
gcc -o target_functions/exponential.os -c
-I/sbinlab2/software/python-enthought-dis/canopy-1.4.0-full-rh5-64/Canopy_64bit/User/include/python2.7
-fPIC target_functions/exponential.c
gcc -o target_functions/relax_fit.os -c
-I/sbinlab2/software/python-enthought-dis/canopy-1.4.0-full-rh5-64/Canopy_64bit/User/include/python2.7
-fPIC target_functions/relax_fit.c
target_functions/relax_fit.c:21:20: error: Python.h: No such file or 
directory
target_functions/relax_fit.c:31: error: expected '=', ',', ';', 'asm'
or '__attribute__' before '*' token
target_functions/relax_fit.c:80: error: expected '=', ',', ';', 'asm'
or '__attribute__' before '*' token
target_functions/relax_fit.c:118: error: expected '=', ',', ';', 'asm'
or '__attribute__' before '*' token
target_functions/relax_fit.c:168: error: expected '=', ',', ';', 'asm'
or '__attribute__' before '*' token
target_functions/relax_fit.c:179: error: expected '=', ',', ';', 'asm'
or '__attribute__' before '*' token
target_functions/relax_fit.c:196: error: expected '=', ',', ';', 'asm'
or '__attribute__' before '*' token
target_functions/relax_fit.c:244: error: expected '=', ',', ';', 'asm'
or '__attribute__' before 'relax_fit_methods'
target_functions/relax_fit.c: In function 'initrelax_fit':
target_functions/relax_fit.c:305: error: 'relax_fit_methods'
undeclared (first use in this function)
target_functions/relax_fit.c:305: error: (Each undeclared identifier
is reported only once
target_functions/relax_fit.c:305: error: for each function it appears in.)
scons: *** [target_functions/relax_fit.os] Error 1
scons: building terminated because of errors.

2014-08-26 13:30 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">The minfx equivalent algorithms as scipy.optimize.fmin_cg() and
scipy.optimize.fmin_ncg(), as well as the other scipy.optimize
functions are now working with the exponential curve-fitting in relax
as the gradient is now implemented.  None of the Scipy algorithms
require the Hessian.  They really need to implement the Newton
optimisation technique to be taken seriously.  This is quite different
to NCG:

<a  rel="nofollow" href="http://home.gna.org/minfx/minfx.ncg-module.html">http://home.gna.org/minfx/minfx.ncg-module.html</a>
<a  rel="nofollow" href="http://home.gna.org/minfx/minfx.newton-module.html">http://home.gna.org/minfx/minfx.newton-module.html</a>

Regards,

Edward


On 26 August 2014 13:23,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Tue Aug 26 13:23:47 2014
New Revision: 25287

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=25287&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=25287&amp;view=rev</a>
Log:
Removed all code regarding scipy.optimize fmin_cg and fmin_ncg.

This problem should soon be able to be solved with minfx.

task #7822(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/index.php?7822">https://gna.org/task/index.php?7822</a>): Implement user function 
to estimate R2eff and associated errors for exponential curve fitting.

Modified:
    trunk/specific_analyses/relax_disp/estimate_r2eff.py

Modified: trunk/specific_analyses/relax_disp/estimate_r2eff.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/estimate_r2eff.py?rev=25287&amp;r1=25286&amp;r2=25287&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/estimate_r2eff.py?rev=25287&amp;r1=25286&amp;r2=25287&amp;view=diff</a>
==============================================================================
--- trunk/specific_analyses/relax_disp/estimate_r2eff.py        
(original)
+++ trunk/specific_analyses/relax_disp/estimate_r2eff.py        Tue Aug 
26 13:23:47 2014
@@ -45,7 +45,7 @@
 # Scipy installed.
 if scipy_module:
     # Import leastsq.
-    from scipy.optimize import fmin_cg, fmin_ncg, leastsq
+    from scipy.optimize import leastsq


 class Exp:
@@ -424,7 +424,6 @@

 # 'minfx'
 # 'scipy.optimize.leastsq'
-# 'scipy.optimize.fmin_cg'
 def estimate_r2eff(spin_id=None, ftol=1e-15, xtol=1e-15, 
maxfev=10000000, factor=100.0, method='minfx', verbosity=1):
     &quot;&quot;&quot;Estimate r2eff and errors by exponential curve fitting with 
scipy.optimize.leastsq.

@@ -540,10 +539,6 @@
                 # Acquire results.
                 results = minimise_leastsq(E=E)

-            elif method == 'scipy.optimize.fmin_cg':
-                # Acquire results.
-                results = minimise_fmin_cg(E=E)
-
             elif method == 'minfx':
                 # Acquire results.
                 results = minimise_minfx(E=E)
@@ -715,46 +710,6 @@
     return results


-def minimise_fmin_cg(E=None):
-    &quot;&quot;&quot;Estimate r2eff and errors by exponential curve fitting with 
scipy.optimize.fmin_cg.
-
-    Unconstrained minimization of a function using the Newton-CG method.
-
-    @keyword E:     The Exponential function class, which contain data 
and functions.
-    @type E:        class
-    @return:        Packed list with optimised parameter, estimated 
parameter error, chi2, iter_count, f_count, g_count, h_count, warning
-    @rtype:         list
-    &quot;&quot;&quot;
-
-    # Check that scipy.optimize.leastsq is available.
-    if not scipy_module:
-        raise RelaxError(&quot;scipy module is not available.&quot;)
-
-    # Initial guess for minimisation. Solved by linear least squares.
-    x0 = E.estimate_x0_exp()
-
-    # Define function to minimise. Use errors as weights in the 
minimisation.
-    use_weights = True
-
-    if use_weights:
-        func = E.func_exp_weighted_general
-        dfunc = E.func_exp_weighted_grad
-        d2func = E.func_exp_weighted_hess
-
-    # There are no args to the function, since values and times are 
stored in the class.
-    args=()
-
-    gfk = dfunc(x0)
-    deltak = numpy.dot(gfk, gfk)
-
-    # Cannot get this to work.
-
-    #xopt, fopt, fcalls, gcalls, hcalls, warnflag = fmin_ncg(f=func, 
x0=x0, fprime=dfunc, fhess=None, args=args, avextol=1e-05, 
epsilon=1.4901161193847656e-08, maxiter=maxfev, full_output=1, disp=1, 
retall=0, callback=None)
-    #test = fmin_ncg(f=func, x0=x0, fprime=dfunc, fhess=d2func, 
args=args, avextol=1e-05, epsilon=1.4901161193847656e-08, maxiter=maxfev)
-    #fmin_cg(f, x0, fprime=None, args=(), gtol=1e-5, norm=Inf, 
epsilon=_epsilon, maxiter=None, full_output=0, disp=1, retall=0, 
callback=None):
-    #fmin_cg(f=func, x0=x0, fprime=dfunc, args=args, gtol=1e-5)
-
-
 def minimise_minfx(E=None):
     &quot;&quot;&quot;Estimate r2eff and errors by minimising with minfx.



_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="/">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="/mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00305" href="msg00305.html">Re: r25287 - /trunk/specific_analyses/relax_disp/estimate_r2eff.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00299" href="msg00299.html">Re: r25287 - /trunk/specific_analyses/relax_disp/estimate_r2eff.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00302" href="msg00302.html">Re: r25287 - /trunk/specific_analyses/relax_disp/estimate_r2eff.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00303" href="msg00303.html">Re: r25287 - /trunk/specific_analyses/relax_disp/estimate_r2eff.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Aug 26 15:20:23 2014</div>  
</body>
</html>
