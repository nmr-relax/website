<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r25491 &#45; /trunk/specific_analyses/relax_disp/data.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 01 Sep 2014 10:21:15 +0200 -->
<!--X-Message-Id: CA+CBx2PSiaureGzky19iDjU3Lhi7QhdpnuMgeKK&#45;vxf__JfmBQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1XOCxK&#45;0005G6&#45;QP@subversion.gna.org -->
<!--X-Reference: CAED9pY9tUVfXCr4aSQ85JeCSKeDr_FVUNUfCPULcd3VmPZ1RnA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r25491 - /trunk/specific_analyses/relax_disp/data.py -- September 01, 2014 - 10:21</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r25491 - /trunk/specific_analyses/relax_disp/data.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00003" class="tabs">Index by Date</a> | <a href="threads.html#00003" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00002.html">Date Prev</a>] [<a href="msg00004.html">Date Next</a>] [<a href="msg00002.html">Thread Prev</a>] [<a href="msg00004.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 1 Sep 2014 10:20:24 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type; bh=ZLQnrBfOAZnX9qRwZPe9TI7eXpVMJwEVN3DZshbSLOs=; b=gbvokZ4inkJaIi1GMFD1Xg94JjIgwmxp11WW92kX++5NHcNAE4X/rL5U1edL10B0Lo HKPxaDY4oYKbwz8t677EO+IEIV4A5q1lh112gh2AxScn1onxn8j2ZGDB63h0TgA/oRHh IPQMaU51A9S9y+1FV1pwFwDTETO6mnAYCXkoQm2RsR2O5ECp9MAIi55CBNCrakurzlZn AxiqAVBm5N3o3lfqRydNNK8rulnIcAos8Xo2Ar+UkOvlLKjX99Y6hfD4otfU9PZQpnGm 0+5e+R39r2K0Xa6K2WMAJACZdNvraqn5B4QP6koZuVB0L+/t3rowgk5M5343g5yfi5Xg bB5g==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00003.html">CA+CBx2PSiaureGzky19iDjU3Lhi7QhdpnuMgeKK-vxf__JfmBQ@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1XOCxK-0005G6-QP@subversion.gna.org&gt; &lt;<a href="msg00002.html">CAED9pY9tUVfXCr4aSQ85JeCSKeDr_FVUNUfCPULcd3VmPZ1RnA@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on September 01, 2014 - 10:21:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Yes.

That was a seriously hard bug to find.

Especially when you consider the MC simulations as the &quot;Golden Standard&quot;.
And then the  &quot;Golden Standard&quot; is wrong...

Ouch.

Should we set the GUI to have exp_sim = -1?
There is no assumption, that 100000 simulations of exponential fits
are better than the co-variance.

Btw.

Can we check Monte-Carlo simulations for the dispersion models?

Where is that performed?

Do you randomize only R1rho' or do you also include randomize for R1?

Best
Troels

2014-09-01 10:06 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

Awesome catch!  This is quite a significant bug!  It was introduced in
October of last year while trying to fix another bug (r21022 in the
relax_disp branch,
<a  rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/18778">http://article.gmane.org/gmane.science.nmr.relax.scm/18778</a>).
Unfortunately our test suite coverage was not comprehensive enough so
the bugfix of r21022 silently introduced this bug.

This bug is specific to relaxation dispersion analyses.  And it only
affects those who have measured full exponential curves, which would
be a lot less than half of all analyses.  It is nevertheless a huge
bug!

Cheers,

Edward



On 31 August 2014 23:46,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Sun Aug 31 23:46:38 2014
New Revision: 25491

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=25491&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=25491&amp;view=rev</a>
Log:
Correction for catastrophic implementation of Monte-Carlo simulations.

And wrong implemetented &quot;else if&quot; statement, would add the intensity for 
the simulated intensity together with
the original intensity.

This means that all intensity values send to minimisation would be twice 
as high than usually.
(If spectra was not replicated.)

This was discovered for Monte-Carlo simulations of R2eff errors in 
exponential fit.

The function is restricted to the analysis of errors for exponential fit 
in Relax Dispersion.
Such data are normally restricted to R1rho analysis.

This will affect all analysis of R1rho data performed until now.
By pure luck, it seems that the effect of this would be that R2eff errors 
are half the value they should be.
A further investigation shows, that for the selected data set, this had a 
minimum on influence on the fitted parameters,
because the chi2 value would be scaled up by a factor 4.

bug #22554(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/bugs/index.php?22554">https://gna.org/bugs/index.php?22554</a>): The distribution of 
intensity with errors in Monte-Carlo simulations are markedly more narrow 
than expected.
task #7822(<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/index.php?7822">https://gna.org/task/index.php?7822</a>): Implement user function 
to estimate R2eff and associated errors for exponential curve fitting.

Modified:
    trunk/specific_analyses/relax_disp/data.py

Modified: trunk/specific_analyses/relax_disp/data.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/data.py?rev=25491&amp;r1=25490&amp;r2=25491&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/data.py?rev=25491&amp;r1=25490&amp;r2=25491&amp;view=diff</a>
==============================================================================
--- trunk/specific_analyses/relax_disp/data.py  (original)
+++ trunk/specific_analyses/relax_disp/data.py  Sun Aug 31 23:46:38 2014
@@ -147,7 +147,7 @@
             intensity += spin.peak_intensity_sim[int_keys[i]][sim_index]

         # Error intensity data.
-        if error:
+        elif error:
             # Error checking.
             if not hasattr(spin, 'peak_intensity_err') or not int_keys[i] 
in spin.peak_intensity_err:
                 raise RelaxError(&quot;The peak intensity errors are missing 
the key '%s'.&quot; % int_keys[i])


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00006" href="msg00006.html">Re: r25491 - /trunk/specific_analyses/relax_disp/data.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00005" href="msg00005.html">Re: r25491 - /trunk/specific_analyses/relax_disp/data.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00004" href="msg00004.html">Re: r25491 - /trunk/specific_analyses/relax_disp/data.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00002" href="msg00002.html">Re: r25491 - /trunk/specific_analyses/relax_disp/data.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Sep 01 11:00:09 2014</div>  
</body>
</html>
