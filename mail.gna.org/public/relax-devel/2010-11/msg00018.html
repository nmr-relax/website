<!-- MHonArc v2.6.16 -->
<!--X-Subject: RE: Re: -->
<!--X-From-R13: @rvqvt Yynhf&#45;Brgre <Yynhf&#45;Brgre.@rvqvtNoehxre&#45;ovbfcva.qr> -->
<!--X-Date: Wed, 24 Nov 2010 18:43:05 +0100 -->
<!--X-Message-Id: C499CEAA2FE47E4F8E5C154780A4767301269353B2@exch8.ads.bruker.de -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: C499CEAA2FE47E4F8E5C154780A4767301269353A4@exch8.ads.bruker.de -->
<!--X-Reference: AANLkTi=j05Y_&#45;YWGrqhX_+qVmjtaP6tf_2+FKCN2hkwU@mail.gmail.com -->
<!--X-Reference: 4CE64610.7090706@bruker&#45;biospin.de -->
<!--X-Reference: AANLkTi=JRRcPNOf5B13=OCFT9GjnzNT_ejc8dYrbq5V4@mail.gmail.com -->
<!--X-Reference: 4CECDB61.4020801@bruker&#45;biospin.de -->
<!--X-Reference: AANLkTi=BTyS1W9kY5U63QyE=pemVNz6&#45;kg_=sWpfLqrX@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>RE: Re: -- November 24, 2010 - 18:43</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />RE: Re:</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00018" class="tabs">Index by Date</a> | <a href="threads.html#00018" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00017.html">Date Prev</a>] [<a href="msg00019.html">Date Next</a>] [<a href="msg00014.html">Thread Prev</a>] [<a href="msg00021.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 24 Nov 2010 18:42:49 +0100</li>
<li class="menuitem">
<em>Accept-language</em>: en-US, de-DE</li>
<li class="menuitem">
<em>Acceptlanguage</em>: en-US, de-DE</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00018.html">C499CEAA2FE47E4F8E5C154780A4767301269353B2@exch8.ads.bruker.de</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;C499CEAA2FE47E4F8E5C154780A4767301269353A4@xxxxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTi=j05Y_-YWGrqhX_+qVmjtaP6tf_2+FKCN2hkwU@xxxxxxxxxxxxxx&gt;	&lt;4CE64610.7090706@xxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTi=JRRcPNOf5B13=OCFT9GjnzNT_ejc8dYrbq5V4@xxxxxxxxxxxxxx&gt;	&lt;4CECDB61.4020801@xxxxxxxxxxxxxxxxx&gt;,	&lt;AANLkTi=BTyS1W9kY5U63QyE=pemVNz6-kg_=sWpfLqrX@xxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Thread-index</em>: AcuL4XimPMTX5GxjTcGk6pMLH4VPGwAGxwRK</li>
<li class="menuitem">
<em>Thread-topic</em>: Re:</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Neidig Klaus-Peter</strong> on November 24, 2010 - 18:43:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

I think there will be no major problems. The PDC output should contain just 
everything needed, I'm already
programming on it.Export (txt or xls) would then be identical to Report (pdf) 
(apart from plots). In the past
a few things have just been forgotten in the export.

Concerning the errors I would have to add a new section that contains the 
full table of errors in 1-to-1 relation
to the table of intensities/integrals. I think this would be most easy to 
read and interpret.

I will meet Wolfgang tomorrow and discuss the pulse program/spectral noise 
issue.

Best regards,
Peter
________________________________________
From: edward.dauvergne@xxxxxxxxx [edward.dauvergne@xxxxxxxxx] On Behalf Of 
Edward d'Auvergne [edward@xxxxxxxxxxxxx]
Sent: Wednesday, November 24, 2010 3:11 PM
To: Neidig Klaus-Peter
Cc: Neidig Klaus-Peter; relax-devel@xxxxxxx
Subject: Re:

On 24 November 2010 10:31, Dr. Klaus-Peter Neidig
&lt;peter.neidig@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Dear Edward,


I talked to some collegues at Bruker to discuss your various items.
In general there is agreement that being as much consistent with
relax as possible is a good idea. However other software at Bruker
does not have to be affected (some of the code is used in multiple
areas) and changes that cause too much effort and are already documented
and in use should be avoided. Enhancing the export functionality
to provide more infos to relax is regarded a good way to go.
</pre></blockquote><pre style="margin: 0em;">

Hi,

Yes, it would be a bad idea to make big changes.  Interfacing with
relax will be quite straightforward and probably no changes will be
required from Bruker's side.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">In detail:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Do the users define the signal-free region?  For example there is
usually more noise in the random coil part of the spectrum due to
unwanted junk in the sample, so the peaks in this region have larger
errors.  What about signals close to the water signal?  Is if possible
to have different errors for these peaks?
</pre></blockquote><pre style="margin: 0em;">

No, the PDC does currently not allow to assign different errors to
different peaks. We take several regions in the spectrum automatically,
e.g. close to the 4 corners and finally regard the one with the lowest 
noise.
We have to rely on some assumptions like proper base line correction,
reasonably clean sample, careful post processing, if any.
</pre></blockquote><pre style="margin: 0em;">

Ah, ok.  We will have to make sure users manually exclude spins with
signals near the water region.  Again this is an easy thing to solve.


</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">I don't understand the origin of this scaling.  Since Art Palmer's
seminal 1991 publication (<a  rel="nofollow" href="http://dx.doi.org/10.1021/ja00012a001">http://dx.doi.org/10.1021/ja00012a001</a>), the
RMSD of the pure base-plane noise has been used for the standard
deviation.  The key text is on page 4375:
</pre></blockquote><pre style="margin: 0em;">

Thanks for the various references. The factor we used so far is empirical
but no problem, I will remove it. Other software pieces at Bruker
that use such factors are not affected. I did run some tests already,
the fitted parameters do not really change but of course the errors of the
fitted parameters do. This needs to be documented to the user.
</pre></blockquote><pre style="margin: 0em;">

Thank you.  In a model-free analysis the accuracy of the errors is
just as important, or maybe even more important, than the data itself
so this will make a big difference.


</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">From my work a long time ago, I noticed that the spectral errors
decreased with an increasing relaxation period.  This can be taken
into account in relax if all spectra are duplicated/triplicated/etc.
But if not, then the errors for all spectra are averaged (using
variance averaging, not standard deviation averaging).  For a single
duplicated/triplicated spectrum, the error is taken as the average
variance of each peak.  So when some, but not all, spectra are
replicated, there will be one error for all spin system at all
relaxation periods.  This sounds similar to what the PDC does, but is
it exactly the same?
</pre></blockquote><pre style="margin: 0em;">

I think the Bruker internal opinion was different in a sense that one should
either have enough replicates (which never happens) and do sdev averaging or
just provide an estimate of the systematic error. The change in intensity 
obviously
depends on the peaks. We have seen peaks with longer T2 varying much
more than those with shorter T2.  We concluded to to assume a worst case 
error
scenario and check for the largest difference of all peak intensities at
replicated mixing times. This error was then applied (added) to all peaks at
all mixing times. I should also mention that in the PDC the user has the 
option
to replace peak intensities/integrals of replicated mixing times by their 
mean
and each mixing time occurs only once in the fit. This yields slightly 
different
results. The request for implementing this came from our application people
who obviously talked to their customers.
</pre></blockquote><pre style="margin: 0em;">

Having enough replicates would never be possible for properly
determining errors, so it must be crudely estimated.  The maximum
error would mean that the errors would probably never be
underestimated.  But for downstream analysis, underestimating some
errors (and overestimating others) would be better as no bias would be
introduced into the errors.  Using the maximum error applied to all
peaks will actually result in molecules appearing more rigid than they
are!  The result will be the hiding of many motional processes.  So
the second option would be better.  Even better would be to use an
average error rather than the maximum by averaging variances (sdev
values cannot be averaged as they cannot be summed, but variances
sum).  Is the peak intensity error located in the PDC files, I cannot
see it in our current testing files
<a  rel="nofollow" href="https://gna.org/file/testT2.txt?file_id=10641">https://gna.org/file/testT2.txt?file_id=10641</a>?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Since changing the error estimation of replicates could influence the 
results
significantly, we do not want to blindly do it. The proposal would be to 
offer
several options (variance averaging, sdev averaging, worst case estimate)
</pre></blockquote><pre style="margin: 0em;">

The sdev averaging here should be avoided as it statistically should
not be done.  For example from Wikipedia:

&quot;The standard deviation of the sum of two random variables can be
related to their individual standard deviations and the covariance
between them:

    stdev(X + Y) = sqrt{var(X) + var(Y) + 2 * cov(X,Y)}.

where var = stdev^2 and cov stand for variance and covariance, respectively.&quot;

The average would then be sqrt(2)*stdev(X+Y), and the covariance is
zero.  Another example are the messages in the thread
<a  rel="nofollow" href="http://mathforum.org/kb/message.jspa?messageID=1602446&amp;tstart=0">http://mathforum.org/kb/message.jspa?messageID=1602446&amp;tstart=0</a>.

Having a number of options (variance averaging, worst case estimate,
etc.) would be great to have.  Could the user's choice be recorded in
the PDC file?  I would like relax to give the user a detailed warning
about hiding dynamics if they choose the worst case estimate.  The
worst case estimate would nevertheless be quite useful so I would not
suggest removing it.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">but advise to use variance averaging in the documentation.
Your remark about decreasing spectral errors with increasing mixing times
is correct, I see this in all the data I have. The peak 
intensities/integrals
decrease however much more, the relative error of each thus increases.
</pre></blockquote><pre style="margin: 0em;">

This is a bit off topic, but would you know if this has something to
do with the total power of the spectrum?  Maybe Wolfgang Bermel's new
pulse sequences with both the temperature compensation block and
single-scan interleaving will eliminate this strange effect.


</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">Does peak intensity mean peak height?  In relax, the term peak
intensity is inclusive of both volume, height, or any other measure of
the peak.  For relaxation data with proper temperature calibration and
proper temperature compensation, this is now often considered the best
method.  Peter Wright published a while back that volumes are more
accurate, but with the temperature consistency improvements the
problems Peter encountered are all solved and hence heights are better
as overlap problems and other spectral issues are avoided.  Is there a
way of automatically determining the method used in the PDC file,
because in the end the user will have to specify this for BMRB data
deposition?  This is not so important though, the user can manually
specify this if needed.
</pre></blockquote><pre style="margin: 0em;">

yes, intensity === height. The integration method used is part of the pdf 
report,
I just see that it is however not included in the export (text, or xls). I 
will change
that of course. The problem with peak heights is if peaks overlap, say one 
peak is
hidden in the shoulder of another. Such peaks usually have to be picked by 
hand
then peak deconvolution would be preferable. We keep on offering our options
but advise in the hand book that peak intensities would be preferred.
</pre></blockquote><pre style="margin: 0em;">

We could have relax read the integration method so that this is
automatically placed in the BMRB deposition file for the user.
Actually, maybe it would be an idea to have relax store the entire PDC
file and have this deposited within one of the BMRB method saveframes?

relax allows the user to do whatever they wish (the GUI interface does
not though), but if there is significant overlap, that data should not
be used.  This is all up to the user though.


</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">The covariance analysis is known to be lowest quality of all the error
estimates.  For an exponential fit, I have not checked how
non-quadratic the minimum is, so I don't know the performance of the
method.  Do the errors from that compare to the area integral together
with base-plane RMSD?
</pre></blockquote><pre style="margin: 0em;">

</pre><blockquote class="blockquote"><pre style="margin: 0em;">I can't remember exactly, but I think Art Palmer published something
different to this and that is why his curvefit program uses MC as well
as Jackknife simulation.  Anyway, if the minimum has a perfectly
quadratic curvature, then the covariance matrix analysis and MC will
give identical results - the methods converge.  But as the minimum
deviates from quadratic, the performance of the covariance matrix
method drops off quickly.  MC simulations are the gold standard for
error propagation, when the direct error equation is too complex to
derive.  But again I don't know how non-quadratic the minimum is in
the exponential optimisation space, so I don't know how well the
covariance matrix performs.  The difference in techniques might be
seen for very weak exchanging peaks with large errors.  Or special
cases such as when the spectra are not properly processed and there
are truncation artifacts.
</pre></blockquote><pre style="margin: 0em;">

With my data the errors obtained from LM (taking errorY incto account) and 
MC
are pretty close. If a typical T1 is 0.473 the errors are 0.0026 and 0.0025.
The base plane rms decreases with mixing time the relative errors with the
given examples are 0.000386, ...0.00651, ...0.003124.
</pre></blockquote><pre style="margin: 0em;">

I haven't tested this personally, and just followed Art Palmer and
other's lead when I implemented this fitting and used the gold
standard Monte Carlo simulations.  It could be that the covariance
matrix technique performs just as well as MC simulations for all
exponential curve-fitting - the equations are not particularly
complex.  Maybe the user choice of covariance matrix estimate or Monte
Carlo simulations could be recorded in the PDC file so that this
information is also deposited in the BMRB?  I would have to talk to
Eldon Ulrich at the BMRB about adding some new tags for that.


</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">What is this factor and why is it used?  The MC simulation errors
should be exact, assuming the input peak intensity errors are exact
estimates.  MC simulations propagate the errors through the non-linear
space, and hence these errors are perfectly exact.  Is there a
reference for this post-MC sim scaling?  Is it optional?  For relax,
it would be good to know both this scaling factor and that mentioned
above for the peak intensity error scaling, so that both can be
removed prior to analysis.  These will impact model-free analysis in a
very negative way.
</pre></blockquote><pre style="margin: 0em;">

In many applications people do not just want a single error but an error 
range
they can rely on with a certain confidence. Also they would like to
account for that different numbers of peaks may be used for different fits
(sometimes not all peaks are picked in all planes or the user removes points
from the fitted curve interactively). This is why implemented the same as
Matlab typically does. I would put an extra column to the output and list
the factor (typically ~ 2) for each fit. This way you can just recalculate
the original errors.
</pre></blockquote><pre style="margin: 0em;">

This would be perfect!  Cheers.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">Certainly, model-free analysis will be influenced, whether in a negative way
or not I don't know. What I have seen so far (limited experience however) is
that if errors are too tight, the modelling calculates for ever and often
finds solutions with such large errors that practically unusable. I must
admit however that the PDC does currently not allow to use multiple fields.
</pre></blockquote><pre style="margin: 0em;">

In model-free analysis, underestimating errors has the strange effect
of introducing artificial motions!  Overestimating causes real motions
to disappear.  Error estimates are incredibly important.


</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">Ah, historic reasons.  We will be able to handle both in relax.  But
if the PDC presents T1 and T2 plots, and these values are in the PDC
output file, the user is highly likely to then use this in
publications.  Some people prefer T1 and T2 plots, but these are an
exception in publications.  This will likely lead to a convention
change in the literature (for only Bruker users) which will make it
harder to compare systems.  It would be good to consider this effect.
</pre></blockquote><pre style="margin: 0em;">

The Bruker people seem to regard this as a minor issue for various reasons.
One is that plots for publications will probably be made with more advanced
tools like Excel and it is no effort to switch between T and R. Another
argument is that people who really want to compare details need to compare
numbers anyway. I will check if there is a simple way to allow the user
to switch between the presentations but currently we would keep the T
displays and outputs.
</pre></blockquote><pre style="margin: 0em;">

Ok, that makes sense.  relax uses xmgrace to display the relaxation
rates (never the rotational relaxation times though).  With BMRB data
deposition very close to being complete within relax, maybe more data
will be placed in the database and not just shown as a low resolution
T1 or T2 plot.  In many currently published papers, unfortunately
comparing low resolution graphs is the only way.  This is the purpose
of the relax-BMRB collaboration.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">This all gives me some work to do and of course some testing. I hope to
do everything this week and then send new export files to you for 
inspection.
If accepted I will proceed to version PDC 1.1.3.
</pre></blockquote><pre style="margin: 0em;">

Cheers.  Michael Bieri has created a relax branch for implementing the
reading of the file.  Having newer files attached to
<a  rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/?7180">https://gna.org/task/?7180</a> will help in our implementation.

Thank you,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00003" href="msg00003.html">[no subject]</a></strong>
<ul><li><em>From:</em> Neidig Klaus-Peter</li></ul></li>
<li><strong><a name="00004" href="msg00004.html">Re:</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00005" href="msg00005.html">Re:</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
<li><strong><a name="00007" href="msg00007.html">Re:</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re:</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
<li><strong><a name="00014" href="msg00014.html">Re:</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Nov 29 13:40:27 2010</div>  
</body>
</html>
