<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: r3200 &#45; in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 16 Mar 2007 08:08:02 +0100 -->
<!--X-Message-Id: 7f080ed10703160007n59fc0579yf0a7fec0c96d3df6@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1HRtHU&#45;0003nl&#45;Qu@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r3200 - in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py -- March 16, 2007 - 08:08</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r3200 - in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00074" class="tabs">Index by Date</a> | <a href="threads.html#00074" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00073.html">Date Prev</a>] [<a href="msg00075.html">Date Next</a>] [<a href="msg00061.html">Thread Prev</a>] [<a href="msg00076.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;c.a.macraild@xxxxxxxxxxx&quot; &lt;c.a.macraild@xxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 16 Mar 2007 18:07:11 +1100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: a=rsa-sha1; c=relaxed/relaxed; d=gmail.com; s=beta;	h=domainkey-signature:received:received:message-id:date:from:sender:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references:x-google-sender-auth;	b=OVF80Xuu4KY1D7DXF9DKy5h5hd/i1xU98pM2xnET5USaNtg+MqVKrlU2NKSbBy3MseIRIjHX7e0xfS4psW0ze/181aN9dvOAXNQKHbbdfPZt6+Sg7olhItPcfEnL/g53+nlBd2rdw2mYMtjf92ICXl6DcwVPXXvxnHdevT1eKMM=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00074.html">7f080ed10703160007n59fc0579yf0a7fec0c96d3df6@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1HRtHU-0003nl-Qu@subversion.gna.org&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on March 16, 2007 - 08:08:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Chris,</pre><br>
<pre style="margin: 0em;">I've cleaned up the unit tests so that you should be able to check
that these changes are working properly.  Would you be able to fix the
relax module import statements for the alternative relax data storage
object?  This commit has put relax into a very bad shape (not that
much was functioning anyway, but now nothing is).  I'm also not sure
why but the data storage singleton instance method 'add()' (to add a
new data pipe) is not working as it should.</pre><br>
<pre style="margin: 0em;">Cheers,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<tt><br>On 3/16/07, c.a.macraild@xxxxxxxxxxx &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">Author: macraild
Date: Thu Mar 15 17:58:23 2007
New Revision: 3200</pre><br>
<pre style="margin: 0em;">URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=3200&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=3200&amp;view=rev</a>
Log:
Alternative implimentation of the data object as a singleton.</pre><br>
<pre style="margin: 0em;">As proposed here:
<a  href="https://mail.gna.org/public/relax-devel/2007-03/msg00013.html">https://mail.gna.org/public/relax-devel/2007-03/msg00013.html</a></pre><br>
<pre style="margin: 0em;">and agreed here:
<a  href="https://mail.gna.org/public/relax-devel/2007-03/msg00058.html#">https://mail.gna.org/public/relax-devel/2007-03/msg00058.html#</a></pre><br>
<pre style="margin: 0em;"><br>Modified:
    1.3/data/__init__.py
    1.3/test_suite/unit_tests/data/test___init__.py</pre><br>
<pre style="margin: 0em;">Modified: 1.3/data/__init__.py
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.3/data/__init__.py?rev=3200&amp;r1=3199&amp;r2=3200&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/data/__init__.py?rev=3200&amp;r1=3199&amp;r2=3200&amp;view=diff</a>
==============================================================================
--- 1.3/data/__init__.py (original)
+++ 1.3/data/__init__.py Thu Mar 15 17:58:23 2007
@@ -37,28 +37,8 @@
 class Data(dict):
     &quot;&quot;&quot;The relax data storage object.&quot;&quot;&quot;</pre><br>
<pre style="margin: 0em;">-    # Singleton initialisation, the reference to the single instance of this 
class.
-    __instance = None
-
     # The current data pipe.
     current_pipe = None
-
-
-    def __new__(self, *args, **kargs):
-        &quot;&quot;&quot;Method for implementing the singleton design pattern.
-
-        If no other class instance currently exists, create a new instance 
of this class.  Otherwise
-        return the class instance.  See 
<a  href="http://en.wikipedia.org/wiki/Singleton_pattern">http://en.wikipedia.org/wiki/Singleton_pattern</a> for a
-        description of this design pattern.
-        &quot;&quot;&quot;
-
-        # Create a new instance if none exists.
-        if self.__instance is None:
-            self.__instance = dict.__new__(self, *args, **kargs)
-
-        # Return the class instance.
-        return self.__instance
-</pre><br>
<pre style="margin: 0em;">     def __repr__(self):
         &quot;&quot;&quot;The string representation of the object.
@@ -145,3 +125,6 @@
         # Change the current data pipe.
         self.current_pipe = pipe_name</pre><br>
<pre style="margin: 0em;">+# Rebind the name Data with an instance to prevent accidental creation
+# of multiple instances of the Data class
+Data = Data()</pre><br>
<pre style="margin: 0em;">Modified: 1.3/test_suite/unit_tests/data/test___init__.py
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.3/test_suite/unit_tests/data/test___init__.py?rev=3200&amp;r1=3199&amp;r2=3200&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/test_suite/unit_tests/data/test___init__.py?rev=3200&amp;r1=3199&amp;r2=3200&amp;view=diff</a>
==============================================================================
--- 1.3/test_suite/unit_tests/data/test___init__.py (original)
+++ 1.3/test_suite/unit_tests/data/test___init__.py Thu Mar 15 17:58:23 2007
@@ -27,9 +27,12 @@
 from data import Data</pre><br>
<pre style="margin: 0em;"><br>-class NewStore(Data):
-    &quot;&quot;&quot;Subclass the relax data storage object for the isolation and creation of a new 
singleton.&quot;&quot;&quot;
-
+class NewStore(dict):
+    &quot;&quot;&quot;Dict subclass to act as proxy for the Singleton Data object.&quot;&quot;&quot;
+    def __getattr__(self, attr):
+        &quot;&quot;&quot;Delegate to the Data class to get methods for testing&quot;&quot;&quot;
+        return getattr(Data.__class__, attr)
+</pre><br>
<pre style="margin: 0em;"> class Empty_container:
     &quot;&quot;&quot;An empty data container.&quot;&quot;&quot;
@@ -53,15 +56,11 @@
         # Add an object to the data store object.
         self.data_store.test = 1</pre><br>
<pre style="margin: 0em;">-        # Create a new reference.
-        self.new_ref = NewStore()
-</pre><br>
<pre style="margin: 0em;">     def tearDown(self):
         &quot;&quot;&quot;Destroy the subclassed data store.&quot;&quot;&quot;</pre><br>
<pre style="margin: 0em;">         # Delete all references (which should decrement the singleton's ref 
counter to 0, hence destroying it).
-        del self.new_ref
         del self.data_store</pre><br>
<pre style="margin: 0em;"><br>@@ -104,18 +103,3 @@
         self.assert_(hasattr(self.data_store, 'current_pipe'))</pre><br>
<pre style="margin: 0em;"><br>-    def test_singleton(self):
-        &quot;&quot;&quot;Test that the relax data storage object is functioning as a 
singleton.&quot;&quot;&quot;
-
-        # Test that the new reference to NewStore is the singleton instance 
reference.
-        self.assertEqual(self.data_store, self.new_ref)
-
-        # Delete all references (which should decrement the singleton's ref 
counter to 0, hence destroying it).
-        del self.new_ref
-        del self.data_store
-
-        # Create a new singleton.
-        new = NewStore()
-
-        # Test that the object 'test' from the original singleton does not 
exist.
-        self.assert_(not hasattr(new, 'test'))</pre><br>
<pre style="margin: 0em;"><br>_______________________________________________
relax (<a  href="http://nmr-relax.com">http://nmr-relax.com</a>)</pre><br>
<pre style="margin: 0em;">This is the relax-commits mailing list
relax-commits@xxxxxxx</pre><br>
<pre style="margin: 0em;">To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a></pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00076" href="msg00076.html">Re: r3200 - in /1.3: data/__init__.py	test_suite/unit_tests/data/test___init__.py</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Mar 19 09:20:34 2007</div>  
</body>
</html>
