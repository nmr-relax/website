<!-- MHonArc v2.6.16 -->
<!--X-Subject: Fwd: Re: The multi&#45;processor package and GUI threading, queuing,	and locking. -->
<!--X-From-R13: tnel gubzcfba <tnelgNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 19 Sep 2011 17:34:38 +0200 -->
<!--X-Message-Id: 4E7760EB.1040907@nmr&#45;relax.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 4E773E83.8080000@bmb.leeds.ac.uk -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Fwd: Re: The multi-processor package and GUI threading, queuing,	and locking. -- September 19, 2011 - 17:34</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Fwd: Re: The multi-processor package and GUI threading, queuing,	and locking.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00007" class="tabs">Index by Date</a> | <a href="threads.html#00007" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00006.html">Date Prev</a>] [<a href="msg00008.html">Date Next</a>] [<a href="msg00006.html">Thread Prev</a>] [<a href="msg00010.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 19 Sep 2011 16:34:03 +0100</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00007.html">4E7760EB.1040907@nmr-relax.com</a>&gt;</li>
<li class="menuitem">
<em>Organization</em>: nmr relax</li>
<li class="menuitem">
<em>References</em>: &lt;4E773E83.8080000@xxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Mozilla/5.0 (X11; Linux i686 on x86_64;	rv:6.0.2) Gecko/20110902 Thunderbird/6.0.2</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>gary thompson</strong> on September 19, 2011 - 17:34:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#FFFFFF" style="background-color: #FFFFFF; color: #000000; "><font color="#000000">
  
  
    <br>
    <br>
    -------- Original Message --------
    <table class="moz-email-headers-table" border="0" cellpadding="0"
      cellspacing="0">
      <tbody>
        <tr>
          <th align="RIGHT" nowrap="nowrap" valign="BASELINE">Subject: </th>
          <td>Re: The multi-processor package and GUI threading,
            queuing, and locking.</td>
        </tr>
        <tr>
          <th align="RIGHT" nowrap="nowrap" valign="BASELINE">Date: </th>
          <td>Mon, 19 Sep 2011 14:07:15 +0100</td>
        </tr>
        <tr>
          <th align="RIGHT" nowrap="nowrap" valign="BASELINE">From: </th>
          <td>Gary Thompson <a rel="nofollow" class="moz-txt-link-rfc2396E" href="mailto:garyt@xxxxxxxxxxxxxxx">&lt;garyt@xxxxxxxxxxxxxxx&gt;</a></td>
        </tr>
        <tr>
          <th align="RIGHT" nowrap="nowrap" valign="BASELINE">To: </th>
          <td>Edward d'Auvergne <a rel="nofollow" class="moz-txt-link-rfc2396E" href="mailto:edward@xxxxxxxxxxxxx">&lt;edward@xxxxxxxxxxxxx&gt;</a></td>
        </tr>
      </tbody>
    </table>
    <br>
    <br>
    <pre>On 09/19/2011 01:34 PM, Edward d'Auvergne wrote:
&gt;&gt;&gt; That's great that you have time, to have this working properly is
&gt;&gt;&gt; quite important.  I didn't realise how much of an issue the merging of
&gt;&gt;&gt; the multi-processor code and GUI code would be.  I have now merged the
&gt;&gt;&gt; multi-processor branch into the main 1.3 line, as well as the new GUI
&gt;&gt;&gt; branch, and that is where the problems are.  I think there are at
&gt;&gt;&gt; least 2 problems currently occurring.  The first has to do with the
&gt;&gt;&gt; GUI tests:
&gt;&gt;&gt;
&gt;&gt;&gt; $ relax --gui-test
&gt;&gt;&gt;
&gt;&gt;&gt; I looks like that there is a clash of the wxPython App.MainLoop() and
&gt;&gt;&gt; how the master processors of the multi package interact.  There
&gt;&gt;&gt; appears to be race conditions, even in the uni-processor fabric.  This
&gt;&gt;&gt; only occurs in the test-suite, I have just tested manual operation of
&gt;&gt;&gt; the GUI which works, so this makes things more difficult.  The problem
&gt;&gt;&gt; was not existent in the gui_testing branch (svn co
&gt;&gt;&gt; <a rel="nofollow" class="moz-txt-link-abbreviated" href="mailto:svn+ssh://bugman@xxxxxxxxxxx/svn/relax/branches/gui_testing/@14200">svn+ssh://bugman@xxxxxxxxxxx/svn/relax/branches/gui_testing/@14200</a>)
&gt;&gt;&gt; until after the multi-processor code was merged.
&gt;&gt;&gt;
&gt;&gt; I presume this problem is solved and it was due to either a deadlock or
&gt;&gt; calling the wx event loop outside of its main thread. Looking at the source
&gt;&gt; code there seems to be quite a bit of thread specific code(?) One of the
&gt;&gt; aims of the multiprocessor frame-work was to avoid directly waiting on
&gt;&gt; threads and locks etc. This is why the whole design is based round queues
&gt;&gt; and callbacks as they are quite simple to deal with and don't directly
&gt;&gt; expose any underlying threaded model.  If you would like me to expand on
&gt;&gt; this more please do say. If there are still multi threaded issues please do
&gt;&gt; say and give some details of how to cause event loop problems or deadlocks
&gt; Hi Gary,
&gt;
&gt; This problem is now solved on GNU/Linux and Mac OS X, though there is
&gt; still something preventing the tests on MS Windows (I don't know if
&gt; it's related).  I fixed this by completely avoiding IO redirection on
&gt; the Uni-processor fabric.  I'm not sure exactly what was causing the
&gt; problem.
Ok I can have a look at this under windows
&gt; For a GUI, having threads is essential.

&gt; For example with a one to two
&gt; week model-free calculation, you need the GUI to remain responsive and
&gt; show how the calculations are going (the text output continually being
&gt; updated, gauges pulsed or set, etc).  Without this the GUI would
&gt; become completely grey, be unresponsive, and give no feedback so that
&gt; the user will think that the program has crashed.  Therefore as the
&gt; wx.App must run in the main thread, the calculations and other time
&gt; consuming operations must be spawned in sub-threads for asynchronous
&gt; operation.  As far as I can see, this appears to not affect the
&gt; multi-processor package as the package is insensitive to whether it is
&gt; run through the main or a sub-thread.  Threading, queuing, and locking
&gt; are key concepts for GUI design, and we unfortunately need to work
&gt; around this.  This has taken me a long time to get right, as is
&gt; expected with these painful concepts.

All the above is true and very clear, what I am saying about the 
multiprocessor package is that it is designed as a general queueing 
package that opetares via events and callbacks and thus allows you to 
run multiple threads without joining thread or other 'dangerous'  
procedures.  You get all the benefits of a threaded application but 
don't have to think about threads...
&gt;
&gt; The threading code is isolated to the 'gui' directory, and is only
&gt; used in the auto-analyses and in the user functions accessed through
&gt; the GUI (via the GUI interpreter thread).  I think in both cases, the
&gt; multi-processor code would operate normally.  This package is
&gt; currently only used for the grid() and minimise() user functions for
&gt; model-free analysis.  In this case, locking occurs through the global
&gt; execution lock either acquired by the auto-analysis or via the GUI
&gt; user function, if performed manually.  This is prior to the
&gt; multi-processor code execution, and is then released once the analysis
&gt; or the user function finishes respectively.  This lock is needed so
&gt; that the GUI does not go grey, but prevents the user from running more
&gt; than one thing at once.  If relax is run with the debugging flag
&gt; (relax -gd), then all locking information is printed to STDOUT.

thats useful to know ;-)
&gt;
&gt; As for the IO redirection problem, I will address this in a second post.

Ok I look forward to that

regards
gary
&gt;
&gt; Cheers,
&gt;
&gt; Edward


-- 
-------------------------------------------------------------------
Dr Gary Thompson                  [Homans Lab Research Coordinator]

Astbury Centre for Structural Molecular Biology,
University of Leeds,
Leeds, LS2 9JT, West-Yorkshire, UK             Tel. +44-113-3433024
email: <a rel="nofollow" class="moz-txt-link-abbreviated" href="mailto:garyt@xxxxxxxxxxxxxxx">garyt@xxxxxxxxxxxxxxx</a>                   Fax  +44-113-3431935
-------------------------------------------------------------------


</pre>
  

</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00010" href="msg00010.html">Re: Re: The multi-processor package and GUI threading, queuing,	and locking.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Sep 22 11:00:22 2011</div>  
</body>
</html>
