<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r3245 &#45; /1.3/generic_fns/selection.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Thu, 12 Apr 2007 09:57:35 +0200 -->
<!--X-Message-Id: 7f080ed10704120056p6103fca3h7b237c91720f1727@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1HWxlQ&#45;0000ED&#45;Hw@subversion.gna.org -->
<!--X-Reference: 7f080ed10703300001v5b66f9cerff78035f5b0cd09e@mail.gmail.com -->
<!--X-Reference: 1175246582.16998.91.camel@mrspell -->
<!--X-Reference: 1175621482.16998.149.camel@mrspell -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r3245 - /1.3/generic_fns/selection.py -- April 12, 2007 - 09:57</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r3245 - /1.3/generic_fns/selection.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00036" class="tabs">Index by Date</a> | <a href="threads.html#00036" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00035.html">Date Prev</a>] [<a href="msg00037.html">Date Next</a>] [<a href="msg00030.html">Thread Prev</a>] [<a href="msg00045.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Chris MacRaild&quot; &lt;c.a.macraild@xxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 12 Apr 2007 17:56:59 +1000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00036.html">7f080ed10704120056p6103fca3h7b237c91720f1727@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1HWxlQ-0000ED-Hw@xxxxxxxxxxxxxxxxxx&gt;	&lt;7f080ed10703300001v5b66f9cerff78035f5b0cd09e@xxxxxxxxxxxxxx&gt;	&lt;<a href="msg00027.html">1175246582.16998.91.camel@mrspell</a>&gt;	&lt;<a href="msg00030.html">1175621482.16998.149.camel@mrspell</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on April 12, 2007 - 09:57:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 4/4/07, Chris MacRaild &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">
I've spent a bit of time in the last week or so trying to impliment
boolean operators in the mol-res-spin selection language. I've come to
the conclusion that this will not be possible in the current
implimentation of the spin loop and related functions.
</pre></blockquote><pre style="margin: 0em;">

I have been looking at the changes (commit by commit message) and they
look good.  I like the idea of a selection object.  A useful speed up
that is made possible with this structure is that the selection string
could be stored and the __init__() function return without doing
anything if the string passed to it is the same.  This would require
either a singleton or that the code of __init__() be shifted into
another method of the object.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Consider the selection &quot;#Ap4Aase:4 | #RNA&quot;. We mean this to select
residue 4 of the molecule Ap4Aase, and all residues of the molecule RNA.
In the current implimentation, however, it selects all residues of both
molecules. The residue_loop look like:

for mol in data:
    if not mol in selection_object:
        continue
    # both Ap4Aase and RNA get to here; Ap4Aase from the first clause
    # of the selection, RNA from the second
    for res in mol.residues:
        if not res in selection_object:
            continue
        yield res
        # All residues get here, thanks to the second clause of the
        # selection. Because it doesn't explicitly select residues,
        # all residues are implicitly selected, and there is no way of
        # knowing which molecule res belongs to.
</pre></blockquote><pre style="margin: 0em;">

We will need a new approach to the spin_loop, residue_loop, and
molecule_loop, that's for sure.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">
I see two solutions to the problems I'm running into:

1) Subtly change the data structure so that each spin 'knows' what
residue it belongs to, and each residue knows what molecule it belongs
to. (ie. instances of the SpinContainer class have an attribute residue,
that is a pointer to the residue instance that contains that spin). Then
restructure the spin-loop as:

for spin in data.spins:
    if spin in selection_object:
        yield spin


This has a drawback in terms of efficiency, in that all spins in the
data structure must be explicitly considered, whereas the current nested
spin-loop only considers spins that belong to selected residues, and
only residues of selected spins. I'm not sure how much of a hit this
will amount to in real situations.
</pre></blockquote><pre style="margin: 0em;">

I don't know if I like the idea of an object accessing back through
the dictionary object it belongs to followed by accessing the
namespace of the object holding the dictionary.  There will be better
ways of solving the problem.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">
2) More radically change the implimentation of the spin loop, such that
it is subsumed into the Selection class. ie. instances of the selection
class will have a method called spin_loop (and residue_loop, and
molecule_loop), which returns the equivalent iterator object. Then we
effectively (though not literally) do the boolean operations on the list
of selected spins, not on the abstract selection object.



Clearly option 2 is a more radical departure from the agreed design, but
it is likely to have better performance characteristics. Any thoughts on
the best way forward?
</pre></blockquote><pre style="margin: 0em;">

I prefer option 2.  However I would prefer another approach so that
someone can just import the spin_loop function from the
'generic_fns.selection' module and utilise it without needing to set
up the Selection object.  It would simplify the API.  Although another
idea would be to implement the Selection.test() function (or a
function with a more appropriate name).  This function could accept
the mol, res, and spin containers and hence have access to all the
info about that spin.  Then the spin_loop would become:

def spin_loop(selection=None):
   &quot;&quot;&quot;Generator function for looping over all the spin systems of the
given selection.

   @param selection:   The spin system selection identifier.
   @type selection:    str
   @return:            The spin system specific data container.
   @rtype:             instance of the SpinContainer class.
   &quot;&quot;&quot;

   # Parse the selection string.
   select_obj = Selection(selection)

   # Loop over the molecules.
   for mol in relax_data_store[relax_data_store.current_pipe].mol:
       # Skip the molecule if there is no match to the selection.
       if not select_obj.test(mol):
           continue

       # Loop over the residues.
       for res in mol.res:
           # Skip the residue if there is no match to the selection.
           if not select_obj.test(mol, res):
               continue

           # Loop over the spins.
           for spin in res.spin:
               # Skip the spin if there is no match to the selection.
               if not select_obj.test(mol, res, spin):
                   continue

               # Yield the spin system data container.
               yield spin

The test function could then iterate over each part of the selection
string delineated by boolean operators and brackets and return True or
False as necessary.  What do you think of this idea Chris?

Regards,

Edward


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00045" href="msg00045.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00015" href="msg00015.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00027" href="msg00027.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
<li><strong><a name="00030" href="msg00030.html">Re: r3245 - /1.3/generic_fns/selection.py</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Apr 13 16:00:25 2007</div>  
</body>
</html>
