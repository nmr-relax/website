<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r27203 &#45; /trunk/specific_analyses/relax_disp/optimisation.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 19 Jan 2015 11:02:52 +0100 -->
<!--X-Message-Id: CA+CBx2NJx0z2V=PKqOgBAvfHHjwRawSN_VTY_zmQgQCZW1nJpg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1YCFF8&#45;0003kR&#45;Ha@subversion.gna.org -->
<!--X-Reference: CAED9pY_UCB6DtSyEqx5bsS1y79ig0hHm&#45;LHxBJ=Yqun2aJZacQ@mail.gmail.com -->
<!--X-Reference: CA+CBx2NSAEogA47XwWo8Ve&#45;6G53xim2Qf=q80L6MuGF7xCmT1w@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;LT8eqF3u62gjnKs_ugNU6Zy9nLt&#45;KHakcQvLVtV0Wzw@mail.gmail.com -->
<!--X-Reference: CA+CBx2PU7+psDQVjtKqJG6bX73e8cEd=+Exo9BnTvirzE+a_7A@mail.gmail.com -->
<!--X-Reference: CAED9pY_R7LujAmEDnEPLcRJks06s+7W6krdzSugJ28VZCs35mQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r27203 - /trunk/specific_analyses/relax_disp/optimisation.py -- January 19, 2015 - 11:02</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r27203 - /trunk/specific_analyses/relax_disp/optimisation.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00055" class="tabs">Index by Date</a> | <a href="threads.html#00055" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00054.html">Date Prev</a>] [<a href="msg00056.html">Date Next</a>] [<a href="msg00053.html">Thread Prev</a>] [<a href="msg00056.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 19 Jan 2015 11:02:02 +0100</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type; bh=KKe7RlKMOiHeF4N/r3eBnAwra9QlQVGiIKnJrQvUoGE=; b=CAb/qDivGabzHtV+Dfaa8yTfJ5kj5hvqZ6r7TkugQ3WrTHJIXTAMHhPCLrPRoJluy/ aOFOXCpSCRDvwujxJ0A+fGFA+evmEspJAMJHVoq/x8eKV+T6cOowFbtqX5gWbvGB6Wz3 5Lks9cr1W8RiNdBvoTmK4J0dMoj3FhMayupfOg2lLC6okg5D3Et7Ca0RHCh3krJv8Cgn E9vym1dZs8czlPDksWZ5BI2fV5Y5CICFpZNcke4SSeUHJ9hotkjVXVYEIiHGXgBuuuiw xKOmcr7U87RGaHU1PN0HvZ0diATdeUbVuGbclv6OItle1s40BZgJgp12kZXdgA2rCHR5 s9wA==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CA+CBx2NJx0z2V=PKqOgBAvfHHjwRawSN_VTY_zmQgQCZW1nJpg@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1YCFF8-0003kR-Ha@subversion.gna.org&gt; &lt;CAED9pY_UCB6DtSyEqx5bsS1y79ig0hHm-LHxBJ=Yqun2aJZacQ@mail.gmail.com&gt; &lt;CA+CBx2NSAEogA47XwWo8Ve-6G53xim2Qf=q80L6MuGF7xCmT1w@mail.gmail.com&gt; &lt;<a href="msg00048.html">CAED9pY-LT8eqF3u62gjnKs_ugNU6Zy9nLt-KHakcQvLVtV0Wzw@mail.gmail.com</a>&gt; &lt;CA+CBx2PU7+psDQVjtKqJG6bX73e8cEd=+Exo9BnTvirzE+a_7A@mail.gmail.com&gt; &lt;<a href="msg00053.html">CAED9pY_R7LujAmEDnEPLcRJks06s+7W6krdzSugJ28VZCs35mQ@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on January 19, 2015 - 11:02:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Edward.

I am now trying to follow page 109-111.
<a  rel="nofollow" href="http://www.graphpad.com/faq/file/Prism4RegressionBook.pdf">http://www.graphpad.com/faq/file/Prism4RegressionBook.pdf</a>
&quot;Generating confidence intervals via model comparison&quot;

Here, I have locked all values except kex.
# The number of parameters to check is kex = 1.
P = 1
# Number of datapoints
N = 1952
# The degrees of freedom for this confidence interval
dof_conf = N - P
# The critical value of the F distribution with p-value of 0.05 for 95%
confidence.
# Can be calculated with microsoft excel:
# F=FINV(0,05; P; dof_conf), F=FINV(0,05; P; dof_conf), F=FINV(0,05; 1;
1951)=3,846229551
 # Can also be calculated with: import scipy.stats; scipy.stats.f.isf(0.05,
1, 1951)=3.8462295505435562
F = 3.8462295505435562
scale = F*P/dof_conf +1 = 1.00197141443

Then I vary kex from 1000, til 5000, and then taking values of kex, where
the calulated chi2 is less than:
chi2_test = 1.00197141443 *  2324.5 = 2329.082

For the 100% dataset, there is a nice shape of chi2.

But this goes against 50 % dataset I have seen.
i_sort    dw_sort    pA_sort    kex_sort      chi2_sort
471       4.50000    0.99375    2125.00000    4664.31083
470       4.50000    0.99375    1750.00000    4665.23872

If I am unlucky, I have created local minima in the space.

So, I am now trying to do this for the 50 % dataset.

This method is interesting, since I can force kex out of its local minima.
But it will be close to impossible to extend to more parameters than 1.

Best
Troels

2015-01-19 10:43 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Ah!  It could be what I've seen with the model-free analysis.  It
could be that the high precision optimisation in relax avoids the
problems of parameter error overestimation due to the real minimum
being located in a broad region or tunnel in the space.  Do you know
the reason for the large kex errors in the original analysis?  Is it
possible to investigate this?  How were the errors calculated, and do
you know the exact implementation details?  For example what was the
optimisation starting point for each error simulation?  I spent my
entire PhD time solving such problems, reading 3 statistics books
cover-to-cover in the maths library, so I may be able to help.  Or at
least point you in a useful direction.

Regards,

Edward


On 19 January 2015 at 10:33, Troels Emtekær Linnet
&lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I actually think that I have created local minima in my dataset, which is
not caught.

I am looking into it.

2015-01-19 10:30 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi,

Maybe we should discuss on the original thread the problem in detail
and see if there is a solution.  I wonder why the kex errors are so
different?

Regards,

Edward



On 19 January 2015 at 09:51, Troels Emtekær Linnet
&lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Edward.

I was through sor (sum of residuals), sos(sum of squares), and now
sse(sum
of squared errors).

I agree with sse being the best, but I have reverted all my commits,
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">and
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">found a solution through the API.

Just using the chi2 value, and finding degrees of freedom with the
</pre></blockquote></blockquote></blockquote><pre style="margin: 0em;">API.
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">

If one wants .sse, one can just quickly do

value.set(val=1.0, param=&quot;r2eff&quot;, error=True)
minimise.calculate(verbosity=1)

Anyway, in the end, the new method did not solve my problem.
STD_fit = sqrt(chi2 / dof)

Since dof is so big (many datapoints, small amounts of parameters for
clustered fitting), STD_fit becomes close to 1.


Best
Troels


2015-01-19 9:35 GMT+01:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Troels,

Could you rename spin.sos to spin.sse?  This is the acronym used in
the field and by other software - the sum of squared errors
(<a  rel="nofollow" href="https://en.wikipedia.org/wiki/Residual_sum_of_squares">https://en.wikipedia.org/wiki/Residual_sum_of_squares</a>,
<a  rel="nofollow" href="http://www.palmer.hs.columbia.edu/software/modelfree_manual.pdf">http://www.palmer.hs.columbia.edu/software/modelfree_manual.pdf</a>).
</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">If
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">the individual SSE elements are divided by the experimental error
sigma_i, then this is the chi2 value.  The SSE and chi2 statistics
</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">are
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">related, and are identical in the case of unit errors.  Other
acronyms, much less used in the NMR field, are SSR or RSS.  I don't
think I've ever encountered SOS before, outside of emergencies
(<a  rel="nofollow" href="https://en.wikipedia.org/wiki/SOS">https://en.wikipedia.org/wiki/SOS</a>).

Cheers,

Edward

On 16 January 2015 at 23:19,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Fri Jan 16 23:19:50 2015
New Revision: 27203

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=27203&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=27203&amp;view=rev</a>
Log:
Implemented storing of sum of squares and the standard deviation of
these for relaxation dispersion, when doing a point calculation.

Task #7882 (<a  rel="nofollow" href="https://gna.org/task/?7882">https://gna.org/task/?7882</a>): Implement Monte-Carlo
simulation, where errors are generated with width of standard
deviation or
residuals.

Modified:
    trunk/specific_analyses/relax_disp/optimisation.py

Modified: trunk/specific_analyses/relax_disp/optimisation.py
URL:


</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;"><a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/optimisation.py?rev=27203&amp;r1=27202&amp;r2=27203&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/optimisation.py?rev=27203&amp;r1=27202&amp;r2=27203&amp;view=diff</a>
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">



</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">==============================================================================
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">--- trunk/specific_analyses/relax_disp/optimisation.py  (original)
+++ trunk/specific_analyses/relax_disp/optimisation.py  Fri Jan 16
23:19:50 2015
@@ -119,7 +119,7 @@
     @type spin_lock_nu1:        list of lists of numpy rank-1
</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">float
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">arrays
     @keyword relax_times_new:   The interpolated experiment
</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">specific
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">fixed time period for relaxation (in seconds).  The dimensions are
{Ei, Mi,
Oi, Di, Ti}.
     @type relax_times_new:      rank-4 list of floats
-    @keyword store_chi2:        A flag which if True will cause
</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">the
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">spin specific chi-squared value to be stored in the spin container.
+    @keyword store_chi2:        A flag which if True will cause
</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">the
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">spin specific chi-squared value to be stored in the spin container
together
with the sum of squares of the residuals and the standard deviation
of the
sum of squares of the residuals.
     @type store_chi2:           bool
     @return:                    The back-calculated R2eff/R1rho
value
for the given spin.
     @rtype:                     numpy rank-1 float array
@@ -215,10 +215,15 @@
     # Make a single function call.  This will cause back
</pre></blockquote></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">calculation
</pre><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">and the data will be stored in the class instance.
     chi2 = model.func(param_vector)

-    # Store the chi-squared value.
+    # Get the sum of squares 'sos' of the residuals between the
fitted
values and the measured values. Get the std deviation of these,
std_sos.
+    sos, sos_std = model.get_sum_of_squares()
+
+    # Store the chi-squared value, sums of squares of residual and
the
standard deviation of sums of squares of residual.
     if store_chi2:
         for spin in spins:
             spin.chi2 = chi2
+            spin.sos = sos
+            spin.sos_std = sos_std

     # Return the structure.
     return model.get_back_calc()


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00056" href="msg00056.html">Re: r27203 - /trunk/specific_analyses/relax_disp/optimisation.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00041" href="msg00041.html">Re: r27203 - /trunk/specific_analyses/relax_disp/optimisation.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00043" href="msg00043.html">Re: r27203 - /trunk/specific_analyses/relax_disp/optimisation.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00048" href="msg00048.html">Re: r27203 - /trunk/specific_analyses/relax_disp/optimisation.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00051" href="msg00051.html">Re: r27203 - /trunk/specific_analyses/relax_disp/optimisation.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00053" href="msg00053.html">Re: r27203 - /trunk/specific_analyses/relax_disp/optimisation.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jan 19 12:00:13 2015</div>  
</body>
</html>
