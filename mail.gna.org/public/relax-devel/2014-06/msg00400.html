<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r24176 &#45; /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg &#60;gyvaargNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 23 Jun 2014 10:35:28 +0200 -->
<!--X-Message-Id: CA+CBx2Ok+kjpZf16REhMWS5uwbvoHei3tSCs8zvy0djFFdaFaA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Wxs3B&#45;00045b&#45;VN@subversion.gna.org -->
<!--X-Reference: CAED9pY_5PPCF8e6jUqGtxSFYkWL58YVSb=xSgLbAHE=foXwGAg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r24176 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py -- June 23, 2014 - 10:35</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r24176 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00400" class="tabs">Index by Date</a> | <a href="threads.html#00400" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00399.html">Date Prev</a>] [<a href="msg00401.html">Date Next</a>] [<a href="msg00396.html">Thread Prev</a>] [<a href="msg00397.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 23 Jun 2014 10:34:37 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:from:date:message-id :subject:to:cc:content-type; bh=l/IR9BQHSoQUer357rnaRmXjQ+4WLXlaLEgqxsDV/0U=; b=zTsguU9WivcF3pv17nab4k8b6gY81m+4N//8DrAyGmEJPy5FWI8UcEVf1bwndQEunZ srU+YHGBCV+o3w6SAQ0iwZcYOki9Z7qAX08BIWXxHm610WG66VwOzZyxZ1eWW7rILXdq RIaz99z+XUXI2IPoL0e3+CH+ZfINl1/m5lt53qZ3Imz8Zv/NNDhfcWSUIYIqfIQ5R/Jy jySiKQ/lHgX2P9tZY/xqg1/pJfbJoRrTogAOQmApYpE+SABeNF5F0tgCA1kpVT5hgq9B DFoEkynCr5baar8JoxY5jQy8CPXOSkMfCyAyxBtSYZ/nvYZjydQpK4+bZL1y6ZFQTtFw V6Fg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00400.html">CA+CBx2Ok+kjpZf16REhMWS5uwbvoHei3tSCs8zvy0djFFdaFaA@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1Wxs3B-00045b-VN@subversion.gna.org&gt; &lt;CAED9pY_5PPCF8e6jUqGtxSFYkWL58YVSb=xSgLbAHE=foXwGAg@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on June 23, 2014 - 10:35:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Ed.

I am collecting all your comments into one message.

I have noted:

6) Unit tests of ns matrices are the same for low and high dimensionality.
First determine where to store low and high dimensional matrices.



2014-06-23 10:19 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">Again, this should not be committed.  Can these checks, that you later
delete, be converted into unit tests?  That would be of huge benefit
for future developers who would like to further optimise the code.

Cheers,

Edward



On 20 June 2014 08:11,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Fri Jun 20 08:11:49 2014
New Revision: 24176

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=24176&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=24176&amp;view=rev</a>
Log:
Insert check, that the newly created multidimensional matrix is the same.

They are, but only to the fifth digit.

Task #7807 (<a  rel="nofollow" href="https://gna.org/task/index.php?7807">https://gna.org/task/index.php?7807</a>): Speed-up of
</pre></blockquote><pre style="margin: 0em;">dispersion models for Clustered analysis.
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Modified:
    branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py

Modified: branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py
URL:
</pre></blockquote><pre style="margin: 0em;"><a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py?rev=24176&amp;r1=24175&amp;r2=24176&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py?rev=24176&amp;r1=24175&amp;r2=24176&amp;view=diff</a>
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

</pre></blockquote><pre style="margin: 0em;">==============================================================================
</pre><blockquote class="blockquote"><pre style="margin: 0em;">--- branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py
</pre></blockquote><pre style="margin: 0em;">(original)
</pre><blockquote class="blockquote"><pre style="margin: 0em;">+++ branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py
</pre></blockquote><pre style="margin: 0em;">Fri Jun 20 08:11:49 2014
</pre><blockquote class="blockquote"><pre style="margin: 0em;">@@ -62,6 +62,7 @@

 # relax module imports.
 from lib.float import isNaN
+from lib.dispersion.ns_matrices import rcpmg_star_rankN
 from lib.linear_algebra.matrix_exponential import matrix_exponential
 from lib.linear_algebra.matrix_power import square_matrix_power

@@ -137,6 +138,9 @@
     # Extract the total numbers of experiments, number of spins, number
</pre></blockquote><pre style="margin: 0em;">of magnetic field strength, number of offsets, maximum number of dispersion
point.
</pre><blockquote class="blockquote"><pre style="margin: 0em;">     NE, NS, NM, NO, ND = back_calc.shape

+    # The matrix R that contains all the contributions to the
</pre></blockquote><pre style="margin: 0em;">evolution, i.e. relaxation, exchange and chemical shift evolution.
</pre><blockquote class="blockquote"><pre style="margin: 0em;">+    R_mat, cR2_mat, Rr_mat, Rex_mat, RCS_mat =
</pre></blockquote><pre style="margin: 0em;">rcpmg_star_rankN(R2A=r20a, R2B=r20b, pA=pA, pB=pB, dw=dw, k_AB=k_AB,
k_BA=k_BA, tcp=tcp)
</pre><blockquote class="blockquote"><pre style="margin: 0em;">+
     # Loop over the spins
     for si in range(NS):
         # Loop over the spectrometer frequencies.
@@ -170,7 +174,32 @@
                 r20a_si_mi_di = r20a[0, si, mi, 0, di]

                 # This matrix is a propagator that will evolve the
</pre></blockquote><pre style="margin: 0em;">magnetization with the matrix R for a delay tcp.
</pre><blockquote class="blockquote"><pre style="margin: 0em;">-                eR_tcp = matrix_exponential(R*tcp_si_mi_di)
+                R_tcp = R*tcp_si_mi_di
+                R_mat_i = R_mat[0, si, mi, 0, di]
+
+                # Insert check
+                diff = R_tcp.real -R_mat_i.real
+                if sum(diff) &gt; 1.0e-5:
+                    print sum(diff)
+                    print &quot;Rr_mat&quot;
+                    print Rr*tcp_si_mi_di
+                    print Rr_mat[0, si, mi, 0, di]
+                    print &quot;RCS_mat&quot;
+                    print RCS*tcp_si_mi_di
+                    print RCS_mat[0, si, mi, 0, di]
+                    print &quot;Rex_mat&quot;
+                    print Rex*tcp_si_mi_di
+                    print Rex_mat[0, si, mi, 0, di]
+                    print &quot;R_mat&quot;
+                    print R*tcp_si_mi_di
+                    print R_mat[0, si, mi, 0, di]
+                    print &quot;cR2_mat&quot;
+                    print cR2*tcp_si_mi_di
+                    print cR2_mat[0, si, mi, 0, di]
+                    print tcp_si_mi_di - tcp[0, si, mi, 0, di]
+                    print asd
+
+                eR_tcp = matrix_exponential(R_tcp)

                 # This is the propagator for an element of [delay tcp;
</pre></blockquote><pre style="margin: 0em;">180 deg pulse; 2 times delay tcp; 180 deg pulse; delay tau], i.e. for 2
times tau-180-tau.
</pre><blockquote class="blockquote"><pre style="margin: 0em;">                 prop_2 = dot(dot(eR_tcp,
</pre></blockquote><pre style="margin: 0em;">matrix_exponential(cR2*tcp_si_mi_di)), eR_tcp)
</pre><blockquote class="blockquote"><pre style="margin: 0em;">


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>

</pre></blockquote><pre style="margin: 0em;">

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00396" href="msg00396.html">Re: r24176 - /branches/disp_spin_speed/lib/dispersion/ns_cpmg_2site_star.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jun 23 10:40:14 2014</div>  
</body>
</html>
