<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sr #3154] Implementation of Baldwin (2014) B14 model &#45; 2&#45;site exact solution model for all time scales -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 06 May 2014 11:53:02 +0200 -->
<!--X-Message-Id: CAED9pY_s&#45;ZYxJzrznKbT1WPaBtFx_Y=mX7OrS2fOj&#45;4AJ&#45;cm9Q@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20140429&#45;222552.sv20529.12099@gna.org -->
<!--X-Reference: 20140429&#45;222920.sv20529.65319@gna.org -->
<!--X-Reference: 20140429&#45;223825.sv20529.27067@gna.org -->
<!--X-Reference: CA+CBx2N5ti2&#45;+cs4TPViYxqnEpjH3432hydxCicgOcdLb01cEw@mail.gmail.com -->
<!--X-Reference: CAED9pY9josZukT1kOeax=U02GsHL5FMpuaQ9JqTTT+Gx5Ah&#45;eQ@mail.gmail.com -->
<!--X-Reference: 5360CCC8.3050309@chem.ox.ac.uk -->
<!--X-Reference: CAED9pY8oW7J&#45;7YcBgSRpDPexRghuRNnK851VJ7E+GePdnS2m3Q@mail.gmail.com -->
<!--X-Reference: 536200D2.2010005@chem.ox.ac.uk -->
<!--X-Reference: CA+CBx2Nbfndqpv7Rq+X751z&#45;5fi41DmXo2sGFSar_qOWQPWEuA@mail.gmail.com -->
<!--X-Reference: 5366AA19.3000304@chem.ox.ac.uk -->
<!--X-Reference: CA+CBx2PXnmcr9DcCEO1K=Jr=ymMncFAJv8amxyBWwzRRv0w3kw@mail.gmail.com -->
<!--X-Reference: 53675322.2@chem.ox.ac.uk -->
<!--X-Reference: CA+CBx2NMXNk5hVD8_3UO=wToC+PR5vDanWj5RNDpZB5Q=PfGEQ@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;=&#45;81yQe1r_RLn+OwbjTf=7h2q9G+OWTw9bKtB7itHYA@mail.gmail.com -->
<!--X-Reference: 5368A5D5.6040505@chem.ox.ac.uk -->
<!--X-Reference: CAED9pY&#45;PDah4W=E90USk3YakAi=UECBKznFbNmewicFa83tz6Q@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales -- May 06, 2014 - 11:53</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00150" class="tabs">Index by Date</a> | <a href="threads.html#00150" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00149.html">Date Prev</a>] [<a href="msg00151.html">Date Next</a>] [<a href="msg00149.html">Thread Prev</a>] [<a href="msg00153.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Andrew Baldwin &lt;andrew.baldwin@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 6 May 2014 11:52:10 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;, Martin Tollinger &lt;Martin.Tollinger@xxxxxxxxxx&gt;, Nikolai Skrynnikov &lt;nikolai@xxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type; bh=yRzPOkVwwhda8EMEIw1Jv/YI3PCASoo5njazG/TjQ4o=; b=m8yacHa0Xs2BP2lzQi+3KFMkoUcC8kSKKUBcIUpN36bdWLYIHpnA1eh/02p/E7ZEJs GsLlTjhjog2dhbl2FKN0VSkIL+YWD8ipukRbZrfftQYBVQ9kcvLOIawgvizPWekg7RcV ZOD5JvH9yjxAfzlReYZXsnO1gm/RtaU0OC4ANnZVfkzfrsnsZtspxerqLWLoTFGU/bxS C1DTTmUF6NGno5iD5CwxQISGF0iw6gMkAUrw/UHZOhAfb0MTdcKwpSD6BH2SUr6pYHDl 9TE/oTLxrUf5s2Uqou3+OtzN+hZvUk+LU+nXQPJOHAxBK9HJTyJlpXOtpkhZZM1DPZyj 15dg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY_s-ZYxJzrznKbT1WPaBtFx_Y=mX7OrS2fOj-4AJ-cm9Q@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;20140429-222552.sv20529.12099@gna.org&gt; &lt;20140429-222920.sv20529.65319@gna.org&gt; &lt;20140429-223825.sv20529.27067@gna.org&gt; &lt;CA+CBx2N5ti2-+cs4TPViYxqnEpjH3432hydxCicgOcdLb01cEw@mail.gmail.com&gt; &lt;CAED9pY9josZukT1kOeax=U02GsHL5FMpuaQ9JqTTT+Gx5Ah-eQ@mail.gmail.com&gt; &lt;<a href="msg00000.html">5360CCC8.3050309@chem.ox.ac.uk</a>&gt; &lt;CAED9pY8oW7J-7YcBgSRpDPexRghuRNnK851VJ7E+GePdnS2m3Q@mail.gmail.com&gt; &lt;<a href="msg00010.html">536200D2.2010005@chem.ox.ac.uk</a>&gt; &lt;<a href="msg00063.html">CA+CBx2Nbfndqpv7Rq+X751z-5fi41DmXo2sGFSar_qOWQPWEuA@mail.gmail.com</a>&gt; &lt;<a href="msg00088.html">5366AA19.3000304@chem.ox.ac.uk</a>&gt; &lt;CA+CBx2PXnmcr9DcCEO1K=Jr=ymMncFAJv8amxyBWwzRRv0w3kw@mail.gmail.com&gt; &lt;<a href="msg00098.html">53675322.2@chem.ox.ac.uk</a>&gt; &lt;CA+CBx2NMXNk5hVD8_3UO=wToC+PR5vDanWj5RNDpZB5Q=PfGEQ@mail.gmail.com&gt; &lt;CAED9pY-=-81yQe1r_RLn+OwbjTf=7h2q9G+OWTw9bKtB7itHYA@mail.gmail.com&gt; &lt;<a href="msg00145.html">5368A5D5.6040505@chem.ox.ac.uk</a>&gt; &lt;CAED9pY-PDah4W=E90USk3YakAi=UECBKznFbNmewicFa83tz6Q@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on May 06, 2014 - 11:53:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">For reference, here are the numbers for the minimum R2eff deviations
between the models and the numeric model:

Relative times of the various approaches:
Baldwin 0.156321 1.0
Numerical 19.931842 127.505850142
Meiboom 0.057285 0.36645748172
Carver 0.080676 0.516091887846
Nikolai 0.452753 2.89630311986
NikolaiFun 0.285322 1.82523141485
NikolaiLong 49.659583 317.676978781
NikolaiLong 50.218869 321.254783426
Minimum error over grid (s-1):
Meiboom:          1.61560178569e-07
Baldwin:          0.0
CarverRichards:   3.05888647745e-11
Nikolai fun:                0.0
Nikolai dougle (9):          0.0
Nikolai long double (18):     1.56125112838e-17
Nikolai long double (23):     1.73193356121e-17

Regards,

Edward



On 6 May 2014 11:43, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

On 6 May 2014 11:05, Andrew Baldwin &lt;andrew.baldwin@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">That CarverRichards number now looks what I would personally expect
</pre></blockquote><pre style="margin: 0em;">

from the theory!

I'd agree with that. This is noteworthy - we're agreeing on something! Had
to happen eventually :)
</pre></blockquote><pre style="margin: 0em;">

:)


</pre><blockquote class="blockquote"><blockquote class="blockquote"><pre style="margin: 0em;">I don't like the Nikolai results, but I also don't
like the fact that I have two completely different implementations of
this code (from the sim_all software and the compareTroells.py
script).
</pre></blockquote><pre style="margin: 0em;">


The different versions of code is a good point. I copied and pasted what I
think is your function here:

<a  rel="nofollow" href="http://www.nmr-relax.com/api/3.1/lib.dispersion.ns_cpmg_2site_expanded-pysrc.html">http://www.nmr-relax.com/api/3.1/lib.dispersion.ns_cpmg_2site_expanded-pysrc.html</a>

And have added this as the fun mode (see function nikolaiFun). My Nikolai
version came from 'reiko_ishima_v1.tar' and 'Exact_Rex_mod_v1.m' as i'm 
sure
he'll explain shortly. I ran my python version against the matlab original
to confirm that the transcription was good.

Note in the grid search in this version of testdisp, the grid is no longer
going over R2E, as the funmode is R2g=R2e. Note also that I've jigged up 
the
Pb in the attached code to cover higher pbs (we now go to 40%) to increase
the apparent errors in the CR equation. This is well outside anywhere
experimentally accessible, but fun to observe.
</pre></blockquote><pre style="margin: 0em;">

Troels, it's worth noting this R2g=R2e.  As most people will use this
in the field, it would be of great value to have a 'B14' model variant
whereby R20A == R20B ;)


</pre><blockquote class="blockquote"><pre style="margin: 0em;">So your function is already faster by a factor of 2 which is good. Please
can you check the function to make sure i've wired your definitions up to 
my
function correctly? When I use a narrow grid search, the function seems to
give the exact result so I think it's probably right.

Here's the o/p:

####

Relative times of the various approaches:
Baldwin 0.194165 1.0
Numerical 21.562522 111.052568692
Meiboom 0.070515 0.363170499318
Carver 0.105395 0.542811526279
compareTroells.py:396: RuntimeWarning: invalid value encountered in log

  R2eff=(1/Tc)*numpy.log(intensity0/intensity);        # we did not factor
out (Ka+Kb)/2 here
Nikolai 0.615217 3.16852676847
compareTroells.py:274: RuntimeWarning: invalid value encountered in log
  R2eff=-inv_relax_time * numpy.log(Mx)
NikolaiFun 0.376738 1.94029819998
NikolaiLong 81.447843 419.477470193
NikolaiLong 82.098139 422.82666289

Maximum error over grid (s-1):
Meiboom:          237214256.582
Baldwin:          6.57168541807e-10
CarverRichards:   29.9287668504
Nikolai fun:                2964.41300775
Nikolai dougle (9):          142.46676955
Nikolai long double (18):     0.063449549192819563320223
Nikolai long double (23):     5.7775487944482434059452e-7
####
</pre></blockquote><pre style="margin: 0em;">

The tcp in this function in relax is defined as 1/(4*nu_CPMG), but in
your script you have &quot;tcp=1./(2*nu_cpmg);&quot;.  Apart from that, it looks
ok.  Changing to the correct tcp gives:

Relative times of the various approaches:
Baldwin 0.159632 1.0
Numerical 19.974315 125.127261451
Meiboom 0.056497 0.353920266613
Carver 0.080027 0.501321790117
Nikolai 0.453068 2.83820286659
NikolaiFun 0.284052 1.77941766062
NikolaiLong 50.020116 313.34642177
NikolaiLong 50.430594 315.917823494
Maximum error over grid (s-1):
Meiboom:          237214256.582
Baldwin:          6.57168541807e-10
CarverRichards:   29.9287668504
Nikolai fun:                104.735381561
Nikolai dougle (9):          142.46676955
Nikolai long double (18):     0.063449549192819563320223
Nikolai long double (23):     5.7775487944482434059452e-7

That's far more reasonable for Nikolai's fun!


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I was hoping that the modification would make it more stable. If anything
the reverse is true. I would have included a note to this effect in the
paper (and still will if you can show it's better). Note the error is very
temperamental. You can miss it even by setting up the grid search
differently. Give it a narrow grid, and you won't see the error. Only
relatively specific, but seemingly hard to predict sets of parameters (all
with large deltaOs) lead it to explode.
</pre></blockquote><pre style="margin: 0em;">

It is worth looking at all deviations rather than just the single
maximum R2eff difference.  It could be that there is an edge case in
the grid whereby a maths domain error occurs.  Or an trig function
overflow.  The median deviation to avoid such outliers might also be
of worth.  By switching in your code all numpy.max() calls with
numpy.median(), and making sure the &quot;Nikolai long double (*)&quot; results
are pre-converted to a numpy float64 array, I then see an incredibly
different picture:

Relative times of the various approaches:
Baldwin 0.152725 1.0
Numerical 19.596446 128.3119725
Meiboom 0.05604 0.366934031756
Carver 0.077236 0.505719430349
Nikolai 0.43944 2.87732853167
NikolaiFun 0.273977 1.7939237191
NikolaiLong 50.243433 328.979754461
NikolaiLong 50.784841 332.524740547
Median error over grid (s-1):
Meiboom:          4.0064828013
Baldwin:          3.9630521087e-12
CarverRichards:   0.00661151728704
Nikolai fun:                6.62225829728e-12
Nikolai dougle (9):          6.70041799822e-12
Nikolai long double (18):     2.62099543458e-12
Nikolai long double (23):     2.27758174227e-12

!

So this is much clearer - outliers are the major difference you are
seeing.  A study of such outliers and their cause would be quite
interesting.  But in most of these cases, simple collapsed equations
for each model should be derivable at the edges which then produce the
expected R2eff over the entire parameter space rather than
computational artefacts in some corners.  Anyway, this result makes it
crystal clear that the different models should not be judged by the
single maximum outlier over the entire parameter space.

Regards,

Edward
</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00000" href="msg00000.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Andrew Baldwin</li></ul></li>
<li><strong><a name="00010" href="msg00010.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Andrew Baldwin</li></ul></li>
<li><strong><a name="00063" href="msg00063.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00088" href="msg00088.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Andrew Baldwin</li></ul></li>
<li><strong><a name="00089" href="msg00089.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00098" href="msg00098.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Andrew Baldwin</li></ul></li>
<li><strong><a name="00113" href="msg00113.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
<li><strong><a name="00141" href="msg00141.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00145" href="msg00145.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Andrew Baldwin</li></ul></li>
<li><strong><a name="00149" href="msg00149.html">Re: [sr #3154] Implementation of Baldwin (2014) B14 model - 2-site exact solution model for all time scales</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue May 06 12:40:11 2014</div>  
</body>
</html>
