<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: numerical cpmg fit -->
<!--X-From-R13: Bnhy Epunaqn <cnhy.fpunaqnNtzk.ng> -->
<!--X-Date: Sun, 14 Jul 2013 08:19:34 +0200 -->
<!--X-Message-Id: 0B2A8433&#45;C5BE&#45;4388&#45;A04C&#45;9AF1D365A60D@gmx.at -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 35036407&#45;39A6&#45;4B59&#45;B529&#45;7074D5F10DBA@gmx.at -->
<!--X-Reference: CAED9pY_zKf+1kML6UNezswM1NQtvZh7n7Jdz_Ss1H5Kn2cj5kw@mail.gmail.com -->
<!--X-Reference: CAED9pY9HUHQ1X6zQpY8CmPR3NFoSXJwgeP02Nme1Y447&#45;6U9RQ@mail.gmail.com -->
<!--X-Reference: CAED9pY_cN9pSyBX2F+ji1gYHN7RkwY72PwE4_&#45;8dEVNU&#45;4R1jg@mail.gmail.com -->
<!--X-Reference: 390EF589&#45;7B7E&#45;466A&#45;BE67&#45;021D16E7E12B@gmx.at -->
<!--X-Reference: CAED9pY8cqOqAhYDFxVCK+Sm8rJ7=p8GFPwKTHwdzg2U8DZsd_w@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: numerical cpmg fit -- July 14, 2013 - 08:19</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: numerical cpmg fit</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00030" class="tabs">Index by Date</a> | <a href="threads.html#00030" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00029.html">Date Prev</a>] [<a href="msg00031.html">Date Next</a>] [<a href="msg00025.html">Thread Prev</a>] [<a href="msg00031.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Sun, 14 Jul 2013 08:19:01 +0200</li>
<li class="menuitem">
<em>Cc</em>: mathilde lescanne &lt;mathilde.lescanne@xxxxxxxxx&gt;,	&quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00030.html">0B2A8433-C5BE-4388-A04C-9AF1D365A60D@gmx.at</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;35036407-39A6-4B59-B529-7074D5F10DBA@xxxxxx&gt;	&lt;CAED9pY_zKf+1kML6UNezswM1NQtvZh7n7Jdz_Ss1H5Kn2cj5kw@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY9HUHQ1X6zQpY8CmPR3NFoSXJwgeP02Nme1Y447-6U9RQ@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY_cN9pSyBX2F+ji1gYHN7RkwY72PwE4_-8dEVNU-4R1jg@xxxxxxxxxxxxxx&gt;	&lt;390EF589-7B7E-466A-BE67-021D16E7E12B@xxxxxx&gt;	&lt;CAED9pY8cqOqAhYDFxVCK+Sm8rJ7=p8GFPwKTHwdzg2U8DZsd_w@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Paul Schanda</strong> on July 14, 2013 - 08:19:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td style="">Hi Edward,<div><br></div><div>fg is the frequency of the ground state (call it "A" or "G"), while fe is the excited state frequency.</div><div>tcpmg is the total duration of the CPMG element. At some instances this is called Tc instead of tcpmg.</div><div>Not to be confused with the delay before and after each pulse, which is tcp. I.e., between two 180deg pulses there are two delays tcp.</div><div><br></div><div>I saw that you keep the convention of "G" and "E" in the functions. Is this also used in the existing functions, or do you use "A" and "B" there? It might be cleaner to have a coherent naming convention.</div><div><br></div><div>Here are some comments to the function:</div><div><br></div><div><br></div><div><table cellpadding="0" cellspacing="0" style="position: static; z-index: auto; "><tbody><tr class="vc_row_odd" id="l70"><td class="vc_file_line_number">70</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-c"># Initialise some structures.</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l71">
<td class="vc_file_line_number">71</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">Rr</span><span class="pygments-">  </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-o">-</span><span class="pygments-mf">1.0</span><span class="pygments-"> </span><span class="pygments-o">*</span><span class="pygments-"> </span><span class="pygments-n">matrix</span><span class="pygments-p">([[</span><span class="pygments-n">r20b</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-mf">0.0</span><span class="pygments-p">],[</span><span class="pygments-mf">0.0</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-n">r20a</span><span class="pygments-p">]])</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l72">
<td class="vc_file_line_number">72</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">Rex</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-o">-</span><span class="pygments-mf">1.0</span><span class="pygments-"> </span><span class="pygments-o">*</span><span class="pygments-"> </span><span class="pygments-n">matrix</span><span class="pygments-p">([[</span><span class="pygments-n">kge</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-o">-</span><span class="pygments-n">keg</span><span class="pygments-p">],[</span><span class="pygments-o">-</span><span class="pygments-n">kge</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-n">keg</span><span class="pygments-p">]])</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l73">
<td class="vc_file_line_number">73</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">RCS</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-nb">complex</span><span class="pygments-p">(</span><span class="pygments-mf">0.0</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-o">-</span><span class="pygments-mf">1.0</span><span class="pygments-p">)</span><span class="pygments-"> </span><span class="pygments-o">*</span><span class="pygments-"> </span><span class="pygments-n">matrix</span><span class="pygments-p">([[</span><span class="pygments-mf">0.0</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-mf">0.0</span><span class="pygments-p">],[</span><span class="pygments-mf">0.0</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-n">fg</span><span class="pygments-p">]])</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l74">
<td class="vc_file_line_number">74</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">R</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">Rr</span><span class="pygments-"> </span><span class="pygments-o">+</span><span class="pygments-"> </span><span class="pygments-n">Rex</span><span class="pygments-"> </span><span class="pygments-o">+</span><span class="pygments-"> </span><span class="pygments-n">RCS</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l75">
<td class="vc_file_line_number">75</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">cR2</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">conj</span><span class="pygments-p">(</span><span class="pygments-n">R</span><span class="pygments-p">)</span><span class="pygments-"> </span><span class="pygments-o">*</span><span class="pygments-"> </span><span class="pygments-mf">2.0</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l76">
<td class="vc_file_line_number">76</td>

<td class="vc_file_line_text">
</td>
</tr>




<tr class="vc_row_odd" id="l77">
<td class="vc_file_line_number">77</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">kex</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">kge</span><span class="pygments-"> </span><span class="pygments-o">+</span><span class="pygments-"> </span><span class="pygments-n">keg<span class="Apple-tab-span" style="white-space:pre">	</span># conversion of kinetic rates</span><span class="pygments-"></span></td>
</tr>




<tr class="vc_row_odd" id="l78">
<td class="vc_file_line_number">78</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">IGeq</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">keg</span><span class="pygments-"> </span><span class="pygments-o">/</span><span class="pygments-"> </span><span class="pygments-n">kex<span class="Apple-tab-span" style="white-space:pre">	</span># calculate relative populations - will be used for generating the equilibrium magnetizations</span><span class="pygments-"></span></td>
</tr>




<tr class="vc_row_odd" id="l79">
<td class="vc_file_line_number">79</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">IEeq</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">kge</span><span class="pygments-"> </span><span class="pygments-o">/</span><span class="pygments-"> </span><span class="pygments-n">kex<span class="Apple-tab-span" style="white-space:pre">	</span># like preceding line, but for excited state</span><span class="pygments-"></span></td>
</tr>




<tr class="vc_row_odd" id="l80">
<td class="vc_file_line_number">80</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">M0</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">matrix</span><span class="pygments-p">([[</span><span class="pygments-n">IGeq</span><span class="pygments-p">],</span><span class="pygments-"> </span><span class="pygments-p">[</span><span class="pygments-n">IEeq</span><span class="pygments-p">]])<span class="Apple-tab-span" style="white-space:pre">	</span># This is a vector that contains the initial magnetizations, corresponding to ground (G) and excited (E) state transverse magnetizations<br></span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l81">
<td class="vc_file_line_number">81</td>

<td class="vc_file_line_text">
</td>
</tr>




<tr class="vc_row_odd" id="l82">
<td class="vc_file_line_number">82</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-c"># Replicated calculations for faster operation.</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l83">
<td class="vc_file_line_number">83</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-n">inv_tcpmg</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-mf">1.0</span><span class="pygments-"> </span><span class="pygments-o">/</span><span class="pygments-"> </span><span class="pygments-n">tcpmg</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l84">
<td class="vc_file_line_number">84</td>

<td class="vc_file_line_text">
</td>
</tr>




<tr class="vc_row_odd" id="l85">
<td class="vc_file_line_number">85</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-c"># Loop over the time points, back calculating the R2eff values.</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l86">
<td class="vc_file_line_number">86</td>

<td class="vc_file_line_text"><span class="pygments-">    </span><span class="pygments-k">for</span><span class="pygments-"> </span><span class="pygments-n">i</span><span class="pygments-"> </span><span class="pygments-ow">in</span><span class="pygments-"> </span><span class="pygments-nb">range</span><span class="pygments-p">(</span><span class="pygments-n">num_points</span><span class="pygments-p">):</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l87">
<td class="vc_file_line_number">87</td>

<td class="vc_file_line_text"><span class="pygments-">        </span><span class="pygments-c"># Replicated calculations for faster operation.</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l88">
<td class="vc_file_line_number">88</td>

<td class="vc_file_line_text"><span class="pygments-">        </span><span class="pygments-n">tcp</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-mf">0.25</span><span class="pygments-"> </span><span class="pygments-o">/</span><span class="pygments-"> </span><span class="pygments-n">cpmg_frqs</span><span class="pygments-p">[</span><span class="pygments-n">i</span><span class="pygments-p">]</span><span class="pygments-"></span>
</td>
</tr>




<tr class="vc_row_odd" id="l89">
<td class="vc_file_line_number">89</td>

<td class="vc_file_line_text"><span class="pygments-">        </span><span class="pygments-n">expm_R_tcp</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">expm</span><span class="pygments-p">(</span><span class="pygments-n">R</span><span class="pygments-o">*</span><span class="pygments-n">tcp</span><span class="pygments-p">)<span class="Apple-tab-span" style="white-space:pre">	</span># This matrix is a propagator that will evolve the magnetization with the matrix R for a delay tcp</span><span class="pygments-"></span></td>
</tr>




<tr class="vc_row_odd" id="l90">
<td class="vc_file_line_number">90</td>

<td class="vc_file_line_text">
</td>
</tr>




<tr class="vc_row_odd" id="l91">
<td class="vc_file_line_number">91</td>

<td class="vc_file_line_text"><span class="pygments-">        </span><span class="pygments-n">prop_2</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">dot</span><span class="pygments-p">(</span><span class="pygments-n">dot</span><span class="pygments-p">(</span><span class="pygments-n">expm_R_tcp</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-n">expm</span><span class="pygments-p">(</span><span class="pygments-n">cR2</span><span class="pygments-o">*</span><span class="pygments-n">tcp</span><span class="pygments-p">)),</span><span class="pygments-"> </span><span class="pygments-n">expm_R_tcp</span><span class="pygments-p">)<span class="Apple-tab-span" style="white-space:pre">	</span># This is the propagator for an element of delay tcp - 180degpulse -2 times delay tcp - 180degpulse - delay tau, i.e. for 2 times tau-180-tau</span><span class="pygments-"></span></td>
</tr>




<tr class="vc_row_odd" id="l92">
<td class="vc_file_line_number">92</td>

<td class="vc_file_line_text">
</td>
</tr>




<tr class="vc_row_odd" id="l93">
<td class="vc_file_line_number">93</td>

<td class="vc_file_line_text"><span class="pygments-">        </span><span class="pygments-n">prop_total</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">square_matrix_power</span><span class="pygments-p">(</span><span class="pygments-n">prop_2</span><span class="pygments-p">,</span><span class="pygments-"> </span><span class="pygments-n">cpmg_frqs</span><span class="pygments-p">[</span><span class="pygments-n">i</span><span class="pygments-p">]</span><span class="pygments-o">*</span><span class="pygments-n">tcpmg</span><span class="pygments-p">)<span class="Apple-tab-span" style="white-space:pre">	</span># Now create the total propagator, that will evolve the magnetization under the CPMG train, ie. it applies the above tau-180-tau-tau-180-tau so many times as required for the CPMG frequency under consideration.</span><span class="pygments-"></span></td>
</tr>




<tr class="vc_row_odd" id="l94">
<td class="vc_file_line_number">94</td>

<td class="vc_file_line_text">
</td>
</tr>




<tr class="vc_row_odd" id="l95">
<td class="vc_file_line_number">95</td>

<td class="vc_file_line_text"><span class="pygments-">        </span><span class="pygments-n">Moft</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">prop_total</span><span class="pygments-"> </span><span class="pygments-o">*</span><span class="pygments-"> </span><span class="pygments-n">M0<span class="Apple-tab-span" style="white-space:pre">		</span># now we apply the above propagator to the initial magnetization vector - resulting in the magnetization that remains after the full CPMG pulse train. It is called M of t (t is the time after the CPMG train</span><span class="pygments-"></span></td>
</tr>




<tr class="vc_row_odd" id="l96">
<td class="vc_file_line_number">96</td>

<td class="vc_file_line_text">
</td>
</tr>




<tr class="vc_row_odd" id="l97">
<td class="vc_file_line_number">97</td>

<td class="vc_file_line_text"><span class="pygments-">        </span><span class="pygments-n">Mgx</span><span class="pygments-"> </span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-n">Moft</span><span class="pygments-p">[</span><span class="pygments-mi">0</span><span class="pygments-p">]</span><span class="pygments-o">.</span><span class="pygments-n">real</span><span class="pygments-"> </span><span class="pygments-o">/</span><span class="pygments-"> </span><span class="pygments-n">M0</span><span class="pygments-p">[</span><span class="pygments-mi">0</span><span class="pygments-p">]<span class="Apple-tab-span" style="white-space:pre">	</span># This and the next line calculate the R2eff, using a two-point approximation, i.e. assuming that the decay is mono-exponential.</span><span class="pygments-"></span></td>
</tr>




<tr class="vc_row_odd" id="l98">
<td class="vc_file_line_number">98</td>

<td class="vc_file_line_text"><span class="pygments-">        </span><span class="pygments-n">back_calc</span><span class="pygments-p">[</span><span class="pygments-n">i</span><span class="pygments-p">]</span><span class="pygments-o">=</span><span class="pygments-"> </span><span class="pygments-o">-</span><span class="pygments-n">inv_tcpmg</span><span class="pygments-"> </span><span class="pygments-o">*</span><span class="pygments-"> </span><span class="pygments-n">log</span><span class="pygments-p">(</span><span class="pygments-n">Mgx</span><span class="pygments-p">)</span></td></tr></tbody></table><div><br></div></div><div><br></div><div>Thanks for the implementation!</div><div><br></div><div>Paul</div><div><br></div><div><div><div><br></div><div><br></div><blockquote type="cite">Hi Paul and Mathilde,<br><br>I have attached this file to the task report #7712<br>(<a rel="nofollow" href="https://gna.org/task/?7712">https://gna.org/task/?7712</a>) as a permanent reference<br>(<a rel="nofollow" href="https://gna.org/support/download.php?file_id=18263">https://gna.org/support/download.php?file_id=18263</a>). &nbsp;For new files<br>it would be appreciated if they were attached to this same task with<br>comments rather than sent to the public mailing list, as this avoids<br>unnecessary strain on the open source infrastructure, and does not<br>require a Gna! login. &nbsp;Cheers.<br><br>I have now added the parameter conversions in that file to the<br>func_ns_2site_star() function of the target_functions/relax_disp.py<br>file, instead of in the r2eff_ns_2site_star() function of<br>lib/dispersion/ns_2site_star.py. &nbsp;This is to minimise the mathematical<br>operations for faster code. &nbsp;You can see it in revision r20284. &nbsp;I may<br>do this for kex, IGeq, IEeq and M0 as well once the code is<br>functional. &nbsp;This will cause large speed ups if large clusters of<br>spins are used or data at many magnetic field strengths are collected.<br><br>I still have two problems - the 'fg' and 'tcpmg' parameters. &nbsp;Could<br>you explain these? &nbsp;I'm pretty sure I know what they are, but it would<br>be good to confirm. &nbsp;Another thing that would be nice to add to the<br>code in lib/dispersion/ns_2site_star.py would be a short description<br>of the matrices and what the operations are. &nbsp;I.e. a simple comment<br>for what each data structure is.<br><br>I have seen that the mpower() function is in this file, so I'll just<br>copy that directly somewhere into the relax library.<br><br>Regards,<br><br>Edward<br><br><br><br>On 12 July 2013 12:09, Paul Schanda &lt;<a rel="nofollow" href="mailto:paul.schanda@xxxxxx">paul.schanda@xxxxxx</a>&gt; wrote:<br><blockquote type="cite">Hi Edward,<br><br>I understand your point of fitting pA and kex instead of keg and kge (or<br>kAB/kBA).<br>Please find attached a program with the convention of kex and pB. The states<br>A and B are called G and E (ground/excited), so the parameters are generally<br>associated with E and G instead of A and B.<br><br><br><br>You will find in the attached program six different implementations, that<br>can be chosen with the variable a set to 1-6.<br>In practice, however, we are using only the "2D complex" numerical approach<br>(a=6), or the Maple-derived approach (a=5). The latter is faster, and is<br>most-often used. It has not been published, though.<br>The numerical Bloch-McConnell treatment is described in many introductory<br>NMR &nbsp;books, and also in e.g.<br>McConnell, H. J Chem Phys 1958, 28, 430–431. (the original reference)<br>Palmer, A. G. Chem Rev 2004, 104, 3623–3640.<br>Palmer, A. G.; Massi, F. Chem Rev 2006, 106, 1700–1719.<br>Baldwin, A. J.; Kay, L. E. J Biomol NMR 2013.<br>The latter two are R1rho, but the formalism of Bloch-McConnell is the same.<br><br>Paul<br><br><br><br>Hi Paul,<br><br>I have now implemented step 2 of the tutorial for adding relaxation<br>dispersion models<br>(<a rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.devel/3907">http://article.gmane.org/gmane.science.nmr.relax.devel/3907</a>, in the<br>commit r20277 at<br><a rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/18033">http://article.gmane.org/gmane.science.nmr.relax.scm/18033</a>). &nbsp;This is<br>one aspect that the relax user sees. &nbsp;I have assumed that 'dw' is a<br>parameter of this model - i.e. the Delta_omega chemical shift<br>difference between states A and B. &nbsp;But I am not sure if this is used<br>in your code and if it relates to the fg parameter. &nbsp;Would you know<br>the relationship?<br><br>Cheers,<br><br>Edward<br><br><br>On 11 July 2013 18:23, Edward d'Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt; wrote:<br><br>Hello,<br><br>Another question I have is what are the parameters of this model? &nbsp;It<br>relates to the function arguments currently labelled as unknown in the<br>function docstring. &nbsp;I would like to implement step 2 of the tutorial<br>on adding relaxation dispersion models to relax (the<br>relax_disp.select_model user function front end, see<br><a rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.devel/3907">http://article.gmane.org/gmane.science.nmr.relax.devel/3907</a>), but I'm<br>not sure how to list the parameters of the model for the user. &nbsp;Is<br>there a population parameter (pA or pB)? &nbsp;Are R2E and R2G the same as<br>the R20A and R20B rates (the R2 rates in the absence of exchange for<br>states A and B for a fixed magnetic field strength)?<br><br>Cheers,<br><br>Edward<br><br><br>On 11 July 2013 16:14, Edward d'Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt; wrote:<br><br>Hi Paul,<br><br>I have now incorporated this code into relax (see<br><a rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/18025">http://article.gmane.org/gmane.science.nmr.relax.scm/18025</a>). &nbsp;Could<br>you please check the code, comments, and docstrings carefully and see<br>if there are any issues? &nbsp;Could you also tell me if anyone else should<br>be included in the copyright notice? &nbsp;It would be useful to replace<br>the 'Unknown' elements in the function docstring with basic<br>descriptions of the parameter and its Python object type. &nbsp;And any<br>suggestions for comments describing in basic NMR terms what the code<br>is doing (the physics of the propagations, for example) would also be<br>appreciated.<br><br>You can get the new code by typing the following in the base directory<br>of the checked out copy of the relax_disp branch:<br><br>$ svn up<br><br>There was an indentation problem that I have tried to solve. &nbsp;Also I<br>cannot determine where the mpower() function comes from - it appears<br>not to be part of numpy or scipy. &nbsp;Is this an outside function you<br>wrote? &nbsp;I have also made a number of significant speed ups of the code<br>(see <a rel="nofollow" href="http://article.gmane.org/gmane.science.nmr.relax.scm/18029">article.gmane.org/gmane.science.nmr.relax.scm/18029</a>). &nbsp;Note that<br>this cannot be selected as a model in the dispersion analysis yet.<br><br>Cheers,<br><br>Edward<br><br><br><br><br>On 11 July 2013 13:47, Paul Schanda &lt;<a rel="nofollow" href="mailto:paul.schanda@xxxxxx">paul.schanda@xxxxxx</a>&gt; wrote:<br><br><br>Hi Edward,<br><br>Here is a function that does a numerical fit of CPMG. It uses an explicit<br>matrix that contains relaxation, exchange and chemical shift terms. It does<br>the 180deg pulses in the CPMG train with conjugate complex matrices.<br>It returns calculated R2eff values, so it can be used for numerical fitting<br>of CPMG.<br>It is an addition to the functions that I previously sent to you.<br>The approach of Bloch-McConnell can be found in chapter 3.1 of Palmer, A. G.<br>Chem Rev 2004, 104, 3623–3640.<br>I wrote this function (initially in MATLAB) in 2010.<br>I agree that this code is released under the GPL3 or higher licence.<br><br>Paul<br><br><br>def func1(R2E,R2G,fg,kge,keg, cpmgfreq,tcpmg):<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kex=kge+keg<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rcalc_array=np.zeros(len(cpmgfreq))<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rr &nbsp;= -1.*np.matrix([[R2G, 0.],[0., R2E]])<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rex = -1.*np.matrix([[kge,-keg],[-kge, keg]])<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RCS = complex(0.,-1.)*np.matrix([[0. ,0.],[0.,fg]])<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R = Rr + Rex + RCS<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cR = np.conj(R)<br><br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IGeq=keg/kex; IEeq=kge/kex<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M0=np.matrix([[IGeq],[IEeq]])<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for k in range(len(cpmgfreq)):<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcp=1./(4.*cpmgfreq[k])<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop_2<br>=np.dot(np.dot(sci.expm(R*tcp),sci.expm(cR*2.*tcp)),sci.expm(R*tcp))<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop_total =mpower(prop_2,cpmgfreq[k]*tcpmg)<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Moft = prop_total*M0<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mgx=Moft[0].real/M0[0]<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rcalc=-(1./tcpmg)*math.log(Mgx);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rcalc_array[k]=Rcalc<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Rcalc_array<br><br><br><br><br>_______________________________________________<br>relax (<a rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)<br><br>This is the relax-devel mailing list<br><a rel="nofollow" href="mailto:relax-devel@xxxxxxx">relax-devel@xxxxxxx</a><br><br>To unsubscribe from this list, get a password<br>reminder, or change your subscription options,<br>visit the list information page at<br>https://mail.gna.org/listinfo/relax-devel<br><br><br><br><br></blockquote></blockquote></div><br><div apple-content-edited="true">
<span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; "><span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium; "><span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Helvetica; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium; "><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div><br class="Apple-interchange-newline"><br></div><div>***************************</div><div><br></div><div>Paul Schanda</div><div><a rel="nofollow" href="mailto:paul.schanda@xxxxxx">paul.schanda@xxxxxx</a></div><div><br></div></div></span><br class="Apple-interchange-newline"></span><br class="Apple-interchange-newline"></span>
</div>
<br></div></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00032" href="msg00032.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00031" href="msg00031.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Paul Schanda</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00010" href="msg00010.html">numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Paul Schanda</li></ul></li>
<li><strong><a name="00011" href="msg00011.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00012" href="msg00012.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00017" href="msg00017.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00018" href="msg00018.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Paul Schanda</li></ul></li>
<li><strong><a name="00025" href="msg00025.html">Re: numerical cpmg fit</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jul 15 10:20:08 2013</div>  
</body>
</html>
