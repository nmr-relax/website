<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: r3245 &#45; /1.3/generic_fns/selection.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Fri, 30 Mar 2007 09:14:57 +0200 -->
<!--X-Message-Id: 7f080ed10703300014l79f918f1ie6c7b656503ef63f@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1HWxlQ&#45;0000ED&#45;Hw@subversion.gna.org -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r3245 - /1.3/generic_fns/selection.py -- March 30, 2007 - 09:14</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r3245 - /1.3/generic_fns/selection.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00164" class="tabs">Index by Date</a> | <a href="threads.html#00164" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00163.html">Date Prev</a>] [<a href="msg00165.html">Date Next</a>] [<a href="msg00175.html">Thread Prev</a>] [<a href="msg00168.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;c.a.macraild@xxxxxxxxxxx&quot; &lt;c.a.macraild@xxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 30 Mar 2007 17:14:14 +1000</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Dkim-signature</em>: a=rsa-sha1; c=relaxed/relaxed; d=gmail.com; s=beta;	h=domainkey-signature:received:received:message-id:date:from:sender:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references:x-google-sender-auth;	b=BXBhX5aPwdouz7I10YJesnPmulFyNQHw6v0JgLJyUChbP5bfNrX7kg7l0GhnmAqB2DQ+NGUnW1AMn1ZyZEsECEi32a0IzaP3ZMEpOGeQCFZPgOGut/1EuNCnBSVmsIdTdynXBHb8HXKn4nW7HBnJG0R8x1ScG1vtuYv4JXSWaic=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00164.html">7f080ed10703300014l79f918f1ie6c7b656503ef63f@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1HWxlQ-0000ED-Hw@subversion.gna.org&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on March 30, 2007 - 09:14:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,</pre><br>
<pre style="margin: 0em;">One other minor point is, would it be possible to rename 'selectObj'
to say 'select_obj' and 'selectString' to something like
'select_string' to keep with the relax conventions?  Also, could
docstrings be added to the Selection class methods so that it's usage
is fully described in the code and in the API documentation?  If you
haven't seen the epydoc docstring convention, all that is needed is to
follow the style of the docstrings of the other functions in that
module.</pre><br>
<pre style="margin: 0em;">Thanks,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<tt><br>On 3/30/07, c.a.macraild@xxxxxxxxxxx &lt;c.a.macraild@xxxxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">Author: macraild
Date: Thu Mar 29 18:46:15 2007
New Revision: 3245</pre><br>
<pre style="margin: 0em;">URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=3245&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=3245&amp;view=rev</a>
Log:
A proposal for a modified mol-res-spin selection mechanism.</pre><br>
<pre style="margin: 0em;">This simple modification, based on a selection object, permits
the use of booleans in selection strings, eg:</pre><br>
<pre style="margin: 0em;">':leu@xxxxxxx | :val@CG1,CG2'</pre><br>
<pre style="margin: 0em;">selects leucine and valine methyls.</pre><br>
<pre style="margin: 0em;">Also, modification of Selection.__contains__() will allow for
wildcards, regex, etc as desired.</pre><br>
<pre style="margin: 0em;"><br>Modified:
    1.3/generic_fns/selection.py</pre><br>
<pre style="margin: 0em;">Modified: 1.3/generic_fns/selection.py
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.3/generic_fns/selection.py?rev=3245&amp;r1=3244&amp;r2=3245&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.3/generic_fns/selection.py?rev=3245&amp;r1=3244&amp;r2=3245&amp;view=diff</a>
==============================================================================
--- 1.3/generic_fns/selection.py (original)
+++ 1.3/generic_fns/selection.py Thu Mar 29 18:46:15 2007
@@ -28,6 +28,7 @@</pre><br>
<pre style="margin: 0em;"> # relax module imports.
 from data import Data as relax_data_store
+from data.mol_res_spin import MoleculeContainer, ResidueContainer, 
SpinContainer
 from relax_errors import RelaxError, RelaxNoRunError, RelaxNoSequenceError, 
RelaxRegExpError, RelaxResSelectDisallowError, RelaxSpinSelectDisallowError</pre><br>
<pre style="margin: 0em;"><br>@@ -55,6 +56,67 @@
 id_string_doc = string</pre><br>
<pre style="margin: 0em;"><br>+
+class Selection(object):
+    &quot;&quot;&quot;An object containing mol-res-spin selections&quot;&quot;&quot;
+
+    def __init__(self, selectString):
+
+        self._union = None
+        self._intersect = None
+
+        self.molecules = None
+        self.residues = None
+        self.spins = None
+
+        if not selectString:
+            return
+
+        if '&amp;' in selectString:
+            and_split = selectString.split('&amp;')
+            part0 = Selection(and_split[0])
+            part1 = Selection(and_split[1])
+            return part0.intersection(part1)
+
+        elif '|' in selectString:
+            and_split = selectString.split('|')
+            part0 = Selection(and_split[0])
+            part1 = Selection(and_split[1])
+            return part0.union(part1)
+
+        else:
+            mol_token, res_token, spin_token = tokenise(selectString)
+            self.molecules = parse_token(mol_token)
+            self.residues = parse_token(res_token)
+            self.spins = parse_token(spin_token)
+
+    def __contains__(self, obj):
+
+        in_self = False
+        if isinstance(obj, MoleculeContainer) and obj.name in self.molecules:
+            in_self = True
+        elif isinstance(obj, ResidueContainer) and obj.name in self.residues:
+            in_self = True
+        elif isinstance(obj, SpinContainer) and obj.name in self.spins:
+            in_self = True
+        if self._union:
+            return in_self or (obj in self._union)
+        if self._intersect:
+            return in_self and (obj in self._union)
+        else:
+            return in_self
+
+    def intersection(self, selectObj):
+
+        if self._union or self._intersect:
+            raise RelaxError, &quot;Cannot define multiple Boolean relationships 
between Selection objects&quot;
+        self._intersect = selectObj
+
+    def union(self, selectObj):
+
+        if self._union or self._intersect:
+            raise RelaxError, &quot;Cannot define multiple Boolean relationships 
between Selection objects&quot;
+        self._union = selectObj</pre><br>
<pre style="margin: 0em;"><br> def desel_all(self, run=None):
@@ -216,22 +278,19 @@
     @rtype:             instance of the MoleculeContainer class.
     &quot;&quot;&quot;</pre><br>
<pre style="margin: 0em;">-    # Split up the selection string.
-    mol_token, res_token, spin_token = tokenise(selection)
+    # Parse the selection string.
+    selectObj = Selection(selection)</pre><br>
<pre style="margin: 0em;">     # Disallowed selections.
-    if res_token:
+    if selectObj.residues:
         raise RelaxResSelectDisallowError
-    if spin_token:
+    if selectObj.spins:
         raise RelaxSpinSelectDisallowError
-
-    # Parse the token.
-    molecules = parse_token(mol_token)</pre><br>
<pre style="margin: 0em;">     # Loop over the molecules.
     for mol in relax_data_store[relax_data_store.current_pipe].mol:
         # Skip the molecule if there is no match to the selection.
-        if mol_token and mol.name not in molecules:
+        if selectObj.molecules and mol.name not in selectObj:
             continue</pre><br>
<pre style="margin: 0em;">         # Yield the molecule data container.
@@ -320,27 +379,23 @@
     @rtype:             instance of the MoleculeContainer class.
     &quot;&quot;&quot;</pre><br>
<pre style="margin: 0em;">-    # Split up the selection string.
-    mol_token, res_token, spin_token = tokenise(selection)
-
+    # Parse the selection string.
+    selectObj = Selection(selection)
+
     # Disallowed selections.
-    if spin_token:
+    if selectObj.spins:
         raise RelaxSpinSelectDisallowError
-
-    # Parse the tokens.
-    molecules = parse_token(mol_token)
-    residues = parse_token(res_token)</pre><br>
<pre style="margin: 0em;">     # Loop over the molecules.
     for mol in relax_data_store[relax_data_store.current_pipe].mol:
         # Skip the molecule if there is no match to the selection.
-        if mol_token and mol.name not in molecules:
+        if selectObj.molecules and mol.name not in selectObj:
             continue</pre><br>
<pre style="margin: 0em;">         # Loop over the residues.
         for res in mol.res:
             # Skip the residue if there is no match to the selection.
-            if res_token and res.name not in residues:
+            if selectObj.residues and res.name not in selectObj:
                 continue</pre><br>
<pre style="margin: 0em;">             # Yield the residue data container.
@@ -575,30 +630,25 @@
     @rtype:             instance of the SpinContainer class.
     &quot;&quot;&quot;</pre><br>
<pre style="margin: 0em;">-    # Split up the selection string.
-    mol_token, res_token, spin_token = tokenise(selection)
-
-    # Parse the tokens.
-    molecules = parse_token(mol_token)
-    residues = parse_token(res_token)
-    spins = parse_token(spin_token)
+    # Parse the selection string.
+    selectObj = Selection(selection)</pre><br>
<pre style="margin: 0em;">     # Loop over the molecules.
     for mol in relax_data_store[relax_data_store.current_pipe].mol:
         # Skip the molecule if there is no match to the selection.
-        if mol_token and mol.name not in molecules:
+        if selectObj.molecules and mol.name not in selectObj:
             continue</pre><br>
<pre style="margin: 0em;">         # Loop over the residues.
         for res in mol.res:
             # Skip the residue if there is no match to the selection.
-            if res_token and res.name not in residues:
+            if selectObj.residues and res.name not in selectObj:
                 continue</pre><br>
<pre style="margin: 0em;">             # Loop over the spins.
             for spin in res.spin:
                 # Skip the spin if there is no match to the selection.
-                if spin_token and spin.name not in spins:
+                if selectObj.spins and spin.name not in selectObj:
                     continue</pre><br>
<pre style="margin: 0em;">                 # Yield the spin system data container.
@@ -697,3 +747,4 @@</pre><br>
<pre style="margin: 0em;">     # Return the three tokens.
     return mol_token, res_token, spin_token
+</pre><br>
<pre style="margin: 0em;"><br>_______________________________________________
relax (<a  href="http://nmr-relax.com">http://nmr-relax.com</a>)</pre><br>
<pre style="margin: 0em;">This is the relax-commits mailing list
relax-commits@xxxxxxx</pre><br>
<pre style="margin: 0em;">To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a></pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Mar 30 12:02:13 2007</div>  
</body>
</html>
