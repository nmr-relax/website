<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [sr #3045] Support for pooled standard deviation for: Peak	heights with partially replicated spectra -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Wed, 19 Jun 2013 17:11:01 +0200 -->
<!--X-Message-Id: CAED9pY9YDhOxzHYbSq0aoHcHLQRHmTvDE2jU+Nr1tHhF2E1+YQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20130619&#45;125008.sv20529.35603@gna.org -->
<!--X-Reference: CAED9pY8=EP6_M+GGqVP8_qpB_pf3cBZWT3rxXv_V4e_Po14_0g@mail.gmail.com -->
<!--X-Reference: CAED9pY_u=ZKv9EQFKfYx1_86o0cGLCwDnxEUHJTce_wZLD=F1A@mail.gmail.com -->
<!--X-Reference: CAED9pY&#45;ByTC6g1gdGXzvWYMrzAL7MBE28LOKKpH1UscOF1ELVg@mail.gmail.com -->
<!--X-Reference: CA+CBx2OH_27M1EUT_2TVx8xijkLryw5Evz&#45;w_aQk9zxrbZoRgA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sr #3045] Support for pooled standard deviation for: Peak	heights with partially replicated spectra -- June 19, 2013 - 17:11</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [sr #3045] Support for pooled standard deviation for: Peak	heights with partially replicated spectra</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00121" class="tabs">Index by Date</a> | <a href="threads.html#00121" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00120.html">Date Prev</a>] [<a href="msg00122.html">Date Next</a>] [<a href="msg00119.html">Thread Prev</a>] [Thread Next]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Wed, 19 Jun 2013 17:10:29 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:sender:in-reply-to:references:date	:x-google-sender-auth:message-id:subject:from:to:cc:content-type	:content-transfer-encoding;	bh=qSXVTyZ1UrVve6gpTXJsw5/l0kW39DnvuFx7X/ya954=;	b=cXbKsPmeTL44WEf5FW8l8uQNa9iGF0f5ysJDYUa3ST0CpruGnSAjKXh2uzxH9RZmMN	aPdp8udZxS7Ojy/lIhCOVcJK7ySRSqLwqdpvEwS+3dp7WXEARpwZ304XJ9aI1dA5RhEk	nlRW9TG21NqJ1CKlerEzDWX16eoiCQAEHrQZy08s5nQJZZVkREe8+gaHmwxYBkb7njez	V6823i7X9BCK90vfYeurS1L9CDi9De8T5rFQiu6Oown33V8DWXbsNJrEbP9ohcRoNpIR	24WVjTsFLwJi56gt4VoK/LvverewHcL+4kfr5YtUcsrcuJ1BgUPCDmcsiCMSalLbUP+m	/ooQ==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00121.html">CAED9pY9YDhOxzHYbSq0aoHcHLQRHmTvDE2jU+Nr1tHhF2E1+YQ@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;20130619-125008.sv20529.35603@xxxxxxx&gt;	&lt;CAED9pY8=EP6_M+GGqVP8_qpB_pf3cBZWT3rxXv_V4e_Po14_0g@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY_u=ZKv9EQFKfYx1_86o0cGLCwDnxEUHJTce_wZLD=F1A@xxxxxxxxxxxxxx&gt;	&lt;CAED9pY-ByTC6g1gdGXzvWYMrzAL7MBE28LOKKpH1UscOF1ELVg@xxxxxxxxxxxxxx&gt;	&lt;CA+CBx2OH_27M1EUT_2TVx8xijkLryw5Evz-w_aQk9zxrbZoRgA@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 19, 2013 - 17:11:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">In code, it is easier to use the pipe_control.mol_res_spin.spin_loop()
generator function to get each spin container.  Then you look at the
spin.intensities dictionary and pull out the elements you like.

However in this case of having the replicates [['0_2', '7_2', '14_2'],
['15_14', '16_14', '20_14'], ['3_30', '8_30', '17_30'], ['9_46',
'19_46', '22_46']], relax does not calculate 4 standard deviations for
a single peak and then average those 4 (via variance averaging) for
that one peak in isolation.  Instead relax will average the standard
deviation for all peaks for just the replicates ['0_2', '7_2',
'14_2'].  And then do this for the other 3.  Hence there will be 4
standard deviation values in total for all peak intensity data for all
spins.

The second averaging then comes into play in relax if you have spectra
without replicates.  This averaging will produce 1 SD value for
absolutely everything!

This is based on the fact that the statistics for a single peak, even
with the replicates [['0_2', '7_2', '14_2'], ['15_14', '16_14',
'20_14'], ['3_30', '8_30', '17_30'], ['9_46', '19_46', '22_46']], is
far too noisy and hence is a bad error estimate.  It is also based on
the fact that the peak height errors for all peaks should be roughly
equal to the RMSD of the baseplane noise.  The assumption that the
white noise of the baseplane maps directly to peak height is robust.
This was demonstrated by Art Palmer in his 1991 JACS paper, from
memory (distant memory so the reference may not be correct).  So, if
you can measure the baseplane RMSD accurately, measuring replicated
spectra is not necessary.

Some exceptions where peaks should not have the same height error is
in the presence of truncation artifacts or if there is overlap with a
small peak due to impurities in the sample.  But in these cases, the
problem is bias and not variance.  See
<a  rel="nofollow" href="http://scott.fortmann-roe.com/docs/BiasVariance.html">http://scott.fortmann-roe.com/docs/BiasVariance.html</a> for a great
description.  Therefore no amount of replicates can determine that
error (actually truncation artifacts introduce both bias and decrease
the variance).

I hope it is now clearer how relax handles the errors.

Regards,

Edward



On 19 June 2013 16:03, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Can we take an example?

Can I easily loop over
replicates, and extract intensity from just one spin?

cdp.replicates
[['0_2', '7_2', '14_2'], ['15_14', '16_14', '20_14'], ['3_30', '8_30',
'17_30'], ['9_46', '19_46', '22_46']]


Troels Emtekær Linnet


2013/6/19 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

And again I got it wrong :)  It's not the averaged variance divided by
k!  It's the sum of variances divided by k, i.e. the average variance.
 Therefore as all peaks are either duplicated, triplicated, etc., then
in all cases the pooled variances collapses down to the average
variance.  Therefore as I see it, the pooled variance for replicated
spectra is redundant.  Or am I wrong again?

Regards,

Edward



On 19 June 2013 15:27, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Just wait, I got that wrong!  First some definitions:

n = number of replicated spectra,
i = each spin system or peak,
k = total number of peaks.

The sum at the bottom of would mean that if n-1=1, then the
denominator would be a large sum.  As n-1 would be the same for all i,
then this becomes the averaged variance divided by k!  Therefore as
you have more and more peaks in the spectrum, the smaller and smaller
the estimator will be.  Taking this to the extreme, as you approach
infinite peaks in the spectrum, the error approaches zero.  That seems
absurd.  Maybe in this case, the unbiased estimator is absurd ;)  I
think I should read that 3rd link you posted.

Regards,

Edward




On 19 June 2013 15:15, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

I'm quite aware of this.  Another useful link is:

<a  rel="nofollow" href="http://en.wikipedia.org/wiki/Pooled_variance">http://en.wikipedia.org/wiki/Pooled_variance</a>

This has also been pointed out to me by Robert Schneider (but not on
the mailing lists).  I am wondering if it is worth it as the number of
users who would benefit are quite low.  The reason for this is that
most users will only have duplicate spectra.  Therefore n-1 ends up
being 1, as n is the number of replicated spectra, and this collapses
down to the currently used variance averaging.  In the case where you
have collected spectra in triplicate, then implementing this makes
sense.  But the number of people using relax with triplicate spectra
in the last 12 years is probably 1 or 2.  So it would be good to
implement this, but it's priority is very low.  In any case, both
averaged variances and pooled variances from a large collection of 2
point sets is horrible statistics, but that's all we've got.

Note also that there are two averaging steps.  The first is to average
the variance for all peaks in the spectrum.  The variance for a single
peak is the dirty estimate from 2 points.  Then if some spectra are
only measured once, then the variances for all spectra are averaged.

Regards,

Edward






On 19 June 2013 14:50, Troels E. Linnet
&lt;NO-REPLY.INVALID-ADDRESS@xxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">URL:
  &lt;<a  rel="nofollow" href="http://gna.org/support/?3045">http://gna.org/support/?3045</a>&gt;

                 Summary: Support for pooled standard deviation for:
Peak
heights with partially replicated spectra
                 Project: relax
            Submitted by: tlinnet
            Submitted on: Wed 19 Jun 2013 12:50:08 PM GMT
                Category: None
                Priority: 5 - Normal
                Severity: 3 - Normal
                  Status: None
                 Privacy: Public
             Assigned to: None
        Originator Email:
             Open/Closed: Open
         Discussion Lock: Any
        Operating System: None

    _______________________________________________________

Details:

According to the manual,
<a  rel="nofollow" href="http://www.nmr-relax.com/manual/spectrum_error_analysis.html">http://www.nmr-relax.com/manual/spectrum_error_analysis.html</a>,
the variance for the replicated datasets are averaged, and used as the
variance for single replicated spectrum.

This is a very reasonable assumption, but I wonder if a pooled
standard
deviation should be used instead.

If we look in the definition of IUPAC Gold Book:
<a  rel="nofollow" href="http://goldbook.iupac.org/P04758.html">http://goldbook.iupac.org/P04758.html</a>

&quot;&quot;&quot;
Results from various series of measurements can be combined in the
following
way to give a pooled relative standard deviation $s_{r,p}$:

$$
s_{r,p}=\sqrt{\frac{\sum(n_i-1)s_{r,i}^2}{\sum n_i -1}} =
\sqrt{\frac{\sum(n_i-1)s_i^2x_i^{-2}}{\sum n_i -1}}
$$
&quot;&quot;&quot;

It is not an easy subject, and the discussion can be &quot;hot&quot;: See for
example
these gals and gils:
<a  rel="nofollow" href="http://www.physicsforums.com/showthread.php?t=268377">http://www.physicsforums.com/showthread.php?t=268377</a>


So my question is, is the use of average of variances the right way to
estimate the variance for single recorded data point?
And should another way be implemented?




    _______________________________________________________

Reply to this item at:

  &lt;<a  rel="nofollow" href="http://gna.org/support/?3045">http://gna.org/support/?3045</a>&gt;

_______________________________________________
  Message sent via/by Gna!
  <a  rel="nofollow" href="http://gna.org/">http://gna.org/</a>


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00110" href="msg00110.html">[sr #3045] Support for pooled standard deviation for: Peak heights	with partially replicated spectra</a></strong>
<ul><li><em>From:</em> Troels E. Linnet</li></ul></li>
<li><strong><a name="00111" href="msg00111.html">Re: [sr #3045] Support for pooled standard deviation for: Peak	heights with partially replicated spectra</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00113" href="msg00113.html">Re: [sr #3045] Support for pooled standard deviation for: Peak	heights with partially replicated spectra</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00114" href="msg00114.html">Re: [sr #3045] Support for pooled standard deviation for: Peak	heights with partially replicated spectra</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00119" href="msg00119.html">Re: [sr #3045] Support for pooled standard deviation for: Peak	heights with partially replicated spectra</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Jun 19 19:40:10 2013</div>  
</body>
</html>
