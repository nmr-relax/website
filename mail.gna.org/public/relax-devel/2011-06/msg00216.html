<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: r13121 &#45; in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py -->
<!--X-From-R13: Vna Eha <unfhNaze.zcvocp.zct.qr> -->
<!--X-Date: Mon, 20 Jun 2011 11:37:58 +0200 -->
<!--X-Message-Id: A203F766&#45;2F63&#45;4F94&#45;B02F&#45;E268E3CA1EBF@nmr.mpibpc.mpg.de -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1QYZWC&#45;0005iI&#45;2k@subversion.gna.org -->
<!--X-Reference: BANLkTimcH_ZVcgU5+DJD_hAAqhS6gsaeiA@mail.gmail.com -->
<!--X-Reference: CBE4466A&#45;6B78&#45;42C1&#45;AD41&#45;B00D4A58EAB5@nmr.mpibpc.mpg.de -->
<!--X-Reference: BANLkTinerEyUsBVdSJMvj8NuG6KP+&#45;M_Fg@mail.gmail.com -->
<!--X-Reference: FD62042C&#45;E3D7&#45;4F6D&#45;A10B&#45;B3E8658ABEF8@nmr.mpibpc.mpg.de -->
<!--X-Reference: BANLkTikHHYJEymx5&#45;1GLJT+VH6OsgCDeEw@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r13121 - in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py -- June 20, 2011 - 11:37</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r13121 - in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00216" class="tabs">Index by Date</a> | <a href="threads.html#00216" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00215.html">Date Prev</a>] [<a href="msg00217.html">Date Next</a>] [<a href="msg00215.html">Thread Prev</a>] [<a href="msg00217.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 20 Jun 2011 11:39:17 +0200</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00216.html">A203F766-2F63-4F94-B02F-E268E3CA1EBF@nmr.mpibpc.mpg.de</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1QYZWC-0005iI-2k@xxxxxxxxxxxxxxxxxx&gt;	&lt;BANLkTimcH_ZVcgU5+DJD_hAAqhS6gsaeiA@xxxxxxxxxxxxxx&gt;	&lt;CBE4466A-6B78-42C1-AD41-B00D4A58EAB5@xxxxxxxxxxxxxxxxx&gt;	&lt;BANLkTinerEyUsBVdSJMvj8NuG6KP+-M_Fg@xxxxxxxxxxxxxx&gt;	&lt;FD62042C-E3D7-4F6D-A10B-B3E8658ABEF8@xxxxxxxxxxxxxxxxx&gt;	&lt;BANLkTikHHYJEymx5-1GLJT+VH6OsgCDeEw@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Han Sun</strong> on June 20, 2011 - 11:37:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>It is really hard to determine the correct connectivities for the  
</tt><tt>chemical compounds. If the two molecules are very close to each  
</tt><tt>other, then it is very probably to determine them wrong. Because  
</tt><tt>unlike the protein and DNA, in which you can only have the sp3 and  
</tt><tt>sp2 hybridization, you can have here from sp to sp3d2 hybridization.  
</tt><tt>Therefore the angles as criteria for determining the connectivities  
</tt><tt>can not be used. In my opinion, the only criteria is then the bond  
</tt><tt>length. But it will not be valid any more, if the two molecules are  
</tt><tt>close to each other. Therefore I think the easiest solution will be  
</tt><tt>to separate different molecules into different xyz files, if the  
</tt><tt>users can accept this.
</tt><pre style="margin: 0em;">

Best
Han

On Jun 20, 2011, at 11:27 AM, Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">
That might be something we have to look at after implementing this.
We can see how the current algorithm works.  And we need to work out
how useful it would be for organic chemists to be able to separate out
two molecules in an XYZ file (i.e. should we implement it, or wait
until a user asks for it).

Cheers,

Edward



On 20 June 2011 11:26, Han Sun &lt;hasu@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

</pre><tt>I think the viewers determine the connectivities from the bond  
</tt><tt>length. But I
</tt><pre style="margin: 0em;">
am not sure.

Han

On Jun 20, 2011, at 10:57 AM, Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi,

</pre><tt>Do you know how organic molecule viewers determine this?  Do they  
</tt><tt>try
</tt><pre style="margin: 0em;">
to work out the connectivity in the molecules?  The internal reader
has a very, very basic algorithm for connectivity.  See
__find_bonded_atoms() in generic_fns/structure/internal.py.  This
</pre><tt>might have to be improved for organic molecules, as my  
</tt><tt>assumptions are
</tt><pre style="margin: 0em;">
ok for standard biomolecules, but maybe do not hold for all organic
molecules.  So in reality, so we need to be able to determine 2
</pre><tt>molecules within one file using connectivities, or a lack of,  
</tt><tt>between
</tt><pre style="margin: 0em;">
two group of atoms?

Regards,

Edward


On 20 June 2011 10:48, Han Sun &lt;hasu@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Edward,

That is the problem. In the xyz file you can probably have several
</pre><tt>molecules, but you can not recognized that. There is no  
</tt><tt>parameter to
</tt><pre style="margin: 0em;">
define
the molecule or the residue like in the pdb file.

Best,
Han

On Jun 20, 2011, at 10:41 AM, Edward d'Auvergne wrote:

</pre><blockquote class="blockquote"><pre style="margin: 0em;">
Hi Han,

</pre><tt>It's now working, your ssh access :)  I was just wondering why  
</tt><tt>you had
</tt><pre style="margin: 0em;">
the statement:

if mol_index==0:

</pre><tt>This could be problematic if you have multiple molecules in the  
</tt><tt>XYZ
</tt><pre style="margin: 0em;">
file.  Is it possible to have more than one in the format?

Cheers,

Edward



On 20 June 2011 10:07,  &lt;hasu@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Author: han87
Date: Mon Jun 20 10:07:35 2011
New Revision: 13121

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=13121&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=13121&amp;view=rev</a>
Log:
</pre><tt>Debugging the user functions load_xyz() and  
</tt><tt>test_read_xyz_internal2().
</tt><pre style="margin: 0em;">

</pre><tt>The user functions load_xyz() in 'generic_fns/structure/ 
</tt><tt>internal.py'
</tt><pre style="margin: 0em;">
and
</pre><tt>test_read_xyz_internal2() in 'test_suite/system_tests/ 
</tt><tt>structure.py'
</tt><pre style="margin: 0em;">
have
been changed so that the molecule name can be read properly.

Modified:
 branches/xyz/generic_fns/structure/internal.py
 branches/xyz/test_suite/system_tests/structure.py

Modified: branches/xyz/generic_fns/structure/internal.py
URL:

</pre><tt><a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/xyz/generic_fns/">http://svn.gna.org/viewcvs/relax/branches/xyz/generic_fns/</a> 
</tt><tt>structure/internal.py?rev=13121&amp;r1=13120&amp;r2=13121&amp;view=diff
</tt><pre style="margin: 0em;">


</pre><tt>================================================================= 
</tt><tt>=============
</tt><pre style="margin: 0em;">
--- branches/xyz/generic_fns/structure/internal.py (original)
</pre><tt>+++ branches/xyz/generic_fns/structure/internal.py Mon Jun 20  
</tt><tt>10:07:35
</tt><pre style="margin: 0em;">
2011
@@ -853,8 +853,9 @@
          if set_mol_name:
              new_mol_name.append(set_mol_name[mol_index])
          else:
</pre><tt>-                # Set the name to the file name plus the  
</tt><tt>structure
</tt><pre style="margin: 0em;">
number.
-                new_mol_name.append(file_root(file) + '_mol' +
repr(mol_index))
+                if mol_index==0:
</pre><tt>+                   #Set the name to the file name plus the  
</tt><tt>structure
</tt><pre style="margin: 0em;">
number.
</pre><tt>+                   new_mol_name.append(file_root(file) +  
</tt><tt>'_mol' +
</tt><pre style="margin: 0em;">
repr(mol_index+1))

          # Store the original mol number.
          orig_mol_num.append(mol_index)
@@ -874,7 +875,8 @@

          # Increment the model index.
          model_index = model_index + 1
-
+
+        orig_mol_num=[0]
      # Create the structural data data structures.
      self.pack_structs(mol_conts, orig_model_num=orig_model_num,
set_model_num=set_model_num, orig_mol_num=orig_mol_num,
set_mol_name=new_mol_name, file_name=file, file_path=path)


Modified: branches/xyz/test_suite/system_tests/structure.py
URL:

</pre><tt><a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/xyz/test_suite/">http://svn.gna.org/viewcvs/relax/branches/xyz/test_suite/</a> 
</tt><tt>system_tests/structure.py?rev=13121&amp;r1=13120&amp;r2=13121&amp;view=diff
</tt><pre style="margin: 0em;">


</pre><tt>================================================================= 
</tt><tt>=============
</tt><pre style="margin: 0em;">
--- branches/xyz/test_suite/system_tests/structure.py (original)
+++ branches/xyz/test_suite/system_tests/structure.py Mon Jun 20
10:07:35
2011
@@ -659,10 +659,10 @@

</pre><tt> self.interpreter.structure.read_xyz(file='SSS-cluster4-new- 
</tt><tt>test.xyz',
</tt><pre style="margin: 0em;">
dir=path)

      # Test the molecule name.
-
</pre><tt> self.assertEqual(cdp.structure.structural_data[0].mol 
</tt><tt>[0].mol_name,
</tt><pre style="margin: 0em;">
'SSS-cluster4-new-test')
+
</pre><tt> self.assertEqual(cdp.structure.structural_data[0].mol 
</tt><tt>[0].mol_name,
</tt><pre style="margin: 0em;">
'SSS-cluster4-new-test_mol1')

      # Load a single atom and test it.
-
</pre><tt> self.interpreter.structure.load_spins('SSS-cluster4-new-test: 
</tt><tt>3@C')
</tt><pre style="margin: 0em;">
+
</pre><tt> self.interpreter.structure.load_spins('SSS-cluster4-new- 
</tt><tt>test_mol1:@C')
</tt><pre style="margin: 0em;">
      self.assertEqual(count_spins(), 1)

      # Try loading a few protons.


_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>

</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre></blockquote></blockquote><pre style="margin: 0em;">



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00217" href="msg00217.html">Re: r13121 - in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00211" href="msg00211.html">Re: r13121 - in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00212" href="msg00212.html">Re: r13121 - in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py</a></strong>
<ul><li><em>From:</em> Han Sun</li></ul></li>
<li><strong><a name="00213" href="msg00213.html">Re: r13121 - in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00214" href="msg00214.html">Re: r13121 - in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py</a></strong>
<ul><li><em>From:</em> Han Sun</li></ul></li>
<li><strong><a name="00215" href="msg00215.html">Re: r13121 - in /branches/xyz: generic_fns/structure/internal.py	test_suite/system_tests/structure.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jun 20 12:20:12 2011</div>  
</body>
</html>
