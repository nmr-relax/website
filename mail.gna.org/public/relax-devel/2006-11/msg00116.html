<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [Bug #7544] Incorrect nucleus names in results -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneq.qnhiretarNtznvy.pbz> -->
<!--X-Date: Thu, 09 Nov 2006 10:29:30 +0100 -->
<!--X-Message-Id: 7f080ed10611090128j4b74e1bfl4843b7fd78e0cad4@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 481156b20611081032i1ebb3700g5b4b64ef88366af3@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [Bug #7544] Incorrect nucleus names in results -- November 09, 2006 - 10:29</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: [Bug #7544] Incorrect nucleus names in results</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00116" class="tabs">Index by Date</a> | <a href="threads.html#00116" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00115.html">Date Prev</a>] [<a href="msg00117.html">Date Next</a>] [<a href="msg00106.html">Thread Prev</a>] [<a href="msg00124.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Alexandar Hansen&quot; &lt;viochemist@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Thu, 9 Nov 2006 20:28:52 +1100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00116.html">7f080ed10611090128j4b74e1bfl4843b7fd78e0cad4@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00106.html">481156b20611081032i1ebb3700g5b4b64ef88366af3@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on November 09, 2006 - 10:29:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>On 11/9/06, Alexandar Hansen &lt;viochemist@xxxxxxxxx&gt; wrote:
</tt><blockquote class="blockquote"><pre style="margin: 0em;">Hi,</pre><br>
<pre style="margin: 0em;">So, I'm attempting this model_free.py fix, but I don't think it's as
straightforward as you say.  My first thought was that the nucleus and pdb
reads were only occuring once before the data loop and, since there's more
than one nucleus/residue type, that should be included in the loop.
Therefore, I copied this:</pre><br>
<pre style="margin: 0em;">        # Nucleus.
            nucleus =
self.relax.generic.nuclei.find_nucleus()</pre><br>
<pre style="margin: 0em;">        # PDB.
            pdb = None
            pdb_model = None
            pdb_heteronuc = None
            pdb_proton = None
            if self.relax.data.pdb.has_key(self.run):
                pdb = self.relax.data.pdb[self.run].file_name
                pdb_model = self.relax.data.pdb[self.run].model
                pdb_heteronuc = self.relax.data.pdb[self.run].heteronuc
                pdb_proton = self.relax.data.pdb[self.run].proton</pre><br>
<tt>Into the 'Loop over the sequence' but this didn't work.
</tt></blockquote><pre style="margin: 0em;"><br>You are on the right track.  However you only need to move the
'pdb_heteronuc' and 'pdb_proton' parts into the loop.  The 'pdb' file
and 'pdb_model' will be the same for all spins.  As for the 'nucleus'
values, these are not yet associated with specific spins.  The
'nuclei()' user function just sets one nucleus type for that run,
hence you can't currently analyse both carbon and nitrogen
simultaneously.  This will be fixed when the redesign of the relax
data model occurs.</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;"> I then manually
read in my pdb and executed some pdb.read and pdb.vector commands to see
what those lines are reading and confirmed that pdb.read() doesn't import
anything about protons or heteronuclei.  Those are only assigned with the
pdb.vectors() lines in full_analysis.py.  Now, you had suggested that, for
me to read in multiple nuclei, I should load the pdb like this:</pre><br>
<pre style="margin: 0em;">                # Load the PDB file.
                pdb.read(name,'my_pdb.pdb')
                pdb.vectors(name, heteronuc='N1', proton='H1', res_name='G')
                pdb.vectors(name, heteronuc='N3', proton='H3', res_name='U')</pre><br>
<pre style="margin: 0em;">While I believe this does read in the different vector types, it ulimately
assignes heteronuc to 'N3' and proton to 'H3', writing over the first vector
call.  Is there another place to pull the nucleus information from for a
given row of input data?
</pre></blockquote><pre style="margin: 0em;"><br>Since I made those changes to the 'pdb.vectors()' user function to
allow different nuclei names, relax is now placing the information
into the residue specific data structure 'self.relax.data.res[run]'.
If you probe around in there you will find the proton and
heteronucleus names.</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">Can I call the nucleus straight from the input
data?  How can I be sure that pdb.vectors are matching everything up
correctly in calculating relaxation?  Where is the list of pdb.vectors
stored?  What information is stored with each pdb vector (orientation, bond
length, nuclei, etc.)?  Sorry for all of the remedial questions.
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">As the proton and heteronucleus names are permanently stored in
'self.relax.data.res[run]', there is no need to read the values from
the input data.  If you probe around in there, you should see the
following data structures:</pre><br>
<pre style="margin: 0em;">   proton
   heteronuc
   xh_vect</pre><br>
<pre style="margin: 0em;">The 'xh_vect' is a unit vector parallel to the XH bond.  It's length
from the PDB is essentially meaningless as it is dependent on which
computer program generated the structure or added the protons later.</pre><br>
<pre style="margin: 0em;">Doh!  I've had a look at the 1.3 line code and have realised that I
haven't placed the proton and heteronuc names into
'self.relax.data.res[run]'!  That will cause complications.  This will
be done before I even send this message.  Ok, it's done (see r2792 at
<a  href="https://mail.gna.org/public/relax-commits/2006-11/msg00090.html">https://mail.gna.org/public/relax-commits/2006-11/msg00090.html</a>).</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">As for read_xxxxx, will this be read_columnar_results or one of the other
read_columnar functions?  Thanks for all of the help.
</pre></blockquote><pre style="margin: 0em;"><br>The main driving function here is 'self.read_columnar_results()'.
Fixing up the reading code will be a little more difficult.  The best
option would probably be to modify the function 'self.
read_columnar_xh_vect()' to set the proton and heteronucleus names the
same way as the 'pdb.vectors()' user function does (by calling the
function 'self.relax.generic.pdb.vectors()').  This could be done by
mimicking the code already in that function.</pre><br>
<pre style="margin: 0em;">Thank you for helping to resolve these issues,</pre><br>
<pre style="margin: 0em;">Edward</pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00124" href="msg00124.html">Re: [Bug #7544] Incorrect nucleus names in results</a></strong>
<ul><li><em>From:</em> Alexandar Hansen</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00106" href="msg00106.html">[Bug #7544] Incorrect nucleus names in results</a></strong>
<ul><li><em>From:</em> Alexandar Hansen</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Thu Nov 09 16:20:25 2006</div>  
</body>
</html>
