<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Numerical integration of the Bloch&#45;McConnell equations for the	relaxation dispersion analysis in relax. -->
<!--X-From-R13: Febryf Szgrxæe Zvaarg <gyvaargNtznvy.pbz> -->
<!--X-Date: Fri, 12 Jul 2013 09:55:30 +0200 -->
<!--X-Message-Id: CA+CBx2P__DLYjUGSMGSVkRf6tDdarVtsdYZEuE3SZsrORLgbiw@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: CAED9pY&#45;geVxWf=PBv6g&#45;7gDjfKKmHni3LGBjCNMLQ88_Ecy9XQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax. -- July 12, 2013 - 09:55</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax.</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00015" class="tabs">Index by Date</a> | <a href="threads.html#00015" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00014.html">Date Prev</a>] [<a href="msg00016.html">Date Next</a>] [<a href="msg00009.html">Thread Prev</a>] [<a href="msg00021.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Edward d'Auvergne&quot; &lt;edward@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Fri, 12 Jul 2013 09:54:39 +0200</li>
<li class="menuitem">
<em>Cc</em>: Dominique Marion &lt;Dominique.Marion@xxxxxx&gt;,	Sébastien M &lt;sebastien@xxxxxxxxxxxxx&gt;,	mathilde lescanne &lt;mathilde.lescanne@xxxxxx&gt;,	&quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;,	Paul Schanda &lt;paul.schanda@xxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:in-reply-to:references:from:date:message-id:subject:to	:cc:content-type;	bh=/HJ+AFevpBie/u2GakENyEtjMwcDkZThx2P26mumF+c=;	b=kEDmBuUxo/e9fEkj0J7b7/AHhIemhjYDOLHE4wGjcHZyXMFq85HBBjw9ZrkbV4E4Zk	DaQhPXR+B+H9kl2jsn4RO4+IqyQdegksV9l6rj/mkZgWw5Y+DNZgg5ifh2luoF63ZgPu	cy8NRKfCF6UciclaC7EmnPAsVTxs3hbzV63yUKgYP+St6ahj+5V4PCi8l/kSOFjOBPWg	KzHDJpRTzGwlbMfhkvYnEj+UZ/99WAZy/cna6axn7wm8zfcSRnCr/eA2SrvE4EBWmzDC	HeBSDcDNd5x/NEXS7T+PAhvYT9l1lV8pxS8I0sJfHlngYCpO3XfSZTcb47d8gcs38EWu	n7Wg==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00015.html">CA+CBx2P__DLYjUGSMGSVkRf6tDdarVtsdYZEuE3SZsrORLgbiw@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;CAED9pY-geVxWf=PBv6g-7gDjfKKmHni3LGBjCNMLQ88_Ecy9XQ@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Troels Emtekær Linnet</strong> on July 12, 2013 - 09:55:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi.<br><br>Very interesting with Numerical integration of the Bloch-McConnell equations !<br><br>Regarding plotting.<br><br>I find it very usefull, that xmgrace plots are produced during analysis and the<br>graphs are exported as stand-alone files, so it not necessary to open relax to view the files.<br>

I have never used xmgrace before, but only gnuplot. But it seems that the GUI for<br>xmgrace is a little more intuitive. And they kind-of do the same things.<br>With the latest tweak that plots are also exported to png files, I can quickly go<br>

through 100 residues in my folder, and modify a single residue without opening<br>the saved data. That&#39;s good.<br>But it is not good, that I probably sometimes would need to combine some data into<div>one graph. With the current solution, this is not easily done.<br>

<br>Regarding matplotlib.<br>I am in favor of matplotlib, because it is a plotting language that I understand (python)<br>and I can re-use old plot code, to get the graph I like.<br>And it is in development.<br><br>As relax are now, one should be able to make an external &quot;plot file&quot;.</div>

<div>And then run the commands via: User functions (n-z) -&gt; script<br>That is how I load my data in. I write a script file, open relax gui, and run the script.</div><div><br></div><div>In the file, one import matplotlib and write some line to extract data from the the current data pipe &quot;cdp&quot;.<br>

For example data for 1-3 residues.<br><br>I am still looking into, how to extract relevant data from the data pipe.<br><a rel="nofollow" href="http://nmr-relax.kimlinnet.dk/index.php?title=Category:List_objects">http://nmr-relax.kimlinnet.dk/index.php?title=Category:List_objects</a><br>

<br>And then just write some matplotlib commands to plot it.<br><br>For a future user friendly GUI solution, I imagine a menu where one can select some template</div><div>matplotlib functions. Then modify them in a wxpython text editor or OS editor, </div>

<div>and then save them in the relax folder, or in $HOME/.relax/xxx</div><div>or in the current working directory. And then of course push a &quot;execute&quot; button.</div><div><br></div><div>Another possibility would also just be, to have a matplotlib script collection on the wiki.</div>

<div><br></div><div>Best</div><div>Troels Emtekær Linnet<br><br><br>2013/7/11 Edward d&#39;Auvergne &lt;<a rel="nofollow" href="mailto:edward@xxxxxxxxxxxxx">edward@xxxxxxxxxxxxx</a>&gt;<br>&gt;<br>&gt; Hi Paul,<br>&gt;<br>&gt; Thank you for the code contribution!  First of all, I have to<br>

&gt; apologise for the length of this email.  I have tried to be as<br>&gt; comprehensive as possible.<br>&gt;<br>&gt; I have attached the ZIP file to the relax task #7712<br>&gt; (<a rel="nofollow" href="https://web.archive.org/web/https://gna.org/task/?7712">https://gna.org/task/?7712</a>).  Note that I have added the [relax-devel<br>

&gt; att gna dot org] mailing list to the CC list to bring this out into<br>&gt; the public - it will be permanently archived in multiple locations<br>&gt; (see <a rel="nofollow" href="http://news.gmane.org/gmane.science.nmr.relax.devel">http://news.gmane.org/gmane.science.nmr.relax.devel</a>,<br>

&gt; <a rel="nofollow" href="http://www.mail-archive.com/relax-devel@xxxxxxx/">http://www.mail-archive.com/relax-devel@xxxxxxx/</a>,<br>&gt; <a rel="nofollow" href="http://www.nmr-relax.com/mail.gna.org/public/relax-devel/">https://mail.gna.org/public/relax-devel/</a>,<br>

&gt; <a rel="nofollow" href="http://marc.info/?l=relax-devel&amp;r=1&amp;w=2">http://marc.info/?l=relax-devel&amp;r=1&amp;w=2</a>).  This is necessary as relax<br>&gt; is an open source project where, without exception, all development<br>

&gt; occurs in public.  It is supported by a number of developers, though<br>&gt; many are now inactive<br>&gt; (<a rel="nofollow" href="https://gna.org/project/memberlist.php?group=relax">https://gna.org/project/memberlist.php?group=relax</a>).  Anyone is free<br>

&gt; to become a relax developer and advance the project for their own<br>&gt; needs/papers (<a rel="nofollow" href="http://www.nmr-relax.com/manual/relax_development.html">http://www.nmr-relax.com/manual/relax_development.html</a>).<br>

&gt;<br>&gt; Below I will address each of your points.  But first, and most<br>&gt; importantly, we need to address the copyright issue.  For the code to<br>&gt; be added to relax, each person who has contributed code to the<br>

&gt; fitting_main.py file and the original MATLAB scripts needs to<br>&gt; communicate in public, by having a message permanently archived on the<br>&gt; [relax-devel att gna dot org] mailing list, that they agree to have<br>

&gt; their code licenced under the Gnu Public Licence version 3 or higher<br>&gt; (GPL3+).  This does not prevent the author placing their code under a<br>&gt; different copyright licence.  But this is only their code, and the<br>

&gt; code which was released under the GPL3 licence can never be retracted.<br>&gt;  For details, see <a rel="nofollow" href="http://gplv3.fsf.org/">http://gplv3.fsf.org/</a>,<br>&gt; <a rel="nofollow" href="http://www.gnu.org/licenses/gpl-3.0.html">http://www.gnu.org/licenses/gpl-3.0.html</a>, or the docs/COPYING file<br>

&gt; that comes with relax.  I will add a copyright statement to each file<br>&gt; produced, and it will look like the start of<br>&gt; <a rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/consistency_tests.py?view=markup">http://svn.gna.org/viewcvs/relax/trunk/test_suite/system_tests/consistency_tests.py?view=markup</a>.<br>

&gt;  There will be one line for each author.  This consists of the years<br>&gt; the author wrote code, the full author name, and maybe a contact email<br>&gt; address.  This would also include all authors of the original MATLAB<br>

&gt; scripts.<br>&gt;<br>&gt; For reference, an archived message thread on this development is:<br>&gt;<br>&gt; <a rel="nofollow" href="http://thread.gmane.org/gmane.science.nmr.relax.devel/3790">http://thread.gmane.org/gmane.science.nmr.relax.devel/3790</a><br>

&gt;<br>&gt; Also for reference is the history of relaxation dispersion in relax.<br>&gt; Development is happening in a relax branch rather than the main<br>&gt; development line.  Therefore it will not be included in an official<br>

&gt; relax release until the branch is completed and merged back.  The<br>&gt; branch was started by Sébastien Morin who contributed much of the<br>&gt; infrastructure back in 2009.  I recently ported it to the newest relax<br>

&gt; code base and significantly expanded its capabilities for my own<br>&gt; needs.  Troels Linnet is also working on this branch for his own paper<br>&gt; and needs, and is advancing towards becoming a full relax developer.<br>

&gt;<br>&gt; Now, to the mail:<br>&gt;<br>&gt;<br>&gt; On 9 July 2013 08:16, Paul Schanda &lt;<a rel="nofollow" href="mailto:paul.schanda@xxxxxx">paul.schanda@xxxxxx</a>&gt; wrote:<br>&gt; &gt; Hi Edward,<br>&gt; &gt;<br>&gt; &gt; As promised, I am sending you in the attachment the python functions that we<br>

&gt; &gt; are using for fitting CPMG data, that was written essentially by Mathilde<br>&gt; &gt; Lescanne and Dominique Marion, based on my MATLAB scripts.<br>&gt;<br>&gt; Thank you.  As discussed at the IBS in Grenoble two weeks ago, this<br>

&gt; could one day also be incorporated into the NESSY project<br>&gt; (<a rel="nofollow" href="http://home.gna.org/nessy/">http://home.gna.org/nessy/</a>).  However that project is in a frozen<br>&gt; state so it would require a significant commitment by a dedicated<br>

&gt; developer for this to happen.<br>&gt;<br>&gt; Also, the code is in a state whereby it can be directly copied and<br>&gt; pasted into relax modules.  Only small modifications will be<br>&gt; necessary.  This includes adding docstrings<br>

&gt; (<a rel="nofollow" href="http://www.python.org/dev/peps/pep-0257/">http://www.python.org/dev/peps/pep-0257/</a>) using the Epydoc format<br>&gt; (<a rel="nofollow" href="http://epydoc.sourceforge.net/">http://epydoc.sourceforge.net/</a>,<br>&gt; <a rel="nofollow" href="http://epydoc.sourceforge.net/epytext.html">http://epydoc.sourceforge.net/epytext.html</a>) for the relax API<br>

&gt; documentation (<a rel="nofollow" href="http://www.nmr-relax.com/api/">http://www.nmr-relax.com/api/</a>).  I will also add lots<br>&gt; of comments as the relax coding style requires ~15 to 30% of comment<br>&gt; lines, simply to make it easier for non-coders to understand the code<br>

&gt; (<a rel="nofollow" href="http://www.nmr-relax.com/manual/Comments.html">http://www.nmr-relax.com/manual/Comments.html</a>).  I may ask you,<br>&gt; Mathilde, about these comments later.<br>&gt;<br>&gt;<br>&gt; &gt; In principle, the fit program should directly work as it is, and generate<br>

&gt; &gt; plots automatically. (using Matplotlib! I would strongly recommend that<br>&gt; &gt; relax also uses matplotlib. Creating plots exclusively outside of python is<br>&gt; &gt; a pain in the neck, and only useful for writing a paper, which is the step<br>

&gt; &gt; that one does after having looked at tons of figures...)<br>&gt;<br>&gt; As I mentioned, Troels Linnet is also interested in Matplotlib as he<br>&gt; has used that in his own dispersion scripts.  Matplotlib support would<br>

&gt; be quite useful and is welcome.  But it is also limited compared to<br>&gt; the capabilities of Grace.  But the main point with matplotlib support<br>&gt; would be that it be added as an optional dependency.  For the<br>

&gt; automated relaxation dispersion analysis in relax, matplotlib plots<br>&gt; can be created when the Python package is present.  We should probably<br>&gt; discuss this in a different thread.<br>&gt;<br>&gt;<br>&gt; &gt; You will find five different versions of fitting CPMG data. In fact we only<br>

&gt; &gt; use two of them, namely an explicit numerical Bloch-McConnell treatment that<br>&gt; &gt; works for perfect 180deg pulses, and a Maple-derived solution of the<br>&gt; &gt; Bloch-McConnell treatment. The latter is numerically exact and in practice<br>

&gt; &gt; the most useful version. It is being used by some of the Kay-(ex-)postdocs.<br>&gt;<br>&gt; These, I assume, are the functions returned by MakeFunction() when the<br>&gt; a argument is set to 1 and 5 respectively.  Would you have the primary<br>

&gt; references for these two with DOI numbers?  This is important for the<br>&gt; relax documentation (both the user manual and in the user function<br>&gt; documentation).<br>&gt;<br>&gt;<br>&gt; &gt; The script allows to fit multiple residues and multiple fields at the same<br>

&gt; &gt; time. This is all controlled via a Excel spreadsheet, where the user can put<br>&gt; &gt; the information. In relax you would do this differently, in a GUI, but the<br>&gt; &gt; logic would stay pretty much the same. The script uses a python package for<br>

&gt; &gt; handling Excel files; you may need to install it.<br>&gt;<br>&gt; For relax, the details in the Excel spreadsheet would either be placed<br>&gt; directly into a script (for the script UI) or manually input via the<br>

&gt; GUI.  relax supports all of these options, though in the automated<br>&gt; analysis it is run a little differently.  You directly define spin<br>&gt; clusters.  Then all spin clusters as well as free spins are optimised<br>

&gt; to all selected dispersion models simultaneously.  You are however<br>&gt; free to create a non-automated, custom analysis in a script whereby<br>&gt; you can do whatever you wish.  relax is designed with flexibility in<br>

&gt; mind and allows you to do anything you wish (and if that doesn&#39;t work,<br>&gt; then it should be considered as a bug).<br>&gt;<br>&gt;<br>&gt; &gt; If you could incorporate this into relax it would be great.<br>
&gt;<br>
&gt; Once the copyright issues are sorted out and there are responses from<br>&gt; all involved, I could then incorporate this quite quickly into relax.<br>&gt; It will only be a few hours of work - mainly due to the documentation.<br>

&gt;  So having as much detail as possible about these numerical models<br>&gt; makes my life much easier.  See the user manual (you need to compile<br>&gt; it yourself) and relax_disp.select_model user function for how this<br>

&gt; documentation is currently set up.<br>&gt;<br>&gt;<br>&gt; &gt; I would also<br>&gt; &gt; greatly appreciate if you could help us getting relax to run. Our interest<br>&gt; &gt; in sending this stuff to you is that we would like to have an environment<br>

&gt; &gt; where the data handling (input, output) is done properly, but which<br>&gt; &gt; basically does the fitting that we would like to do (Bloch-McConnell).<br>&gt;<br>&gt; For the installing the relaxation dispersion branch, Troels has<br>

&gt; created a very useful tutorial:<br>&gt;<br>&gt; <a rel="nofollow" href="http://wiki.nmr-relax.com/index.php?title=Installation_linux">http://wiki.nmr-relax.com/index.php?title=Installation_linux</a><br>&gt;<br>&gt; This includes instructions for building the relax user manual (this<br>

&gt; requires LaTeX).  Note that this wiki is still in a state of being set<br>&gt; up, so user creation and page editing is not yet fully functional.<br>&gt;<br>&gt;<br>&gt; &gt; As said, it would be really great to have the program create plots<br>

&gt; &gt; automatically. I don&#39;t want to use xmgrace for generating plots, or at least<br>&gt; &gt; not if I just want to get a quick overview of the fits. Could you please<br>&gt; &gt; have a look how complicated it would be to include matplotlib-plotting into<br>

&gt; &gt; relax?<br>&gt;<br>&gt; The complication is only deciding at which level this would be added.<br>&gt; For example the R2eff/R1rho plots are currently created by the<br>&gt; relax_disp.plot_disp_curves user function after a given dispersion<br>

&gt; model has been optimised for all spin clusters and free spins (and<br>&gt; Monte Carlo simulations have been performed).  This could simply be<br>&gt; modified by adding an argument for selecting the graph type (set to<br>

&gt; either &#39;grace&#39; or &#39;matplotlib&#39;).  If this is added, then in the<br>&gt; auto-analysis I would enable both.  For this, ideas can be taken from<br>&gt; the fitting_main.py script, from Troels&#39; scripts, and from NESSY&#39;s<br>

&gt; matplotlib plotting.<br>&gt;<br>&gt; On another level, there are the grace.view and grace.write user<br>&gt; functions.  These are used for plotting all of the other parameters.<br>&gt; If there is interest, then this code could be copied and modified to<br>

&gt; the matplotlib.view and matplotlib.write user functions.<br>&gt;<br>&gt; Troels, what do you think?<br>&gt;<br>&gt; Note that, although Grace and OpenDX are the current ways of viewing<br>&gt; 2D and 3D plots, the relax design is not exclusive to these softwares<br>

&gt; and allows other plotting capabilities to be relatively easily added<br>&gt; by anyone with interest.  Matplotlib, Gnuplot, SigmaPlot, Octave<br>&gt; (which uses Gnuplot), MATLAB, and Mathematica have all been considered<br>

&gt; at some point as a plotting output from relax.  Though most<br>&gt; users/developers found Grace sufficient so these were never<br>&gt; implemented due to a lack of interest.<br>&gt;<br>&gt;<br>&gt; &gt; Please let me know if you need any further information.<br>

&gt;<br>&gt; We&#39;ll see what is needed as things progress.<br>&gt;<br>&gt; Cheers,<br>&gt;<br>&gt; Edward<br>&gt;<br>&gt;<br>&gt; &gt;<br>&gt; &gt; best -<br>&gt; &gt;<br>&gt; &gt;<br>&gt; &gt; Paul<br>&gt; &gt;<br>&gt; &gt;<br>

&gt; &gt;<br>&gt; &gt; --<br>&gt; &gt; Paul Schanda, Ph.D.<br>&gt; &gt; Biomolecular NMR group<br>&gt; &gt; Institut de Biologie Structurale Jean-Pierre Ebel (IBS)<br>&gt; &gt; 41, rue Jules Horowitz<br>&gt; &gt; F-38027 Grenoble<br>

&gt; &gt; France<br>&gt; &gt; +33 438 78 95 55<br>&gt; &gt; <a rel="nofollow" href="mailto:paul.schanda@xxxxxx">paul.schanda@xxxxxx</a><br>&gt; &gt; <a rel="nofollow" href="http://www.ibs.fr/groups/biomolecular-nmr-spectroscopy?lang=en">http://www.ibs.fr/groups/biomolecular-nmr-spectroscopy?lang=en</a><br>

</div>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00021" href="msg00021.html">Re: Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00009" href="msg00009.html">Numerical integration of the Bloch-McConnell equations for the	relaxation dispersion analysis in relax.</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Jul 12 16:00:08 2013</div>  
</body>
</html>
