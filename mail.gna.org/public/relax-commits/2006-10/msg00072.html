<!-- MHonArc v2.6.10 -->
<!--X-Subject: r2640 &#45; /1.2/sconstruct -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Fri, 13 Oct 2006 07:44:31 +0200 -->
<!--X-Message-Id: E1GYFpw&#45;0002RX&#45;Tq@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r2640 - /1.2/sconstruct -- October 13, 2006 - 07:44</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r2640 - /1.2/sconstruct</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00072" class="tabs">Index by Date</a> | <a href="threads.html#00072" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00071.html">Date Prev</a>] [<a href="msg00073.html">Date Next</a>] [<a href="msg00071.html">Thread Prev</a>] [<a href="msg00073.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Fri, 13 Oct 2006 05:44:00 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00072.html">E1GYFpw-0002RX-Tq@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on October 13, 2006 - 07:44:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Fri Oct 13 07:43:59 2006
New Revision: 2640

URL: <a  href="http://svn.gna.org/viewcvs/relax?rev=2640&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=2640&amp;view=rev</a>
Log:
Removal of the installation targets and changing of the initialisation of the 
system path variables.

The installation target functions 'self.install()' and 'self.uninstall()' 
have been deleted as they
are now located in the 'scons.install' module.

The 'self.paths()' function has been removed.  All the paths, environmental 
variables, etc. are now
initialised at the top of the 'sconstruct' file.


Modified:
    1.2/sconstruct

Modified: 1.2/sconstruct
URL: 
<a  href="http://svn.gna.org/viewcvs/relax/1.2/sconstruct?rev=2640&amp;r1=2639&amp;r2=2640&amp;view=diff">http://svn.gna.org/viewcvs/relax/1.2/sconstruct?rev=2640&amp;r1=2639&amp;r2=2640&amp;view=diff</a>
==============================================================================
--- 1.2/sconstruct (original)
+++ 1.2/sconstruct Fri Oct 13 07:43:59 2006
@@ -27,24 +27,121 @@
 
 # Import statements.
 import platform
-from os import F_OK, access, getcwd, path, remove, rmdir, sep, system, walk
+from os import getcwd, path, remove, sep, walk
 from re import search
-from shutil import copytree
 import sys
-from tarfile import TarFile
-from zipfile import ZipFile
-
-# UNIX only functions from the os module.
-try:
-    from os import lstat, symlink
-except ImportError:
-    pass
-
-
-# relax and Scons modules.
+
+# Scons modules.
 from scons.distrib import package, gpg_sign
+from scons.install import install, uninstall
 from scons.manuals import clean_manual_files, compile_api_manual_html, 
compile_user_manual_html, compile_user_manual_pdf, fetch_docstrings, 
version_file
+
+# relax version file.
 from version import version
+
+
+
+########################
+# Paths and file names #
+########################
+
+# The operating system.
+SYSTEM = platform.uname()[0]
+
+# The machine type.
+MACH = platform.uname()[4]
+
+# Symbolic link flag.
+SYMLINK_FLAG = 1
+
+# GNU/Linux.
+if SYSTEM == 'Linux':
+    # System specific string.
+    SYS = 'GNU-Linux'
+
+    # Linux installation path.
+    INSTALL_PATH = '/usr/local'
+
+
+# MS Windows.
+elif SYSTEM == 'Windows':
+    # Architecture.
+    arch = platform.architecture()[0]
+
+    # 32 bit.
+    if arch == '32bit':
+        SYS = 'Win32'
+
+    # 64 bit.
+    elif arch == '64bit':
+        SYS = 'Win64'
+
+    # Unknown.
+    else:
+        SYS = 'Win'
+
+    # Windows installation path.
+    INSTALL_PATH = 'C:\\'
+
+    # No symlinks!
+    SYMLINK_FLAG = 0
+
+
+# Mac OS X.
+elif SYSTEM == 'Darwin':
+    # System specific string.
+    SYS = SYSTEM
+
+    # Mac OS X installation path.
+    INSTALL_PATH = sys.prefix + sep + 'local'
+
+
+# All other operating systems.
+else:
+    # System specific string.
+    SYS = SYSTEM
+
+    # Installation path.
+    INSTALL_PATH = sys.prefix + sep + 'local'
+
+
+
+# Installation.
+###############
+
+# Relax installation directory.
+RELAX_PATH = INSTALL_PATH + sep + 'relax'
+
+# Installation path for binaries.
+BIN_PATH = INSTALL_PATH + sep + 'bin'
+
+# Symbolic link installation path.
+SYMLINK = BIN_PATH + sep + 'relax'
+
+
+
+# The distribution files.
+#########################
+
+if SYSTEM == 'Windows':
+    BIN_FILE = 'relax-' + version + '.' + SYS + '.zip'
+    SRC_FILE = 'relax-' + version + '.src.zip'
+    DIST_TYPE = 'zip'
+else:
+    BIN_FILE = 'relax-' + version + '.' + SYS + '.' + MACH + '.tar.bz2'
+    SRC_FILE = 'relax-' + version + '.src.tar.bz2'
+    DIST_TYPE = 'tar'
+
+
+# Documentation.
+################
+
+# Documentation directory.
+DOCS_DIR = 'docs' + sep
+
+# LaTeX directory.
+LATEX_DIR = 'docs' + sep + 'latex' + sep
+
 
 
 
@@ -62,13 +159,6 @@
         # Set the help message.
         self.help()
 
-        # The operating system.
-        self.SYSTEM = platform.uname()[0]
-
-        # Set up the paths and file names.
-        self.set_paths()
-
-
 
         # C module compilation.
         #######################
@@ -83,12 +173,21 @@
         #######################
 
         # Install target.
-        install_env = Environment(BUILDERS={'install' : 
Builder(action=self.install)},
-                                  RELAX_PATH=self.RELAX_PATH)
+        install_env = Environment(BUILDERS={'install' : 
Builder(action=install)},
+                                  BIN_PATH=BIN_PATH,
+                                  INSTALL_PATH=INSTALL_PATH,
+                                  RELAX_PATH=RELAX_PATH,
+                                  SYMLINK=SYMLINK,
+                                  SYMLINK_FLAG=SYMLINK_FLAG)
         install_env.install(target='install', source=None)
 
         # Uninstall target.
-        uninstall_env = Environment(BUILDERS={'uninstall' : 
Builder(action=self.uninstall)})
+        uninstall_env = Environment(BUILDERS={'uninstall' : 
Builder(action=uninstall)},
+                                  BIN_PATH=BIN_PATH,
+                                  INSTALL_PATH=INSTALL_PATH,
+                                  RELAX_PATH=RELAX_PATH,
+                                  SYMLINK=SYMLINK,
+                                  SYMLINK_FLAG=SYMLINK_FLAG)
         uninstall_env.uninstall(target='uninstall', source=None)
 
 
@@ -119,27 +218,27 @@
 
         # Target for packaging the binary distribution.
         package_bin_env = Environment(BUILDERS={'archive' : 
Builder(action=package)},
-                                      DIST_FILE=self.BIN_FILE,
-                                      DIST_TYPE=self.DIST_TYPE)
+                                      DIST_FILE=BIN_FILE,
+                                      DIST_TYPE=DIST_TYPE)
         package_bin_env.archive(target='package_bin', source=None)
         package_bin_env.Depends('package_bin', 'version_check')     # Check 
the program version number first.
 
         # Target for packaging the source distribution.
         package_src_env = Environment(BUILDERS={'archive' : 
Builder(action=package)},
-                                      DIST_FILE=self.SRC_FILE,
-                                      DIST_TYPE=self.DIST_TYPE)
+                                      DIST_FILE=SRC_FILE,
+                                      DIST_TYPE=DIST_TYPE)
         package_src_env.archive(target='package_src', source=None)
         package_src_env.Depends('package_src', 'version_check')     # Check 
the program version number first.
 
         # Target for creating a GPG signature of the binary distribution 
file.
         gpg_bin_env = Environment(BUILDERS={'sign' : 
Builder(action=gpg_sign)},
-                                  DIST_FILE=self.BIN_FILE)
+                                  DIST_FILE=BIN_FILE)
         gpg_bin_env.sign(target='gpg_bin', source=None)
         gpg_bin_env.Depends('gpg_bin', 'version_check')     # Check the 
program version number before signing.
 
         # Target for creating a GPG signature of the source distribution 
file.
         gpg_src_env = Environment(BUILDERS={'sign' : 
Builder(action=gpg_sign)},
-                                  DIST_FILE=self.SRC_FILE)
+                                  DIST_FILE=SRC_FILE)
         gpg_src_env.sign(target='gpg_src', source=None)
         gpg_src_env.Depends('gpg_src', 'version_check')     # Check the 
program version number before signing.
 
@@ -173,9 +272,9 @@
         ################
 
         # Create the manual build environment.
-        manual_env = Environment(DOCS_DIR=self.DOCS_DIR,
-                                 LATEX_DIR=self.LATEX_DIR,
-                                 SYSTEM=self.SYSTEM)
+        manual_env = Environment(DOCS_DIR=DOCS_DIR,
+                                 LATEX_DIR=LATEX_DIR,
+                                 SYSTEM=SYSTEM)
 
 
         # Set up the builder for the standard manual targets (using the 
self.dummy function).
@@ -350,88 +449,6 @@
         Help(string)
 
 
-    def install(self, target, source, env):
-        &quot;&quot;&quot;relax installation function (a Builder action).&quot;&quot;&quot;
-
-        # Print out.
-        ############
-
-        print
-        print &quot;####################&quot;
-        print &quot;# Installing relax #&quot;
-        print &quot;####################\n\n&quot;
-        print &quot;Installing the program relax into the directory &quot; + 
`self.RELAX_PATH` + &quot;\n\n&quot;
-
-
-        # Tests.
-        ########
-
-        # Test that the installation path exists.
-        if not access(self.INSTALL_PATH, F_OK):
-            sys.stderr.write(&quot;Cannot install relax, the installation path &quot; 
+ `self.INSTALL_PATH` + &quot; does not exist.\n\n&quot;)
-            return
-
-        # Test if the binary directory already exists.
-        if not access(self.BIN_PATH, F_OK):
-            sys.stderr.write(&quot;Cannot install relax, the directory &quot; + 
`self.BIN_PATH` + &quot; does not exist.\n\n&quot;)
-            return
-
-        # Test if the relax installation directory already exists.
-        if access(self.RELAX_PATH, F_OK):
-            sys.stderr.write(&quot;Cannot install relax, the directory &quot; + 
`self.RELAX_PATH` + &quot; already exists.\n\n&quot;)
-            return
-
-        # Test if the symlink exists.
-        if self.symlink_flag:
-            try:
-                lstat(self.SYMLINK)
-            except OSError:
-                # OK, symlink doesn't exist.
-                pass
-            else:
-                sys.stderr.write(&quot;Cannot install relax, the file &quot; + 
`self.SYMLINK` + &quot; already exists.\n\n&quot;)
-                return
-
-
-        # Install.
-        ##########
-
-        # Copy the files (and create the directory).
-        try:
-            print &quot;\nCopying all files in &quot; + `getcwd()` + &quot; to &quot; + 
`self.RELAX_PATH` + &quot;.&quot;
-            copytree(getcwd(), self.RELAX_PATH)
-        except OSError, message:
-            # Failure message.
-            sys.stderr.write(&quot;Cannot install relax, &quot; + message.__doc__ + 
&quot;\n&quot;)
-
-            # You don't have the privilages to do this.
-            if message.errno == 13:
-                sys.stderr.write(&quot;Permission denied, cannot create the 
directory &quot; + `self.RELAX_PATH` + &quot;.\n\n&quot;)
-
-            # All other errors (print normal python error message).
-            else:
-                sys.stderr.write(&quot;OSError: [Errno &quot; + `message.errno` + &quot;] &quot; 
+ message.strerror + &quot;: &quot; + `message.filename` + &quot;\n\n&quot;)
-
-            # Quit the function.
-            return
-
-        # Create the symbolic link.
-        if self.symlink_flag:
-            print &quot;\nCreating the symbolic link from &quot; + `self.RELAX_PATH + 
sep + 'relax'` + &quot; to &quot; + `self.SYMLINK` + &quot;.&quot;
-            symlink(self.RELAX_PATH + sep + 'relax', self.SYMLINK)
-
-
-        # Byte compile.
-        ###############
-
-        # Run relax to create the *.pyc files.
-           print &quot;\nRunning relax to create the byte-compiled *.pyc files.&quot;
-        system(self.SYMLINK + &quot; --test&quot;)
-
-        # Final print out.
-        print &quot;\n\n\n&quot;
-
-
     def relax_fit(self):
         &quot;&quot;&quot;Function for setting up scons for building the relaxation curve 
fitting C modules.&quot;&quot;&quot;
 
@@ -448,7 +465,7 @@
         py_include_fullpath = py_include_minpath + path.sep + 'python' + 
`sys.version_info[0]` + '.' + `sys.version_info[1]`
 
         # C flags.
-        if self.SYSTEM == 'Windows':
+        if SYSTEM == 'Windows':
             cflags = '/nologo /I\&quot;' + py_include_minpath + '\&quot;'
         else:
             cflags = '-I' + py_include_fullpath
@@ -458,7 +475,7 @@
 
         # Python library path.
         libpath = ''
-        if self.SYSTEM == 'Windows':
+        if SYSTEM == 'Windows':
             libpath = sys.prefix + path.sep + 'libs'
 
         # Add the python library path to the environment.
@@ -489,97 +506,6 @@
         env.AddPreAction(nodes[0], Action(self.dummy, print_string))
 
 
-    def set_paths(self):
-        &quot;&quot;&quot;Function for setting the paths and file names.&quot;&quot;&quot;
-
-        # The machine type.
-        self.MACH = platform.uname()[4]
-
-        # Symbolic link flag.
-        self.symlink_flag = 1
-
-        # GNU/Linux.
-        if self.SYSTEM == 'Linux':
-            # System specific string.
-            self.SYS = 'GNU-Linux'
-
-            # Linux installation path.
-            self.INSTALL_PATH = '/usr/local'
-
-
-        # MS Windows.
-        elif self.SYSTEM == 'Windows':
-            # Architecture.
-            arch = platform.architecture()[0]
-
-            # 32 bit.
-            if arch == '32bit':
-                self.SYS = 'Win32'
-            elif arch == '64bit':
-                self.SYS = 'Win64'
-            else:
-                self.SYS = 'Win'
-
-            # Windows installation path.
-            self.INSTALL_PATH = 'C:\\'
-
-            # No symlinks!
-            self.symlink_flag = 0
-
-        # Mac OS X.
-        elif self.SYSTEM == 'Darwin':
-            # System specific string.
-            self.SYS = self.SYSTEM
-
-            # Mac OS X installation path.
-            self.INSTALL_PATH = sys.prefix + sep + 'local'
-
-
-        # All other operating systems.
-        else:
-            # System specific string.
-            self.SYS = self.SYSTEM
-
-            # Installation path.
-            self.INSTALL_PATH = sys.prefix + sep + 'local'
-
-
-
-        # Installation.
-        ###############
-        
-        # Relax installation directory.
-        self.RELAX_PATH = self.INSTALL_PATH + sep + 'relax'
-
-        # Installation path for binaries.
-        self.BIN_PATH = self.INSTALL_PATH + sep + 'bin'
-
-        # Symbolic link installation path.
-        self.SYMLINK = self.BIN_PATH + sep + 'relax'
-
-
-
-        # The distribution files.
-        if self.SYSTEM == 'Windows':
-            self.BIN_FILE = 'relax-' + version + '.' + self.SYS + '.zip'
-            self.SRC_FILE = 'relax-' + version + '.src.zip'
-            self.DIST_TYPE = 'zip'
-        else:
-            self.BIN_FILE = 'relax-' + version + '.' + self.SYS + '.' + 
self.MACH + '.tar.bz2'
-            self.SRC_FILE = 'relax-' + version + '.src.tar.bz2'
-            self.DIST_TYPE = 'tar'
-
-
-        # Documentation.
-        ################
-
-        # Documentation directory.
-        self.DOCS_DIR = 'docs' + sep
-
-        # LaTeX directory.
-        self.LATEX_DIR = 'docs' + sep + 'latex' + sep
-
-
     def test_version(self, target, source, env):
         &quot;&quot;&quot;Builder action for testing that the program version number has 
been set.&quot;&quot;&quot;
 
@@ -599,67 +525,5 @@
         print &quot;\n\n\n&quot;
 
 
-    def uninstall(self, target, source, env):
-        &quot;&quot;&quot;relax deinstallation function (a Builder action).&quot;&quot;&quot;
-
-        # Print out.
-        ############
-
-        print
-        print &quot;######################&quot;
-        print &quot;# Uninstalling relax #&quot;
-        print &quot;######################\n\n&quot;
-        print &quot;Uninstalling the program relax from the directory &quot; + 
`self.INSTALL_PATH` + &quot;\n\n&quot;
-
-
-        # Tests.
-        ########
-
-        # Test that the installation path exists.
-        if not access(self.INSTALL_PATH, F_OK):
-            sys.stderr.write(&quot;Cannot uninstall relax, the installation path 
&quot; + `self.INSTALL_PATH` + &quot; does not exist.\n\n&quot;)
-            return
-
-        # Test if the binary directory already exists.
-        if not access(self.BIN_PATH, F_OK):
-            sys.stderr.write(&quot;Cannot uninstall relax, the directory &quot; + 
`self.BIN_PATH` + &quot; does not exist.\n\n&quot;)
-            return
-
-        # Test if the relax installation directory exists.
-        if not access(self.RELAX_PATH, F_OK):
-            sys.stderr.write(&quot;Cannot uninstall relax, the directory &quot; + 
`self.RELAX_PATH` + &quot; does not exist.\n\n&quot;)
-            return
-
-        # Test if the symlink exists.
-        if self.symlink_flag:
-            try:
-                lstat(self.SYMLINK)
-            except OSError:
-                sys.stderr.write(&quot;Cannot uninstall relax, the file &quot; + 
`self.SYMLINK` + &quot; does not exist.\n\n&quot;)
-                return
-
-
-        # Uninstall.
-        ############
-
-        # Remove the symbolic link.
-        if self.symlink_flag:
-            print &quot;\nRemoving the symbolic link &quot; + `self.SYMLINK` + &quot;.&quot;
-            remove(self.SYMLINK)
-
-        # Remove the directory.
-        print &quot;\nRemoving the entire directory &quot; + `self.RELAX_PATH` + &quot;.\n&quot;
-        for root, dirs, files in walk(self.RELAX_PATH, topdown=False):
-            for file in files:
-                remove(path.join(root, file))
-            for file in dirs:
-                rmdir(path.join(root, file))
-        rmdir(self.RELAX_PATH)
-
-        # Final print out.
-        print &quot;\n\n\n&quot;
-
-
-
-# Execute the main and manual classes.
+# Execute the main class.
 Main()



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Fri Oct 13 08:00:09 2006</div>  
</body>
</html>
