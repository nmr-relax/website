<!-- MHonArc v2.6.16 -->
<!--X-Subject: r13282 &#45; in /branches/gui_testing/gui: analyses/__init__.py menu.py	relax_gui.py -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Wed, 29 Jun 2011 11:36:53 +0200 -->
<!--X-Message-Id: E1QbrCX&#45;0007Jg&#45;KS@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r13282 - in /branches/gui_testing/gui: analyses/__init__.py menu.py	relax_gui.py -- June 29, 2011 - 11:36</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r13282 - in /branches/gui_testing/gui: analyses/__init__.py menu.py	relax_gui.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00449" class="tabs">Index by Date</a> | <a href="threads.html#00449" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00448.html">Date Prev</a>] [<a href="msg00450.html">Date Next</a>] [<a href="msg00448.html">Thread Prev</a>] [<a href="msg00450.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Wed, 29 Jun 2011 09:36:53 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00449.html">E1QbrCX-0007Jg-KS@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on June 29, 2011 - 11:36:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Wed Jun 29 11:36:53 2011
New Revision: 13282

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=13282&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=13282&amp;view=rev</a>
Log:
Shifted all of the analysis specific code into the new Analysis_controller 
class.

A few new methods have been created to abstract the page objects and other 
analysis specific
structures.


Modified:
    branches/gui_testing/gui/analyses/__init__.py
    branches/gui_testing/gui/menu.py
    branches/gui_testing/gui/relax_gui.py

Modified: branches/gui_testing/gui/analyses/__init__.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/gui_testing/gui/analyses/__init__.py?rev=13282&amp;r1=13281&amp;r2=13282&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/gui_testing/gui/analyses/__init__.py?rev=13282&amp;r1=13281&amp;r2=13282&amp;view=diff</a>
==============================================================================
--- branches/gui_testing/gui/analyses/__init__.py (original)
+++ branches/gui_testing/gui/analyses/__init__.py Wed Jun 29 11:36:53 2011
@@ -23,15 +23,209 @@
 # Package docstring.
 &quot;&quot;&quot;Package for the automatic and custom analysis GUI elements.&quot;&quot;&quot;
 
-
-__all__ = []
+# Python module imports.
+import wx
+
+# relax GUI module imports.
+from gui.analyses.auto_model_free import Auto_model_free
+from gui.analyses.auto_noe import Auto_noe
+from gui.analyses.auto_r1 import Auto_r1
+from gui.analyses.auto_r2 import Auto_r2
+from gui.analyses.results import Results_viewer
+from gui.analyses.wizard import Analysis_wizard
+
+
+# The package contents.
+__all__ = ['auto_model_free',
+           'auto_noe',
+           'auto_r1',
+           'auto_r2',
+           'auto_rx_base',
+           'base',
+           'relax_control',
+           'results_analysis',
+           'results',
+           'select_model_calc']
 
 
 class Analysis_controller:
     &quot;&quot;&quot;Class for controlling all aspects of analyses.&quot;&quot;&quot;
 
-    def __init__(self):
-        &quot;&quot;&quot;Initialise the analysis controller.&quot;&quot;&quot;
+    def __init__(self, gui):
+        &quot;&quot;&quot;Initialise the analysis controller.
+
+        @param gui:         The gui object.
+        @type gui:          wx object
+        &quot;&quot;&quot;
+
+        # Store the args.
+        self.gui = gui
+
+        # Initialise some variables.
+        self.init_state = True
 
         # The analyses page objects.
         self.analyses = []
+
+
+    def analysis_loop(self):
+        &quot;&quot;&quot;Loop over the analyses, yielding the page objects.
+
+        @return:    The page object.
+        @rtype:     wx.Frame object
+        &quot;&quot;&quot;
+
+        # Loop over the analyses.
+        for i in range(len(self.analyses)):
+            yield self.analyses[i]
+
+
+    def delete_all(self):
+        &quot;&quot;&quot;Remove all analyses.&quot;&quot;&quot;
+
+        # Delete the current tabs.
+        while len(self.analyses):
+            # Remove the last analysis, until there is nothing left.
+            self.delete_analysis(len(self.analyses)-1)
+
+
+    def delete_analysis(self, index):
+        &quot;&quot;&quot;Delete the analysis tab and data store corresponding to the index.
+
+        @param index:   The index of the analysis to delete.
+        @type index:    int
+        &quot;&quot;&quot;
+
+        # Delete the data store object.
+        ds.relax_gui.analyses.pop(index)
+
+        # Delete the tab.
+        self.notebook.DeletePage(index)
+
+        # Delete the tab object.
+        self.analyses.pop(index)
+
+        # No more analyses, so in the initial state.
+        if len(ds.relax_gui.analyses) == 0:
+            # Reset the flag.
+            self.init_state = True
+
+            # Delete the previous sizer.
+            old_sizer = self.GetSizer()
+            old_sizer.DeleteWindows()
+
+            # Recreate the start screen.
+            self.add_start_screen()
+
+
+    def menu_close(self, event):
+        &quot;&quot;&quot;Close the currently opened analysis.
+
+        @param event:   The wx event.
+        @type event:    wx event
+        &quot;&quot;&quot;
+
+        # Get the current analysis index.
+        index = self.notebook.GetSelection()
+
+        # Ask if this should be done.
+        msg = &quot;Are you sure you would like to close the current %s analysis 
tab?&quot; % ds.relax_gui.analyses[index].analysis_type
+        if not question(msg, default=False):
+            return
+
+        # Delete.
+        self.delete_analysis(index)
+
+
+    def menu_new(self, event):
+        &quot;&quot;&quot;Launch a wizard to select the new analysis.
+
+        @param event:   The wx event.
+        @type event:    wx event
+        &quot;&quot;&quot;
+
+        # Initialise the analysis wizard, and obtain the user specified data.
+        self.new_wizard = Analysis_wizard()
+        data = self.new_wizard.run()
+
+        # Failure, so do nothing.
+        if data == None:
+            return
+
+        # Unpack the data.
+        analysis_type, analysis_name, pipe_name = data
+
+        # Initialise the new analysis.
+        self.new_analysis(analysis_type, analysis_name, pipe_name)
+
+        # Delete the wizard data.
+        del self.new_wizard
+
+
+    def new_analysis(self, analysis_type=None, analysis_name=None, 
pipe_name=None, index=None):
+        &quot;&quot;&quot;Initialise a new analysis.
+
+        @keyword analysis_type: The type of analysis to initialise.  This 
can be one of 'noe', 'r1', 'r2', or 'mf'.
+        @type analysis_type:    str
+        @keyword analysis_name: The name of the analysis to initialise.
+        @type analysis_name:    str
+        @keyword index:         The index of the analysis in the relax data 
store (set to None if no data currently exists).
+        @type index:            None or int
+        &quot;&quot;&quot;
+
+        # Starting from the initial state.
+        if self.init_state:
+            # A new sizer for the notebook (to replace the current sizer).
+            sizer = wx.BoxSizer(wx.VERTICAL)
+
+            # Create a notebook and add it to the sizer.
+            self.notebook = wx.Notebook(self.gui, -1, style=wx.NB_TOP)
+            sizer.Add(self.notebook, 1, wx.ALL|wx.EXPAND, 0)
+
+            # Delete the previous sizer.
+            old_sizer = self.gui.GetSizer()
+            old_sizer.DeleteWindows()
+
+            # Add the new sizer to the main window.
+            self.gui.SetSizer(sizer)
+            sizer.Layout()
+
+            # Set the flag.
+            self.init_state = False
+
+        # The analysis classes.
+        classes = {'noe': Auto_noe,
+                   'r1':  Auto_r1,
+                   'r2':  Auto_r2,
+                   'mf':  Auto_model_free}
+
+        # Bad analysis type.
+        if analysis_type not in classes.keys():
+            raise RelaxError(&quot;The analysis '%s' is unknown.&quot; % analysis_type)
+
+        # Get the class.
+        analysis = classes[analysis_type]
+
+        # Initialise the class and append it to the analysis window object.
+        self.analyses.append(analysis(gui=self.gui, notebook=self.notebook, 
analysis_name=analysis_name, pipe_name=pipe_name, data_index=index))
+
+        # Add to the notebook.
+        self.notebook.AddPage(self.analyses[-1].parent, analysis_name)
+
+        # Reset the main window layout.
+        self.gui.Layout()
+
+
+    def show_results_viewer(self, event):
+        &quot;&quot;&quot;Display the analysis results.
+
+        @param event:   The wx event.
+        @type event:    wx event
+        &quot;&quot;&quot;
+
+        # Build the results viewer window.
+        if not hasattr(self, 'results_viewer'):
+            self.results_viewer = Results_viewer(gui=self.gui)
+
+        # Open the window.
+        self.results_viewer.Show()

Modified: branches/gui_testing/gui/menu.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/gui_testing/gui/menu.py?rev=13282&amp;r1=13281&amp;r2=13282&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/gui_testing/gui/menu.py?rev=13282&amp;r1=13281&amp;r2=13282&amp;view=diff</a>
==============================================================================
--- branches/gui_testing/gui/menu.py (original)
+++ branches/gui_testing/gui/menu.py Wed Jun 29 11:36:53 2011
@@ -60,12 +60,12 @@
         self.menubar.Append(menu, &quot;&amp;File&quot;)
 
         # The 'File' menu actions.
-        self.gui.Bind(wx.EVT_MENU, self.gui.new,                    id=1)
-        self.gui.Bind(wx.EVT_MENU, self.gui.close_analysis,         id=6)
-        self.gui.Bind(wx.EVT_MENU, self.gui.state_load,             id=2)
-        self.gui.Bind(wx.EVT_MENU, self.gui.action_state_save,      id=3)
-        self.gui.Bind(wx.EVT_MENU, self.gui.action_state_save_as,   id=4)
-        self.gui.Bind(wx.EVT_MENU, self.gui.exit_gui,               id=5)
+        self.gui.Bind(wx.EVT_MENU, self.gui.analysis.menu_new,   id=1)
+        self.gui.Bind(wx.EVT_MENU, self.gui.analysis.menu_close, id=6)
+        self.gui.Bind(wx.EVT_MENU, self.gui.state_load,                     
id=2)
+        self.gui.Bind(wx.EVT_MENU, self.gui.action_state_save,              
id=3)
+        self.gui.Bind(wx.EVT_MENU, self.gui.action_state_save_as,           
id=4)
+        self.gui.Bind(wx.EVT_MENU, self.gui.exit_gui,                       
id=5)
 
         # The 'View' menu entries.
         menu = wx.Menu()
@@ -76,10 +76,10 @@
         self.menubar.Append(menu, &quot;&amp;View&quot;)
 
         # The 'View' actions.
-        self.gui.Bind(wx.EVT_MENU, self.gui.show_controller,        id=50)
-        self.gui.Bind(wx.EVT_MENU, self.gui.show_prompt,            id=51)
-        self.gui.Bind(wx.EVT_MENU, self.gui.show_tree,              id=52)
-        self.gui.Bind(wx.EVT_MENU, self.gui.show_results_viewer,    id=53)
+        self.gui.Bind(wx.EVT_MENU, self.gui.show_controller,                
id=50)
+        self.gui.Bind(wx.EVT_MENU, self.gui.show_prompt,                    
id=51)
+        self.gui.Bind(wx.EVT_MENU, self.gui.show_tree,                      
id=52)
+        self.gui.Bind(wx.EVT_MENU, self.gui.analysis.show_results_viewer,   
id=53)
 
         # The 'User functions' menu entries.
         self._user_functions()

Modified: branches/gui_testing/gui/relax_gui.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/gui_testing/gui/relax_gui.py?rev=13282&amp;r1=13281&amp;r2=13282&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/gui_testing/gui/relax_gui.py?rev=13282&amp;r1=13281&amp;r2=13282&amp;view=diff</a>
==============================================================================
--- branches/gui_testing/gui/relax_gui.py (original)
+++ branches/gui_testing/gui/relax_gui.py Wed Jun 29 11:36:53 2011
@@ -48,12 +48,6 @@
 # relaxGUI module imports.
 from gui.about import About_gui, About_relax
 from gui.analyses import Analysis_controller
-from gui.analyses.auto_model_free import Auto_model_free
-from gui.analyses.auto_noe import Auto_noe
-from gui.analyses.auto_r1 import Auto_r1
-from gui.analyses.auto_r2 import Auto_r2
-from gui.analyses.results import Results_viewer
-from gui.analyses.wizard import Analysis_wizard
 from gui.base_classes import Container
 from gui.components.spin_view import Spin_view_window
 from gui.controller import Controller
@@ -83,7 +77,6 @@
         super(Main, self).__init__(parent=parent, id=id, title=title, 
style=wx.DEFAULT_FRAME_STYLE)
 
         # Initialise some variables for the GUI.
-        self.init_state = True
         self.launch_dir = getcwd()
 
         # Set up the frame.
@@ -93,7 +86,7 @@
         self.Centre()
 
         # The analysis window object storage.
-        self.analysis_controller = Analysis_controller()
+        self.analysis = Analysis_controller(self)
 
         # The calculation threads list.
         self.calc_threads = []
@@ -225,57 +218,9 @@
         self.Refresh()
 
 
-    def close_analysis(self, event):
-        &quot;&quot;&quot;Close the currently opened analysis.
-
-        @param event:   The wx event.
-        @type event:    wx event
-        &quot;&quot;&quot;
-
-        # Get the current analysis index.
-        index = self.notebook.GetSelection()
-
-        # Ask if this should be done.
-        msg = &quot;Are you sure you would like to close the current %s analysis 
tab?&quot; % ds.relax_gui.analyses[index].analysis_type
-        if not question(msg, default=False):
-            return
-
-        # Delete.
-        self.delete_analysis(index)
-
-
     def contact_relax(self, event):
         &quot;&quot;&quot;Write an email to the relax mailing-list using the standard 
mailing program.&quot;&quot;&quot;
         webbrowser.open_new('<a  rel="nofollow" href="mailto:relax-users@xxxxxxx">mailto:relax-users@xxxxxxx</a>')
-
-
-    def delete_analysis(self, index):
-        &quot;&quot;&quot;Delete the analysis tab and data store corresponding to the index.
-
-        @param index:   The index of the analysis to delete.
-        @type index:    int
-        &quot;&quot;&quot;
-
-        # Delete the data store object.
-        ds.relax_gui.analyses.pop(index)
-
-        # Delete the tab.
-        self.notebook.DeletePage(index)
-
-        # Delete the tab object.
-        self.analyses.pop(index)
-
-        # No more analyses, so in the initial state.
-        if len(ds.relax_gui.analyses) == 0:
-            # Reset the flag.
-            self.init_state = True
-
-            # Delete the previous sizer.
-            old_sizer = self.GetSizer()
-            old_sizer.DeleteWindows()
-
-            # Recreate the start screen.
-            self.add_start_screen()
 
 
     def exit_gui(self, event=None):
@@ -341,85 +286,6 @@
         ds.relax_gui.table_te = []
 
 
-    def new(self, event):
-        &quot;&quot;&quot;Launch a wizard to select the new analysis.
-
-        @param event:   The wx event.
-        @type event:    wx event
-        &quot;&quot;&quot;
-
-        # Initialise the analysis wizard, and obtain the user specified data.
-        self.new_wizard = Analysis_wizard()
-        data = self.new_wizard.run()
-
-        # Failure, so do nothing.
-        if data == None:
-            return
-
-        # Unpack the data.
-        analysis_type, analysis_name, pipe_name = data
-
-        # Initialise the new analysis.
-        self.new_analysis(analysis_type, analysis_name, pipe_name)
-
-        # Delete the wizard data.
-        del self.new_wizard
-
-
-    def new_analysis(self, analysis_type=None, analysis_name=None, 
pipe_name=None, index=None):
-        &quot;&quot;&quot;Initialise a new analysis.
-
-        @keyword analysis_type: The type of analysis to initialise.  This 
can be one of 'noe', 'r1', 'r2', or 'mf'.
-        @type analysis_type:    str
-        @keyword analysis_name: The name of the analysis to initialise.
-        @type analysis_name:    str
-        @keyword index:         The index of the analysis in the relax data 
store (set to None if no data currently exists).
-        @type index:            None or int
-        &quot;&quot;&quot;
-
-        # Starting from the initial state.
-        if self.init_state:
-            # A new sizer for the notebook (to replace the current sizer).
-            sizer = wx.BoxSizer(wx.VERTICAL)
-
-            # Create a notebook and add it to the sizer.
-            self.notebook = wx.Notebook(self, -1, style=wx.NB_TOP)
-            sizer.Add(self.notebook, 1, wx.ALL|wx.EXPAND, 0)
-
-            # Delete the previous sizer.
-            old_sizer = self.GetSizer()
-            old_sizer.DeleteWindows()
-
-            # Add the new sizer to the main window.
-            self.SetSizer(sizer)
-            sizer.Layout()
-
-            # Set the flag.
-            self.init_state = False
-
-        # The analysis classes.
-        classes = {'noe': Auto_noe,
-                   'r1':  Auto_r1,
-                   'r2':  Auto_r2,
-                   'mf':  Auto_model_free}
-
-        # Bad analysis type.
-        if analysis_type not in classes.keys():
-            raise RelaxError(&quot;The analysis '%s' is unknown.&quot; % analysis_type)
-
-        # Get the class.
-        analysis = classes[analysis_type]
-
-        # Initialise the class and append it to the analysis window object.
-        self.analyses.append(analysis(gui=self, notebook=self.notebook, 
analysis_name=analysis_name, pipe_name=pipe_name, data_index=index))
-
-        # Add to the notebook.
-        self.notebook.AddPage(self.analyses[-1].parent, analysis_name)
-
-        # Reset the main window layout.
-        self.Layout()
-
-
     def free_file_format_settings(self, event):
         &quot;&quot;&quot;Open the free file format settings window.
 
@@ -535,21 +401,6 @@
         self.relax_prompt.Show()
 
 
-    def show_results_viewer(self, event):
-        &quot;&quot;&quot;Display the analysis results.
-
-        @param event:   The wx event.
-        @type event:    wx event
-        &quot;&quot;&quot;
-
-        # Build the results viewer window.
-        if not hasattr(self, 'results_viewer'):
-            self.results_viewer = Results_viewer(gui=self)
-
-        # Open the window.
-        self.results_viewer.Show()
-
-
     def show_tree(self, event):
         &quot;&quot;&quot;Display the molecule, residue, and spin tree window.
 
@@ -573,7 +424,7 @@
         &quot;&quot;&quot;
 
         # Warning.
-        if not self.init_state:
+        if not self.analysis.init_state:
             # The message.
             msg = &quot;Loading a saved relax state file will cause all unsaved 
data to be lost.  Are you sure you would to open a save file?&quot;
 
@@ -597,9 +448,7 @@
         self.SetCursor(wx.StockCursor(wx.CURSOR_ARROWWAIT))
 
         # Delete the current tabs.
-        while len(self.analyses):
-            # Remove the last analysis, until there is nothing left.
-            self.delete_analysis(len(self.analyses)-1)
+        self.analysis.delete_all()
 
         # Reset the relax data store.
         reset()
@@ -658,9 +507,7 @@
         &quot;&quot;&quot;
 
         # Loop over each analysis.
-        for i in range(len(self.analyses)):
-            # Execute the analysis frame specific update methods.
-            if hasattr(self.analyses[i], 'sync_ds'):
-                self.analyses[i].sync_ds(upload)
-
-
+        for page in self.analysis.analysis_loop():
+            # Execute the analysis page specific update methods.
+            if hasattr(page, 'sync_ds'):
+                page.sync_ds(upload)



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Wed Jun 29 11:40:03 2011</div>  
</body>
</html>
