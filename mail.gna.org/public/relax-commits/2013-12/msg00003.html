<!-- MHonArc v2.6.16 -->
<!--X-Subject: r21725 &#45; /trunk/specific_analyses/relax_disp/disp_data.py -->
<!--X-From-R13: rqjneqNaze&#45;erynk.pbz -->
<!--X-Date: Sun, 01 Dec 2013 20:12:43 +0100 -->
<!--X-Message-Id: E1VnCRe&#45;0000pX&#45;TZ@subversion.gna.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>r21725 - /trunk/specific_analyses/relax_disp/disp_data.py -- December 01, 2013 - 20:12</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />r21725 - /trunk/specific_analyses/relax_disp/disp_data.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00003" class="tabs">Index by Date</a> | <a href="threads.html#00003" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00002.html">Date Prev</a>] [<a href="msg00004.html">Date Next</a>] [<a href="msg00002.html">Thread Prev</a>] [<a href="msg00004.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: relax-commits@xxxxxxx</li>
<li class="menuitem">
<em>Date</em>: Sun, 01 Dec 2013 19:12:42 -0000</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00003.html">E1VnCRe-0000pX-TZ@subversion.gna.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>edward</strong> on December 01, 2013 - 20:12:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Author: bugman
Date: Sun Dec  1 20:12:40 2013
New Revision: 21725

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=21725&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=21725&amp;view=rev</a>
Log:
A big change to the usage of the relax_disp.r2eff_read_spin user function.

Now the nu_CPMG frequency or the spin-lock field strength must be set prior 
to calling this user
function.  This allows for more flexibility as often the experiment IDs and 
frequency values in the
files do not match to the same number of decimal places.  The frequency is no 
longer read from the
file but must be preset.


Modified:
    trunk/specific_analyses/relax_disp/disp_data.py

Modified: trunk/specific_analyses/relax_disp/disp_data.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/disp_data.py?rev=21725&amp;r1=21724&amp;r2=21725&amp;view=diff">http://svn.gna.org/viewcvs/relax/trunk/specific_analyses/relax_disp/disp_data.py?rev=21725&amp;r1=21724&amp;r2=21725&amp;view=diff</a>
==============================================================================
--- trunk/specific_analyses/relax_disp/disp_data.py (original)
+++ trunk/specific_analyses/relax_disp/disp_data.py Sun Dec  1 20:12:40 2013
@@ -36,6 +36,7 @@
 from math import atan, floor, pi, sqrt
 from numpy import array, float64, int32, ones, zeros
 from random import gauss
+from re import search
 import sys
 from warnings import warn
 
@@ -1808,8 +1809,28 @@
         if error == 0.0:
             raise RelaxError(&quot;An invalid error value of zero has been 
encountered.&quot;)
 
-        # Generate a new spectrum ID.
-        new_id = &quot;%s_%s&quot; % (id, disp_point)
+        # Find the matching spectrum ID.
+        new_id = None
+        for spectrum_id in cdp.spectrum_ids:
+            # Skip IDs which don't start with the base ID.
+            if not search(&quot;^%s&quot;%id, spectrum_id):
+                continue
+
+            # Find a close enough dispersion point (to one decimal place to 
allow for user truncation).
+            if hasattr(cdp, 'cpmg_frqs') and spectrum_id in cdp.cpmg_frqs:
+                if abs(disp_point - cdp.cpmg_frqs[spectrum_id]) &lt; 0.1:
+                    new_id = spectrum_id
+                    break
+            if hasattr(cdp, 'spin_lock_nu1') and spectrum_id in 
cdp.spin_lock_nu1:
+                if abs(disp_point - cdp.spin_lock_nu1[spectrum_id]) &lt; 0.1:
+                    new_id = spectrum_id
+                    break
+
+        # No match.
+        if new_id == None:
+            raise RelaxError(&quot;The experiment ID corresponding to the base ID 
'%s' and the dispersion point '%s' could not be found.&quot; % (id, disp_point))
+
+        # Add the ID to the list.
         new_ids.append(new_id)
 
         # Data checks.
@@ -1844,12 +1865,6 @@
             # Store.
             spin.r2eff_err[point_key] = error
 
-        # Set the dispersion point frequency.
-        if exp_type in EXP_TYPE_LIST_CPMG:
-            cpmg_frq(spectrum_id=new_id, cpmg_frq=disp_point)
-        else:
-            spin_lock_field(spectrum_id=new_id, field=disp_point)
-
         # Append the data for printout.
         data.append([&quot;%20.15f&quot; % disp_point, &quot;%20.15f&quot; % value, &quot;%20.15f&quot; % 
error])
 
@@ -1861,7 +1876,6 @@
         raise RelaxError(&quot;No R2eff/R1rho data could be extracted.&quot;)
 
     # Print out.
-    print(&quot;Using the experiment IDs %s.&quot; % new_ids)
     print(&quot;The following R2eff/R1rho data has been loaded into the relax 
data store:\n&quot;)
     write_data(out=sys.stdout, headings=[&quot;Disp_point&quot;, &quot;R2eff&quot;, 
&quot;R2eff_error&quot;], data=data)
 



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Sun Dec 01 20:40:03 2013</div>  
</body>
</html>
