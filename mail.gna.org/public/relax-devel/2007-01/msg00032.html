<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: Redesign of the relax data model: 3. Molecules, residues,	and spins -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneq.qnhiretarNtznvy.pbz> -->
<!--X-Date: Mon, 15 Jan 2007 10:45:53 +0100 -->
<!--X-Message-Id: 7f080ed10701150145q53b01785ucc3b04a3a61fdc07@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: f001463a0701071417w6bd7927cp8fdd052e698575ec@mail.gmail.com -->
<!--X-Reference: 1168433714.7569.359.camel@mrspell -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Redesign of the relax data model: 3. Molecules, residues,	and spins -- January 15, 2007 - 10:45</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Redesign of the relax data model: 3. Molecules, residues,	and spins</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00032" class="tabs">Index by Date</a> | <a href="threads.html#00032" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00031.html">Date Prev</a>] [<a href="msg00033.html">Date Next</a>] [<a href="msg00021.html">Thread Prev</a>] [<a href="msg00036.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Chris MacRaild&quot; &lt;c.a.macraild@xxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 15 Jan 2007 20:45:09 +1100</li>
<li class="menuitem">
<em>Cc</em>: relax-devel@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00032.html">7f080ed10701150145q53b01785ucc3b04a3a61fdc07@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;<a href="msg00014.html">f001463a0701071417w6bd7927cp8fdd052e698575ec@mail.gmail.com</a>&gt;	&lt;<a href="msg00021.html">1168433714.7569.359.camel@mrspell</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on January 15, 2007 - 10:45:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<blockquote class="blockquote"><pre style="margin: 0em;">&gt; &gt;   It will be up to the spin-specific function passed in by the calling
&gt; &gt;   function to handle the 'spin.select' value.  Because of the complexity
&gt; &gt;   of the loop, the use of this single 'spin_loop()' function will simplify
&gt; &gt;   the relax code base, will minimise potential bugs, and will simplify
&gt; &gt;   future changes to the relax data model (if necessary).
&gt;
&gt; use of an iterator object will provide flexibility as iterators can be
&gt; wrapped filtered and generally mucked about with using pythons loops
&gt; and iter tools. Whats more they are  doddle to code as all you do is
&gt; write an ordinary function and call yield with a value each time you
&gt; have  identified a selected spin
&gt; (<a  href="http://www.python.org/dev/peps/pep-0255/">http://www.python.org/dev/peps/pep-0255/</a>).... This also allows
&gt; arbitrary selection to be added as wrapper iterators or filtered
&gt; iterators
&gt;</pre><br>
<pre style="margin: 0em;">The UCSF selection syntax is sufficiently powerful for all relax needs,
as well as being simple and well known amongst potential users. It seems
like an excellent alternative to the current spin selection methods.
Coding the parser as an iterator is also a good idea.
</pre></blockquote><pre style="margin: 0em;"><br>Agreed.  Before we go down the path of the Molmol/UCSF syntax, is
there another more intuitive syntax used by other NMR software?</pre><br>
<br>
<blockquote class="blockquote"><pre style="margin: 0em;">To extend things a bit further, we could incorporate all of this with a
functor similar to that proposed for handling multiple run selections
(<a  href="http://www.nmr-relax.com/mail.gna.org/public/relax-devel/2007-01/msg00013.html">https://mail.gna.org/public/relax-devel/2007-01/msg00013.html</a> and
<a  href="http://www.nmr-relax.com/mail.gna.org/public/relax-devel/2007-01/msg00020.html">https://mail.gna.org/public/relax-devel/2007-01/msg00020.html</a> ). Of
course the spin functor would opperate at a different level of code to
the run functor - whereas all user functions would be instances of the
run functor, only certain internal functions (those that act on a single
spin) would be instances of the spin functor.
</pre></blockquote><pre style="margin: 0em;"><br>The user functions are instances of the run functor?  Do you mean the
functions called by the user functions are instances?</pre><br>
<pre style="margin: 0em;">The spin selection itself is used quite differently by different parts
of the code base and I'm not sure if implementing the parser as a
generator is a good idea.  For example the selection string could be
passed to the spin loop function which is a generator yielding  the
spin system data container.  Using Gary's spin system selection and
generator ideas
(<a  href="http://www.nmr-relax.com/mail.gna.org/public/relax-devel/2007-01/msg00014.html">https://mail.gna.org/public/relax-devel/2007-01/msg00014.html</a>,
Message-id: &lt;f001463a0701071417w6bd7927cp8fdd052e698575ec@xxxxxxxxxxxxxx&gt;),
the spin loop presented at
<a  href="http://www.nmr-relax.com/mail.gna.org/public/relax-devel/2006-10/msg00057.html">https://mail.gna.org/public/relax-devel/2006-10/msg00057.html</a>
(Message-id: &lt;1160557041.9523.74.camel@xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&gt;)
would be simple.  One argument goes into the function, the selection
string, and the final line would be a yield statement.  In this spin
loop example, maybe it would be useful to have separate
generators/iterators for the molecules, residues, and atoms.  Then the
spin loop could become:</pre><br>
<pre style="margin: 0em;">   def spin_loop(selection=None):
       &quot;&quot;&quot;Function for selectively looping over all spins.&quot;&quot;&quot;</pre><br>
<pre style="margin: 0em;">       # Reassign the data container.
       data = self.relax.data[self.relax.run]</pre><br>
<pre style="margin: 0em;">       # Loop over the molecules.
       for mol in data.mol:
           # Skip the molecule if there is no match to the selection.
           skip = 1
           for mol_name in mol_iterator(selection):
               if mol_name == mol.name:
                   skip = 0
           if skip:
               continue</pre><br>
<pre style="margin: 0em;">           # Loop over the residues.
           for res in mol.res:
               # Skip the residue if there is no match to the selection.
               skip = 1
               for res_num, res_name in res_iterator(selection):
                   if res_num == res.num and res_name == res.name:
                       skip = 0
               if skip:
                   continue</pre><br>
<pre style="margin: 0em;">               # Loop over the spins.
               for spin in res.spin:
                   # Skip the spin if there is no match to the selection.
                   skip = 1
                   for atom_num, atom_name in atom_iterator(selection):
                       if atom_num == spin.num and atom_name == spin.name:
                           skip = 0
                   if skip:
                       continue</pre><br>
<pre style="margin: 0em;">                   # Yield the spin system data container.
                   yield spin</pre><br>
<pre style="margin: 0em;"><br>This setup could possibly be more numerically efficient than say:</pre><br>
<pre style="margin: 0em;">   def spin_loop(selection=None):
       &quot;&quot;&quot;Function for selectively looping over all spins.&quot;&quot;&quot;</pre><br>
<pre style="margin: 0em;">       # Reassign the data container.
       data = self.relax.data[self.relax.run]</pre><br>
<pre style="margin: 0em;">       # Loop over the molecules.
       for mol in data.mol:
           # Loop over the residues.
           for res in mol.res:
               # Loop over the spins.
               for spin in res.spin:
                   # Skip the spin if there is no match to the selection.
                   skip = 1
                   for mol_name, res_num, res_name, atom_num,
atom_name in atom_iterator(selection):
                       if mol_name == mol.name and res_num == res.num
and res_name == res.name and atom_num == spin.num and atom_name ==
spin.name:
                           skip = 0
                   if skip:
                       continue</pre><br>
<pre style="margin: 0em;">                   # Yield the spin system data container.
                   yield spin</pre><br>
<pre style="margin: 0em;"><br>However rather than using a generator for the selection, maybe the
function 'is_selected' could be created:</pre><br>
<pre style="margin: 0em;">   def spin_loop(selection=None):
       &quot;&quot;&quot;Function for selectively looping over all spins.&quot;&quot;&quot;</pre><br>
<pre style="margin: 0em;">       # Reassign the data container.
       data = self.relax.data[self.relax.run]</pre><br>
<pre style="margin: 0em;">       # Loop over the molecules.
       for mol in data.mol:
           # Loop over the residues.
           for res in mol.res:
               # Loop over the spins.
               for spin in res.spin:
                   # Skip the spin if there is no match to the selection.
                   if not is_selected(selection, mol.name, res.num,
res.name, spin.num, spin.name):
                       continue</pre><br>
<pre style="margin: 0em;">                   # Yield the spin system data container.
                   yield spin</pre><br>
<pre style="margin: 0em;"><br>Edward</pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00036" href="msg00036.html">Re: Redesign of the relax data model: 3. Molecules, residues,	and spins</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00014" href="msg00014.html">re: Redesign of the relax data model: 3. Molecules, residues,	and spins</a></strong>
<ul><li><em>From:</em> gary thompson</li></ul></li>
<li><strong><a name="00021" href="msg00021.html">re: Redesign of the relax data model: 3. Molecules, residues,	and spins</a></strong>
<ul><li><em>From:</em> Chris MacRaild</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Jan 15 19:00:27 2007</div>  
</body>
</html>
