<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: Extremely long optimization times -->
<!--X-From-R13: Eronfgvra [beva <fronfgvra.zbeva.1Nhyniny.pn> -->
<!--X-Date: Mon, 17 Sep 2007 18:10:18 +0200 -->
<!--X-Message-Id: 46EEA6B2.90606@ulaval.ca -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 46DD5337.3020900@ulaval.ca -->
<!--X-Reference: 7f080ed10709140254q4cbe6b79qc124f9cc65e19f40@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Extremely long optimization times -- September 17, 2007 - 18:10</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: Extremely long optimization times</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00010" class="tabs">Index by Date</a> | <a href="threads.html#00010" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00009.html">Date Prev</a>] [<a href="msg00011.html">Date Next</a>] [<a href="msg00006.html">Thread Prev</a>] [<a href="msg00015.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Edward d'Auvergne &lt;edward.dauvergne@xxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 17 Sep 2007 12:09:22 -0400</li>
<li class="menuitem">
<em>Cc</em>: relax-users@xxxxxxx</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00010.html">46EEA6B2.90606@ulaval.ca</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;46DD5337.3020900@xxxxxxxxx&gt;	&lt;7f080ed10709140254q4cbe6b79qc124f9cc65e19f40@xxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>User-agent</em>: Thunderbird 2.0.0.6 (X11/20070802)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Sebastien Morin</strong> on September 17, 2007 - 18:10:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#ffffff" style="background-color: #ffffff; color: #000000; "><font color="#000000">



<tt>Hi Ed,<br>
<br>
First, there were some bad assignments in my data set. I used the
automatic assignment (which takes an assigned peak list and propagates
it to other peak lists) procedure within NMRPipe for the first time and
some peaks were badly assigned.<br>
<br>
Second, the PDB file is quite good as it is a representative
conformation from a 60 ns MD simulation using CHARMM. That said, the
protein moves in the simulation and, hence, the orientations also
change. I could take another conformation, which is what I'll do to
cross-validate my models, but nevertheless the orientations will change
and subtil changes will appear. This shouldn't be an issue since the
vectors that move a lot in the simulations should have correlating
relaxation properties and that should be seen in the models chosen.<br>
<br>
Third, here are the stats for the ellipsoid optimization :<br>
<br>
round&nbsp; t_total_(h)&nbsp; t_opt_(h)&nbsp; iter_opt&nbsp; model_change&nbsp; tm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a&nbsp;&nbsp;&nbsp;&nbsp;
b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; g&nbsp; &nbsp; &nbsp; chi2&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; comments<br>
=====&nbsp; ===========&nbsp; =========&nbsp; ========&nbsp; ============&nbsp; ======&nbsp;&nbsp; ====&nbsp;
=====&nbsp; ====&nbsp;&nbsp; ==================&nbsp;&nbsp;&nbsp; =======================<br>
&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp; 146&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 144&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 207&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; --- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12.423 &nbsp; 18.8&nbsp;
159.7&nbsp; 99.1&nbsp;&nbsp; 9282.2280010132217&nbsp;&nbsp;&nbsp; ok<br>
&nbsp;2&nbsp;&nbsp; &nbsp;&nbsp; 49&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; 47&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 62&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; 215 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12.463 &nbsp; 74.7&nbsp;
152.0&nbsp; 94.3&nbsp;&nbsp; 8793.0777454789404&nbsp;&nbsp;&nbsp; ok<br>
&nbsp;3&nbsp;&nbsp; &nbsp;&nbsp; 16&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 14&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 19&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </tt><tt>16 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>12.448
&nbsp; 78.0&nbsp; 152.3&nbsp; 96.9&nbsp;&nbsp; 8767.5325004348124&nbsp;&nbsp;&nbsp; ok<br>
&nbsp;4&nbsp;&nbsp; &nbsp;&nbsp; 12&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 13&nbsp; &nbsp; &nbsp;&nbsp; </tt><tt>&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>12.445
&nbsp; 80.2&nbsp; 151.9&nbsp; 97.9&nbsp;&nbsp; 8765.5659442063006&nbsp;&nbsp;&nbsp; ok<br>
&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 19&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 17&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 23&nbsp; &nbsp; &nbsp;</tt><tt>&nbsp;&nbsp;&nbsp; 2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&nbsp;
12.445 &nbsp; 83.1&nbsp; 151.7&nbsp; 98.3&nbsp;&nbsp; 8761.0001889287214&nbsp;&nbsp;&nbsp; ok<br>
&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 23&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 27&nbsp; &nbsp; </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&nbsp;&nbsp;
12.452&nbsp;&nbsp; 80.9&nbsp; 151.4&nbsp; 96.2&nbsp;&nbsp; 8744.6870170285692&nbsp;&nbsp;&nbsp; ok<br>
&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 14&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 19&nbsp; &nbsp; &nbsp;</tt><tt>&nbsp;&nbsp;&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&nbsp;
12.445&nbsp;&nbsp; 83.1&nbsp; 151.7&nbsp; 98.3&nbsp;&nbsp; 8761.0001889287269&nbsp;&nbsp;&nbsp; almost_5<br>
&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 23&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 28&nbsp; &nbsp; </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&nbsp;&nbsp;
12.452&nbsp;&nbsp; 80.9&nbsp; 151.4&nbsp; 96.2&nbsp;&nbsp; 8744.6870170285729&nbsp;&nbsp;&nbsp; almost_6<br>
&nbsp;9&nbsp;&nbsp; &nbsp;&nbsp; 14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 17&nbsp; &nbsp; </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&nbsp;&nbsp;
12.445&nbsp;&nbsp; 83.1&nbsp; 151.7&nbsp; 98.3&nbsp;&nbsp; 8761.0001889287269&nbsp;&nbsp;&nbsp;
almost_5_and_exactly_7<br>
10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 29&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 33&nbsp; &nbsp; &nbsp;</tt><tt>&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&nbsp;
12.452&nbsp;&nbsp; 80.9&nbsp; 151.4&nbsp; 96.2&nbsp;&nbsp; 8744.6870170285656&nbsp;&nbsp;&nbsp; almost_6_and_8<br>
11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stopped...................................<br>
<br>
As you can see, there is a kind of interchange between two runs in the
end of the optimization. In fact, from the iteration 5 on, there is
only one residue for which the model is changing, it's always the same.
It changes from model 5 to 6 and 6 to 5... with a tf of ~17, a ts of
~25000 and a S2 of ~0.73 (chi2 ~40 in aic file, but then with ts ~
1200) when with model 6 and ts of ~650 and S2 of ~0.78 when with model 5</tt><tt>
(chi2 ~50 in aic file)</tt><tt>. How come a so high ts (25000) isn't
eliminated..?<br>
<br>
round&nbsp;&nbsp; AIC_or_OPT&nbsp; model&nbsp;&nbsp; S2&nbsp;&nbsp;&nbsp; S2f &nbsp; S2s &nbsp; tf &nbsp;&nbsp;&nbsp;&nbsp; ts &nbsp; &nbsp;&nbsp; chi2<br>
=====&nbsp;&nbsp; ==========&nbsp; =====&nbsp;&nbsp; ===&nbsp;&nbsp; ====&nbsp; ====&nbsp; ======&nbsp; ======&nbsp; =========<br>
&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AIC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.78&nbsp; 0.96&nbsp; 0.81&nbsp; None&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 698 &nbsp; 52<br>
10 &nbsp;&nbsp;&nbsp;&nbsp; AIC&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.78&nbsp; 0.97&nbsp; 0.80&nbsp; 11.2&nbsp;&nbsp;&nbsp;&nbsp; 1173&nbsp;&nbsp; 39<br>
&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OPT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.78&nbsp; 0.96&nbsp; 0.81&nbsp; None&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 630&nbsp;&nbsp; ---<br>
10 &nbsp;&nbsp;&nbsp;&nbsp; OPT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.73&nbsp; 0.93&nbsp; 0.79&nbsp; 16.8&nbsp;&nbsp;&nbsp; 24904&nbsp;&nbsp; ---<br>
<br>
<br>
Fourth, the previous runs were made on 4 different computers which give
almost exactly the same calculation time, maybe differing from 10-15
%... This shouldn't be what's causing those so extremely long times...<br>
<br>
Fifth, I used the default algorithm whithin the full_analysis.py
script. How can I change the optimization algorithm so it's a two stage
procedure like you proposed ? Should I run several times with MIN_ALGOR
= 'simplex' and, after a few runs (maybe when the chi2 and number of
iterations get to a plateau) switch to MIN_ALGOR = 'newton' ?<br>
<br>
I think that's almost everything I can find now...<br>
<br>
Let me know if you know how to catch those problems before they
appear...<br>
<br>
Cheers<br>
<br>
<br>
S&eacute;b&nbsp; :)<br>
<br>
<br>
<br>
<br>
</tt><br>
Edward d'Auvergne wrote:
<blockquote
 cite=""
 type="cite">
  <pre wrap="">Hi,

I've been trying to think of what could possibly be causing these
really long times, but I'm really not sure what is happening.
Unfortunately there just was not enough information in the post to
decipher the key to this problem.  Is there something special about
those 7 residues?  How accurate do you think their orientations are in
the PDB file you are using?  And how accurate is the PDB file itself
with respect to all parts of the system?

Have you had a chance to investigate further as to what the issue
might be?  For example, which part of the calculation is taking the
time?  Is it the global optimisation of all parameters?  Are the final
results of each round similar or completely different (selected model
wise and parameter value wise).  How do the iteration numbers compare
at each stage.  Essentially a fine analysis and comparison of the
results files and the printout from relax will be necessary to track
down this abnormal computation time.  Oh, are you running these on the
same computer as the previous analysis?

As for the optimisation algorithm being stuck, if you've used the
default algorithm then this shouldn't happen.  Optimisation should
terminate.  There are certain very rare situations where the algorithm
known as the GMW Hessian modification, which is used by default as a
subalgorithm by the Newton algorithm in relax, can take large amounts
of time to complete.  You'll see this as a increase in the number of
iterations by 4 to 5 orders of magnitude.  One way to test this is to
use a lower quality optimisation algorithm first and then complete to
high precision with the Newton algorithm.  In this case I would use
simplex first followed by the default Newton algorithm and its default
subalgorithms.  In all cases constraints should be used.  This will
only solve the long computation times if the GMW algorithm is at
fault.

Regards,

Edward


On 9/4/07, Sebastien Morin <a rel="nofollow" class="moz-txt-link-rfc2396E" href="mailto:sebastien.morin.1@xxxxxxxxx">&lt;sebastien.morin.1@xxxxxxxxx&gt;</a> wrote:
  </pre>
  <blockquote type="cite">
    <pre wrap="">Hi all,

I am using the full_analysis.py script with data a three magnetic fields.

After a first complete cycle (going through the final optimization), I
realized that a few residues had extremely high chi-squared values (&gt;
1000) no matter the diffusion model or model-free model chosen...

So I removed those residues (7 out of 222) and started the full_analysis
protocole again.

However, the optimization times are now extremely long and I should get
the final results in weeks...


Here are the available times (for local_tm, sphere and ellipsoid) :


Diffusion_model    Round      Time-before_N=222  X2
Time-now_N=215  X2
===============    =====      =================  =======
==============  =======
local_tm           ---          12h30              45949
14h30            5802    OK, X2 much smaller

sphere             init         ---              1154338        ---
      249255
                   1             2h30              65654        36h00
        10303    Long, but X2 much smaller
                   2             2h30              65654      &gt; 30h00

ellipsoid          init         ---               753535
---            177764
                   1             4h00              64592      &gt;
67h00                    ??
                   2             2h30              64592
not_there_yet

Is it possible that the algorithms get stuck somewhere during the
optimization..?

I thought that removing badly fit residues would, on the contrary, speed
up calculations...

Thanks for ideas !


S&eacute;bastien  :)

--
         ______________________________________
     _______________________________________________
    |                                               |
   || Sebastien Morin                               ||
  ||| Etudiant au PhD en biochimie                  |||
 |||| Laboratoire de resonance magnetique nucleaire ||||
||||| Dr Stephane Gagne                             |||||
 |||| CREFSIP (Universite Laval, Quebec, CANADA)    ||||
  ||| 1-418-656-2131 #4530                          |||
   ||                                               ||
    |_______________________________________________|
         ______________________________________



_______________________________________________
relax (<a rel="nofollow" class="moz-txt-link-freetext" href="http://nmr-relax.com">http://nmr-relax.com</a>)

This is the relax-users mailing list
<a rel="nofollow" class="moz-txt-link-abbreviated" href="mailto:relax-users@xxxxxxx">relax-users@xxxxxxx</a>

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a rel="nofollow" class="moz-txt-link-freetext" href="/mail.gna.org/listinfo/relax-users">https://mail.gna.org/listinfo/relax-users</a>

    </pre>
  </blockquote>
  <pre wrap=""><!---->

  </pre>
</blockquote>
<br>
<pre class="moz-signature" cols="72">-- 
         ______________________________________    
     _______________________________________________
    |                                               |
   || Sebastien Morin                               ||
  ||| Etudiant au PhD en biochimie                  |||
 |||| Laboratoire de resonance magnetique nucleaire ||||
||||| Dr Stephane Gagne                             |||||
 |||| CREFSIP (Universite Laval, Quebec, CANADA)    ||||
  ||| 1-418-656-2131 #4530                          |||
   ||                                               ||
    |_______________________________________________|
         ______________________________________    
</pre>


</font></td></tr></table>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00015" href="msg00015.html">Re: Extremely long optimization times</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00002" href="msg00002.html">Extremely long optimization times</a></strong>
<ul><li><em>From:</em> Sebastien Morin</li></ul></li>
<li><strong><a name="00006" href="msg00006.html">Re: Extremely long optimization times</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Sep 17 23:40:39 2007</div>  
</body>
</html>
