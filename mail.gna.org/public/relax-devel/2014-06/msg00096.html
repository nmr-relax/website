<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: r23735 &#45; /branches/disp_spin_speed/target_functions/relax_disp.py -->
<!--X-From-R13: "Sqjneq q'Ohiretar" &#60;rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Tue, 10 Jun 2014 13:45:36 +0200 -->
<!--X-Message-Id: CAED9pY9H1K1=OSD+9WzfTHHQnRc0o9Pc8J5V4Xe1ek3_iz7kuw@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1WthCq&#45;0008Ks&#45;3U@subversion.gna.org -->
<!--X-Reference: CAED9pY85vVgXxxNy6zFtWE8&#45;UHSuaogC9gn7KS5TgvjXfrXDOg@mail.gmail.com -->
<!--X-Reference: CA+CBx2NTPw8J+ries2M_vx2kNZztdkL+QP7ObOPHVtMs+_8nPg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: r23735 - /branches/disp_spin_speed/target_functions/relax_disp.py -- June 10, 2014 - 13:45</title>
<link rel="stylesheet" type="text/css" href="/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="https://gna.org/images/gna.theme/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re: r23735 - /branches/disp_spin_speed/target_functions/relax_disp.py</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00096" class="tabs">Index by Date</a> | <a href="threads.html#00096" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00095.html">Date Prev</a>] [<a href="msg00097.html">Date Next</a>] [<a href="msg00094.html">Thread Prev</a>] [<a href="msg00103.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Tue, 10 Jun 2014 13:45:04 +0200</li>
<li class="menuitem">
<em>Cc</em>: &quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113; h=mime-version:sender:in-reply-to:references:date:message-id:subject :from:to:cc:content-type:content-transfer-encoding; bh=zGWDSTyKR9c/jMcOnqZERB6C315ljm4uE9PyBoi1lxE=; b=Zyva/a8+jTnh+nVqp9E+o7DqY4HiKGOlnr+XNy47i4Gmh5sfGtLfe2XKMzOW3wdCho xjJj8Q9iCj0RkaXyQUdHKzx1MQ7DJUoyAga39Xa9uTHBv7w3/rjzYv3WvdGlaZMjI6yU P3uF5S7FLL28DXjbfDH/aIl7nC+ILiJVv4BA5VRtvY1mc4YlB0BKFg8kLDwrrwBOn7uC wP88e+l3SpIb708+ilqCSD7yu29KVtdoC3Q4g8WH9SvY01ABbPgNzrdq3kRwa7B9D3ej sF7qfHHwsT0j2aYJKfLmOM0Uoz2LSWrgWEfacNxnIUCq35j3oL4qji/rV+YH2E3D3oR3 1lsw==</li>
<li class="menuitem">
<em>Message-id</em>: &lt;CAED9pY9H1K1=OSD+9WzfTHHQnRc0o9Pc8J5V4Xe1ek3_iz7kuw@mail.gmail.com&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;E1WthCq-0008Ks-3U@subversion.gna.org&gt; &lt;<a href="msg00090.html">CAED9pY85vVgXxxNy6zFtWE8-UHSuaogC9gn7KS5TgvjXfrXDOg@mail.gmail.com</a>&gt; &lt;<a href="msg00094.html">CA+CBx2NTPw8J+ries2M_vx2kNZztdkL+QP7ObOPHVtMs+_8nPg@mail.gmail.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on June 10, 2014 - 13:45:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi,

I don't think you even need the pA array.  What is the variable
self.spins_a?  Simply try using pA directly.  Here is a demo:

&quot;&quot;&quot;
from numpy import array, float64, ones

a = ones(3)
pA = 0.9
pA_array = pA * a

b = array([1, 2, 3], float64)

print(&quot;\nFloat times array:&quot;)
print(repr(pA * b))
print(&quot;\nArray times array:&quot;)
print(repr(pA_array * b))
&quot;&quot;&quot;

If you run this, you will obtain the same result for both operations.
Is there a good reason, that I cannot see, why the second option is
required in the target functions?

Cheers,

Edward





On 10 June 2014 12:09, Troels Emtekær Linnet &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">You are Correct !!!

The final version is:
pA_arr = pA*self.spins_a

The &quot;trick&quot; was to make a numpy multi dimensional spin array in the
__init__ function of the class.

That is filled with 1.0 where there are dispersion points.

This array essential replace the spin looping!

Best
Troels




2014-06-10 11:56 GMT+02:00 Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt;:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi Troels,

From the dispersion equations, to me it looks like that you can keep
pA as a single value.  Why have you converted it to an array
structure?  You will have no problems as you can multiply any numpy
array with a single float.  This should be the same for all model
parameters, excluding dw and R20.  If you can use single values, that
should be much quicker for the target functions.

Regards,

Edward



On 8 June 2014 19:48,  &lt;tlinnet@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Author: tlinnet
Date: Sun Jun  8 19:48:31 2014
New Revision: 23735

URL: <a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax?rev=23735&amp;view=rev">http://svn.gna.org/viewcvs/relax?rev=23735&amp;view=rev</a>
Log:
Important fix for the creation of the multi dimensional pA numpy array.

It should be created as numpy.zeros([ei][si][mi][oi]) instead of 
numpy.ones([ei][si][mi][oi]).

This allows for rapid testing of all dimensions with np.allclose(pA, 
numpy.ones(dw.shape)).
pA can have missing filled out values, when the number of dispersion 
points are different
per spectrometer frequency.

Task #7807 (<a  rel="nofollow" href="https://gna.org/task/index.php?7807">https://gna.org/task/index.php?7807</a>): Speed-up of dispersion 
models for Clustered analysis.

Modified:
    branches/disp_spin_speed/target_functions/relax_disp.py

Modified: branches/disp_spin_speed/target_functions/relax_disp.py
URL: 
<a  rel="nofollow" href="http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/target_functions/relax_disp.py?rev=23735&amp;r1=23734&amp;r2=23735&amp;view=diff">http://svn.gna.org/viewcvs/relax/branches/disp_spin_speed/target_functions/relax_disp.py?rev=23735&amp;r1=23734&amp;r2=23735&amp;view=diff</a>
==============================================================================
--- branches/disp_spin_speed/target_functions/relax_disp.py     (original)
+++ branches/disp_spin_speed/target_functions/relax_disp.py     Sun Jun  
8 19:48:31 2014
@@ -411,7 +411,7 @@
             # The number of disp point can change per spectrometer, so 
we make the maximum size.
             self.R20A_a = np.ones(back_calc_shape + 
[self.max_num_disp_points])
             self.R20B_a = np.ones(back_calc_shape + 
[self.max_num_disp_points])
-            self.pA_a = np.ones(back_calc_shape + 
[self.max_num_disp_points])
+            self.pA_a = np.zeros(back_calc_shape + 
[self.max_num_disp_points])
             self.dw_frq_a = np.ones(back_calc_shape + 
[self.max_num_disp_points])
             self.kex_a = np.ones(back_calc_shape + 
[self.max_num_disp_points])
             self.cpmg_frqs_a = np.ones(back_calc_shape + 
[self.max_num_disp_points])


_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-commits mailing list
relax-commits@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-commits">https://mail.gna.org/listinfo/relax-commits</a>
</pre></blockquote><pre style="margin: 0em;">

_______________________________________________
relax (<a  rel="nofollow" href="http://www.nmr-relax.com">http://www.nmr-relax.com</a>)

This is the relax-devel mailing list
relax-devel@xxxxxxx

To unsubscribe from this list, get a password
reminder, or change your subscription options,
visit the list information page at
<a  rel="nofollow" href="https://mail.gna.org/listinfo/relax-devel">https://mail.gna.org/listinfo/relax-devel</a>
</pre></blockquote></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00103" href="msg00103.html">Re: r23735 - /branches/disp_spin_speed/target_functions/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00090" href="msg00090.html">Re: r23735 - /branches/disp_spin_speed/target_functions/relax_disp.py</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00094" href="msg00094.html">Re: r23735 - /branches/disp_spin_speed/target_functions/relax_disp.py</a></strong>
<ul><li><em>From:</em> Troels Emtekær Linnet</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer">You are on the <a href="http://gna.org">Gna!</a> mail server.</div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Tue Jun 10 14:40:10 2014</div>  
</body>
</html>
