<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: -->
<!--X-From-R13: "Sqjneq q'Ohiretar" <rqjneqNaze&#45;erynk.pbz> -->
<!--X-Date: Mon, 29 Nov 2010 17:31:47 +0100 -->
<!--X-Message-Id: AANLkTikJXjHf1SgDaZOkmO_urS&#45;mkt12fAaZrt3RvO8y@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: C499CEAA2FE47E4F8E5C154780A4767301269353A4@exch8.ads.bruker.de -->
<!--X-Reference: AANLkTi=j05Y_&#45;YWGrqhX_+qVmjtaP6tf_2+FKCN2hkwU@mail.gmail.com -->
<!--X-Reference: 4CE64610.7090706@bruker&#45;biospin.de -->
<!--X-Reference: AANLkTi=JRRcPNOf5B13=OCFT9GjnzNT_ejc8dYrbq5V4@mail.gmail.com -->
<!--X-Reference: 4CECDB61.4020801@bruker&#45;biospin.de -->
<!--X-Reference: AANLkTi=BTyS1W9kY5U63QyE=pemVNz6&#45;kg_=sWpfLqrX@mail.gmail.com -->
<!--X-Reference: 4CF39E0E.10306@bruker&#45;biospin.de -->
<!--X-Reference: AANLkTinyy6EyfLVt8kRjq+PfD3Y5E8fQ8mqe3rrbGfr4@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: -- November 29, 2010 - 17:31</title>
<link rel="stylesheet" type="text/css" href="/mail.gna.org/archives-color-gna.css"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<h2><img src="/mail.gna.org/images/mail.orig.png" width="48" height="48"
alt="mail" class="pageicon" />Re:</h2>
<br />
<div class="topmenu">
<a href="../" class="tabs">Others Months</a> | <a href="index.html#00028" class="tabs">Index by Date</a> | <a href="threads.html#00028" class="tabs">Thread Index</a><br />
<span class="smaller">&gt;&gt;&nbsp;&nbsp;
[<a href="msg00027.html">Date Prev</a>] [<a href="msg00029.html">Date Next</a>] [<a href="msg00027.html">Thread Prev</a>] [<a href="msg00029.html">Thread Next</a>]
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h3><a name="header" href="#header">Header</a></h3>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul class="headdata">
<li class="menuitem">
<em>To</em>: &quot;Dr. Klaus-Peter Neidig&quot; &lt;peter.neidig@xxxxxxxxxxxxxxxxx&gt;</li>
<li class="menuitem">
<em>Date</em>: Mon, 29 Nov 2010 17:31:35 +0100</li>
<li class="menuitem">
<em>Cc</em>: Neidig Klaus-Peter &lt;Klaus-Peter.Neidig@xxxxxxxxxxxxxxxxx&gt;,	&quot;relax-devel@xxxxxxx&quot; &lt;relax-devel@xxxxxxx&gt;</li>
<li class="menuitem">
<em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:mime-version:received:sender:received	:in-reply-to:references:date:x-google-sender-auth:message-id:subject	:from:to:cc:content-type:content-transfer-encoding;	bh=XeLnzDtKWwy3wDHDDkc2/YAudepBAlkBU9BIpmlxm84=;	b=vchuZGq9pP8ydYYt5ih700mQQgDBKvjkHWAvDBl78OWzz6d18l1+VPls/c7PVwElH8	CgRAI0KUJPc5pqx16qRb2Hwjfjg/WPfjJGwHtavSPc20QMNmBAR1aw08S1ex9OK9h8oA	olREbCIm3YOa2u3lqpNrla1IdN+SdavQM845s=</li>
<li class="menuitem">
<em>Message-id</em>: &lt;<a href="msg00028.html">AANLkTikJXjHf1SgDaZOkmO_urS-mkt12fAaZrt3RvO8y@mail.gmail.com</a>&gt;</li>
<li class="menuitem">
<em>References</em>: &lt;C499CEAA2FE47E4F8E5C154780A4767301269353A4@xxxxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTi=j05Y_-YWGrqhX_+qVmjtaP6tf_2+FKCN2hkwU@xxxxxxxxxxxxxx&gt;	&lt;4CE64610.7090706@xxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTi=JRRcPNOf5B13=OCFT9GjnzNT_ejc8dYrbq5V4@xxxxxxxxxxxxxx&gt;	&lt;4CECDB61.4020801@xxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTi=BTyS1W9kY5U63QyE=pemVNz6-kg_=sWpfLqrX@xxxxxxxxxxxxxx&gt;	&lt;4CF39E0E.10306@xxxxxxxxxxxxxxxxx&gt;	&lt;AANLkTinyy6EyfLVt8kRjq+PfD3Y5E8fQ8mqe3rrbGfr4@xxxxxxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div><!-- end headdata -->
<br />
<h3><a name="content" href="#content">Content</a></h3>
<div class="postedby">Posted by <strong>Edward d'Auvergne</strong> on November 29, 2010 - 17:31:</div>
<div class="msgdata">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Sorry, some of the links are dud!  The files are attached to the task
<a  rel="nofollow" href="https://gna.org/task/?7180">https://gna.org/task/?7180</a>.  You should be able to see which is which
in the comments section.

Regards,

Edward


On 29 November 2010 17:20, Edward d'Auvergne &lt;edward@xxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">Hi,

I have answered below:


On 29 November 2010 13:35, Dr. Klaus-Peter Neidig
&lt;peter.neidig@xxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote class="blockquote"><pre style="margin: 0em;">

Hi Edward,

after reading the mails again and checking the code again I think it would 
be good to do another cross-check,
perhaps best with an artificial example:

suppose we have mixing times   10, 10, 10 (3 replicates)
                               20
                               30, 30 (2 replicates)
                               40
                               50

and spectra with 3 peaks.

A:
I would take peak1, then check for the largest difference in intensity in 
the first 3 replicates and in the 2 replicates.
The largest found difference is then assigned as a systematic error to 
peak1 at all mixing times.
</pre></blockquote><pre style="margin: 0em;">

Is an absolute value is used for finding the maximum difference?  So
say in the mixing time of 10, the intensities are 1, 4, 2 so the max
difference is 3.  And in the 30 has intensities of 0.9 and 3.  So the
error of peak 1 would be 3.  Is this correct?


</pre><blockquote class="blockquote"><pre style="margin: 0em;">The procedure is repeated for peak2 and peak3.  Most likely peak1, peak2 
and peak3 then have different systematic
errors. That would be like a worst case scenario per peak and is what 
currently was active in the PDC.
</pre></blockquote><pre style="margin: 0em;">

Oh, this is different to what I though was happening.  I assumed that
this value was averaged, or the maximum of peaks 1, 2, and 3 was taken
as the error for all peaks.  This would probably result in very noisy
error estimates as the amount of error sampling is only 2 (in this
case).  This will also overestimate the error.  I can set up a test to
see what happens.  I am using a Gaussian centered at 20 with a
standard deviation of 1.  I take 2 points (peak intensities from
duplicated spectra) randomly from the distribution and calculate the
difference.  This is then repeated N times (number of duplicated
spectra) and the maximum difference is taken.  I repeat this M times
for determining some stats, where M = 1e6.  The average error estimate
is:

N = 2, ave(error) = 1.594
N = 3, ave(error) = 1.875
N = 4, ave(error) = 2.070
N = 5, ave(error) = 2.221
N = 6, ave(error) = 2.339
N = 100, ave(error) = 3.884

N = 2, sd(error) = 0.852
N = 3, sd(error) = 0.829
N = 4, sd(error) = 0.806
N = 5, sd(error) = 0.786
N = 6, sd(error) = 0.770
N = 100, sd(error) = 0.566


These are all log-normal distributions.  As you can see, the error
estimate is always on average overestimated, and the more duplicated
spectra N, the worse this becomes.  The spread of values is also a
worry.  With 3 duplicated spectra, the resultant errors are  1.875 +/-
0.829 which means that the error estimates are all over the place.
The perfect estimate would be 1.000 +/- 0.000, as the sd is exactly 1.
 The Python script, an xmgrace, and a PS plot for N=3 can be found at
<a  rel="nofollow" href="https://gna.org/task/index.php#comment1">https://gna.org/task/index.php#comment1</a>.

Does this test match the technique that the PDC uses?  Of course,
there could be a bug in my script
(<a  rel="nofollow" href="https://gna.org/support/download.php?file_id=11436">https://gna.org/support/download.php?file_id=11436</a>)!


</pre><blockquote class="blockquote"><pre style="margin: 0em;">B:
The absolute worst scenario would be  to check for the largest ever 
ocuring difference and assign that to all
3 peaks at all mixing times. This we used in earlier versions of the PDC.
</pre></blockquote><pre style="margin: 0em;">

In this case there is no sd(error).  So using 100 peaks and repeating
the calculation a number of times:

[edau@localhost peak_intensity_errors]$ python sampling_test2.py
N = 2, error = 5.005
N = 3, error = 4.485
N = 4, error = 3.863
N = 5, error = 4.268
N = 6, error = 5.392
N = 100, error = 5.353
[edau@localhost peak_intensity_errors]$ python sampling_test2.py
N = 2, error = 4.161
N = 3, error = 4.056
N = 4, error = 5.135
N = 5, error = 3.890
N = 6, error = 4.412
N = 100, error = 5.469
[edau@localhost peak_intensity_errors]$ python sampling_test2.py
N = 2, error = 3.550
N = 3, error = 4.184
N = 4, error = 4.574
N = 5, error = 4.182
N = 6, error = 5.080
N = 100, error = 5.973
[edau@localhost peak_intensity_errors]$ python sampling_test2.py
N = 2, error = 4.549
N = 3, error = 3.824
N = 4, error = 5.337
N = 5, error = 4.507
N = 6, error = 4.113
N = 100, error = 6.410
[edau@localhost peak_intensity_errors]$ python sampling_test2.py
N = 2, error = 3.966
N = 3, error = 4.667
N = 4, error = 4.770
N = 5, error = 4.708
N = 6, error = 5.058
N = 100, error = 5.607


The Python script for this is attached at
<a  rel="nofollow" href="https://gna.org/task/index.php?7180#comment2">https://gna.org/task/index.php?7180#comment2</a>.  This technique always
overestimates the value of 1 and is hyper-variable, but increasing
with increasing number of duplicated time points.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">C:
Your variance averaging would work as follows:
loop over the first 3 replicates, calculate variance for each peak
loop over the 2 replicates, calculate variance for each peak
finally take the average over 6 variances and assign this as a systematic 
error to all peaks at all mixing times
Is this correct ?
</pre></blockquote><pre style="margin: 0em;">

This is correct.  Using 100 peaks, duplicates for 1 time point
(ignoring the multiple relaxation periods for now), and M = 1e6 for
some stats on the error estimate, the results are:

ave(error) = 0.998
sd(error) = 0.071

This is for Gaussians of mu = 20 and sigma = 1.  As you can see, the
standard deviation of 1 is nicely estimated (plus and minus 0.071 for
different attempts).  This is the best error estimate.  The Python
script is at <a  rel="nofollow" href="https://gna.org/task/index.php#comment3">https://gna.org/task/index.php#comment3</a>.  The PS plot is
at <a  rel="nofollow" href="https://gna.org/task/download.php?file_id=11442">https://gna.org/task/download.php?file_id=11442</a>.

If we now extend this to multiple relaxation periods, that would be
equivalent to M ~= 10 but with variance averaging rather than sd
averaging.  The error estimate would not be as good as 0.998 but the
more replicated spectra, the closer the estimate will be to the real
value.


</pre><blockquote class="blockquote"><pre style="margin: 0em;">I think A: and C: should be offered. After implementing this I see my data 
that the C: produces much larger
errors than A and the errors of the fitted parameters get much larger, 
sometimes larger than the values itself.
This seems not acceptable.
</pre></blockquote><pre style="margin: 0em;">

From my tests, the errors should be bigger with the A procedure.  This
is strange!  It might be worth seeing if the C procedure
implementation matches that in
<a  rel="nofollow" href="https://gna.org/support/download.php?file_id=11440">https://gna.org/support/download.php?file_id=11440</a>.  I may have also
have made a mistake within the logic of these testing scripts!


</pre><blockquote class="blockquote"><pre style="margin: 0em;">In the mean I also spoke to Wolfgang Bermel. My statement that peaks with 
longer T2 seem to very more
in replicates is not obvious to him. When looking to the data it turned 
out that I had looked at peaks that do
not only have longer T2 but also have larger resonance offsets. Wolfgang 
suspects that their might be an
offset effect.

The statement that spectra taken at longer mixing times show a lower base 
plane noise seems to be not true
in general. The trend I have seen in one of the spectra is not fully 
convincing so we checked a couple of other
spectra all taken with the latest release pulse programs. With those data 
we would not really confirm the trend.
We concluded to have an eye on that from now on.
</pre></blockquote><pre style="margin: 0em;">

Ah, I remember also talking to him at ICMRBS 2008 about this and he
said the same.  The single scan interleaving might have fixed this.
Maybe it was an old sample heating problem in the R2 that I
remembered.  Or maybe the problem was that I measured on a Varian
machine ;)  But thanks for asking.  I am continually asking if people
see this.  Some do, and some don't, but it's hard to tell what is
happening.

Cheers,

Edward

</pre></blockquote><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div><!-- end msgdata -->
<br />
<h3><a name="related" href="#related">Related Messages</a></h3>
<div class="relateddata">
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00003" href="msg00003.html">[no subject]</a></strong>
<ul><li><em>From:</em> Neidig Klaus-Peter</li></ul></li>
<li><strong><a name="00004" href="msg00004.html">Re:</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00005" href="msg00005.html">Re:</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
<li><strong><a name="00007" href="msg00007.html">Re:</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00013" href="msg00013.html">Re:</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
<li><strong><a name="00014" href="msg00014.html">Re:</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
<li><strong><a name="00021" href="msg00021.html">Re:</a></strong>
<ul><li><em>From:</em> Dr. Klaus-Peter Neidig</li></ul></li>
<li><strong><a name="00027" href="msg00027.html">Re:</a></strong>
<ul><li><em>From:</em> Edward d'Auvergne</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
</div><!-- end relateddata -->
<!-- NoBotLinksApartFromRelatedMessages -->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<div class="footer"></div><br />
<div class="right">Powered by <a href="http://www.mhonarc.org">MHonArc</a>, Updated Mon Nov 29 21:20:16 2010</div>  
</body>
</html>
